(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,626698,e=>{"use strict";let t,i,r,a;e.s(["VideoPlayer",()=>_r],626698);var n=e.i(843476),s=e.i(881933),o=e.i(271645),l=Object.create,d=Object.defineProperty,u=Object.getOwnPropertyDescriptor,h=Object.getOwnPropertyNames,c=Object.getPrototypeOf,m=Object.prototype.hasOwnProperty,f=function(e,t){return function(){return e&&(t=e(e=0)),t}},p=function(e,t){return function(){return t||e((t={exports:{}}).exports,t),t.exports}},g=function(e,t,i,r){if(t&&"object"==typeof t||"function"==typeof t)for(var a,n=h(t),s=0,o=n.length;s<o;s++)a=n[s],m.call(e,a)||a===i||d(e,a,{get:(function(e){return t[e]}).bind(null,a),enumerable:!(r=u(t,a))||r.enumerable});return e},E=function(e,t,i){return i=null!=e?l(c(e)):{},g(!t&&e&&e.__esModule?i:d(i,"default",{value:e,enumerable:!0}),e)},y=p(function(t,i){i.exports="undefined"!=typeof window?window:e.g});function b(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):b(e,t)}var T=f(function(){T()});function _(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}var A=f(function(){}),S=p(function(e,t){var i=Array.prototype.slice;t.exports=function(e,t){for(("length"in e)||(e=[e]),e=i.call(e);e.length;){var r=e.shift(),a=t(r);if(a)return a;r.childNodes&&r.childNodes.length&&(e=i.call(r.childNodes).concat(e))}}}),I=p(function(e,t){function i(e,t){if(!b(this,i))return new i(e,t);this.data=e,this.nodeValue=e,this.length=e.length,this.ownerDocument=t||null}T(),t.exports=i,i.prototype.nodeType=8,i.prototype.nodeName="#comment",i.prototype.toString=function(){return"[object Comment]"}}),R=p(function(e,t){function i(e,t){if(!b(this,i))return new i(e);this.data=e||"",this.length=this.data.length,this.ownerDocument=t||null}T(),t.exports=i,i.prototype.type="DOMTextNode",i.prototype.nodeType=3,i.prototype.nodeName="#text",i.prototype.toString=function(){return this.data},i.prototype.replaceData=function(e,t,i){var r=this.data,a=r.substring(0,e),n=r.substring(e+t,r.length);this.data=a+i+n,this.length=this.data.length}}),k=p(function(e,t){t.exports=function(e){var t=this,i=e.type;e.target||(e.target=t),t.listeners||(t.listeners={});var r=t.listeners[i];if(r)return r.forEach(function(i){e.currentTarget=t,"function"==typeof i?i(e):i.handleEvent(e)});t.parentNode&&t.parentNode.dispatchEvent(e)}}),L=p(function(e,t){t.exports=function(e,t){this.listeners||(this.listeners={}),this.listeners[e]||(this.listeners[e]=[]),-1===this.listeners[e].indexOf(t)&&this.listeners[e].push(t)}}),D=p(function(e,t){t.exports=function(e,t){if(this.listeners&&this.listeners[e]){var i=this.listeners[e],r=i.indexOf(t);-1!==r&&i.splice(r,1)}}}),w=p(function(e,t){A(),t.exports=function e(t){switch(t.nodeType){case 3:return a(t.data);case 8:return"<!--"+t.data+"-->";default:var n,s,o;return s=[],o=(n=t).tagName,"http://www.w3.org/1999/xhtml"===n.namespaceURI&&(o=o.toLowerCase()),s.push("<"+o+function(e){var t=[];for(var i in e)(function(e,t){var i=_(e[t]);return"style"===t&&Object.keys(e.style).length>0||e.hasOwnProperty(t)&&("string"===i||"boolean"===i||"number"===i)&&"nodeName"!==t&&"className"!==t&&"tagName"!==t&&"textContent"!==t&&"innerText"!==t&&"namespaceURI"!==t&&"innerHTML"!==t})(e,i)&&t.push({name:i,value:e[i]});for(var a in e._attributes)for(var n in e._attributes[a]){var s=e._attributes[a][n],o=(s.prefix?s.prefix+":":"")+n;t.push({name:o,value:s.value})}return e.className&&t.push({name:"class",value:e.className}),t.length?r(t):""}(n)+function(e){var t=e.dataset,i=[];for(var a in t)i.push({name:"data-"+a,value:t[a]});return i.length?r(i):""}(n)),i.indexOf(o)>-1?s.push(" />"):(s.push(">"),n.childNodes.length?s.push.apply(s,n.childNodes.map(e)):n.textContent||n.innerText?s.push(a(n.textContent||n.innerText)):n.innerHTML&&s.push(n.innerHTML),s.push("</"+o+">")),s.join("")}};var i=["area","base","br","col","embed","hr","img","input","keygen","link","menuitem","meta","param","source","track","wbr"];function r(e){var t=[];return e.forEach(function(e){var i=e.name,r=e.value;"style"===i&&(r=function(e){if("string"==typeof e)return e;var t="";return Object.keys(e).forEach(function(i){var r=e[i];i=i.replace(/[A-Z]/g,function(e){return"-"+e.toLowerCase()}),t+=i+":"+r+";"}),t}(r)),t.push(i+'="'+a(r).replace(/"/g,"&quot;")+'"')}),t.length?" "+t.join(" "):""}function a(e){var t="";return"string"==typeof e?t=e:e&&(t=e.toString()),t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}}),C=p(function(e,t){T();var i=S(),r=k(),a=L(),n=D(),s=w(),o="http://www.w3.org/1999/xhtml";function l(e,t,i){if(!b(this,l))return new l(e);var r=void 0===i?o:i||null;this.tagName=r===o?String(e).toUpperCase():e,this.nodeName=this.tagName,this.className="",this.dataset={},this.childNodes=[],this.parentNode=null,this.style={},this.ownerDocument=t||null,this.namespaceURI=r,this._attributes={},"INPUT"===this.tagName&&(this.type="text")}t.exports=l,l.prototype.type="DOMElement",l.prototype.nodeType=1,l.prototype.appendChild=function(e){return e.parentNode&&e.parentNode.removeChild(e),this.childNodes.push(e),e.parentNode=this,e},l.prototype.replaceChild=function(e,t){e.parentNode&&e.parentNode.removeChild(e);var i=this.childNodes.indexOf(t);return t.parentNode=null,this.childNodes[i]=e,e.parentNode=this,t},l.prototype.removeChild=function(e){var t=this.childNodes.indexOf(e);return this.childNodes.splice(t,1),e.parentNode=null,e},l.prototype.insertBefore=function(e,t){e.parentNode&&e.parentNode.removeChild(e);var i=null==t?-1:this.childNodes.indexOf(t);return i>-1?this.childNodes.splice(i,0,e):this.childNodes.push(e),e.parentNode=this,e},l.prototype.setAttributeNS=function(e,t,i){var r=null,a=t,n=t.indexOf(":");(n>-1&&(r=t.substr(0,n),a=t.substr(n+1)),"INPUT"===this.tagName&&"type"===t)?this.type=i:(this._attributes[e]||(this._attributes[e]={}))[a]={value:i,prefix:r}},l.prototype.getAttributeNS=function(e,t){var i=this._attributes[e],r=i&&i[t]&&i[t].value;return"INPUT"===this.tagName&&"type"===t?this.type:"string"!=typeof r?null:r},l.prototype.removeAttributeNS=function(e,t){var i=this._attributes[e];i&&delete i[t]},l.prototype.hasAttributeNS=function(e,t){var i=this._attributes[e];return!!i&&t in i},l.prototype.setAttribute=function(e,t){return this.setAttributeNS(null,e,t)},l.prototype.getAttribute=function(e){return this.getAttributeNS(null,e)},l.prototype.removeAttribute=function(e){return this.removeAttributeNS(null,e)},l.prototype.hasAttribute=function(e){return this.hasAttributeNS(null,e)},l.prototype.removeEventListener=n,l.prototype.addEventListener=a,l.prototype.dispatchEvent=r,l.prototype.focus=function(){},l.prototype.toString=function(){return s(this)},l.prototype.getElementsByClassName=function(e){var t=e.split(" "),r=[];return i(this,function(e){if(1===e.nodeType){var i=(e.className||"").split(" ");t.every(function(e){return -1!==i.indexOf(e)})&&r.push(e)}}),r},l.prototype.getElementsByTagName=function(e){e=e.toLowerCase();var t=[];return i(this.childNodes,function(i){1===i.nodeType&&("*"===e||i.tagName.toLowerCase()===e)&&t.push(i)}),t},l.prototype.contains=function(e){return i(this,function(t){return e===t})||!1}}),M=p(function(e,t){T();var i=C();function r(e){if(!b(this,r))return new r;this.childNodes=[],this.parentNode=null,this.ownerDocument=e||null}t.exports=r,r.prototype.type="DocumentFragment",r.prototype.nodeType=11,r.prototype.nodeName="#document-fragment",r.prototype.appendChild=i.prototype.appendChild,r.prototype.replaceChild=i.prototype.replaceChild,r.prototype.removeChild=i.prototype.removeChild,r.prototype.toString=function(){return this.childNodes.map(function(e){return String(e)}).join("")}}),O=p(function(e,t){function i(e){}t.exports=i,i.prototype.initEvent=function(e,t,i){this.type=e,this.bubbles=t,this.cancelable=i},i.prototype.preventDefault=function(){}}),P=p(function(e,t){T();var i=S(),r=I(),a=R(),n=C(),s=M(),o=O(),l=k(),d=L(),u=D();function h(){if(!b(this,h))return new h;this.head=this.createElement("head"),this.body=this.createElement("body"),this.documentElement=this.createElement("html"),this.documentElement.appendChild(this.head),this.documentElement.appendChild(this.body),this.childNodes=[this.documentElement],this.nodeType=9}t.exports=h;var c=h.prototype;c.createTextNode=function(e){return new a(e,this)},c.createElementNS=function(e,t){return new n(t,this,null===e?null:String(e))},c.createElement=function(e){return new n(e,this)},c.createDocumentFragment=function(){return new s(this)},c.createEvent=function(e){return new o(e)},c.createComment=function(e){return new r(e,this)},c.getElementById=function(e){return e=String(e),i(this.childNodes,function(t){if(String(t.id)===e)return t})||null},c.getElementsByClassName=n.prototype.getElementsByClassName,c.getElementsByTagName=n.prototype.getElementsByTagName,c.contains=n.prototype.contains,c.removeEventListener=u,c.addEventListener=d,c.dispatchEvent=l}),x=p(function(e,t){t.exports=new(P())}),N=p(function(t,i){var r,a=e.g,n=x();"undefined"!=typeof document?r=document:(r=a["__GLOBAL_DOCUMENT_CACHE@4"])||(r=a["__GLOBAL_DOCUMENT_CACHE@4"]=n),i.exports=r});function U(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=Array(t);i<t;i++)r[i]=e[i];return r}function F(e,t){if(e){if("string"==typeof e)return U(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if("Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i)return Array.from(i);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return U(e,t)}}function B(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var i=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=i){var r,a,n=[],s=!0,o=!1;try{for(i=i.call(e);!(s=(r=i.next()).done)&&(n.push(r.value),!(t&&n.length===t));s=!0);}catch(e){o=!0,a=e}finally{try{s||null==i.return||i.return()}finally{if(o)throw a}}return n}}(e,t)||F(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var H=E(y()),G=E(y()),K=E(y()),V={now:function(){var e=K.default.performance,t=e&&e.timing,i=t&&t.navigationStart;return Math.round("number"==typeof i&&"function"==typeof e.now?i+e.now():Date.now())}},W=function(){if("function"==typeof(null==(e=G.default.crypto)?void 0:e.getRandomValues)){i=new Uint8Array(32),G.default.crypto.getRandomValues(i);for(var e,t,i,r=0;r<32;r++)i[r]=i[r]%16}else{i=[];for(var a=0;a<32;a++)i[a]=16*Math.random()|0}var n=0;t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t="x"===e?i[n]:3&i[n]|8;return n++,t.toString(16)});var s=V.now(),o=null==s?void 0:s.toString(16).substring(3);return o?t.substring(0,28)+o:t},q=function(){return("000000"+(0x81bf1000*Math.random()|0).toString(36)).slice(-6)},Y=function(e){var t;if(e&&void 0!==e.nodeName)return e.muxId||(e.muxId=q()),e.muxId;try{t=document.querySelector(e)}catch(e){}return t&&!t.muxId&&(t.muxId=e),(null==t?void 0:t.muxId)||e},j=function(e){e&&void 0!==e.nodeName?e=Y(t=e):t=document.querySelector(e);var t,i=t&&t.nodeName?t.nodeName.toLowerCase():"";return[t,e,i]};function Q(e){return function(e){if(Array.isArray(e))return U(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||F(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var z={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4},X=function(e){var t,i,r,a,n,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,o=e?[console,e]:[console],l=(t=console.trace).bind.apply(t,Q(o)),d=(i=console.info).bind.apply(i,Q(o)),u=(r=console.debug).bind.apply(r,Q(o)),h=(a=console.warn).bind.apply(a,Q(o)),c=(n=console.error).bind.apply(n,Q(o)),m=s;return{trace:function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];if(!(m>z.TRACE))return l.apply(void 0,Q(t))},debug:function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];if(!(m>z.DEBUG))return u.apply(void 0,Q(t))},info:function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];if(!(m>z.INFO))return d.apply(void 0,Q(t))},warn:function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];if(!(m>z.WARN))return h.apply(void 0,Q(t))},error:function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];if(!(m>z.ERROR))return c.apply(void 0,Q(t))},get level(){return m},set level(v){v!==this.level&&(m=null!=v?v:s)}}}("[mux]"),Z=E(y());function J(){return"1"===(Z.default.doNotTrack||Z.default.navigator&&Z.default.navigator.doNotTrack)}function $(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ee(e,t){if(!b(e,t))throw TypeError("Cannot call a class as a function")}function et(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ei(e,t,i){return t&&et(e.prototype,t),i&&et(e,i),e}function er(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function ea(e){return(ea=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function en(e,t,i){return(en="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ea(e)););return e}(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(i||e):a.value}})(e,t,i||e)}function es(e,t){return(es=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}T(),A();var eo=function(e){return el(e)[0]},el=function(e){if("string"!=typeof e||""===e)return["localhost"];var t,i=(e.match(/^(([^:\/?#]+):)?(\/\/([^\/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/)||[])[4];return i&&(t=(i.match(/[^\.]+\.[^\.]+$/)||[])[0]),[i,t]},ed=E(y()),eu={exists:function(){var e=ed.default.performance;return void 0!==(e&&e.timing)},domContentLoadedEventEnd:function(){var e=ed.default.performance,t=e&&e.timing;return t&&t.domContentLoadedEventEnd},navigationStart:function(){var e=ed.default.performance,t=e&&e.timing;return t&&t.navigationStart}};function eh(e,t,i){i=void 0===i?1:i,e[t]=e[t]||0,e[t]+=i}function ec(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{},r=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(i).filter(function(e){return Object.getOwnPropertyDescriptor(i,e).enumerable}))),r.forEach(function(t){er(e,t,i[t])})}return e}function em(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):(function(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);i.push.apply(i,r)}return i})(Object(t)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(t,i))}),e}var ef=["x-request-id","cf-ray","x-amz-cf-id","x-akamai-request-id"],ep=["x-cdn","content-type"].concat(ef);function eg(e){var t={};return(e=e||"").trim().split(/[\r\n]+/).forEach(function(e){if(e){var i=e.split(": "),r=i.shift();r&&(ep.indexOf(r.toLowerCase())>=0||0===r.toLowerCase().indexOf("x-litix-"))&&(t[r]=i.join(": "))}}),t}function ev(e){if(e){var t=ef.find(function(t){return void 0!==e[t]});return t?e[t]:void 0}}var eE=function(e){var t={};for(var i in e){var r=e[i];-1!==r["DATA-ID"].search("io.litix.data.")&&(t[r["DATA-ID"].replace("io.litix.data.","")]=r.VALUE)}return t},ey=function(e){if(!e)return{};var t=eu.navigationStart(),i=e.loading,r=i?i.start:e.trequest,a=i?i.first:e.tfirst,n=i?i.end:e.tload;return{bytesLoaded:e.total,requestStart:Math.round(t+r),responseStart:Math.round(t+a),responseEnd:Math.round(t+n)}},eb=function(e){if(!(!e||"function"!=typeof e.getAllResponseHeaders))return eg(e.getAllResponseHeaders())},eT=function(e,t,i){arguments.length>3&&void 0!==arguments[3]&&arguments[3];var r=arguments.length>4?arguments[4]:void 0,a=e.log,n=e.utils.secondsToMs,s=function(e){var t,i=parseInt(r.version);return 1===i&&null!==e.programDateTime&&(t=e.programDateTime),0===i&&null!==e.pdt&&(t=e.pdt),t};if(!eu.exists())return void a.warn("performance timing not supported. Not tracking HLS.js.");var o=function(i,r){return e.emit(t,i,r)},l=function(e,t){var i=t.levels,r=t.audioTracks,a=t.url,n=t.stats,s=t.networkDetails,l=t.sessionData,d={},u={};i.forEach(function(e,t){d[t]={width:e.width,height:e.height,bitrate:e.bitrate,attrs:e.attrs}}),r.forEach(function(e,t){u[t]={name:e.name,language:e.lang,bitrate:e.bitrate}});var h=ey(n),c=h.bytesLoaded,m=h.requestStart,f=h.responseStart,p=h.responseEnd;o("requestcompleted",em(ec({},eE(l)),{request_event_type:e,request_bytes_loaded:c,request_start:m,request_response_start:f,request_response_end:p,request_type:"manifest",request_hostname:eo(a),request_response_headers:eb(s),request_rendition_lists:{media:d,audio:u,video:{}}}))};i.on(r.Events.MANIFEST_LOADED,l);var d=function(e,t){var i=t.details,r=t.level,a=t.networkDetails,l=ey(t.stats),d=l.bytesLoaded,u=l.requestStart,h=l.responseStart,c=l.responseEnd,m=i.fragments[i.fragments.length-1],f=s(m)+n(m.duration);o("requestcompleted",{request_event_type:e,request_bytes_loaded:d,request_start:u,request_response_start:h,request_response_end:c,request_current_level:r,request_type:"manifest",request_hostname:eo(i.url),request_response_headers:eb(a),video_holdback:i.holdBack&&n(i.holdBack),video_part_holdback:i.partHoldBack&&n(i.partHoldBack),video_part_target_duration:i.partTarget&&n(i.partTarget),video_target_duration:i.targetduration&&n(i.targetduration),video_source_is_live:i.live,player_manifest_newest_program_time:isNaN(f)?void 0:f})};i.on(r.Events.LEVEL_LOADED,d);var u=function(e,t){var i=t.details,r=t.networkDetails,a=ey(t.stats);o("requestcompleted",{request_event_type:e,request_bytes_loaded:a.bytesLoaded,request_start:a.requestStart,request_response_start:a.responseStart,request_response_end:a.responseEnd,request_type:"manifest",request_hostname:eo(i.url),request_response_headers:eb(r)})};i.on(r.Events.AUDIO_TRACK_LOADED,u);var h=function(e,t){var r=t.stats,a=t.networkDetails,n=t.frag,s=ey(r=r||n.stats),l=s.bytesLoaded,d=s.requestStart,u=s.responseStart,h=s.responseEnd,c=a?eb(a):void 0,m={request_event_type:e,request_bytes_loaded:l,request_start:d,request_response_start:u,request_response_end:h,request_hostname:a?eo(a.responseURL):void 0,request_id:c?ev(c):void 0,request_response_headers:c,request_media_duration:n.duration,request_url:null==a?void 0:a.responseURL};"main"===n.type?(m.request_type="media",m.request_current_level=n.level,m.request_video_width=(i.levels[n.level]||{}).width,m.request_video_height=(i.levels[n.level]||{}).height,m.request_labeled_bitrate=(i.levels[n.level]||{}).bitrate):m.request_type=n.type,o("requestcompleted",m)};i.on(r.Events.FRAG_LOADED,h);var c=function(e,t){var i=t.frag,r=i.start;o("fragmentchange",{currentFragmentPDT:s(i),currentFragmentStart:n(r)})};i.on(r.Events.FRAG_CHANGED,c);var m=function(e,t){var i,a=t.type,n=t.details,s=t.response,l=t.fatal,d=t.frag,u=t.networkDetails,h=(null==d?void 0:d.url)||t.url||"",c=u?eb(u):void 0;(n===r.ErrorDetails.MANIFEST_LOAD_ERROR||n===r.ErrorDetails.MANIFEST_LOAD_TIMEOUT||n===r.ErrorDetails.FRAG_LOAD_ERROR||n===r.ErrorDetails.FRAG_LOAD_TIMEOUT||n===r.ErrorDetails.LEVEL_LOAD_ERROR||n===r.ErrorDetails.LEVEL_LOAD_TIMEOUT||n===r.ErrorDetails.AUDIO_TRACK_LOAD_ERROR||n===r.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT||n===r.ErrorDetails.SUBTITLE_LOAD_ERROR||n===r.ErrorDetails.SUBTITLE_LOAD_TIMEOUT||n===r.ErrorDetails.KEY_LOAD_ERROR||n===r.ErrorDetails.KEY_LOAD_TIMEOUT)&&o("requestfailed",{request_error:n,request_url:h,request_hostname:eo(h),request_id:c?ev(c):void 0,request_type:n===r.ErrorDetails.FRAG_LOAD_ERROR||n===r.ErrorDetails.FRAG_LOAD_TIMEOUT?"media":n===r.ErrorDetails.AUDIO_TRACK_LOAD_ERROR||n===r.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT?"audio":n===r.ErrorDetails.SUBTITLE_LOAD_ERROR||n===r.ErrorDetails.SUBTITLE_LOAD_TIMEOUT?"subtitle":n===r.ErrorDetails.KEY_LOAD_ERROR||n===r.ErrorDetails.KEY_LOAD_TIMEOUT?"encryption":"manifest",request_error_code:null==s?void 0:s.code,request_error_text:null==s?void 0:s.text}),l&&o("error",{player_error_code:a,player_error_message:n,player_error_context:"".concat(h?"url: ".concat(h,"\n"):"")+"".concat(s&&(s.code||s.text)?"response: ".concat(s.code,", ").concat(s.text,"\n"):"")+"".concat(t.reason?"failure reason: ".concat(t.reason,"\n"):"")+"".concat(t.level?"level: ".concat(t.level,"\n"):"")+"".concat(t.parent?"parent stream controller: ".concat(t.parent,"\n"):"")+"".concat(t.buffer?"buffer length: ".concat(t.buffer,"\n"):"")+"".concat(t.error?"error: ".concat(t.error,"\n"):"")+"".concat(t.event?"event: ".concat(t.event,"\n"):"")+"".concat(t.err?"error message: ".concat(null==(i=t.err)?void 0:i.message,"\n"):"")})};i.on(r.Events.ERROR,m);var f=function(e,t){var i=t.frag,r=i&&i._url||"";o("requestcanceled",{request_event_type:e,request_url:r,request_type:"media",request_hostname:eo(r)})};i.on(r.Events.FRAG_LOAD_EMERGENCY_ABORTED,f);var p=function(e,t){var r=t.level,n=i.levels[r];if(n&&n.attrs&&n.attrs.BANDWIDTH){var s,l=n.attrs.BANDWIDTH,d=parseFloat(n.attrs["FRAME-RATE"]);isNaN(d)||(s=d),l?o("renditionchange",{video_source_fps:s,video_source_bitrate:l,video_source_width:n.width,video_source_height:n.height,video_source_rendition_name:n.name,video_source_codec:null==n?void 0:n.videoCodec}):a.warn("missing BANDWIDTH from HLS manifest parsed by HLS.js")}};i.on(r.Events.LEVEL_SWITCHED,p),i._stopMuxMonitor=function(){i.off(r.Events.MANIFEST_LOADED,l),i.off(r.Events.LEVEL_LOADED,d),i.off(r.Events.AUDIO_TRACK_LOADED,u),i.off(r.Events.FRAG_LOADED,h),i.off(r.Events.FRAG_CHANGED,c),i.off(r.Events.ERROR,m),i.off(r.Events.FRAG_LOAD_EMERGENCY_ABORTED,f),i.off(r.Events.LEVEL_SWITCHED,p),i.off(r.Events.DESTROYING,i._stopMuxMonitor),delete i._stopMuxMonitor},i.on(r.Events.DESTROYING,i._stopMuxMonitor)},e_=function(e){e&&"function"==typeof e._stopMuxMonitor&&e._stopMuxMonitor()},eA=function(e,t){if(!e||!e.requestEndDate)return{};var i,r=eo(e.url),a=e.url,n=e.bytesLoaded,s=new Date(e.requestStartDate).getTime(),o=new Date(e.firstByteDate).getTime(),l=new Date(e.requestEndDate).getTime(),d=isNaN(e.duration)?0:e.duration,u="function"==typeof t.getMetricsFor?t.getMetricsFor(e.mediaType).HttpList:t.getDashMetrics().getHttpRequests(e.mediaType);u.length>0&&(i=eg(u[u.length-1]._responseHeaders||""));var h=i?ev(i):void 0;return{requestStart:s,requestResponseStart:o,requestResponseEnd:l,requestBytesLoaded:n,requestResponseHeaders:i,requestMediaDuration:d,requestHostname:r,requestUrl:a,requestId:h}},eS=function(e,t){var i=t.getQualityFor(e),r=t.getCurrentTrackFor(e).bitrateList;return r?{currentLevel:i,renditionWidth:r[i].width||null,renditionHeight:r[i].height||null,renditionBitrate:r[i].bandwidth}:{}},eI=function(e){var t;return null==(t=e.match(/.*codecs\*?="(.*)"/))?void 0:t[1]},eR=function(e){try{var t,i;return null==(i=e.getVersion)||null==(t=i.call(e))?void 0:t.split(".").map(function(e){return parseInt(e)})[0]}catch(e){return!1}},ek=function(e,t,i){arguments.length>3&&void 0!==arguments[3]&&arguments[3];var r=e.log;if(!i||!i.on)return void r.warn("Invalid dash.js player reference. Monitoring blocked.");var a=eR(i),n=function(i,r){return e.emit(t,i,r)},s=function(e){var t=e.type,i=(e.data||{}).url;n("requestcompleted",{request_event_type:t,request_start:0,request_response_start:0,request_response_end:0,request_bytes_loaded:-1,request_type:"manifest",request_hostname:eo(i),request_url:i})};i.on("manifestLoaded",s);var o={},l=function(e){if("function"!=typeof e.getRequests)return null;var t=e.getRequests({state:"executed"});return 0===t.length?null:t[t.length-1]},d=function(e){var t=e.type,r=e.chunk,a=e.request,s=(r||{}).mediaInfo||{},l=s.type,d=s.bitrateList,u={};(d=d||[]).forEach(function(e,t){u[t]={},u[t].width=e.width,u[t].height=e.height,u[t].bitrate=e.bandwidth,u[t].attrs={}}),"video"===l?o.video=u:"audio"===l?o.audio=u:o.media=u;var h=eA(a,i),c=h.requestStart,m=h.requestResponseStart,f=h.requestResponseEnd,p=h.requestResponseHeaders,g=h.requestMediaDuration,E=h.requestHostname,y=h.requestUrl;n("requestcompleted",{request_event_type:t,request_start:c,request_response_start:m,request_response_end:f,request_bytes_loaded:-1,request_type:l+"_init",request_response_headers:p,request_hostname:E,request_id:h.requestId,request_url:y,request_media_duration:g,request_rendition_lists:o})};a>=4?i.on("initFragmentLoaded",d):i.on("initFragmentLoaded",function(e){var t=e.type,i=e.fragmentModel,r=e.chunk;d({type:t,request:l(i),chunk:r})});var u=function(e){var t=e.type,r=e.chunk,a=e.request,s=r||{},o=s.mediaInfo,l=s.start,d=(o||{}).type,u=eA(a,i),h=u.requestStart,c=u.requestResponseStart,m=u.requestResponseEnd,f=u.requestBytesLoaded,p=u.requestResponseHeaders,g=u.requestMediaDuration,E=u.requestHostname,y=u.requestUrl,b=u.requestId,T=eS(d,i),_=T.currentLevel,A=T.renditionWidth,S=T.renditionHeight;n("requestcompleted",{request_event_type:t,request_start:h,request_response_start:c,request_response_end:m,request_bytes_loaded:f,request_type:d,request_response_headers:p,request_hostname:E,request_id:b,request_url:y,request_media_start_time:l,request_media_duration:g,request_current_level:_,request_labeled_bitrate:T.renditionBitrate,request_video_width:A,request_video_height:S})};a>=4?i.on("mediaFragmentLoaded",u):i.on("mediaFragmentLoaded",function(e){var t=e.type,i=e.fragmentModel,r=e.chunk;u({type:t,request:l(i),chunk:r})});var h={video:void 0,audio:void 0,totalBitrate:void 0},c=function(){if(h.video&&"number"==typeof h.video.bitrate){if(!(h.video.width&&h.video.height))return void r.warn("have bitrate info for video but missing width/height");var e=h.video.bitrate;if(h.audio&&"number"==typeof h.audio.bitrate&&(e+=h.audio.bitrate),e!==h.totalBitrate)return h.totalBitrate=e,{video_source_bitrate:e,video_source_height:h.video.height,video_source_width:h.video.width,video_source_codec:eI(h.video.codec)}}},m=function(e,t,a){if("number"!=typeof e.newQuality)return void r.warn("missing evt.newQuality in qualityChangeRendered event",e);var s=e.mediaType;if("audio"===s||"video"===s){var o=i.getBitrateInfoListFor(s).find(function(t){return t.qualityIndex===e.newQuality});if(!(o&&"number"==typeof o.bitrate))return void r.warn("missing bitrate info for ".concat(s));h[s]=em(ec({},o),{codec:i.getCurrentTrackFor(s).codec});var l=c();l&&n("renditionchange",l)}};i.on("qualityChangeRendered",m);var f=function(e){var t=e.request,i=e.mediaType;n("requestcanceled",{request_event_type:(t=t||{}).type+"_"+t.action,request_url:t.url,request_type:i,request_hostname:eo(t.url)})};i.on("fragmentLoadingAbandoned",f);var p=function(e){var t,i,r=e.error,a=(null==r||null==(t=r.data)?void 0:t.request)||{},s=(null==r||null==(i=r.data)?void 0:i.response)||{};(null==r?void 0:r.code)===27&&n("requestfailed",{request_error:a.type+"_"+a.action,request_url:a.url,request_hostname:eo(a.url),request_type:a.mediaType,request_error_code:s.status,request_error_text:s.statusText});var o="".concat(null!=a&&a.url?"url: ".concat(a.url,"\n"):"")+"".concat(null!=s&&s.status||null!=s&&s.statusText?"response: ".concat(null==s?void 0:s.status,", ").concat(null==s?void 0:s.statusText,"\n"):"");n("error",{player_error_code:null==r?void 0:r.code,player_error_message:null==r?void 0:r.message,player_error_context:o})};i.on("error",p),i._stopMuxMonitor=function(){i.off("manifestLoaded",s),i.off("initFragmentLoaded",d),i.off("mediaFragmentLoaded",u),i.off("qualityChangeRendered",m),i.off("error",p),i.off("fragmentLoadingAbandoned",f),delete i._stopMuxMonitor}},eL=function(e){e&&"function"==typeof e._stopMuxMonitor&&e._stopMuxMonitor()},eD=0,ew=function(){function e(){ee(this,e),er(this,"_listeners",void 0)}return ei(e,[{key:"on",value:function(e,t,i){return t._eventEmitterGuid=t._eventEmitterGuid||++eD,this._listeners=this._listeners||{},this._listeners[e]=this._listeners[e]||[],i&&(t=t.bind(i)),this._listeners[e].push(t),t}},{key:"off",value:function(e,t){var i=this._listeners&&this._listeners[e];i&&i.forEach(function(e,r){e._eventEmitterGuid===t._eventEmitterGuid&&i.splice(r,1)})}},{key:"one",value:function(e,t,i){var r=this;t._eventEmitterGuid=t._eventEmitterGuid||++eD;var a=function(){r.off(e,a),t.apply(i||this,arguments)};a._eventEmitterGuid=t._eventEmitterGuid,this.on(e,a)}},{key:"emit",value:function(e,t){var i=this;if(this._listeners){t=t||{};var r=this._listeners["before*"]||[],a=this._listeners[e]||[],n=this._listeners["after"+e]||[],s=function(t,r){(t=t.slice()).forEach(function(t){t.call(i,{type:e},r)})};s(r,t),s(a,t),s(n,t)}}}]),e}(),eC=E(y()),eM=function(){function e(t){var i=this;ee(this,e),er(this,"_playbackHeartbeatInterval",void 0),er(this,"_playheadShouldBeProgressing",void 0),er(this,"pm",void 0),this.pm=t,this._playbackHeartbeatInterval=null,this._playheadShouldBeProgressing=!1,t.on("playing",function(){i._playheadShouldBeProgressing=!0}),t.on("play",this._startPlaybackHeartbeatInterval.bind(this)),t.on("playing",this._startPlaybackHeartbeatInterval.bind(this)),t.on("adbreakstart",this._startPlaybackHeartbeatInterval.bind(this)),t.on("adplay",this._startPlaybackHeartbeatInterval.bind(this)),t.on("adplaying",this._startPlaybackHeartbeatInterval.bind(this)),t.on("devicewake",this._startPlaybackHeartbeatInterval.bind(this)),t.on("viewstart",this._startPlaybackHeartbeatInterval.bind(this)),t.on("rebufferstart",this._startPlaybackHeartbeatInterval.bind(this)),t.on("pause",this._stopPlaybackHeartbeatInterval.bind(this)),t.on("ended",this._stopPlaybackHeartbeatInterval.bind(this)),t.on("viewend",this._stopPlaybackHeartbeatInterval.bind(this)),t.on("error",this._stopPlaybackHeartbeatInterval.bind(this)),t.on("aderror",this._stopPlaybackHeartbeatInterval.bind(this)),t.on("adpause",this._stopPlaybackHeartbeatInterval.bind(this)),t.on("adended",this._stopPlaybackHeartbeatInterval.bind(this)),t.on("adbreakend",this._stopPlaybackHeartbeatInterval.bind(this)),t.on("seeked",function(){t.data.player_is_paused?i._stopPlaybackHeartbeatInterval():i._startPlaybackHeartbeatInterval()}),t.on("timeupdate",function(){null!==i._playbackHeartbeatInterval&&t.emit("playbackheartbeat")}),t.on("devicesleep",function(e,r){null!==i._playbackHeartbeatInterval&&(eC.default.clearInterval(i._playbackHeartbeatInterval),t.emit("playbackheartbeatend",{viewer_time:r.viewer_time}),i._playbackHeartbeatInterval=null)})}return ei(e,[{key:"_startPlaybackHeartbeatInterval",value:function(){var e=this;null===this._playbackHeartbeatInterval&&(this.pm.emit("playbackheartbeat"),this._playbackHeartbeatInterval=eC.default.setInterval(function(){e.pm.emit("playbackheartbeat")},this.pm.playbackHeartbeatTime))}},{key:"_stopPlaybackHeartbeatInterval",value:function(){this._playheadShouldBeProgressing=!1,null!==this._playbackHeartbeatInterval&&(eC.default.clearInterval(this._playbackHeartbeatInterval),this.pm.emit("playbackheartbeatend"),this._playbackHeartbeatInterval=null)}}]),e}(),eO=function e(t){var i=this;ee(this,e),er(this,"viewErrored",void 0),t.on("viewinit",function(){i.viewErrored=!1}),t.on("error",function(e,r){try{var a=t.errorTranslator({player_error_code:r.player_error_code,player_error_message:r.player_error_message,player_error_context:r.player_error_context,player_error_severity:r.player_error_severity,player_error_business_exception:r.player_error_business_exception});a&&(t.data.player_error_code=a.player_error_code||r.player_error_code,t.data.player_error_message=a.player_error_message||r.player_error_message,t.data.player_error_context=a.player_error_context||r.player_error_context,t.data.player_error_severity=a.player_error_severity||r.player_error_severity,t.data.player_error_business_exception=a.player_error_business_exception||r.player_error_business_exception,i.viewErrored=!0)}catch(e){t.mux.log.warn("Exception in error translator callback.",e),i.viewErrored=!0}}),t.on("aftererror",function(){var e,i,r,a,n;null==(e=t.data)||delete e.player_error_code,null==(i=t.data)||delete i.player_error_message,null==(r=t.data)||delete r.player_error_context,null==(a=t.data)||delete a.player_error_severity,null==(n=t.data)||delete n.player_error_business_exception})},eP=function(){function e(t){ee(this,e),er(this,"_watchTimeTrackerLastCheckedTime",void 0),er(this,"pm",void 0),this.pm=t,this._watchTimeTrackerLastCheckedTime=null,t.on("playbackheartbeat",this._updateWatchTime.bind(this)),t.on("playbackheartbeatend",this._clearWatchTimeState.bind(this))}return ei(e,[{key:"_updateWatchTime",value:function(e,t){var i=t.viewer_time;null===this._watchTimeTrackerLastCheckedTime&&(this._watchTimeTrackerLastCheckedTime=i),eh(this.pm.data,"view_watch_time",i-this._watchTimeTrackerLastCheckedTime),this._watchTimeTrackerLastCheckedTime=i}},{key:"_clearWatchTimeState",value:function(e,t){this._updateWatchTime(e,t),this._watchTimeTrackerLastCheckedTime=null}}]),e}(),ex=function(){function e(t){var i=this;ee(this,e),er(this,"_playbackTimeTrackerLastPlayheadPosition",void 0),er(this,"_lastTime",void 0),er(this,"_isAdPlaying",void 0),er(this,"_callbackUpdatePlaybackTime",void 0),er(this,"pm",void 0),this.pm=t,this._playbackTimeTrackerLastPlayheadPosition=-1,this._lastTime=V.now(),this._isAdPlaying=!1,this._callbackUpdatePlaybackTime=null;var r=this._startPlaybackTimeTracking.bind(this);t.on("playing",r),t.on("adplaying",r),t.on("seeked",r);var a=this._stopPlaybackTimeTracking.bind(this);t.on("playbackheartbeatend",a),t.on("seeking",a),t.on("adplaying",function(){i._isAdPlaying=!0}),t.on("adended",function(){i._isAdPlaying=!1}),t.on("adpause",function(){i._isAdPlaying=!1}),t.on("adbreakstart",function(){i._isAdPlaying=!1}),t.on("adbreakend",function(){i._isAdPlaying=!1}),t.on("adplay",function(){i._isAdPlaying=!1}),t.on("viewinit",function(){i._playbackTimeTrackerLastPlayheadPosition=-1,i._lastTime=V.now(),i._isAdPlaying=!1,i._callbackUpdatePlaybackTime=null})}return ei(e,[{key:"_startPlaybackTimeTracking",value:function(){null===this._callbackUpdatePlaybackTime&&(this._callbackUpdatePlaybackTime=this._updatePlaybackTime.bind(this),this._playbackTimeTrackerLastPlayheadPosition=this.pm.data.player_playhead_time,this.pm.on("playbackheartbeat",this._callbackUpdatePlaybackTime))}},{key:"_stopPlaybackTimeTracking",value:function(){this._callbackUpdatePlaybackTime&&(this._updatePlaybackTime(),this.pm.off("playbackheartbeat",this._callbackUpdatePlaybackTime),this._callbackUpdatePlaybackTime=null,this._playbackTimeTrackerLastPlayheadPosition=-1)}},{key:"_updatePlaybackTime",value:function(){var e=this.pm.data.player_playhead_time,t=V.now(),i=-1;this._playbackTimeTrackerLastPlayheadPosition>=0&&e>this._playbackTimeTrackerLastPlayheadPosition?i=e-this._playbackTimeTrackerLastPlayheadPosition:this._isAdPlaying&&(i=t-this._lastTime),i>0&&i<=1e3&&eh(this.pm.data,"view_content_playback_time",i),this._playbackTimeTrackerLastPlayheadPosition=e,this._lastTime=t}}]),e}(),eN=function(){function e(t){ee(this,e),er(this,"pm",void 0),this.pm=t;var i=this._updatePlayheadTime.bind(this);t.on("playbackheartbeat",i),t.on("playbackheartbeatend",i),t.on("timeupdate",i),t.on("destroy",function(){t.off("timeupdate",i)})}return ei(e,[{key:"_updateMaxPlayheadPosition",value:function(){this.pm.data.view_max_playhead_position=void 0===this.pm.data.view_max_playhead_position?this.pm.data.player_playhead_time:Math.max(this.pm.data.view_max_playhead_position,this.pm.data.player_playhead_time)}},{key:"_updatePlayheadTime",value:function(e,t){var i=this,r=function(){i.pm.currentFragmentPDT&&i.pm.currentFragmentStart&&(i.pm.data.player_program_time=i.pm.currentFragmentPDT+i.pm.data.player_playhead_time-i.pm.currentFragmentStart)};if(t&&t.player_playhead_time)this.pm.data.player_playhead_time=t.player_playhead_time,r(),this._updateMaxPlayheadPosition();else if(this.pm.getPlayheadTime){var a=this.pm.getPlayheadTime();void 0!==a&&(this.pm.data.player_playhead_time=a,r(),this._updateMaxPlayheadPosition())}}}]),e}(),eU=function e(t){if(ee(this,e),!t.disableRebufferTracking){var i,r=function(e,t){a(t),i=void 0},a=function(e){if(i){var r=e.viewer_time-i;eh(t.data,"view_rebuffer_duration",r),i=e.viewer_time,t.data.view_rebuffer_duration>3e5&&(t.emit("viewend"),t.send("viewend"),t.mux.log.warn("Ending view after rebuffering for longer than ".concat(3e5,"ms, future events will be ignored unless a programchange or videochange occurs.")))}t.data.view_watch_time>=0&&t.data.view_rebuffer_count>0&&(t.data.view_rebuffer_frequency=t.data.view_rebuffer_count/t.data.view_watch_time,t.data.view_rebuffer_percentage=t.data.view_rebuffer_duration/t.data.view_watch_time)};t.on("playbackheartbeat",function(e,t){return a(t)}),t.on("rebufferstart",function(e,a){i||(eh(t.data,"view_rebuffer_count",1),i=a.viewer_time,t.one("rebufferend",r))}),t.on("viewinit",function(){i=void 0,t.off("rebufferend",r)})}},eF=function(){function e(t){var i=this;ee(this,e),er(this,"_lastCheckedTime",void 0),er(this,"_lastPlayheadTime",void 0),er(this,"_lastPlayheadTimeUpdatedTime",void 0),er(this,"_rebuffering",void 0),er(this,"pm",void 0),this.pm=t,t.disableRebufferTracking||t.disablePlayheadRebufferTracking||(this._lastCheckedTime=null,this._lastPlayheadTime=null,this._lastPlayheadTimeUpdatedTime=null,t.on("playbackheartbeat",this._checkIfRebuffering.bind(this)),t.on("playbackheartbeatend",this._cleanupRebufferTracker.bind(this)),t.on("seeking",function(){i._cleanupRebufferTracker(null,{viewer_time:V.now()})}))}return ei(e,[{key:"_checkIfRebuffering",value:function(e,t){if(this.pm.seekingTracker.isSeeking||this.pm.adTracker.isAdBreak||!this.pm.playbackHeartbeat._playheadShouldBeProgressing)return void this._cleanupRebufferTracker(e,t);if(null===this._lastCheckedTime)return void this._prepareRebufferTrackerState(t.viewer_time);if(this._lastPlayheadTime!==this.pm.data.player_playhead_time)return void this._cleanupRebufferTracker(e,t,!0);var i=t.viewer_time-this._lastPlayheadTimeUpdatedTime;"number"==typeof this.pm.sustainedRebufferThreshold&&i>=this.pm.sustainedRebufferThreshold&&(this._rebuffering||(this._rebuffering=!0,this.pm.emit("rebufferstart",{viewer_time:this._lastPlayheadTimeUpdatedTime}))),this._lastCheckedTime=t.viewer_time}},{key:"_clearRebufferTrackerState",value:function(){this._lastCheckedTime=null,this._lastPlayheadTime=null,this._lastPlayheadTimeUpdatedTime=null}},{key:"_prepareRebufferTrackerState",value:function(e){this._lastCheckedTime=e,this._lastPlayheadTime=this.pm.data.player_playhead_time,this._lastPlayheadTimeUpdatedTime=e}},{key:"_cleanupRebufferTracker",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._rebuffering)this._rebuffering=!1,this.pm.emit("rebufferend",{viewer_time:t.viewer_time});else{if(null===this._lastCheckedTime)return;var r=this.pm.data.player_playhead_time-this._lastPlayheadTime,a=t.viewer_time-this._lastPlayheadTimeUpdatedTime;"number"==typeof this.pm.minimumRebufferDuration&&r>0&&a-r>this.pm.minimumRebufferDuration&&(this._lastCheckedTime=null,this.pm.emit("rebufferstart",{viewer_time:this._lastPlayheadTimeUpdatedTime}),this.pm.emit("rebufferend",{viewer_time:this._lastPlayheadTimeUpdatedTime+a-r}))}i?this._prepareRebufferTrackerState(t.viewer_time):this._clearRebufferTrackerState()}}]),e}(),eB=function(){function e(t){var i=this;ee(this,e),er(this,"NAVIGATION_START",void 0),er(this,"pm",void 0),this.pm=t,t.on("viewinit",function(){var e=t.data,r=e.view_id;if(!e.view_program_changed){var a=function(e,a){var n=a.viewer_time;"playing"===e.type&&void 0===t.data.view_time_to_first_frame?i.calculateTimeToFirstFrame(n||V.now(),r):"adplaying"===e.type&&(void 0===t.data.view_time_to_first_frame||i._inPrerollPosition())&&i.calculateTimeToFirstFrame(n||V.now(),r)};t.one("playing",a),t.one("adplaying",a),t.one("viewend",function(){t.off("playing",a),t.off("adplaying",a)})}})}return ei(e,[{key:"_inPrerollPosition",value:function(){return void 0===this.pm.data.view_content_playback_time||this.pm.data.view_content_playback_time<=1e3}},{key:"calculateTimeToFirstFrame",value:function(e,t){t===this.pm.data.view_id&&(this.pm.watchTimeTracker._updateWatchTime(null,{viewer_time:e}),this.pm.data.view_time_to_first_frame=this.pm.data.view_watch_time,(this.pm.data.player_autoplay_on||this.pm.data.video_is_autoplay)&&this.NAVIGATION_START&&(this.pm.data.view_aggregate_startup_time=this.pm.data.view_start+this.pm.data.view_watch_time-this.NAVIGATION_START))}}]),e}(),eH=function e(t){var i=this;ee(this,e),er(this,"_lastPlayerHeight",void 0),er(this,"_lastPlayerWidth",void 0),er(this,"_lastPlayheadPosition",void 0),er(this,"_lastSourceHeight",void 0),er(this,"_lastSourceWidth",void 0),t.on("viewinit",function(){i._lastPlayheadPosition=-1}),["pause","rebufferstart","seeking","error","adbreakstart","hb","renditionchange","orientationchange","viewend"].forEach(function(e){t.on(e,function(){if(i._lastPlayheadPosition>=0&&t.data.player_playhead_time>=0&&i._lastPlayerWidth>=0&&i._lastSourceWidth>0&&i._lastPlayerHeight>=0&&i._lastSourceHeight>0){var e=t.data.player_playhead_time-i._lastPlayheadPosition;if(e<0){i._lastPlayheadPosition=-1;return}var r=Math.min(i._lastPlayerWidth/i._lastSourceWidth,i._lastPlayerHeight/i._lastSourceHeight),a=Math.max(0,r-1),n=Math.max(0,1-r);t.data.view_max_upscale_percentage=Math.max(t.data.view_max_upscale_percentage||0,a),t.data.view_max_downscale_percentage=Math.max(t.data.view_max_downscale_percentage||0,n),eh(t.data,"view_total_content_playback_time",e),eh(t.data,"view_total_upscaling",a*e),eh(t.data,"view_total_downscaling",n*e)}i._lastPlayheadPosition=-1})}),["playing","hb","renditionchange","orientationchange"].forEach(function(e){t.on(e,function(){i._lastPlayheadPosition=t.data.player_playhead_time,i._lastPlayerWidth=t.data.player_width,i._lastPlayerHeight=t.data.player_height,i._lastSourceWidth=t.data.video_source_width,i._lastSourceHeight=t.data.video_source_height})})},eG=function e(t){var i=this;ee(this,e),er(this,"isSeeking",void 0),this.isSeeking=!1;var r=-1,a=function(){var e=V.now(),a=(t.data.viewer_time||e)-(r||e);eh(t.data,"view_seek_duration",a),t.data.view_max_seek_time=Math.max(t.data.view_max_seek_time||0,a),i.isSeeking=!1,r=-1};t.on("seeking",function(e,n){if(Object.assign(t.data,n),i.isSeeking&&n.viewer_time-r<=2e3){r=n.viewer_time;return}i.isSeeking&&a(),i.isSeeking=!0,r=n.viewer_time,eh(t.data,"view_seek_count",1),t.send("seeking")}),t.on("seeked",function(){a()}),t.on("viewend",function(){i.isSeeking&&(a(),t.send("seeked")),i.isSeeking=!1,r=-1})},eK=function(e,t){e.push(t),e.sort(function(e,t){return e.viewer_time-t.viewer_time})},eV=["adbreakstart","adrequest","adresponse","adplay","adplaying","adpause","adended","adbreakend","aderror","adclicked","adskipped"],eW=function(){function e(t){var i=this;ee(this,e),er(this,"_adHasPlayed",void 0),er(this,"_adRequests",void 0),er(this,"_adResponses",void 0),er(this,"_currentAdRequestNumber",void 0),er(this,"_currentAdResponseNumber",void 0),er(this,"_prerollPlayTime",void 0),er(this,"_wouldBeNewAdPlay",void 0),er(this,"isAdBreak",void 0),er(this,"pm",void 0),this.pm=t,t.on("viewinit",function(){i.isAdBreak=!1,i._currentAdRequestNumber=0,i._currentAdResponseNumber=0,i._adRequests=[],i._adResponses=[],i._adHasPlayed=!1,i._wouldBeNewAdPlay=!0,i._prerollPlayTime=void 0}),eV.forEach(function(e){return t.on(e,i._updateAdData.bind(i))});var r=function(){i.isAdBreak=!1};t.on("adbreakstart",function(){i.isAdBreak=!0}),t.on("play",r),t.on("playing",r),t.on("viewend",r),t.on("adrequest",function(e,r){r=Object.assign({ad_request_id:"generatedAdRequestId"+i._currentAdRequestNumber++},r),eK(i._adRequests,r),eh(t.data,"view_ad_request_count"),i.inPrerollPosition()&&(t.data.view_preroll_requested=!0,i._adHasPlayed||eh(t.data,"view_preroll_request_count"))}),t.on("adresponse",function(e,r){r=Object.assign({ad_request_id:"generatedAdRequestId"+i._currentAdResponseNumber++},r),eK(i._adResponses,r);var a=i.findAdRequest(r.ad_request_id);a&&eh(t.data,"view_ad_request_time",Math.max(0,r.viewer_time-a.viewer_time))}),t.on("adplay",function(e,r){i._adHasPlayed=!0,i._wouldBeNewAdPlay&&(i._wouldBeNewAdPlay=!1,eh(t.data,"view_ad_played_count")),i.inPrerollPosition()&&!t.data.view_preroll_played&&(t.data.view_preroll_played=!0,i._adRequests.length>0&&(t.data.view_preroll_request_time=Math.max(0,r.viewer_time-i._adRequests[0].viewer_time)),t.data.view_start&&(t.data.view_startup_preroll_request_time=Math.max(0,r.viewer_time-t.data.view_start)),i._prerollPlayTime=r.viewer_time)}),t.on("adplaying",function(e,r){i.inPrerollPosition()&&void 0===t.data.view_preroll_load_time&&void 0!==i._prerollPlayTime&&(t.data.view_preroll_load_time=r.viewer_time-i._prerollPlayTime,t.data.view_startup_preroll_load_time=r.viewer_time-i._prerollPlayTime)}),t.on("adclicked",function(e,r){i._wouldBeNewAdPlay||eh(t.data,"view_ad_clicked_count")}),t.on("adskipped",function(e,r){i._wouldBeNewAdPlay||eh(t.data,"view_ad_skipped_count")}),t.on("adended",function(){i._wouldBeNewAdPlay=!0}),t.on("aderror",function(){i._wouldBeNewAdPlay=!0})}return ei(e,[{key:"inPrerollPosition",value:function(){return void 0===this.pm.data.view_content_playback_time||this.pm.data.view_content_playback_time<=1e3}},{key:"findAdRequest",value:function(e){for(var t=0;t<this._adRequests.length;t++)if(this._adRequests[t].ad_request_id===e)return this._adRequests[t]}},{key:"_updateAdData",value:function(e,t){if(this.inPrerollPosition()){if(!this.pm.data.view_preroll_ad_tag_hostname&&t.ad_tag_url){var i=B(el(t.ad_tag_url),2),r=i[0],a=i[1];this.pm.data.view_preroll_ad_tag_domain=a,this.pm.data.view_preroll_ad_tag_hostname=r}if(!this.pm.data.view_preroll_ad_asset_hostname&&t.ad_asset_url){var n=B(el(t.ad_asset_url),2),s=n[0],o=n[1];this.pm.data.view_preroll_ad_asset_domain=o,this.pm.data.view_preroll_ad_asset_hostname=s}}this.pm.data.ad_asset_url=null==t?void 0:t.ad_asset_url,this.pm.data.ad_tag_url=null==t?void 0:t.ad_tag_url,this.pm.data.ad_creative_id=null==t?void 0:t.ad_creative_id,this.pm.data.ad_id=null==t?void 0:t.ad_id,this.pm.data.ad_universal_id=null==t?void 0:t.ad_universal_id}}]),e}(),eq=E(y()),eY=function e(t){ee(this,e);var i,r,a=function(){t.disableRebufferTracking||(eh(t.data,"view_waiting_rebuffer_count",1),i=V.now(),r=eq.default.setInterval(function(){if(i){var e=V.now();eh(t.data,"view_waiting_rebuffer_duration",e-i),i=e}},250))},n=function(){t.disableRebufferTracking||i&&(eh(t.data,"view_waiting_rebuffer_duration",V.now()-i),i=!1,eq.default.clearInterval(r))},s=!1,o=function(){s=!0},l=function(){s=!1,n()};t.on("waiting",function(){s&&a()}),t.on("playing",function(){n(),o()}),t.on("pause",l),t.on("seeking",l)},ej=function e(t){var i=this;ee(this,e),er(this,"lastWallClockTime",void 0);var r=function(){i.lastWallClockTime=V.now(),t.on("before*",a)},a=function(e){var r=V.now(),a=i.lastWallClockTime;i.lastWallClockTime=r,r-a>3e4&&(t.emit("devicesleep",{viewer_time:a}),Object.assign(t.data,{viewer_time:a}),t.send("devicesleep"),t.emit("devicewake",{viewer_time:r}),Object.assign(t.data,{viewer_time:r}),t.send("devicewake"))};t.one("playbackheartbeat",r),t.on("playbackheartbeatend",function(){t.off("before*",a),t.one("playbackheartbeat",r)})},eQ=E(y()),ez=function(){var e=function(){for(var e=0,t={};e<arguments.length;e++){var i=arguments[e];for(var r in i)t[r]=i[r]}return t};return function t(i){function r(t,a,n){var s;if("undefined"!=typeof document){if(arguments.length>1){if("number"==typeof(n=e({path:"/"},r.defaults,n)).expires){var o=new Date;o.setMilliseconds(o.getMilliseconds()+864e5*n.expires),n.expires=o}try{s=JSON.stringify(a),/^[\{\[]/.test(s)&&(a=s)}catch(e){}return a=i.write?i.write(a,t):encodeURIComponent(String(a)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=(t=(t=encodeURIComponent(String(t))).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent)).replace(/[\(\)]/g,escape),document.cookie=t+"="+a+(n.expires?"; expires="+n.expires.toUTCString():"")+(n.path?"; path="+n.path:"")+(n.domain?"; domain="+n.domain:"")+(n.secure?"; secure":"")}t||(s={});for(var l=document.cookie?document.cookie.split("; "):[],d=/(%[0-9A-Z]{2})+/g,u=0;u<l.length;u++){var h=l[u].split("="),c=h.slice(1).join("=");'"'===c.charAt(0)&&(c=c.slice(1,-1));try{var m=h[0].replace(d,decodeURIComponent);if(c=i.read?i.read(c,m):i(c,m)||c.replace(d,decodeURIComponent),this.json)try{c=JSON.parse(c)}catch(e){}if(t===m){s=c;break}t||(s[m]=c)}catch(e){}}return s}}return r.set=r,r.get=function(e){return r.call(r,e)},r.getJSON=function(){return r.apply({json:!0},[].slice.call(arguments))},r.defaults={},r.remove=function(t,i){r(t,"",e(i,{expires:-1}))},r.withConverter=t,r}(function(){})}(),eX="muxData",eZ=function(){var e;try{e=(ez.get(eX)||"").split("&").reduce(function(e,t){var i=B(t.split("="),2),r=i[0],a=i[1],n=+a;return e[r]=a&&n==a?n:a,e},{})}catch(t){e={}}return e},eJ=function(e){try{ez.set(eX,Object.entries(e).map(function(e){var t=B(e,2),i=t[0],r=t[1];return"".concat(i,"=").concat(r)}).join("&"),{expires:365})}catch(e){}},e$=function(){var e=eZ();return e.mux_viewer_id=e.mux_viewer_id||W(),e.msn=e.msn||Math.random(),eJ(e),{mux_viewer_id:e.mux_viewer_id,mux_sample_number:e.msn}},e0=function(){var e=eZ(),t=V.now();return e.session_start&&(e.sst=e.session_start,delete e.session_start),e.session_id&&(e.sid=e.session_id,delete e.session_id),e.session_expires&&(e.sex=e.session_expires,delete e.session_expires),(!e.sex||e.sex<t)&&(e.sid=W(),e.sst=t),e.sex=t+15e5,eJ(e),{session_id:e.sid,session_start:e.sst,session_expires:e.sex}},e1=E(y()),e2=function(){var e;switch(e3()){case"cellular":e="cellular";break;case"ethernet":e="wired";break;case"wifi":e="wifi";break;case void 0:break;default:e="other"}return e},e3=function(){var e=e1.default.navigator,t=e&&(e.connection||e.mozConnection||e.webkitConnection);return t&&t.type};e2.getConnectionFromAPI=e3;var e4=e8({a:"env",b:"beacon",c:"custom",d:"ad",e:"event",f:"experiment",i:"internal",m:"mux",n:"response",p:"player",q:"request",r:"retry",s:"session",t:"timestamp",u:"viewer",v:"video",w:"page",x:"view",y:"sub"}),e5=e8({ad:"ad",af:"affiliate",ag:"aggregate",ap:"api",al:"application",ao:"audio",ar:"architecture",as:"asset",au:"autoplay",av:"average",bi:"bitrate",bn:"brand",br:"break",bw:"browser",by:"bytes",bz:"business",ca:"cached",cb:"cancel",cc:"codec",cd:"code",cg:"category",ch:"changed",ci:"client",ck:"clicked",cl:"canceled",cn:"config",co:"count",ce:"counter",cp:"complete",cq:"creator",cr:"creative",cs:"captions",ct:"content",cu:"current",cx:"connection",cz:"context",dg:"downscaling",dm:"domain",dn:"cdn",do:"downscale",dr:"drm",dp:"dropped",du:"duration",dv:"device",dy:"dynamic",eb:"enabled",ec:"encoding",ed:"edge",en:"end",eg:"engine",em:"embed",er:"error",ep:"experiments",es:"errorcode",et:"errortext",ee:"event",ev:"events",ex:"expires",ez:"exception",fa:"failed",fi:"first",fm:"family",ft:"format",fp:"fps",fq:"frequency",fr:"frame",fs:"fullscreen",ha:"has",hb:"holdback",he:"headers",ho:"host",hn:"hostname",ht:"height",id:"id",ii:"init",in:"instance",ip:"ip",is:"is",ke:"key",la:"language",lb:"labeled",le:"level",li:"live",ld:"loaded",lo:"load",ls:"lists",lt:"latency",ma:"max",md:"media",me:"message",mf:"manifest",mi:"mime",ml:"midroll",mm:"min",mn:"manufacturer",mo:"model",mx:"mux",ne:"newest",nm:"name",no:"number",on:"on",or:"origin",os:"os",pa:"paused",pb:"playback",pd:"producer",pe:"percentage",pf:"played",pg:"program",ph:"playhead",pi:"plugin",pl:"preroll",pn:"playing",po:"poster",pp:"pip",pr:"preload",ps:"position",pt:"part",py:"property",px:"pop",pz:"plan",ra:"rate",rd:"requested",re:"rebuffer",rf:"rendition",rg:"range",rm:"remote",ro:"ratio",rp:"response",rq:"request",rs:"requests",sa:"sample",sd:"skipped",se:"session",sh:"shift",sk:"seek",sm:"stream",so:"source",sq:"sequence",sr:"series",ss:"status",st:"start",su:"startup",sv:"server",sw:"software",sy:"severity",ta:"tag",tc:"tech",te:"text",tg:"target",th:"throughput",ti:"time",tl:"total",to:"to",tt:"title",ty:"type",ug:"upscaling",un:"universal",up:"upscale",ur:"url",us:"user",va:"variant",vd:"viewed",vi:"video",ve:"version",vw:"view",vr:"viewer",wd:"width",wa:"watch",wt:"waiting"});function e8(e){var t={};for(var i in e)e.hasOwnProperty(i)&&(t[e[i]]=i);return t}function e9(e){var t={},i={};return Object.keys(e).forEach(function(r){var a=!1;if(e.hasOwnProperty(r)&&void 0!==e[r]){var n=r.split("_"),s=n[0],o=e4[s];o||(X.info("Data key word `"+n[0]+"` not expected in "+r),o=s+"_"),n.splice(1).forEach(function(e){"url"===e&&(a=!0),e5[e]?o+=e5[e]:Number.isInteger(Number(e))?o+=e:(X.info("Data key word `"+e+"` not expected in "+r),o+="_"+e+"_")}),a?i[o]=e[r]:t[o]=e[r]}}),Object.assign(t,i)}var e6=E(y()),e7=E(N()),te={maxBeaconSize:300,maxQueueLength:3600,baseTimeBetweenBeacons:1e4,maxPayloadKBSize:500},tt=["hb","requestcompleted","requestfailed","requestcanceled"],ti=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._beaconUrl=e||"https://img.litix.io",this._eventQueue=[],this._postInFlight=!1,this._resendAfterPost=!1,this._failureCount=0,this._sendTimeout=!1,this._options=Object.assign({},te,t)};ti.prototype.queueEvent=function(e,t){var i=Object.assign({},t);return(this._eventQueue.length<=this._options.maxQueueLength||"eventrateexceeded"===e)&&(this._eventQueue.push(i),this._sendTimeout||this._startBeaconSending(),this._eventQueue.length<=this._options.maxQueueLength)},ti.prototype.flushEvents=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(e&&1===this._eventQueue.length)return void this._eventQueue.pop();this._eventQueue.length&&this._sendBeaconQueue(),this._startBeaconSending()},ti.prototype.destroy=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.destroyed=!0,e?this._clearBeaconQueue():this.flushEvents(),e6.default.clearTimeout(this._sendTimeout)},ti.prototype._clearBeaconQueue=function(){var e=this._eventQueue.length>this._options.maxBeaconSize?this._eventQueue.length-this._options.maxBeaconSize:0,t=this._eventQueue.slice(e);e>0&&Object.assign(t[t.length-1],e9({mux_view_message:"event queue truncated"}));var i=this._createPayload(t);tn(this._beaconUrl,i,!0,function(){})},ti.prototype._sendBeaconQueue=function(){var e=this;if(this._postInFlight){this._resendAfterPost=!0;return}var t=this._eventQueue.slice(0,this._options.maxBeaconSize);this._eventQueue=this._eventQueue.slice(this._options.maxBeaconSize),this._postInFlight=!0;var i=this._createPayload(t),r=V.now();tn(this._beaconUrl,i,!1,function(i,a){a?(e._eventQueue=t.concat(e._eventQueue),e._failureCount+=1,X.info("Error sending beacon: "+a)):e._failureCount=0,e._roundTripTime=V.now()-r,e._postInFlight=!1,e._resendAfterPost&&(e._resendAfterPost=!1,e._eventQueue.length>0&&e._sendBeaconQueue())})},ti.prototype._getNextBeaconTime=function(){if(!this._failureCount)return this._options.baseTimeBetweenBeacons;var e=Math.pow(2,this._failureCount-1);return(1+(e*=Math.random()))*this._options.baseTimeBetweenBeacons},ti.prototype._startBeaconSending=function(){var e=this;e6.default.clearTimeout(this._sendTimeout),this.destroyed||(this._sendTimeout=e6.default.setTimeout(function(){e._eventQueue.length&&e._sendBeaconQueue(),e._startBeaconSending()},this._getNextBeaconTime()))},ti.prototype._createPayload=function(e){var t=this,i={transmission_timestamp:Math.round(V.now())};this._roundTripTime&&(i.rtt_ms=Math.round(this._roundTripTime));var r,a,n,s=function(){n=(r=JSON.stringify({metadata:i,events:a||e})).length/1024},o=function(){return n<=t._options.maxPayloadKBSize};return s(),o()||(X.info("Payload size is too big ("+n+" kb). Removing unnecessary events."),a=e.filter(function(e){return -1===tt.indexOf(e.e)}),s()),o()||(X.info("Payload size still too big ("+n+" kb). Cropping fields.."),a.forEach(function(e){for(var t in e){var i=e[t];"string"==typeof i&&i.length>51200&&(e[t]=i.substring(0,51200))}}),s()),r};var tr,ta="function"==typeof e7.default.exitPictureInPicture?function(e){return e.length<=57344}:function(e){return!1},tn=function(e,t,i,r){if(i&&navigator&&navigator.sendBeacon&&navigator.sendBeacon(e,t))return void r();if(e6.default.fetch)return void e6.default.fetch(e,{method:"POST",body:t,headers:{"Content-Type":"text/plain"},keepalive:ta(t)}).then(function(e){return r(null,e.ok?null:"Error")}).catch(function(e){return r(null,e)});if(e6.default.XMLHttpRequest){var a=new e6.default.XMLHttpRequest;a.onreadystatechange=function(){if(4===a.readyState)return r(null,200!==a.status?"error":void 0)},a.open("POST",e),a.setRequestHeader("Content-Type","text/plain"),a.send(t);return}r()},ts=["env_key","view_id","view_sequence_number","player_sequence_number","beacon_domain","player_playhead_time","viewer_time","mux_api_version","event","video_id","player_instance_id","player_error_code","player_error_message","player_error_context","player_error_severity","player_error_business_exception"],to=["adplay","adplaying","adpause","adfirstquartile","admidpoint","adthirdquartile","adended","adresponse","adrequest"],tl=["ad_id","ad_creative_id","ad_universal_id"],td=["viewstart","error","ended","viewend"],tu=function(){function e(t,i){var r,a,n,s,o,l,d,u,h,c,m,f,p,g,E,y,b,T,_,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};ee(this,e),er(this,"mux",void 0),er(this,"envKey",void 0),er(this,"options",void 0),er(this,"eventQueue",void 0),er(this,"sampleRate",void 0),er(this,"disableCookies",void 0),er(this,"respectDoNotTrack",void 0),er(this,"previousBeaconData",void 0),er(this,"lastEventTime",void 0),er(this,"rateLimited",void 0),er(this,"pageLevelData",void 0),er(this,"viewerData",void 0),this.mux=t,this.envKey=i,this.options=A,this.previousBeaconData=null,this.lastEventTime=0,this.rateLimited=!1,this.eventQueue=new ti((r=this.envKey,n=(a=this.options).beaconCollectionDomain,s=a.beaconDomain,n?"https://"+n:(r=r||"inferred").match(/^[a-z0-9]+$/)?"https://"+r+"."+(s||"litix.io"):"https://img.litix.io/a.gif")),this.sampleRate=null!=(b=this.options.sampleRate)?b:1,this.disableCookies=null!=(T=this.options.disableCookies)&&T,this.respectDoNotTrack=null!=(_=this.options.respectDoNotTrack)&&_,this.previousBeaconData=null,this.lastEventTime=0,this.rateLimited=!1,this.pageLevelData={mux_api_version:this.mux.API_VERSION,mux_embed:this.mux.NAME,mux_embed_version:this.mux.VERSION,viewer_application_name:null==(o=this.options.platform)?void 0:o.name,viewer_application_version:null==(l=this.options.platform)?void 0:l.version,viewer_application_engine:null==(d=this.options.platform)?void 0:d.layout,viewer_device_name:null==(u=this.options.platform)?void 0:u.product,viewer_device_category:"",viewer_device_manufacturer:null==(h=this.options.platform)?void 0:h.manufacturer,viewer_os_family:null==(m=this.options.platform)||null==(c=m.os)?void 0:c.family,viewer_os_architecture:null==(p=this.options.platform)||null==(f=p.os)?void 0:f.architecture,viewer_os_version:null==(E=this.options.platform)||null==(g=E.os)?void 0:g.version,viewer_connection_type:e2(),page_url:null===eQ.default||void 0===eQ.default||null==(y=eQ.default.location)?void 0:y.href},this.viewerData=this.disableCookies?{}:e$()}return ei(e,[{key:"send",value:function(e,t){if(!(!e||!(null!=t&&t.view_id))){if(this.respectDoNotTrack&&J())return X.info("Not sending `"+e+"` because Do Not Track is enabled");if(!t||"object"!=typeof t)return X.error("A data object was expected in send() but was not provided");var i=this.disableCookies?{}:e0(),r=em(ec({},this.pageLevelData,t,i,this.viewerData),{event:e,env_key:this.envKey});r.user_id&&(r.viewer_user_id=r.user_id,delete r.user_id);var a,n=(null!=(a=r.mux_sample_number)?a:0)>=this.sampleRate,s=e9(this._deduplicateBeaconData(e,r));if(this.lastEventTime=this.mux.utils.now(),n)return X.info("Not sending event due to sample rate restriction",e,r,s);if(this.envKey||X.info("Missing environment key (envKey) - beacons will be dropped if the video source is not a valid mux video URL",e,r,s),!this.rateLimited){if(X.info("Sending event",e,r,s),this.rateLimited=!this.eventQueue.queueEvent(e,s),this.mux.WINDOW_UNLOADING&&"viewend"===e)this.eventQueue.destroy(!0);else if(this.mux.WINDOW_HIDDEN&&"hb"===e?this.eventQueue.flushEvents(!0):td.indexOf(e)>=0&&this.eventQueue.flushEvents(),this.rateLimited)return r.event="eventrateexceeded",s=e9(r),this.eventQueue.queueEvent(r.event,s),X.error("Beaconing disabled due to rate limit.")}}}},{key:"destroy",value:function(){this.eventQueue.destroy(!1)}},{key:"_deduplicateBeaconData",value:function(e,t){var i=this,r={},a=t.view_id;if("-1"===a||"viewstart"===e||"viewend"===e||!this.previousBeaconData||this.mux.utils.now()-this.lastEventTime>=6e5)r=ec({},t),a&&(this.previousBeaconData=r),a&&"viewend"===e&&(this.previousBeaconData=null);else{var n=0===e.indexOf("request");Object.entries(t).forEach(function(t){var a=B(t,2),s=a[0],o=a[1];i.previousBeaconData&&(o!==i.previousBeaconData[s]||ts.indexOf(s)>-1||i.objectHasChanged(n,s,o,i.previousBeaconData[s])||i.eventRequiresKey(e,s))&&(r[s]=o,i.previousBeaconData[s]=o)})}return r}},{key:"objectHasChanged",value:function(e,t,i,r){return!!e&&0===t.indexOf("request_")&&("request_response_headers"===t||"object"!=typeof i||"object"!=typeof r||Object.keys(i||{}).length!==Object.keys(r||{}).length)}},{key:"eventRequiresKey",value:function(e,t){return!!("renditionchange"===e&&0===t.indexOf("video_source_")||tl.includes(t)&&to.includes(e))}}]),e}(),th=function e(t){ee(this,e);var i=0,r=0,a=0,n=0,s=0,o=0,l=0;t.on("requestcompleted",function(e,o){var l,d,u=o.request_start,h=o.request_response_start,c=o.request_response_end,m=o.request_bytes_loaded;if(n++,h?(l=h-(null!=u?u:0),d=(null!=c?c:0)-h):d=(null!=c?c:0)-(null!=u?u:0),d>0&&m&&m>0){var f=m/d*8e3;s++,r+=m,a+=d,t.data.view_min_request_throughput=Math.min(t.data.view_min_request_throughput||1/0,f),t.data.view_average_request_throughput=r/a*8e3,t.data.view_request_count=n,l>0&&(i+=l,t.data.view_max_request_latency=Math.max(t.data.view_max_request_latency||0,l),t.data.view_average_request_latency=i/s)}}),t.on("requestfailed",function(e,i){n++,o++,t.data.view_request_count=n,t.data.view_request_failed_count=o}),t.on("requestcanceled",function(e,i){n++,l++,t.data.view_request_count=n,t.data.view_request_canceled_count=l})},tc=function e(t){var i=this;ee(this,e),er(this,"_lastEventTime",void 0),t.on("before*",function(e,r){var a=r.viewer_time,n=V.now(),s=i._lastEventTime;if(i._lastEventTime=n,s&&n-s>36e5){var o=Object.keys(t.data).reduce(function(e,i){return 0===i.indexOf("video_")?Object.assign(e,er({},i,t.data[i])):e},{});t.mux.log.info("Received event after at least an hour inactivity, creating a new view");var l=t.playbackHeartbeat._playheadShouldBeProgressing;t._resetView(Object.assign({viewer_time:a},o)),t.playbackHeartbeat._playheadShouldBeProgressing=l,t.playbackHeartbeat._playheadShouldBeProgressing&&"play"!==e.type&&"adbreakstart"!==e.type&&(t.emit("play",{viewer_time:a}),"playing"!==e.type&&t.emit("playing",{viewer_time:a}))}})},tm=["viewstart","ended","loadstart","pause","play","playing","ratechange","waiting","adplay","adpause","adended","aderror","adplaying","adrequest","adresponse","adbreakstart","adbreakend","adfirstquartile","admidpoint","adthirdquartile","rebufferstart","rebufferend","seeked","error","hb","requestcompleted","requestfailed","requestcanceled","renditionchange"],tf=new Set(["requestcompleted","requestfailed","requestcanceled"]),tp=function(e){if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function");r.prototype=Object.create(e&&e.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),e&&es(r,e);var t,i=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,i=ea(r);return e=t?Reflect.construct(i,arguments,ea(this).constructor):i.apply(this,arguments),e&&("object"===_(e)||"function"==typeof e)?e:$(this)});function r(e,t,a){ee(this,r),er($(n=i.call(this)),"DOM_CONTENT_LOADED_EVENT_END",void 0),er($(n),"NAVIGATION_START",void 0),er($(n),"_destroyed",void 0),er($(n),"_heartBeatTimeout",void 0),er($(n),"adTracker",void 0),er($(n),"dashjs",void 0),er($(n),"data",void 0),er($(n),"disablePlayheadRebufferTracking",void 0),er($(n),"disableRebufferTracking",void 0),er($(n),"errorTracker",void 0),er($(n),"errorTranslator",void 0),er($(n),"emitTranslator",void 0),er($(n),"getAdData",void 0),er($(n),"getPlayheadTime",void 0),er($(n),"getStateData",void 0),er($(n),"stateDataTranslator",void 0),er($(n),"hlsjs",void 0),er($(n),"id",void 0),er($(n),"longResumeTracker",void 0),er($(n),"minimumRebufferDuration",void 0),er($(n),"mux",void 0),er($(n),"playbackEventDispatcher",void 0),er($(n),"playbackHeartbeat",void 0),er($(n),"playbackHeartbeatTime",void 0),er($(n),"playheadTime",void 0),er($(n),"seekingTracker",void 0),er($(n),"sustainedRebufferThreshold",void 0),er($(n),"watchTimeTracker",void 0),er($(n),"currentFragmentPDT",void 0),er($(n),"currentFragmentStart",void 0),n.DOM_CONTENT_LOADED_EVENT_END=eu.domContentLoadedEventEnd(),n.NAVIGATION_START=eu.navigationStart(),n.mux=e,n.id=t,null!=a&&a.beaconDomain&&n.mux.log.warn("The `beaconDomain` setting has been deprecated in favor of `beaconCollectionDomain`. Please change your integration to use `beaconCollectionDomain` instead of `beaconDomain`."),(a=Object.assign({debug:!1,minimumRebufferDuration:250,sustainedRebufferThreshold:1e3,playbackHeartbeatTime:25,beaconDomain:"litix.io",sampleRate:1,disableCookies:!1,respectDoNotTrack:!1,disableRebufferTracking:!1,disablePlayheadRebufferTracking:!1,errorTranslator:function(e){return e},emitTranslator:function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return t},stateDataTranslator:function(e){return e}},a)).data=a.data||{},a.data.property_key&&(a.data.env_key=a.data.property_key,delete a.data.property_key),X.level=a.debug?z.DEBUG:z.WARN,n.getPlayheadTime=a.getPlayheadTime,n.getStateData=a.getStateData||function(){return{}},n.getAdData=a.getAdData||function(){},n.minimumRebufferDuration=a.minimumRebufferDuration,n.sustainedRebufferThreshold=a.sustainedRebufferThreshold,n.playbackHeartbeatTime=a.playbackHeartbeatTime,n.disableRebufferTracking=a.disableRebufferTracking,n.disableRebufferTracking&&n.mux.log.warn("Disabling rebuffer tracking. This should only be used in specific circumstances as a last resort when your player is known to unreliably track rebuffering."),n.disablePlayheadRebufferTracking=a.disablePlayheadRebufferTracking,n.errorTranslator=a.errorTranslator,n.emitTranslator=a.emitTranslator,n.stateDataTranslator=a.stateDataTranslator,n.playbackEventDispatcher=new tu(e,a.data.env_key,a),n.data={player_instance_id:W(),mux_sample_rate:a.sampleRate,beacon_domain:a.beaconCollectionDomain||a.beaconDomain},n.data.view_sequence_number=1,n.data.player_sequence_number=1;var n,s=(function(){void 0===this.data.view_start&&(this.data.view_start=this.mux.utils.now(),this.emit("viewstart"))}).bind($(n));if(n.on("viewinit",function(e,t){this._resetVideoData(),this._resetViewData(),this._resetErrorData(),this._updateStateData(),Object.assign(this.data,t),this._initializeViewData(),this.one("play",s),this.one("adbreakstart",s)}),n.on("videochange",function(e,t){this._resetView(t)}),n.on("programchange",function(e,t){this.data.player_is_paused&&this.mux.log.warn("The `programchange` event is intended to be used when the content changes mid playback without the video source changing, however the video is not currently playing. If the video source is changing please use the videochange event otherwise you will lose startup time information."),this._resetView(Object.assign(t,{view_program_changed:!0})),s(),this.emit("play"),this.emit("playing")}),n.on("fragmentchange",function(e,t){this.currentFragmentPDT=t.currentFragmentPDT,this.currentFragmentStart=t.currentFragmentStart}),n.on("destroy",n.destroy),"undefined"!=typeof window&&"function"==typeof window.addEventListener&&"function"==typeof window.removeEventListener){var o=function(){var e=void 0!==n.data.view_start;n.mux.WINDOW_HIDDEN="hidden"===document.visibilityState,e&&n.mux.WINDOW_HIDDEN&&(n.data.player_is_paused||n.emit("hb"))};window.addEventListener("visibilitychange",o,!1);var l=function(e){e.persisted||n.destroy()};window.addEventListener("pagehide",l,!1),n.on("destroy",function(){window.removeEventListener("visibilitychange",o),window.removeEventListener("pagehide",l)})}return n.on("playerready",function(e,t){Object.assign(this.data,t)}),tm.forEach(function(e){n.on(e,function(t,i){0!==e.indexOf("ad")&&this._updateStateData(),Object.assign(this.data,i),this._sanitizeData()}),n.on("after"+e,function(){("error"!==e||this.errorTracker.viewErrored)&&this.send(e)})}),n.on("viewend",function(e,t){Object.assign(n.data,t)}),n.one("playerready",function(e){var t=this.mux.utils.now();this.data.player_init_time&&(this.data.player_startup_time=t-this.data.player_init_time),!this.mux.PLAYER_TRACKED&&this.NAVIGATION_START&&(this.mux.PLAYER_TRACKED=!0,(this.data.player_init_time||this.DOM_CONTENT_LOADED_EVENT_END)&&(this.data.page_load_time=Math.min(this.data.player_init_time||1/0,this.DOM_CONTENT_LOADED_EVENT_END||1/0)-this.NAVIGATION_START)),this.send("playerready"),delete this.data.player_startup_time,delete this.data.page_load_time}),n.longResumeTracker=new tc($(n)),n.errorTracker=new eO($(n)),new ej($(n)),n.seekingTracker=new eG($(n)),n.playheadTime=new eN($(n)),n.playbackHeartbeat=new eM($(n)),new eH($(n)),n.watchTimeTracker=new eP($(n)),new ex($(n)),n.adTracker=new eW($(n)),new eF($(n)),new eU($(n)),new eB($(n)),new eY($(n)),new th($(n)),a.hlsjs&&n.addHLSJS(a),a.dashjs&&n.addDashJS(a),n.emit("viewinit",a.data),n}return ei(r,[{key:"emit",value:function(e,t){var i,a=Object.assign({viewer_time:this.mux.utils.now()},t),n=[e,a];if(this.emitTranslator)try{n=this.emitTranslator(e,a)}catch(e){this.mux.log.warn("Exception in emit translator callback.",e)}null!=n&&n.length&&(i=en(ea(r.prototype),"emit",this)).call.apply(i,[this].concat(Q(n)))}},{key:"destroy",value:function(){this._destroyed||(this._destroyed=!0,void 0!==this.data.view_start&&(this.emit("viewend"),this.send("viewend")),this.playbackEventDispatcher.destroy(),this.removeHLSJS(),this.removeDashJS(),window.clearTimeout(this._heartBeatTimeout))}},{key:"send",value:function(e){if(this.data.view_id){var t=Object.assign({},this.data);if(void 0===t.video_source_is_live&&(t.player_source_duration===1/0||t.video_source_duration===1/0?t.video_source_is_live=!0:(t.player_source_duration>0||t.video_source_duration>0)&&(t.video_source_is_live=!1)),t.video_source_is_live||["player_program_time","player_manifest_newest_program_time","player_live_edge_program_time","player_program_time","video_holdback","video_part_holdback","video_target_duration","video_part_target_duration"].forEach(function(e){t[e]=void 0}),t.video_source_url=t.video_source_url||t.player_source_url,t.video_source_url){var i=B(el(t.video_source_url),2),r=i[0];t.video_source_domain=i[1],t.video_source_hostname=r}delete t.ad_request_id,this.playbackEventDispatcher.send(e,t),this.data.view_sequence_number++,this.data.player_sequence_number++,tf.has(e)||this._restartHeartBeat(),"viewend"===e&&delete this.data.view_id}}},{key:"_resetView",value:function(e){this.emit("viewend"),this.send("viewend"),this.emit("viewinit",e)}},{key:"_updateStateData",value:function(){var e=this.getStateData();if("function"==typeof this.stateDataTranslator)try{e=this.stateDataTranslator(e)}catch(e){this.mux.log.warn("Exception in stateDataTranslator translator callback.",e)}Object.assign(this.data,e),this.playheadTime._updatePlayheadTime(),this._sanitizeData()}},{key:"_sanitizeData",value:function(){var e=this;["player_width","player_height","video_source_width","video_source_height","player_playhead_time","video_source_bitrate"].forEach(function(t){var i=parseInt(e.data[t],10);e.data[t]=isNaN(i)?void 0:i}),["player_source_url","video_source_url"].forEach(function(t){if(e.data[t]){var i=e.data[t].toLowerCase();(0===i.indexOf("data:")||0===i.indexOf("blob:"))&&(e.data[t]="MSE style URL")}})}},{key:"_resetVideoData",value:function(){var e=this;Object.keys(this.data).forEach(function(t){0===t.indexOf("video_")&&delete e.data[t]})}},{key:"_resetViewData",value:function(){var e=this;Object.keys(this.data).forEach(function(t){0===t.indexOf("view_")&&delete e.data[t]}),this.data.view_sequence_number=1}},{key:"_resetErrorData",value:function(){delete this.data.player_error_code,delete this.data.player_error_message,delete this.data.player_error_context,delete this.data.player_error_severity,delete this.data.player_error_business_exception}},{key:"_initializeViewData",value:function(){var e=this,t=this.data.view_id=W(),i=function(){t===e.data.view_id&&eh(e.data,"player_view_count",1)};this.data.player_is_paused?this.one("play",i):i()}},{key:"_restartHeartBeat",value:function(){var e=this;window.clearTimeout(this._heartBeatTimeout),this._heartBeatTimeout=window.setTimeout(function(){e.data.player_is_paused||e.emit("hb")},1e4)}},{key:"addHLSJS",value:function(e){return e.hlsjs?this.hlsjs?void this.mux.log.warn("An instance of HLS.js is already being monitored for this player."):void(this.hlsjs=e.hlsjs,eT(this.mux,this.id,e.hlsjs,{},e.Hls||window.Hls)):void this.mux.log.warn("You must pass a valid hlsjs instance in order to track it.")}},{key:"removeHLSJS",value:function(){this.hlsjs&&(e_(this.hlsjs),this.hlsjs=void 0)}},{key:"addDashJS",value:function(e){return e.dashjs?this.dashjs?void this.mux.log.warn("An instance of Dash.js is already being monitored for this player."):void(this.dashjs=e.dashjs,ek(this.mux,this.id,e.dashjs)):void this.mux.log.warn("You must pass a valid dashjs instance in order to track it.")}},{key:"removeDashJS",value:function(){this.dashjs&&(eL(this.dashjs),this.dashjs=void 0)}}]),r}(ew),tg=E(N()),tv=["loadstart","pause","play","playing","seeking","seeked","timeupdate","ratechange","stalled","waiting","error","ended"],tE={1:"MEDIA_ERR_ABORTED",2:"MEDIA_ERR_NETWORK",3:"MEDIA_ERR_DECODE",4:"MEDIA_ERR_SRC_NOT_SUPPORTED"},ty=E(y());ty.default&&ty.default.WeakMap&&(tr=new WeakMap);var tb={TARGET_DURATION:"#EXT-X-TARGETDURATION",PART_INF:"#EXT-X-PART-INF",SERVER_CONTROL:"#EXT-X-SERVER-CONTROL",INF:"#EXTINF",PROGRAM_DATE_TIME:"#EXT-X-PROGRAM-DATE-TIME",VERSION:"#EXT-X-VERSION",SESSION_DATA:"#EXT-X-SESSION-DATA"},tT=function(e){return this.buffer="",this.manifest={segments:[],serverControl:{},sessionData:{}},this.currentUri={},this.process(e),this.manifest};tT.prototype.process=function(e){var t;for(this.buffer+=e,t=this.buffer.indexOf("\n");t>-1;t=this.buffer.indexOf("\n"))this.processLine(this.buffer.substring(0,t)),this.buffer=this.buffer.substring(t+1)},tT.prototype.processLine=function(e){var t=e.indexOf(":"),i=tL(e,t),r=i[0],a=2===i.length?tS(i[1]):void 0;if("#"!==r[0])this.currentUri.uri=r,this.manifest.segments.push(this.currentUri),!this.manifest.targetDuration||"duration"in this.currentUri||(this.currentUri.duration=this.manifest.targetDuration),this.currentUri={};else switch(r){case tb.TARGET_DURATION:if(!isFinite(a)||a<0)return;this.manifest.targetDuration=a,this.setHoldBack();break;case tb.PART_INF:t_(this.manifest,i),this.manifest.partInf.partTarget&&(this.manifest.partTargetDuration=this.manifest.partInf.partTarget),this.setHoldBack();break;case tb.SERVER_CONTROL:t_(this.manifest,i),this.setHoldBack();break;case tb.INF:0===a?this.currentUri.duration=.01:a>0&&(this.currentUri.duration=a);break;case tb.PROGRAM_DATE_TIME:var n=new Date(a);this.manifest.dateTimeString||(this.manifest.dateTimeString=a,this.manifest.dateTimeObject=n),this.currentUri.dateTimeString=a,this.currentUri.dateTimeObject=n;break;case tb.VERSION:t_(this.manifest,i);break;case tb.SESSION_DATA:var s=eE(tD(i[1]));Object.assign(this.manifest.sessionData,s)}},tT.prototype.setHoldBack=function(){var e=this.manifest,t=e.serverControl,i=e.targetDuration,r=e.partTargetDuration;if(t){var a="holdBack",n="partHoldBack",s=i&&3*i,o=r&&2*r;i&&!t.hasOwnProperty(a)&&(t[a]=s),s&&t[a]<s&&(t[a]=s),r&&!t.hasOwnProperty(n)&&(t[n]=3*r),r&&t[n]<o&&(t[n]=o)}};var t_=function(e,t){var i,r=tA(t[0].replace("#EXT-X-",""));tk(t[1])?(i={},i=Object.assign(tR(t[1]),i)):i=tS(t[1]),e[r]=i},tA=function(e){return e.toLowerCase().replace(/-(\w)/g,function(e){return e[1].toUpperCase()})},tS=function(e){if("yes"===e.toLowerCase()||"no"===e.toLowerCase())return"yes"===e.toLowerCase();var t=-1!==e.indexOf(":")?e:parseFloat(e);return isNaN(t)?e:t},tI=function(e){var t={},i=e.split("=");return i.length>1&&(t[tA(i[0])]=tS(i[1])),t},tR=function(e){for(var t=e.split(","),i={},r=0;t.length>r;r++)i=Object.assign(tI(t[r]),i);return i},tk=function(e){return e.indexOf("=")>-1},tL=function(e,t){return -1===t?[e]:[e.substring(0,t),e.substring(t+1)]},tD=function(e){var t={};if(e){var i=e.search(",");return[e.slice(0,i),e.slice(i+1)].forEach(function(e,i){for(var r=e.replace(/['"]+/g,"").split("="),a=0;a<r.length;a++)"DATA-ID"===r[a]&&(t["DATA-ID"]=r[1-a]),"VALUE"===r[a]&&(t.VALUE=r[1-a])}),{data:t}}},tw={safeCall:function(e,t,i,r){var a=r;if(e&&"function"==typeof e[t])try{a=e[t].apply(e,i)}catch(e){X.info("safeCall error",e)}return a},safeIncrement:eh,getComputedStyle:function(e,t){var i;return e&&t&&ty.default&&"function"==typeof ty.default.getComputedStyle?(tr&&tr.has(e)&&(i=tr.get(e)),i||(i=ty.default.getComputedStyle(e,null),tr&&tr.set(e,i)),i.getPropertyValue(t)):""},secondsToMs:function(e){return Math.floor(1e3*e)},assign:Object.assign,headersStringToObject:eg,cdnHeadersToRequestId:ev,extractHostnameAndDomain:el,extractHostname:eo,manifestParser:tT,generateShortID:q,generateUUID:W,now:V.now,findMediaElement:j},tC={},tM=function(e){var t=arguments;"string"==typeof e?tM.hasOwnProperty(e)?H.default.setTimeout(function(){t=Array.prototype.splice.call(t,1),tM[e].apply(null,t)},0):X.warn("`"+e+"` is an unknown task"):"function"==typeof e?H.default.setTimeout(function(){e(tM)},0):X.warn("`"+e+"` is invalid.")},tO={loaded:V.now(),NAME:"mux-embed",VERSION:"5.9.0",API_VERSION:"2.1",PLAYER_TRACKED:!1,monitor:function(e,t){return function(e,t,i){var r=B(j(t),3),a=r[0],n=r[1],s=r[2],o=e.log,l=e.utils.getComputedStyle,d=e.utils.secondsToMs;if(!a)return o.error("No element was found with the `"+n+"` query selector.");if("video"!==s&&"audio"!==s)return o.error("The element of `"+n+"` was not a media element.");a.mux&&(a.mux.destroy(),delete a.mux,o.warn("Already monitoring this video element, replacing existing event listeners")),(i=Object.assign({automaticErrorTracking:!0},i,{getPlayheadTime:function(){return d(a.currentTime)},getStateData:function(){var e,t,i=(null==(e=this.getPlayheadTime)?void 0:e.call(this))||d(a.currentTime),r=this.hlsjs&&this.hlsjs.url,n=this.dashjs&&"function"==typeof this.dashjs.getSource&&this.dashjs.getSource(),s={player_is_paused:a.paused,player_width:parseInt(l(a,"width")),player_height:parseInt(l(a,"height")),player_autoplay_on:a.autoplay,player_preload_on:a.preload,player_language_code:a.lang,player_is_fullscreen:tg.default&&!!(tg.default.fullscreenElement||tg.default.webkitFullscreenElement||tg.default.mozFullScreenElement||tg.default.msFullscreenElement),video_poster_url:a.poster,video_source_url:r||n||a.currentSrc,video_source_duration:d(a.duration),video_source_height:a.videoHeight,video_source_width:a.videoWidth,view_dropped_frame_count:null==a||null==(t=a.getVideoPlaybackQuality)?void 0:t.call(a).droppedVideoFrames};if(a.getStartDate&&i>0){var o=a.getStartDate();if(o&&"function"==typeof o.getTime&&o.getTime()){var u=o.getTime();s.player_program_time=u+i,a.seekable.length>0&&(s.player_live_edge_program_time=u+a.seekable.end(a.seekable.length-1))}}return s}})).data=Object.assign({player_software:"HTML5 Video Element",player_mux_plugin_name:"VideoElementMonitor",player_mux_plugin_version:e.VERSION},i.data),a.mux=a.mux||{},a.mux.deleted=!1,a.mux.emit=function(t,i){e.emit(n,t,i)},a.mux.updateData=function(e){a.mux.emit("hb",e)};var u=function(){o.error("The monitor for this video element has already been destroyed.")};a.mux.destroy=function(){Object.keys(a.mux.listeners).forEach(function(e){a.removeEventListener(e,a.mux.listeners[e],!1)}),delete a.mux.listeners,a.mux.destroy=u,a.mux.swapElement=u,a.mux.emit=u,a.mux.addHLSJS=u,a.mux.addDashJS=u,a.mux.removeHLSJS=u,a.mux.removeDashJS=u,a.mux.updateData=u,a.mux.setEmitTranslator=u,a.mux.setStateDataTranslator=u,a.mux.setGetPlayheadTime=u,a.mux.deleted=!0,e.emit(n,"destroy")},a.mux.swapElement=function(t){var i=B(j(t),3),r=i[0],n=i[1],s=i[2];return r?"video"!==s&&"audio"!==s?e.log.error("The element of `"+n+"` was not a media element."):void(r.muxId=a.muxId,delete a.muxId,r.mux=r.mux||{},r.mux.listeners=Object.assign({},a.mux.listeners),delete a.mux.listeners,Object.keys(r.mux.listeners).forEach(function(e){a.removeEventListener(e,r.mux.listeners[e],!1),r.addEventListener(e,r.mux.listeners[e],!1)}),r.mux.swapElement=a.mux.swapElement,r.mux.destroy=a.mux.destroy,delete a.mux,a=r):e.log.error("No element was found with the `"+n+"` query selector.")},a.mux.addHLSJS=function(t){e.addHLSJS(n,t)},a.mux.addDashJS=function(t){e.addDashJS(n,t)},a.mux.removeHLSJS=function(){e.removeHLSJS(n)},a.mux.removeDashJS=function(){e.removeDashJS(n)},a.mux.setEmitTranslator=function(t){e.setEmitTranslator(n,t)},a.mux.setStateDataTranslator=function(t){e.setStateDataTranslator(n,t)},a.mux.setGetPlayheadTime=function(t){t||(t=i.getPlayheadTime),e.setGetPlayheadTime(n,t)},e.init(n,i),e.emit(n,"playerready"),a.paused||(e.emit(n,"play"),a.readyState>2&&e.emit(n,"playing")),a.mux.listeners={},tv.forEach(function(t){("error"!==t||i.automaticErrorTracking)&&(a.mux.listeners[t]=function(){var i={};if("error"===t){if(!a.error||1===a.error.code)return;i.player_error_code=a.error.code,i.player_error_message=tE[a.error.code]||a.error.message}e.emit(n,t,i)},a.addEventListener(t,a.mux.listeners[t],!1))})}(tM,e,t)},destroyMonitor:function(e){var t=B(j(e),1)[0];t&&t.mux&&"function"==typeof t.mux.destroy?t.mux.destroy():X.error("A video element monitor for `"+e+"` has not been initialized via `mux.monitor`.")},addHLSJS:function(e,t){var i=Y(e);tC[i]?tC[i].addHLSJS(t):X.error("A monitor for `"+i+"` has not been initialized.")},addDashJS:function(e,t){var i=Y(e);tC[i]?tC[i].addDashJS(t):X.error("A monitor for `"+i+"` has not been initialized.")},removeHLSJS:function(e){var t=Y(e);tC[t]?tC[t].removeHLSJS():X.error("A monitor for `"+t+"` has not been initialized.")},removeDashJS:function(e){var t=Y(e);tC[t]?tC[t].removeDashJS():X.error("A monitor for `"+t+"` has not been initialized.")},init:function(e,t){J()&&t&&t.respectDoNotTrack&&X.info("The browser's Do Not Track flag is enabled - Mux beaconing is disabled.");var i=Y(e);tC[i]=new tp(tM,i,t)},emit:function(e,t,i){var r=Y(e);tC[r]?(tC[r].emit(t,i),"destroy"===t&&delete tC[r]):X.error("A monitor for `"+r+"` has not been initialized.")},updateData:function(e,t){var i=Y(e);tC[i]?tC[i].emit("hb",t):X.error("A monitor for `"+i+"` has not been initialized.")},setEmitTranslator:function(e,t){var i=Y(e);tC[i]?tC[i].emitTranslator=t:X.error("A monitor for `"+i+"` has not been initialized.")},setStateDataTranslator:function(e,t){var i=Y(e);tC[i]?tC[i].stateDataTranslator=t:X.error("A monitor for `"+i+"` has not been initialized.")},setGetPlayheadTime:function(e,t){var i=Y(e);tC[i]?tC[i].getPlayheadTime=t:X.error("A monitor for `"+i+"` has not been initialized.")},checkDoNotTrack:J,log:X,utils:tw,events:{PLAYER_READY:"playerready",VIEW_INIT:"viewinit",VIDEO_CHANGE:"videochange",PLAY:"play",PAUSE:"pause",PLAYING:"playing",TIME_UPDATE:"timeupdate",SEEKING:"seeking",SEEKED:"seeked",REBUFFER_START:"rebufferstart",REBUFFER_END:"rebufferend",ERROR:"error",ENDED:"ended",RENDITION_CHANGE:"renditionchange",ORIENTATION_CHANGE:"orientationchange",AD_REQUEST:"adrequest",AD_RESPONSE:"adresponse",AD_BREAK_START:"adbreakstart",AD_PLAY:"adplay",AD_PLAYING:"adplaying",AD_PAUSE:"adpause",AD_FIRST_QUARTILE:"adfirstquartile",AD_MID_POINT:"admidpoint",AD_THIRD_QUARTILE:"adthirdquartile",AD_ENDED:"adended",AD_BREAK_END:"adbreakend",AD_ERROR:"aderror",REQUEST_COMPLETED:"requestcompleted",REQUEST_FAILED:"requestfailed",REQUEST_CANCELLED:"requestcanceled",HEARTBEAT:"hb",DESTROY:"destroy"},WINDOW_HIDDEN:!1,WINDOW_UNLOADING:!1};Object.assign(tM,tO),void 0!==H.default&&"function"==typeof H.default.addEventListener&&H.default.addEventListener("pagehide",function(e){e.persisted||(tM.WINDOW_UNLOADING=!0)},!1);let tP=Number.isFinite||function(e){return"number"==typeof e&&isFinite(e)},tx=Number.isSafeInteger||function(e){return"number"==typeof e&&Math.abs(e)<=tN},tN=Number.MAX_SAFE_INTEGER||0x1fffffffffffff,tU=function(e){return e.NETWORK_ERROR="networkError",e.MEDIA_ERROR="mediaError",e.KEY_SYSTEM_ERROR="keySystemError",e.MUX_ERROR="muxError",e.OTHER_ERROR="otherError",e}({}),tF=function(e){return e.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",e.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",e.KEY_SYSTEM_NO_SESSION="keySystemNoSession",e.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",e.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",e.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",e.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",e.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",e.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",e.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",e.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",e.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",e.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",e.MANIFEST_LOAD_ERROR="manifestLoadError",e.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",e.MANIFEST_PARSING_ERROR="manifestParsingError",e.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",e.LEVEL_EMPTY_ERROR="levelEmptyError",e.LEVEL_LOAD_ERROR="levelLoadError",e.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",e.LEVEL_PARSING_ERROR="levelParsingError",e.LEVEL_SWITCH_ERROR="levelSwitchError",e.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",e.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",e.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",e.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",e.FRAG_LOAD_ERROR="fragLoadError",e.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",e.FRAG_DECRYPT_ERROR="fragDecryptError",e.FRAG_PARSING_ERROR="fragParsingError",e.FRAG_GAP="fragGap",e.REMUX_ALLOC_ERROR="remuxAllocError",e.KEY_LOAD_ERROR="keyLoadError",e.KEY_LOAD_TIMEOUT="keyLoadTimeOut",e.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",e.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",e.BUFFER_APPEND_ERROR="bufferAppendError",e.BUFFER_APPENDING_ERROR="bufferAppendingError",e.BUFFER_STALLED_ERROR="bufferStalledError",e.BUFFER_FULL_ERROR="bufferFullError",e.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",e.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",e.ASSET_LIST_LOAD_ERROR="assetListLoadError",e.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",e.ASSET_LIST_PARSING_ERROR="assetListParsingError",e.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",e.INTERNAL_EXCEPTION="internalException",e.INTERNAL_ABORTED="aborted",e.ATTACH_MEDIA_ERROR="attachMediaError",e.UNKNOWN="unknown",e}({}),tB=function(e){return e.MEDIA_ATTACHING="hlsMediaAttaching",e.MEDIA_ATTACHED="hlsMediaAttached",e.MEDIA_DETACHING="hlsMediaDetaching",e.MEDIA_DETACHED="hlsMediaDetached",e.MEDIA_ENDED="hlsMediaEnded",e.STALL_RESOLVED="hlsStallResolved",e.BUFFER_RESET="hlsBufferReset",e.BUFFER_CODECS="hlsBufferCodecs",e.BUFFER_CREATED="hlsBufferCreated",e.BUFFER_APPENDING="hlsBufferAppending",e.BUFFER_APPENDED="hlsBufferAppended",e.BUFFER_EOS="hlsBufferEos",e.BUFFERED_TO_END="hlsBufferedToEnd",e.BUFFER_FLUSHING="hlsBufferFlushing",e.BUFFER_FLUSHED="hlsBufferFlushed",e.MANIFEST_LOADING="hlsManifestLoading",e.MANIFEST_LOADED="hlsManifestLoaded",e.MANIFEST_PARSED="hlsManifestParsed",e.LEVEL_SWITCHING="hlsLevelSwitching",e.LEVEL_SWITCHED="hlsLevelSwitched",e.LEVEL_LOADING="hlsLevelLoading",e.LEVEL_LOADED="hlsLevelLoaded",e.LEVEL_UPDATED="hlsLevelUpdated",e.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",e.LEVELS_UPDATED="hlsLevelsUpdated",e.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",e.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",e.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",e.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",e.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",e.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",e.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",e.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",e.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",e.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",e.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",e.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",e.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",e.CUES_PARSED="hlsCuesParsed",e.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",e.INIT_PTS_FOUND="hlsInitPtsFound",e.FRAG_LOADING="hlsFragLoading",e.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",e.FRAG_LOADED="hlsFragLoaded",e.FRAG_DECRYPTED="hlsFragDecrypted",e.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",e.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",e.FRAG_PARSING_METADATA="hlsFragParsingMetadata",e.FRAG_PARSED="hlsFragParsed",e.FRAG_BUFFERED="hlsFragBuffered",e.FRAG_CHANGED="hlsFragChanged",e.FPS_DROP="hlsFpsDrop",e.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",e.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",e.ERROR="hlsError",e.DESTROYING="hlsDestroying",e.KEY_LOADING="hlsKeyLoading",e.KEY_LOADED="hlsKeyLoaded",e.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",e.BACK_BUFFER_REACHED="hlsBackBufferReached",e.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",e.ASSET_LIST_LOADING="hlsAssetListLoading",e.ASSET_LIST_LOADED="hlsAssetListLoaded",e.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",e.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",e.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",e.INTERSTITIAL_STARTED="hlsInterstitialStarted",e.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",e.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",e.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",e.INTERSTITIAL_ENDED="hlsInterstitialEnded",e.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",e.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",e.EVENT_CUE_ENTER="hlsEventCueEnter",e}({});var tH={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},tG={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class tK{sample(e,t){let i=Math.pow(this.alpha_,e);this.estimate_=t*(1-i)+i*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){let e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}constructor(e,t=0,i=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=i}}class tV{update(e,t){let{slow_:i,fast_:r,ttfb_:a}=this;i.halfLife!==e&&(this.slow_=new tK(e,i.getEstimate(),i.getTotalWeight())),r.halfLife!==t&&(this.fast_=new tK(t,r.getEstimate(),r.getTotalWeight())),a.halfLife!==e&&(this.ttfb_=new tK(e,a.getEstimate(),a.getTotalWeight()))}sample(e,t){let i=(e=Math.max(e,this.minDelayMs_))/1e3,r=8*t/i;this.fast_.sample(i,r),this.slow_.sample(i,r)}sampleTTFB(e){let t=Math.sqrt(2)*Math.exp(-Math.pow(e/1e3,2)/2);this.ttfb_.sample(t,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}constructor(e,t,i,r=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=i,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new tK(e),this.fast_=new tK(t),this.defaultTTFB_=r,this.ttfb_=new tK(e)}}function tW(){return(tW=Object.assign.bind()).apply(null,arguments)}function tq(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,r)}return i}function tY(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?tq(Object(i),!0).forEach(function(t){var r,a;r=t,a=i[t],(r=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t);if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(r))in e?Object.defineProperty(e,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[r]=a}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):tq(Object(i)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}class tj{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;let i="[".concat(e,"]:");this.trace=tQ,this.debug=t.debug.bind(null,i),this.log=t.log.bind(null,i),this.warn=t.warn.bind(null,i),this.info=t.info.bind(null,i),this.error=t.error.bind(null,i)}}let tQ=function(){},tz={trace:tQ,debug:tQ,log:tQ,warn:tQ,info:tQ,error:tQ};function tX(){return tW({},tz)}function tZ(e,t,i){return t[e]?t[e].bind(t):function(e,t){let i=self.console[e];return i?i.bind(self.console,"".concat(t?"["+t+"] ":"","[").concat(e,"] >")):tQ}(e,i)}let tJ=tX();function t$(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];if("undefined"!=typeof self)return(e||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function t0(e,t){let i=Object.keys(e),r=Object.keys(t),a=i.length,n=r.length;return!a||!n||a===n&&!i.some(e=>-1===r.indexOf(e))}function t1(e){let t,i,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("undefined"!=typeof TextDecoder){let t=new TextDecoder("utf-8").decode(e);if(r){let e=t.indexOf("\0");return -1!==e?t.substring(0,e):t}return t.replace(/\0/g,"")}let a=e.length,n="",s=0;for(;s<a&&(0!==(t=e[s++])||!r);)if(0!==t&&3!==t)switch(t>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:n+=String.fromCharCode(t);break;case 12:case 13:n+=String.fromCharCode((31&t)<<6|63&(i=e[s++]));break;case 14:n+=String.fromCharCode((15&t)<<12|(63&(i=e[s++]))<<6|63&e[s++])}return n}function t2(e){let t="";for(let i=0;i<e.length;i++){let r=e[i].toString(16);r.length<2&&(r="0"+r),t+=r}return t}function t3(e){return Uint8Array.from(e.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}var t4={exports:{}},t5=function(){var e,t,i,r,a;return lM?t4.exports:(lM=1,e=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,t=/^(?=([^\/?#]*))\1([^]*)$/,i=/(?:\/|^)\.(?=\/)/g,r=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,t4.exports=a={buildAbsoluteURL:function(e,i,r){if(r=r||{},e=e.trim(),!(i=i.trim())){if(!r.alwaysNormalize)return e;var n=a.parseURL(e);if(!n)throw Error("Error trying to parse base URL.");return n.path=a.normalizePath(n.path),a.buildURLFromParts(n)}var s=a.parseURL(i);if(!s)throw Error("Error trying to parse relative URL.");if(s.scheme)return r.alwaysNormalize?(s.path=a.normalizePath(s.path),a.buildURLFromParts(s)):i;var o=a.parseURL(e);if(!o)throw Error("Error trying to parse base URL.");if(!o.netLoc&&o.path&&"/"!==o.path[0]){var l=t.exec(o.path);o.netLoc=l[1],o.path=l[2]}o.netLoc&&!o.path&&(o.path="/");var d={scheme:o.scheme,netLoc:s.netLoc,path:null,params:s.params,query:s.query,fragment:s.fragment};if(!s.netLoc&&(d.netLoc=o.netLoc,"/"!==s.path[0]))if(s.path){var u=o.path,h=u.substring(0,u.lastIndexOf("/")+1)+s.path;d.path=a.normalizePath(h)}else d.path=o.path,!s.params&&(d.params=o.params,s.query||(d.query=o.query));return null===d.path&&(d.path=r.alwaysNormalize?a.normalizePath(s.path):s.path),a.buildURLFromParts(d)},parseURL:function(t){var i=e.exec(t);return i?{scheme:i[1]||"",netLoc:i[2]||"",path:i[3]||"",params:i[4]||"",query:i[5]||"",fragment:i[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(i,"");e.length!==(e=e.replace(r,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}},t4.exports)}();class t8{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var t9={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class t6{setByteRange(e,t){let i,r=e.split("@",2);i=1===r.length?(null==t?void 0:t.byteRangeEndOffset)||0:parseInt(r[1]),this._byteRange=[i,parseInt(r[0])+i]}get baseurl(){return this.base.url}get byteRange(){return null===this._byteRange?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return null===this._streams&&(this._streams={[t9.AUDIO]:null,[t9.VIDEO]:null,[t9.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return null!==this._stats}get hasStreams(){return null!==this._streams}get stats(){return null===this._stats&&(this._stats=new t8),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=t5.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){let{elementaryStreams:e}=this;e[t9.AUDIO]=null,e[t9.VIDEO]=null,e[t9.AUDIOVIDEO]=null}constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,"string"==typeof e&&(e={url:e}),this.base=e,function(e,t){let i=function e(t,i){let r=Object.getPrototypeOf(t);if(r){let t=Object.getOwnPropertyDescriptor(r,i);return t||e(r,i)}}(e,t);i&&(i.enumerable=!0,Object.defineProperty(e,t,i))}(this,"stats")}}function t7(e){return"initSegment"!==e.sn}class ie extends t6{get byteLength(){if(this.hasStats){let e=this.stats.total;if(e)return e}if(this.byteRange.length){let e=this.byteRange[0],t=this.byteRange[1];if(tP(e)&&tP(t))return t-e}return null}get bitrate(){return this.byteLength?8*this.byteLength/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){let{levelkeys:e}=this;if(!e&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){let e=this.levelkeys.identity;if(e)this._decryptdata=e.getDecryptData(this.sn);else{let e=Object.keys(this.levelkeys);if(1===e.length){let t=this._decryptdata=this.levelkeys[e[0]]||null;if(t)return t.getDecryptData(this.sn)}}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(null===this.programDateTime)return null;let e=tP(this.duration)?this.duration:0;return this.programDateTime+1e3*e}get encrypted(){var e,t;if(null!=(e=this._decryptdata)&&e.encrypted)return!0;if(this.levelkeys){let e=Object.keys(this.levelkeys),i=e.length;if(i>1||1===i&&null!=(t=this.levelkeys[e[0]])&&t.encrypted)return!0}return!1}get programDateTime(){return null===this._programDateTime&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!tP(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return t7(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){if(this.levelkeys){let t=this.levelkeys[e];t&&!this._decryptdata&&(this._decryptdata=t.getDecryptData(this.sn))}}abortRequests(){var e,t;null==(e=this.loader)||e.abort(),null==(t=this.keyLoader)||t.abort()}setElementaryStreamInfo(e,t,i,r,a){let n=arguments.length>5&&void 0!==arguments[5]&&arguments[5],{elementaryStreams:s}=this,o=s[e];if(!o){s[e]={startPTS:t,endPTS:i,startDTS:r,endDTS:a,partial:n};return}o.startPTS=Math.min(o.startPTS,t),o.endPTS=Math.max(o.endPTS,i),o.startDTS=Math.min(o.startDTS,r),o.endDTS=Math.max(o.endDTS,a)}constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}}class it extends t6{get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){let{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}constructor(e,t,i,r,a){super(i),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=r;let n=e.enumeratedString("BYTERANGE");n&&this.setByteRange(n,a),a&&(this.fragOffset=a.fragOffset+a.duration)}}let ii=[].push,ir={video:1,audio:2,id3:3,text:4};function ia(e){return String.fromCharCode.apply(null,e)}function is(e,t){let i=e[t]<<8|e[t+1];return i<0?65536+i:i}function io(e,t){let i=id(e,t);return i<0?0x100000000+i:i}function il(e,t){let i=io(e,t);return i*=0x100000000,i+=io(e,t+4)}function id(e,t){return e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}function iu(e,t){let i=[];if(!t.length)return i;let r=e.byteLength;for(let a=0;a<r;){let n=io(e,a),s=ia(e.subarray(a+4,a+8)),o=n>1?a+n:r;if(s===t[0])if(1===t.length)i.push(e.subarray(a+8,o));else{let r=iu(e.subarray(a+8,o),t.slice(1));r.length&&ii.apply(i,r)}a=o}return i}function ih(e){let t=[],i=iu(e,["moov","trak"]);for(let e=0;e<i.length;e++){let r=i[e],a=iu(r,["tkhd"])[0];if(a){let e=a[0],i=io(a,0===e?12:20),n=iu(r,["mdia","mdhd"])[0];if(n){e=n[0];let a=io(n,0===e?12:20),s=iu(r,["mdia","hdlr"])[0];if(s){let e=ia(s.subarray(8,12)),n={soun:t9.AUDIO,vide:t9.VIDEO}[e],o=function(e){let t,i=e.subarray(8),r=i.subarray(86),a=ia(i.subarray(4,8)),n=a,s="enca"===a||"encv"===a;if(s){let e=iu(i,[a])[0].subarray("enca"===a?28:78);iu(e,["sinf"]).forEach(e=>{let t=iu(e,["schm"])[0];if(t){let i=ia(t.subarray(4,8));if("cbcs"===i||"cenc"===i){let t=iu(e,["frma"])[0];t&&(n=ia(t))}}})}let o=n;switch(n){case"avc1":case"avc2":case"avc3":case"avc4":{let e=iu(r,["avcC"])[0];e&&e.length>3&&(n+="."+ip(e[1])+ip(e[2])+ip(e[3]),t=ic("avc1"===o?"dva1":"dvav",r));break}case"mp4a":{let e=iu(i,[a])[0],t=iu(e.subarray(28),["esds"])[0];if(t&&t.length>7){let e=4;if(3!==t[e++])break;e=im(t,e)+2;let i=t[e++];if(128&i&&(e+=2),64&i&&(e+=t[e++]),4!==t[e++])break;e=im(t,e);let r=t[e++];if(64===r)n+="."+ip(r);else break;if(e+=12,5!==t[e++])break;e=im(t,e);let a=t[e++],s=(248&a)>>3;31===s&&(s+=1+((7&a)<<3)+((224&t[e])>>5)),n+="."+s}break}case"hvc1":case"hev1":{let e=iu(r,["hvcC"])[0];if(e&&e.length>12){let t=e[1],i=["","A","B","C"][t>>6],r=io(e,2),a=e[12],s=e.subarray(6,12);n+="."+i+(31&t),n+="."+(function(e){let t=0;for(let i=0;i<32;i++)t|=(e>>i&1)<<31-i;return t>>>0})(r).toString(16).toUpperCase(),n+="."+((32&t)>>5?"H":"L")+a;let o="";for(let e=s.length;e--;){let t=s[e];(t||o)&&(o="."+t.toString(16).toUpperCase()+o)}n+=o}t=ic("hev1"==o?"dvhe":"dvh1",r);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":n=ic(n,r)||n;break;case"vp09":{let e=iu(r,["vpcC"])[0];if(e&&e.length>6){let t=e[4],i=e[5],r=e[6]>>4&15;n+="."+ig(t)+"."+ig(i)+"."+ig(r)}break}case"av01":{let e=iu(r,["av1C"])[0];if(e&&e.length>2){let i=e[1]>>>5,a=31&e[1],s=e[2]>>>7?"H":"M",o=(64&e[2])>>6,l=(32&e[2])>>5,d=(16&e[2])>>4,u=(8&e[2])>>3,h=(4&e[2])>>2,c=3&e[2];n+="."+i+"."+ig(a)+s+"."+ig(2===i&&o?l?12:10:o?10:8)+"."+d+"."+u+h+c+"."+ig(1)+"."+ig(1)+"."+ig(1)+".0",t=ic("dav1",r)}}}return{codec:n,encrypted:s,supplemental:t}}(iu(r,["mdia","minf","stbl","stsd"])[0]);n?(t[i]={timescale:a,type:n,stsd:o},t[n]=tY({timescale:a,id:i},o)):t[i]={timescale:a,type:e,stsd:o}}}}}return iu(e,["moov","mvex","trex"]).forEach(e=>{let i=t[io(e,4)];i&&(i.default={duration:io(e,12),flags:io(e,20)})}),t}function ic(e,t){let i=iu(t,["dvvC"]),r=i.length?i[0]:iu(t,["dvcC"])[0];if(r){let t=r[2]>>1&127,i=r[2]<<5&32|r[3]>>3&31;return e+"."+ig(t)+"."+ig(i)}}function im(e,t){let i=t+5;for(;128&e[t++]&&t<i;);return t}function ip(e){return("0"+e.toString(16).toUpperCase()).slice(-2)}function ig(e){return(e<10?"0":"")+e}function iv(e){let t=iu(e,["schm"])[0];if(t){let i=ia(t.subarray(4,8));if("cbcs"===i||"cenc"===i)return iu(e,["schi","tenc"])[0]}return null}function iE(e,t){let i=new Uint8Array(e.length+t.length);return i.set(e),i.set(t,e.length),i}function iy(e,t){let i=[],r=t.samples,a=t.timescale,n=t.id,s=!1;return iu(r,["moof"]).map(o=>{let l=o.byteOffset-8;iu(o,["traf"]).map(o=>{let d=iu(o,["tfdt"]).map(e=>{let t=e[0],i=io(e,4);return 1===t&&(i*=0x100000000,i+=io(e,8)),i/a})[0];return void 0!==d&&(e=d),iu(o,["tfhd"]).map(d=>{let u=io(d,4),h=0xffffff&io(d,0),c=0,m=0,f=8;u===n&&((1&h)!=0&&(f+=8),(2&h)!=0&&(f+=4),(8&h)!=0&&(c=io(d,f),f+=4),(16&h)!=0&&(m=io(d,f),f+=4),(32&h)!=0&&(f+=4),"video"===t.type&&(s=ib(t.codec)),iu(o,["trun"]).map(n=>{let o=n[0],d=0xffffff&io(n,0),u=0,h=(256&d)!=0,f=0,p=(512&d)!=0,g=0,E=(1024&d)!=0,y=(2048&d)!=0,b=0,T=io(n,4),_=8;(1&d)!=0&&(u=io(n,_),_+=4),(4&d)!=0&&(_+=4);let A=u+l;for(let l=0;l<T;l++){if(h?(f=io(n,_),_+=4):f=c,p?(g=io(n,_),_+=4):g=m,E&&(_+=4),y&&(b=0===o?io(n,_):id(n,_),_+=4),t.type===t9.VIDEO){let t=0;for(;t<g;){let n=io(r,A);A+=4,function(e,t){if(!e)return 6==(31&t);{let e=t>>1&63;return 39===e||40===e}}(s,r[A])&&iT(r.subarray(A,A+n),s?2:1,e+b/a,i),A+=n,t+=n+4}}e+=f/a}}))})})}),i}function ib(e){if(!e)return!1;let t=e.substring(0,4);return"hvc1"===t||"hev1"===t||"dvh1"===t||"dvhe"===t}function iT(e,t,i,r){let a,n=i_(e);a=0+t;let s=0,o=0,l=0;for(;a<n.length;){s=0;do{if(a>=n.length)break;s+=l=n[a++]}while(255===l)o=0;do{if(a>=n.length)break;o+=l=n[a++]}while(255===l)let e=n.length-a,t=a;if(o<e)a+=o;else if(o>e){tJ.error("Malformed SEI payload. ".concat(o," is too small, only ").concat(e," bytes left to parse."));break}if(4===s){if(181===n[t++]){let e=is(n,t);if(t+=2,49===e){let e=io(n,t);if(t+=4,0x47413934===e){let e=n[t++];if(3===e){let a=n[t++],o=31&a,l=64&a,d=l?2+3*o:0,u=new Uint8Array(d);if(l){u[0]=a;for(let e=1;e<d;e++)u[e]=n[t++]}r.push({type:e,payloadType:s,pts:i,bytes:u})}}}}}else if(5===s&&o>16){let e=[];for(let i=0;i<16;i++){let r=n[t++].toString(16);e.push(1==r.length?"0"+r:r),(3===i||5===i||7===i||9===i)&&e.push("-")}let a=o-16,l=new Uint8Array(a);for(let e=0;e<a;e++)l[e]=n[t++];r.push({payloadType:s,pts:i,uuid:e.join(""),userData:t1(l),userDataBytes:l})}}}function i_(e){let t=e.byteLength,i=[],r=1;for(;r<t-2;)0===e[r]&&0===e[r+1]&&3===e[r+2]?(i.push(r+2),r+=2):r++;if(0===i.length)return e;let a=t-i.length,n=new Uint8Array(a),s=0;for(r=0;r<a;s++,r++)s===i[0]&&(s++,i.shift()),n[r]=e[s];return n}let iA=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),iS={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function iI(e,t){let i=iS[t];return!!i&&!!i[e.slice(0,4)]}function iR(e,t){let i=!(arguments.length>2)||void 0===arguments[2]||arguments[2];return!e.split(",").some(e=>!ik(e,t,i))}function ik(e,t){var i;let r=!(arguments.length>2)||void 0===arguments[2]||arguments[2],a=t$(r);return null!=(i=null==a?void 0:a.isTypeSupported(iL(e,t)))&&i}function iL(e,t){return"".concat(t,"/mp4;codecs=").concat(e)}function iD(e){if(e){let t=e.substring(0,4);return iS.video[t]}return 2}function iw(e){let t=iA();return e.split(",").reduce((e,i)=>{let r=t&&ib(i)?9:iS.video[i];return r?(2*r+e)/(e?3:2):(iS.audio[i]+e)/(e?2:1)},0)}let iC={},iM=/flac|opus|mp4a\.40\.34/i;function iO(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];return e.replace(iM,e=>(function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];if(iC[e])return iC[e];let i={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[e];for(let a=0;a<i.length;a++){var r;if(ik(i[a],"audio",t))return iC[e]=i[a],i[a];if("mp3"===i[a]&&null!=(r=t$(t))&&r.isTypeSupported("audio/mpeg"))return""}return e})(e.toLowerCase(),t))}function iP(e,t){if(e&&(e.length>4||-1!==["ac-3","ec-3","alac","fLaC","Opus"].indexOf(e))&&(ix(e,"audio")||ix(e,"video")))return e;if(t){let i=t.split(",");if(i.length>1){if(e){for(let t=i.length;t--;)if(i[t].substring(0,4)===e.substring(0,4))return i[t]}return i[0]}}return t||e}function ix(e,t){return iI(e,t)&&ik(e,t)}function iN(e){let t=t$(e)||{isTypeSupported:()=>!1};return{mpeg:t.isTypeSupported("audio/mpeg"),mp3:t.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:t.isTypeSupported('audio/mp4; codecs="ac-3"')}}function iU(e){return e.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}let iF={supported:!1,smooth:!1,powerEfficient:!1},iB={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]};function iH(e,t){return{supported:!1,configurations:t,decodingInfoResults:[iF],error:e}}function iG(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=e.videoCodec;if(!a&&!e.audioCodec||!i)return Promise.resolve(iB);let n=[],s=function(e){var t;let i=null==(t=e.videoCodec)?void 0:t.split(","),r=iK(e),a=e.width||640,n=e.height||480,s=e.frameRate||30,o=e.videoRange.toLowerCase();return i?i.map(e=>{let t={contentType:iL(function(e){if(e.startsWith("av01.")){let t=e.split("."),i=["0","111","01","01","01","0"];for(let e=t.length;e>4&&e<10;e++)t[e]=i[e-4];return t.join(".")}return e}(e),"video"),width:a,height:n,bitrate:r,framerate:s};return"sdr"!==o&&(t.transferFunction=o),t}):[]}(e),o=s.length,l=function(e,t,i){var r;let a=null==(r=e.audioCodec)?void 0:r.split(","),n=iK(e);return a&&e.audioGroups?e.audioGroups.reduce((e,r)=>{var s;let o=r?null==(s=t.groups[r])?void 0:s.tracks:null;return o?o.reduce((e,t)=>{if(t.groupId===r){let r=parseFloat(t.channels||"");a.forEach(t=>{let a={contentType:iL(t,"audio"),bitrate:i?function(e,t){if(t<=1)return 1;let i=128e3;return"ec-3"===e?i=768e3:"ac-3"===e&&(i=64e4),Math.min(t/2,i)}(t,n):n};r&&(a.channels=""+r),e.push(a)})}return e},e):e},[]):[]}(e,t,o>0),d=l.length;for(let e=o||+d||1;e--;){let t={type:"media-source"};if(o&&(t.video=s[e%o]),d){t.audio=l[e%d];let i=t.audio.bitrate;t.video&&i&&(t.video.bitrate-=i)}n.push(t)}if(a){let e=navigator.userAgent;if(a.split(",").some(e=>ib(e))&&iA())return Promise.resolve(iH(Error("Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (".concat(e,")")),n))}return Promise.all(n.map(e=>{let t=function(e){let t="",{audio:i,video:r}=e;if(r){let e=iU(r.contentType);t+="".concat(e,"_r").concat(r.height,"x").concat(r.width,"f").concat(Math.ceil(r.framerate)).concat(r.transferFunction||"sd","_").concat(Math.ceil(r.bitrate/1e5))}if(i){let e=iU(i.contentType);t+="".concat(r?"_":"").concat(e,"_c").concat(i.channels)}return t}(e);return r[t]||(r[t]=i.decodingInfo(e))})).then(e=>({supported:!e.some(e=>!e.supported),configurations:n,decodingInfoResults:e})).catch(e=>({supported:!1,configurations:n,decodingInfoResults:[],error:e}))}function iK(e){return 1e3*Math.ceil(Math.max(.9*e.bitrate,e.averageBitrate)/1e3)||1}let iV=["NONE","TYPE-0","TYPE-1",null],iW=["SDR","PQ","HLG"];var iq={No:"",Yes:"YES",v2:"v2"};function iY(e){let{canSkipUntil:t,canSkipDateRanges:i,age:r}=e;return t&&r<t/2?i?iq.v2:iq.Yes:iq.No}class ij{addDirectives(e){let t=new self.URL(e);return void 0!==this.msn&&t.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}constructor(e,t,i){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=i}}class iQ{get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return iz(this._audioGroups,e)}hasSubtitleGroup(e){return iz(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if("audio"===e){let e=this._audioGroups;e||(e=this._audioGroups=[]),-1===e.indexOf(t)&&e.push(t)}else if("text"===e){let e=this._subtitleGroups;e||(e=this._subtitleGroups=[]),-1===e.indexOf(t)&&e.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return null==(e=this.audioGroups)?void 0:e[0]}get textGroupId(){var e;return null==(e=this.subtitleGroups)?void 0:e[0]}addFallback(){}constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(e=>!!e).map(e=>e.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;let i=null==(t=e.supplemental)?void 0:t.videoCodec;i&&i!==e.videoCodec&&(this.codecSet+=",".concat(i.substring(0,4)))}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}}function iz(e,t){return!!t&&!!e&&-1!==e.indexOf(t)}let iX=(e,t)=>JSON.stringify(e,(e=>{let t=new WeakSet;return(i,r)=>{if(e&&(r=e(i,r)),"object"==typeof r&&null!==r){if(t.has(r))return;t.add(r)}return r}})(t));function iZ(e,t){tJ.log('[abr] start candidates with "'.concat(e,'" ignored because ').concat(t))}function iJ(e){return e.reduce((e,t)=>{let i=e.groups[t.groupId];i||(i=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),i.tracks.push(t);let r=t.channels||"2";return i.channels[r]=(i.channels[r]||0)+1,i.hasDefault=i.hasDefault||t.default,i.hasAutoSelect=i.hasAutoSelect||t.autoselect,i.hasDefault&&(e.hasDefaultAudio=!0),i.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function i$(e){if(!e)return e;let{lang:t,assocLang:i,characteristics:r,channels:a,audioCodec:n}=e;return{lang:t,assocLang:i,characteristics:r,channels:a,audioCodec:n}}function i0(e,t,i){if("attrs"in e){let i=t.indexOf(e);if(-1!==i)return i}for(let r=0;r<t.length;r++)if(i1(e,t[r],i))return r;return -1}function i1(e,t,i){let{groupId:r,name:a,lang:n,assocLang:s,default:o}=e,l=e.forced;return(void 0===r||t.groupId===r)&&(void 0===a||t.name===a)&&(void 0===n||function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"--";return e.length===t.length?e===t:e.startsWith(t)||t.startsWith(e)}(n,t.lang))&&(void 0===n||t.assocLang===s)&&(void 0===o||t.default===o)&&(void 0===l||t.forced===l)&&(!("characteristics"in e)||function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=e.split(","),r=t.split(",");return i.length===r.length&&!i.some(e=>-1===r.indexOf(e))}(e.characteristics||"",t.characteristics))&&(void 0===i||i(e,t))}function i2(e,t){let{audioCodec:i,channels:r}=e;return(void 0===i||(t.audioCodec||"").substring(0,4)===i.substring(0,4))&&(void 0===r||r===(t.channels||"2"))}function i3(e,t,i){for(let r=t;r>-1;r--)if(i(e[r]))return r;for(let r=t+1;r<e.length;r++)if(i(e[r]))return r;return -1}function i4(e,t){var i;return!!e&&e!==(null==(i=t.loadLevelObj)?void 0:i.uri)}let i5={search:function(e,t){let i=0,r=e.length-1,a=null,n=null;for(;i<=r;){let s=t(n=e[a=(i+r)/2|0]);if(s>0)i=a+1;else{if(!(s<0))return n;r=a-1}}return null}};function i8(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.005,n=null;if(e){n=t[1+e.sn-t[0].sn]||null;let r=e.endDTS-i;r>0&&r<15e-7&&(i+=15e-7),n&&e.level!==n.level&&n.end<=e.end&&(n=t[2+e.sn-t[0].sn]||null)}else 0===i&&0===t[0].start&&(n=t[0]);if(n&&((!e||e.level===n.level)&&0===i9(i,r,n)||function(e,t,i){if(t&&0===t.start&&t.level<e.level&&(t.endPTS||0)>0){let r=t.tagList.reduce((e,t)=>("INF"===t[0]&&(e+=parseFloat(t[1])),e),i);return e.start<=r}return!1}(n,e,Math.min(a,r))))return n;let s=i5.search(t,i9.bind(null,i,r));return s&&(s!==e||!n)?s:n}function i9(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;if(i.start<=e&&i.start+i.duration>e)return 0;let r=Math.min(t,i.duration+(i.deltaPTS?i.deltaPTS:0));return i.start+i.duration-r<=e?1:i.start-r>e&&i.start?-1:0}function i6(e,t,i){if(e&&e.startCC<=t&&e.endCC>=t){let r,a=e.fragments,{fragmentHint:n}=e;return n&&(a=a.concat(n)),i5.search(a,e=>e.cc<t?1:e.cc>t?-1:(r=e,e.end<=i)?1:e.start>i?-1:0),r||null}return null}function i7(e){switch(e.details){case tF.FRAG_LOAD_TIMEOUT:case tF.KEY_LOAD_TIMEOUT:case tF.LEVEL_LOAD_TIMEOUT:case tF.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function re(e){return e.details.startsWith("key")}function rt(e){return re(e)&&!!e.frag&&!e.frag.decryptdata}function ri(e,t){let i=i7(t);return e.default["".concat(i?"timeout":"error","Retry")]}function rr(e,t){return Math.min(("linear"===e.backoff?1:Math.pow(2,t))*e.retryDelayMs,e.maxRetryDelayMs)}function ra(e){return tY(tY({},e),{errorRetry:null,timeoutRetry:null})}function rn(e,t,i,r){var a;if(!e)return!1;let n=null==r?void 0:r.code,s=t<e.maxNumRetry&&(rs(a=n)||!!a&&(a<400||a>499)||!!i);return e.shouldRetry?e.shouldRetry(e,t,i,r,s):s}function rs(e){return 0===e&&!1===navigator.onLine}var ro={DoNothing:0,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,RetryRequest:5},rl={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,MoveAllAlternatesMatchingKey:4};function rd(e){let t={action:ro.DoNothing,flags:rl.None};return e&&(t.resolved=!0),t}var ru={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class rh{_registerListeners(){let{hls:e}=this;e&&(e.on(tB.MANIFEST_LOADING,this.onManifestLoading,this),e.on(tB.BUFFER_APPENDED,this.onBufferAppended,this),e.on(tB.FRAG_BUFFERED,this.onFragBuffered,this),e.on(tB.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){let{hls:e}=this;e&&(e.off(tB.MANIFEST_LOADING,this.onManifestLoading,this),e.off(tB.BUFFER_APPENDED,this.onBufferAppended,this),e.off(tB.FRAG_BUFFERED,this.onFragBuffered,this),e.off(tB.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){let i=this.activePartLists[t];if(i)for(let t=i.length;t--;){let r=i[t];if(!r)break;if(r.start<=e&&e<=r.end&&r.loaded)return r}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,i){let{fragments:r}=this,a=Object.keys(r);for(let n=a.length;n--;){let s=r[a[n]];if((null==s?void 0:s.body.type)===t&&(!i||s.buffered)){let t=s.body;if(t.start<=e&&e<=t.end)return t}}return null}detectEvictedFragments(e,t,i,r,a){this.timeRanges&&(this.timeRanges[e]=t);let n=(null==r?void 0:r.fragment.sn)||-1;Object.keys(this.fragments).forEach(r=>{let s=this.fragments[r];if(!s||n>=s.body.sn)return;if(!s.buffered&&(!s.loaded||a)){s.body.type===i&&this.removeFragment(s.body);return}let o=s.range[e];if(o){if(0===o.time.length)return void this.removeFragment(s.body);o.time.some(e=>{let i=!this.isTimeBuffered(e.startPTS,e.endPTS,t);return i&&this.removeFragment(s.body),i})}})}detectPartialFragments(e){let t=this.timeRanges;if(!t||"initSegment"===e.frag.sn)return;let i=e.frag,r=rm(i),a=this.fragments[r];if(!a||a.buffered&&i.gap)return;let n=!i.relurl;Object.keys(t).forEach(r=>{let s=i.elementaryStreams[r];if(!s)return;let o=t[r],l=n||!0===s.partial;a.range[r]=this.getBufferedTimes(i,e.part,l,o)}),a.loaded=null,Object.keys(a.range).length?(a.buffered=!0,(a.body.endList=i.endList||a.body.endList)&&(this.endListFragments[a.body.type]=a),rc(a)||this.removeParts(i.sn-1,i.type)):this.removeFragment(a.body)}removeParts(e,t){let i=this.activePartLists[t];i&&(this.activePartLists[t]=rf(i,t=>t.fragment.sn>=e))}fragBuffered(e,t){let i=rm(e),r=this.fragments[i];!r&&t&&(r=this.fragments[i]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),r&&(r.loaded=null,r.buffered=!0)}getBufferedTimes(e,t,i,r){let a={time:[],partial:i},n=e.start,s=e.end,o=e.minEndPTS||s,l=e.maxStartPTS||n;for(let e=0;e<r.length;e++){let t=r.start(e)-this.bufferPadding,i=r.end(e)+this.bufferPadding;if(l>=t&&o<=i){a.time.push({startPTS:Math.max(n,r.start(e)),endPTS:Math.min(s,r.end(e))});break}if(n<i&&s>t){let t=Math.max(n,r.start(e)),i=Math.min(s,r.end(e));i>t&&(a.partial=!0,a.time.push({startPTS:t,endPTS:i}))}else if(s<=t)break}return a}getPartialFragment(e){let t,i,r,a=null,n=0,{bufferPadding:s,fragments:o}=this;return Object.keys(o).forEach(l=>{let d=o[l];d&&rc(d)&&(i=d.body.start-s,r=d.body.end+s,e>=i&&e<=r&&n<=(t=Math.min(e-i,r-e))&&(a=d.body,n=t))}),a}isEndListAppended(e){let t=this.endListFragments[e];return void 0!==t&&(t.buffered||rc(t))}getState(e){let t=rm(e),i=this.fragments[t];if(i)if(!i.buffered)return ru.APPENDING;else if(rc(i))return ru.PARTIAL;else return ru.OK;return ru.NOT_LOADED}isTimeBuffered(e,t,i){let r,a;for(let n=0;n<i.length;n++){if(r=i.start(n)-this.bufferPadding,a=i.end(n)+this.bufferPadding,e>=r&&t<=a)return!0;if(t<=r)break}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if("initSegment"===t.frag.sn||t.frag.bitrateTest)return;let i=t.frag,r=t.part?null:t,a=rm(i);this.fragments[a]={body:i,appendedPTS:null,loaded:r,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){let{frag:i,part:r,timeRanges:a,type:n}=t;if("initSegment"===i.sn)return;let s=i.type;if(r){let e=this.activePartLists[s];e||(this.activePartLists[s]=e=[]),e.push(r)}this.timeRanges=a;let o=a[n];this.detectEvictedFragments(n,o,s,r)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){let t=rm(e);return!!this.fragments[t]}hasFragments(e){let{fragments:t}=this,i=Object.keys(t);if(!e)return i.length>0;for(let r=i.length;r--;){let a=t[i[r]];if((null==a?void 0:a.body.type)===e)return!0}return!1}hasParts(e){var t;return!!(null!=(t=this.activePartLists[e])&&t.length)}removeFragmentsInRange(e,t,i,r,a){(!r||this.hasGaps)&&Object.keys(this.fragments).forEach(n=>{let s=this.fragments[n];if(!s)return;let o=s.body;o.type===i&&(!r||o.gap)&&o.start<t&&o.end>e&&(s.buffered||a)&&this.removeFragment(o)})}removeFragment(e){let t=rm(e);e.clearElementaryStreamInfo();let i=this.activePartLists[e.type];if(i){let t=e.sn;this.activePartLists[e.type]=rf(i,e=>e.fragment.sn!==t)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;let t=null==(e=this.hls)||null==(e=e.latestLevelDetails)?void 0:e.partList;t&&t.forEach(e=>e.clearElementaryStreamInfo())}constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}}function rc(e){var t,i,r;return e.buffered&&!!(e.body.gap||null!=(t=e.range.video)&&t.partial||null!=(i=e.range.audio)&&i.partial||null!=(r=e.range.audiovideo)&&r.partial)}function rm(e){return"".concat(e.type,"_").concat(e.level,"_").concat(e.sn)}function rf(e,t){return e.filter(e=>{let i=t(e);return i||e.clearElementaryStreamInfo(),i})}var rp={cbc:0,ctr:1};class rg{decrypt(e,t){switch(this.aesMode){case rp.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case rp.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw Error("[AESCrypto] invalid aes mode ".concat(this.aesMode))}}constructor(e,t,i){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=i}}class rv{uint8ArrayToUint32Array_(e){let t=new DataView(e),i=new Uint32Array(4);for(let e=0;e<4;e++)i[e]=t.getUint32(4*e);return i}initTable(){let e=this.sBox,t=this.invSBox,i=this.subMix,r=i[0],a=i[1],n=i[2],s=i[3],o=this.invSubMix,l=o[0],d=o[1],u=o[2],h=o[3],c=new Uint32Array(256),m=0,f=0,p=0;for(p=0;p<256;p++)p<128?c[p]=p<<1:c[p]=p<<1^283;for(p=0;p<256;p++){let i=f^f<<1^f<<2^f<<3^f<<4;i=i>>>8^255&i^99,e[m]=i,t[i]=m;let o=c[m],p=c[o],g=c[p],E=257*c[i]^0x1010100*i;r[m]=E<<24|E>>>8,a[m]=E<<16|E>>>16,n[m]=E<<8|E>>>24,s[m]=E,E=0x1010101*g^65537*p^257*o^0x1010100*m,l[i]=E<<24|E>>>8,d[i]=E<<16|E>>>16,u[i]=E<<8|E>>>24,h[i]=E,m?(m=o^c[c[c[g^o]]],f^=c[c[f]]):m=f=1}}expandKey(e){let t,i,r,a,n=this.uint8ArrayToUint32Array_(e),s=!0,o=0;for(;o<n.length&&s;)s=n[o]===this.key[o],o++;if(s)return;this.key=n;let l=this.keySize=n.length;if(4!==l&&6!==l&&8!==l)throw Error("Invalid aes key size="+l);let d=this.ksRows=(l+6+1)*4,u=this.keySchedule=new Uint32Array(d),h=this.invKeySchedule=new Uint32Array(d),c=this.sBox,m=this.rcon,f=this.invSubMix,p=f[0],g=f[1],E=f[2],y=f[3];for(t=0;t<d;t++){if(t<l){r=u[t]=n[t];continue}a=r,t%l==0?a=(c[(a=a<<8|a>>>24)>>>24]<<24|c[a>>>16&255]<<16|c[a>>>8&255]<<8|c[255&a])^m[t/l|0]<<24:l>6&&t%l==4&&(a=c[a>>>24]<<24|c[a>>>16&255]<<16|c[a>>>8&255]<<8|c[255&a]),u[t]=r=(u[t-l]^a)>>>0}for(i=0;i<d;i++)t=d-i,a=3&i?u[t]:u[t-4],i<4||t<=4?h[i]=a:h[i]=p[c[a>>>24]]^g[c[a>>>16&255]]^E[c[a>>>8&255]]^y[c[255&a]],h[i]=h[i]>>>0}networkToHostOrderSwap(e){return e<<24|(65280&e)<<8|(0xff0000&e)>>8|e>>>24}decrypt(e,t,i){let r,a,n,s,o,l,d,u,h,c,m,f,p,g,E=this.keySize+6,y=this.invKeySchedule,b=this.invSBox,T=this.invSubMix,_=T[0],A=T[1],S=T[2],I=T[3],R=this.uint8ArrayToUint32Array_(i),k=R[0],L=R[1],D=R[2],w=R[3],C=new Int32Array(e),M=new Int32Array(C.length),O=this.networkToHostOrderSwap;for(;t<C.length;){for(g=1,h=O(C[t]),c=O(C[t+1]),m=O(C[t+2]),f=O(C[t+3]),o=h^y[0],l=f^y[1],d=m^y[2],u=c^y[3],p=4;g<E;g++)r=_[o>>>24]^A[l>>16&255]^S[d>>8&255]^I[255&u]^y[p],a=_[l>>>24]^A[d>>16&255]^S[u>>8&255]^I[255&o]^y[p+1],n=_[d>>>24]^A[u>>16&255]^S[o>>8&255]^I[255&l]^y[p+2],s=_[u>>>24]^A[o>>16&255]^S[l>>8&255]^I[255&d]^y[p+3],o=r,l=a,d=n,u=s,p+=4;r=b[o>>>24]<<24^b[l>>16&255]<<16^b[d>>8&255]<<8^b[255&u]^y[p],a=b[l>>>24]<<24^b[d>>16&255]<<16^b[u>>8&255]<<8^b[255&o]^y[p+1],n=b[d>>>24]<<24^b[u>>16&255]<<16^b[o>>8&255]<<8^b[255&l]^y[p+2],s=b[u>>>24]<<24^b[o>>16&255]<<16^b[l>>8&255]<<8^b[255&d]^y[p+3],M[t]=O(r^k),M[t+1]=O(s^L),M[t+2]=O(n^D),M[t+3]=O(a^w),k=h,L=c,D=m,w=f,t+=4}return M.buffer}constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}}class rE{expandKey(){let e=function(e){switch(e){case rp.cbc:return"AES-CBC";case rp.ctr:return"AES-CTR";default:throw Error("[FastAESKey] invalid aes mode ".concat(e))}}(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}constructor(e,t,i){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=i}}class ry{destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){let{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;let i=new Uint8Array(e);if(this.reset(),this.removePKCS7Padding){let e=i.byteLength,t=e&&new DataView(i.buffer).getUint8(e-1);return t?i.slice(0,e-t):i}return i}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,i,r){return this.useSoftware?new Promise((a,n)=>{let s=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(s,t,i,r);let o=this.flush();o?a(o.buffer):n(Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,i,r)}softwareDecrypt(e,t,i,r){let{currentIV:a,currentResult:n,remainderData:s}=this;if(r!==rp.cbc||16!==t.byteLength)return tJ.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),s&&(e=iE(s,e),this.remainderData=null);let o=this.getValidChunk(e);if(!o.length)return null;a&&(i=a);let l=this.softwareDecrypter;return(l||(l=this.softwareDecrypter=new rv),l.expandKey(t),this.currentResult=l.decrypt(o.buffer,0,i),this.currentIV=o.slice(-16).buffer,n)?n:null}webCryptoDecrypt(e,t,i,r){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,i,r));this.key=t,this.fastAesKey=new rE(this.subtle,t,r)}return this.fastAesKey.expandKey().then(t=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new rg(this.subtle,new Uint8Array(i),r).decrypt(e.buffer,t)):Promise.reject(Error("web crypto not initialized"))).catch(a=>(tJ.warn("[decrypter]: WebCrypto Error, disable WebCrypto API, ".concat(a.name,": ").concat(a.message)),this.onWebCryptoError(e,t,i,r)))}onWebCryptoError(e,t,i,r){let a=this.enableSoftwareAES;if(a){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,i,r);let a=this.flush();if(a)return a.buffer}throw Error("WebCrypto"+(a?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e,i=e.length-e.length%16;return i!==e.length&&(t=e.slice(0,i),this.remainderData=e.slice(i)),t}logOnce(e){this.logEnabled&&(tJ.log("[decrypter]: ".concat(e)),this.logEnabled=!1)}constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{let e=self.crypto;e&&(this.subtle=e.subtle||e.webkitSubtle)}catch(e){}this.useSoftware=!this.subtle}}class rb{destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){let i=e.url;if(!i)return Promise.reject(new rA({type:tU.NETWORK_ERROR,details:tF.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:Error("Fragment does not have a ".concat(i?"part list":"url")),networkDetails:null}));this.abort();let r=this.config,a=r.fLoader,n=r.loader;return new Promise((s,o)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(e=>"GAP"===e[0]))return void o(r_(e));else e.gap=!1;let l=this.loader=a?new a(r):new n(r),d=rT(e);e.loader=l;let u=ra(r.fragLoadPolicy.default),h={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:"initSegment"===e.sn?1/0:131072};e.stats=l.stats;let c={onSuccess:(t,i,r,a)=>{this.resetLoader(e,l);let n=t.data;r.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(n.slice(0,16)),n=n.slice(16)),s({frag:e,part:null,payload:n,networkDetails:a})},onError:(t,r,a,n)=>{this.resetLoader(e,l),o(new rA({type:tU.NETWORK_ERROR,details:tF.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:tY({url:i,data:void 0},t),error:Error("HTTP Error ".concat(t.code," ").concat(t.text)),networkDetails:a,stats:n}))},onAbort:(t,i,r)=>{this.resetLoader(e,l),o(new rA({type:tU.NETWORK_ERROR,details:tF.INTERNAL_ABORTED,fatal:!1,frag:e,error:Error("Aborted"),networkDetails:r,stats:t}))},onTimeout:(t,i,r)=>{this.resetLoader(e,l),o(new rA({type:tU.NETWORK_ERROR,details:tF.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:Error("Timeout after ".concat(h.timeout,"ms")),networkDetails:r,stats:t}))}};t&&(c.onProgress=(i,r,a,n)=>t({frag:e,part:null,payload:a,networkDetails:n})),l.load(d,h,c)})}loadPart(e,t,i){this.abort();let r=this.config,a=r.fLoader,n=r.loader;return new Promise((s,o)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap)return void o(r_(e,t));let l=this.loader=a?new a(r):new n(r),d=rT(e,t);e.loader=l;let u=ra(r.fragLoadPolicy.default),h={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:131072};t.stats=l.stats,l.load(d,h,{onSuccess:(r,a,n,o)=>{this.resetLoader(e,l),this.updateStatsFromPart(e,t);let d={frag:e,part:t,payload:r.data,networkDetails:o};i(d),s(d)},onError:(i,r,a,n)=>{this.resetLoader(e,l),o(new rA({type:tU.NETWORK_ERROR,details:tF.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:tY({url:d.url,data:void 0},i),error:Error("HTTP Error ".concat(i.code," ").concat(i.text)),networkDetails:a,stats:n}))},onAbort:(i,r,a)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,l),o(new rA({type:tU.NETWORK_ERROR,details:tF.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:Error("Aborted"),networkDetails:a,stats:i}))},onTimeout:(i,r,a)=>{this.resetLoader(e,l),o(new rA({type:tU.NETWORK_ERROR,details:tF.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:Error("Timeout after ".concat(h.timeout,"ms")),networkDetails:a,stats:i}))}})})}updateStatsFromPart(e,t){let i=e.stats,r=t.stats,a=r.total;if(i.loaded+=r.loaded,a){let r=Math.round(e.duration/t.duration),n=Math.min(Math.round(i.loaded/a),r),s=(r-n)*Math.round(i.loaded/n);i.total=i.loaded+s}else i.total=Math.max(i.loaded,i.total);let n=i.loading,s=r.loading;n.start?n.first+=s.first-s.start:(n.start=s.start,n.first=s.first),n.end=s.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}}function rT(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=t||e,r={frag:e,part:t,responseType:"arraybuffer",url:i.url,headers:{},rangeStart:0,rangeEnd:0},a=i.byteRangeStartOffset,n=i.byteRangeEndOffset;if(tP(a)&&tP(n)){var s,o;let t=a,i=n;if("initSegment"===e.sn&&("AES-128"===(o=null==(s=e.decryptdata)?void 0:s.method)||"AES-256"===o)){let e=n-a;e%16&&(i=n+(16-e%16)),0!==a&&(r.resetIV=!0,t=a-16)}r.rangeStart=t,r.rangeEnd=i}return r}function r_(e,t){let i=Error("GAP ".concat(e.gap?"tag":"attribute"," found")),r={type:tU.MEDIA_ERROR,details:tF.FRAG_GAP,fatal:!1,frag:e,error:i,networkDetails:null};return t&&(r.part=t),(t||e).stats.aborted=!0,new rA(r)}class rA extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class rS extends tj{destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return!this._tickInterval&&(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)}clearNextTick(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)}tick(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}}class rI{constructor(e,t,i,r=0,a=-1,n=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=rR(),this.buffering={audio:rR(),video:rR(),audiovideo:rR()},this.level=e,this.sn=t,this.id=i,this.size=r,this.part=a,this.partial=n}}function rR(){return{start:0,executeStart:0,executeEnd:0,end:0}}let rk={length:0,start:()=>0,end:()=>0};class rL{static isBuffered(e,t){if(e){let i=rL.getBuffered(e);for(let e=i.length;e--;)if(t>=i.start(e)&&t<=i.end(e))return!0}return!1}static bufferedRanges(e){if(e){let t=rL.getBuffered(e);return rL.timeRangesToArray(t)}return[]}static timeRangesToArray(e){let t=[];for(let i=0;i<e.length;i++)t.push({start:e.start(i),end:e.end(i)});return t}static bufferInfo(e,t,i){if(e){let r=rL.bufferedRanges(e);if(r.length)return rL.bufferedInfo(r,t,i)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,i){let r;t=Math.max(0,t),e.length>1&&e.sort((e,t)=>e.start-t.start||t.end-e.end);let a=-1,n=[];if(i)for(let r=0;r<e.length;r++){t>=e[r].start&&t<=e[r].end&&(a=r);let s=n.length;if(s){let t=n[s-1].end;e[r].start-t<i?e[r].end>t&&(n[s-1].end=e[r].end):n.push(e[r])}else n.push(e[r])}else n=e;let s=0,o=t,l=t;for(let e=0;e<n.length;e++){let d=n[e].start,u=n[e].end;if(-1===a&&t>=d&&t<=u&&(a=e),t+i>=d&&t<u)o=d,s=(l=u)-t;else if(t+i<d){r=d;break}}return{len:s,start:o||0,end:l||0,nextStart:r,buffered:e,bufferedIndex:a}}static getBuffered(e){try{return e.buffered||rk}catch(e){return tJ.log("failed to get media.buffered",e),rk}}}let rD=/\{\$([a-zA-Z0-9-_]+)\}/g;function rw(e,t){if(null!==e.variableList||e.hasVariableRefs){let i=e.variableList;return t.replace(rD,t=>{let r=t.substring(2,t.length-1),a=null==i?void 0:i[r];return void 0===a?(e.playlistParsingError||(e.playlistParsingError=Error('Missing preceding EXT-X-DEFINE tag for Variable Reference: "'.concat(r,'"'))),t):a})}return t}function rC(e,t,i){let r,a,n=e.variableList;if(n||(e.variableList=n={}),"QUERYPARAM"in t){r=t.QUERYPARAM;try{let e=new self.URL(i).searchParams;if(e.has(r))a=e.get(r);else throw Error('"'.concat(r,'" does not match any query parameter in URI: "').concat(i,'"'))}catch(t){e.playlistParsingError||(e.playlistParsingError=Error("EXT-X-DEFINE QUERYPARAM: ".concat(t.message)))}}else r=t.NAME,a=t.VALUE;r in n?e.playlistParsingError||(e.playlistParsingError=Error('EXT-X-DEFINE duplicate Variable Name declarations: "'.concat(r,'"'))):n[r]=a||""}let rM=/^(\d+)x(\d+)$/,rO=/(.+?)=(".*?"|.*?)(?:,|$)/g;class rP{get clientAttrs(){return Object.keys(this).filter(e=>"X-"===e.substring(0,2))}decimalInteger(e){let t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2),i=new Uint8Array((t=(1&t.length?"0":"")+t).length/2);for(let e=0;e<t.length/2;e++)i[e]=parseInt(t.slice(2*e,2*e+2),16);return i}return null}hexadecimalIntegerAsNumber(e){let t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){let i=this[e];return i?parseFloat(i):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){let i=this[e];return(i?i.split(/[ ,]+/):[]).reduce((e,t)=>(e[t.toLowerCase()]=!0,e),t)}bool(e){return"YES"===this[e]}decimalResolution(e){let t=rM.exec(this[e]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let i,r={};for(rO.lastIndex=0;null!==(i=rO.exec(e));){let a=i[1].trim(),n=i[2],s=0===n.indexOf('"')&&n.lastIndexOf('"')===n.length-1,o=!1;if(s)n=n.slice(1,-1);else switch(a){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":o=!0}if(t&&(s||o))n=rw(t,n);else if(!o&&!s)switch(a){case"CLOSED-CAPTIONS":if("NONE"===n)break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":tJ.warn("".concat(e,": attribute ").concat(a," is missing quotes"))}r[a]=n}return r}constructor(e,t){"string"==typeof e&&(e=rP.parseAttrList(e,t)),tW(this,e)}}class rx{get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){let e=this._cue;return void 0===e?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){let{tagAnchor:e}=this;return null===e||null===e.programDateTime?(tJ.warn('Expected tagAnchor Fragment with PDT set for DateRange "'.concat(this.id,'": ').concat(e)),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){let e=this._endDate||this._dateAtEnd;if(e)return e;let t=this.duration;return null!==t?this._dateAtEnd=new Date(this._startDate.getTime()+1e3*t):null}get duration(){if("DURATION"in this.attr){let e=this.attr.decimalFloatingPoint("DURATION");if(tP(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return"com.apple.hls.interstitial"===this.class}get isValid(){return!!this.id&&!this._badValueForSameId&&tP(this.startDate.getTime())&&(null===this.duration||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}constructor(e,t,i=0){var r;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=(null==t?void 0:t.tagAnchor)||null,this.tagOrder=null!=(r=null==t?void 0:t.tagOrder)?r:i,t){let i=t.attr;for(let t in i)if(Object.prototype.hasOwnProperty.call(e,t)&&e[t]!==i[t]){tJ.warn('DATERANGE tag attribute: "'.concat(t,'" does not match for tags with ID: "').concat(e.ID,'"')),this._badValueForSameId=t;break}e=tW(new rP({}),i,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){let e=(null==t?void 0:t.endDate)||new Date(this.attr["END-DATE"]);tP(e.getTime())&&(this._endDate=e)}}}class rN{reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}let t=this.lastPartSn-e.lastPartSn,i=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!i||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||0===t&&i>0,this.updated||this.advanced?this.misses=Math.floor(.6*e.misses):this.misses=e.misses+1}hasKey(e){return this.encryptedFragments.some(t=>{let i=t.decryptdata;return i||(t.setKeyFormat(e.keyFormat),i=t.decryptdata),!!i&&e.matches(i)})}get hasProgramDateTime(){return!!this.fragments.length&&tP(this.fragments[this.fragments.length-1].programDateTime)}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||10}get drift(){let e=this.driftEndTime-this.driftStartTime;return e>0?1e3*(this.driftEnd-this.driftStart)/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){return this.fragments.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){let e=this.partList;if(e){let t=this.lastPartIndex;if(-1!==t){for(let i=e.length;i--;)if(e[i].index>t)return e[i].index;return t}}return 0}get lastPartSn(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){let e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}}function rU(e,t){return e.length===t.length&&!e.some((e,i)=>e!==t[i])}function rF(e,t){return!e&&!t||!!e&&!!t&&rU(e,t)}function rB(e){return"AES-128"===e||"AES-256"===e||"AES-256-CTR"===e}function rH(e){switch(e){case"AES-128":case"AES-256":return rp.cbc;case"AES-256-CTR":return rp.ctr;default:throw Error("invalid full segment method ".concat(e))}}function rG(e){return Uint8Array.from(atob(e),e=>e.charCodeAt(0))}function rK(e){return Uint8Array.from(unescape(encodeURIComponent(e)),e=>e.charCodeAt(0))}function rV(e){let t=function(e,t,i){let r=e[t];e[t]=e[i],e[i]=r};t(e,0,3),t(e,1,2),t(e,4,5),t(e,6,7)}let rW="undefined"!=typeof self?self:void 0;var rq={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},rY={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function rj(e){switch(e){case rY.FAIRPLAY:return rq.FAIRPLAY;case rY.PLAYREADY:return rq.PLAYREADY;case rY.WIDEVINE:return rq.WIDEVINE;case rY.CLEARKEY:return rq.CLEARKEY}}function rQ(e){switch(e){case rq.FAIRPLAY:return rY.FAIRPLAY;case rq.PLAYREADY:return rY.PLAYREADY;case rq.WIDEVINE:return rY.WIDEVINE;case rq.CLEARKEY:return rY.CLEARKEY}}function rz(e){let{drmSystems:t,widevineLicenseUrl:i}=e,r=t?[rq.FAIRPLAY,rq.WIDEVINE,rq.PLAYREADY,rq.CLEARKEY].filter(e=>!!t[e]):[];return!r[rq.WIDEVINE]&&i&&r.push(rq.WIDEVINE),r}let rX=function(e){return null!=rW&&null!=(e=rW.navigator)&&e.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}(),rZ={};class rJ{static clearKeyUriToKeyIdMap(){rZ={}}static setKeyIdForUri(e,t){rZ[e]=t}matches(e){return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&rU(e.keyFormatVersions,this.keyFormatVersions)&&rF(e.iv,this.iv)&&rF(e.keyId,this.keyId)}isSupported(){if(this.method){if(rB(this.method)||"NONE"===this.method)return!0;if("identity"===this.keyFormat)return"SAMPLE-AES"===this.method;switch(this.keyFormat){case rY.FAIRPLAY:case rY.WIDEVINE:case rY.PLAYREADY:case rY.CLEARKEY:return -1!==["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)}}return!1}getDecryptData(e){if(!this.encrypted||!this.uri)return null;if(rB(this.method)){let t=this.iv;return t||("number"!=typeof e&&(tJ.warn('missing IV for initialization segment with method="'.concat(this.method,'" - compliance issue')),e=0),t=function(e){let t=new Uint8Array(16);for(let i=12;i<16;i++)t[i]=e>>8*(15-i)&255;return t}(e)),new rJ(this.method,this.uri,"identity",this.keyFormatVersions,t)}if(this.pssh&&this.keyId)return this;let t=function(e){let t=e.split(":"),i=null;if("data"===t[0]&&2===t.length){let e=t[1].split(";"),r=e[e.length-1].split(",");if(2===r.length){let t="base64"===r[0],a=r[1];t?(e.splice(-1,1),i=rG(a)):i=function(e){let t=rK(e).subarray(0,16),i=new Uint8Array(16);return i.set(t,16-t.length),i}(a)}}return i}(this.uri);if(t)switch(this.keyFormat){case rY.WIDEVINE:if(this.pssh=t,!this.keyId){let e=function(e){let t=[];if(e instanceof ArrayBuffer){let i=e.byteLength,r=0;for(;r+32<i;){let i=function(e){let t=e.getUint32(0),i=e.byteOffset,r=e.byteLength;if(r<t)return{offset:i,size:r};if(0x70737368!==e.getUint32(4))return{offset:i,size:t};let a=e.getUint32(8)>>>24;if(0!==a&&1!==a)return{offset:i,size:t};let n=e.buffer,s=t2(new Uint8Array(n,i+12,16)),o=null,l=0;if(0===a)l=28;else{let a=e.getUint32(28);if(!a||r<32+16*a)return{offset:i,size:t};o=[];for(let e=0;e<a;e++)o.push(new Uint8Array(n,i+32+16*e,16));l=32+16*a}if(!l)return{offset:i,size:t};let d=e.getUint32(l);return t-32<d?{offset:i,size:t}:{version:a,systemId:s,kids:o,data:new Uint8Array(n,i+l+4,d),offset:i,size:t}}(new DataView(e,r));t.push(i),r+=i.size}}return t}(t.buffer);if(e.length){var i;let t=e[0];this.keyId=null!=(i=t.kids)&&i.length?t.kids[0]:null}}if(!this.keyId){let e=t.length-22;this.keyId=t.subarray(e,e+16)}break;case rY.PLAYREADY:{let e=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=function(e,t,i){let r,a;if(16!==e.byteLength)throw RangeError("Invalid system id");r=new Uint8Array,a=new Uint8Array;let n=new Uint8Array(4);return i.byteLength>0&&new DataView(n.buffer).setUint32(0,i.byteLength,!1),function(e){for(var t=arguments.length,i=Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];let a=i.length,n=8,s=a;for(;s--;)n+=i[s].byteLength;let o=new Uint8Array(n);for(o[0]=n>>24&255,o[1]=n>>16&255,o[2]=n>>8&255,o[3]=255&n,o.set(e,4),s=0,n=8;s<a;s++)o.set(i[s],n),n+=i[s].byteLength;return o}([112,115,115,104],new Uint8Array([0,0,0,0]),e,a,r,n,i)}(e,0,t),this.keyId=function(e){let t=new Uint16Array(e.buffer,e.byteOffset,e.byteLength/2),i=String.fromCharCode.apply(null,Array.from(t)),r=i.substring(i.indexOf("<"),i.length),a=new DOMParser().parseFromString(r,"text/xml").getElementsByTagName("KID")[0];if(a){let e=a.childNodes[0]?a.childNodes[0].nodeValue:a.getAttribute("VALUE");if(e){let t=rG(e).subarray(0,16);return rV(t),t}}return null}(t);break}default:{let e=t.subarray(0,16);if(16!==e.length){let t=new Uint8Array(16);t.set(e,16-e.length),e=t}this.keyId=e}}if(!this.keyId||16!==this.keyId.byteLength){let e=rZ[this.uri];if(!e){let t=Object.keys(rZ).length%Number.MAX_SAFE_INTEGER;new DataView((e=new Uint8Array(16)).buffer,12,4).setUint32(0,t),rJ.setKeyIdForUri(this.uri,e)}this.keyId=e}return this}constructor(e,t,i,r=[1],a=null,n){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=i,this.keyFormatVersions=r,this.iv=a,this.encrypted=!!e&&"NONE"!==e,this.isCommonEncryption=this.encrypted&&!rB(e),null!=n&&n.startsWith("0x")&&(this.keyId=new Uint8Array(t3(n)))}}let r$=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,r0=/#EXT-X-MEDIA:(.*)/g,r1=/^#EXT(?:INF|-X-TARGETDURATION):/m,r2=RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),r3=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class r4{static findGroup(e,t){for(let i=0;i<e.length;i++){let r=e[i];if(r.id===t)return r}}static resolve(e,t){return t5.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return r1.test(e)}static parseMasterPlaylist(e,t){var i;let r,a={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:rD.test(e)},n=[];if(r$.lastIndex=0,!e.startsWith("#EXTM3U"))return a.playlistParsingError=Error("no EXTM3U delimiter"),a;for(;null!=(r=r$.exec(e));)if(r[1]){let e=new rP(r[1],a),s=rw(a,r[2]),o={attrs:e,bitrate:e.decimalInteger("BANDWIDTH")||e.decimalInteger("AVERAGE-BANDWIDTH"),name:e.NAME,url:r4.resolve(s,t)},l=e.decimalResolution("RESOLUTION");l&&(o.width=l.width,o.height=l.height),r6(e.CODECS,o);let d=e["SUPPLEMENTAL-CODECS"];d&&(o.supplemental={},r6(d,o.supplemental)),null!=(i=o.unknownCodecs)&&i.length||n.push(o),a.levels.push(o)}else if(r[3]){let e=r[3],i=r[4];switch(e){case"SESSION-DATA":{let e=new rP(i,a),t=e["DATA-ID"];t&&(null===a.sessionData&&(a.sessionData={}),a.sessionData[t]=e);break}case"SESSION-KEY":{let e=r8(i,t,a);e.encrypted&&e.isSupported()?(null===a.sessionKeys&&(a.sessionKeys=[]),a.sessionKeys.push(e)):tJ.warn('[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "'.concat(i,'"'));break}case"DEFINE":{let e=new rP(i,a);rC(a,e,t)}break;case"CONTENT-STEERING":{let e=new rP(i,a);a.contentSteering={uri:r4.resolve(e["SERVER-URI"],t),pathwayId:e["PATHWAY-ID"]||"."};break}case"START":a.startTimeOffset=r9(i)}}let s=n.length>0&&n.length<a.levels.length;return a.levels=s?n:a.levels,0===a.levels.length&&(a.playlistParsingError=Error("no levels found in manifest")),a}static parseMasterPlaylistMedia(e,t,i){let r,a={},n=i.levels,s={AUDIO:n.map(e=>({id:e.attrs.AUDIO,audioCodec:e.audioCodec})),SUBTITLES:n.map(e=>({id:e.attrs.SUBTITLES,textCodec:e.textCodec})),"CLOSED-CAPTIONS":[]},o=0;for(r0.lastIndex=0;null!==(r=r0.exec(e));){let e=new rP(r[1],i),n=e.TYPE;if(n){let i=s[n],r=a[n]||[];a[n]=r;let l=e.LANGUAGE,d=e["ASSOC-LANGUAGE"],u=e.CHANNELS,h=e.CHARACTERISTICS,c=e["INSTREAM-ID"],m={attrs:e,bitrate:0,id:o++,groupId:e["GROUP-ID"]||"",name:e.NAME||l||"",type:n,default:e.bool("DEFAULT"),autoselect:e.bool("AUTOSELECT"),forced:e.bool("FORCED"),lang:l,url:e.URI?r4.resolve(e.URI,t):""};if(d&&(m.assocLang=d),u&&(m.channels=u),h&&(m.characteristics=h),c&&(m.instreamId=c),null!=i&&i.length){let e=r4.findGroup(i,m.groupId)||i[0];r7(m,e,"audioCodec"),r7(m,e,"textCodec")}r.push(m)}}return a}static parseLevelPlaylist(e,t,i,r,a,n){var s;let o,l,d,u,h={url:t},c=new rN(t),m=c.fragments,f=[],p=null,g=0,E=0,y=0,b=0,T=0,_=null,A=new ie(r,h),S=-1,I=!1,R=null;if(r2.lastIndex=0,c.m3u8=e,c.hasVariableRefs=rD.test(e),(null==(s=r2.exec(e))?void 0:s[0])!=="#EXTM3U")return c.playlistParsingError=Error("Missing format identifier #EXTM3U"),c;for(;null!==(o=r2.exec(e));){I&&(I=!1,(A=new ie(r,h)).playlistOffset=y,A.setStart(y),A.sn=g,A.cc=b,T&&(A.bitrate=T),A.level=i,p&&(A.initSegment=p,p.rawProgramDateTime&&(A.rawProgramDateTime=p.rawProgramDateTime,p.rawProgramDateTime=null),R&&(A.setByteRange(R),R=null)));let e=o[1];if(e){A.duration=parseFloat(e);let t=(" "+o[2]).slice(1);A.title=t||null,A.tagList.push(t?["INF",e,t]:["INF",e])}else if(o[3]){if(tP(A.duration)){A.playlistOffset=y,A.setStart(y),d&&ai(A,d,c),A.sn=g,A.level=i,A.cc=b,m.push(A);let e=(" "+o[3]).slice(1);A.relurl=rw(c,e),ae(A,_,f),_=A,y+=A.duration,g++,E=0,I=!0}}else{if(!(o=o[0].match(r3))){tJ.warn("No matches on slow regex match for level playlist!");continue}for(l=1;l<o.length&&void 0===o[l];l++);let e=(" "+o[l]).slice(1),a=(" "+o[l+1]).slice(1),s=o[l+2]?(" "+o[l+2]).slice(1):null;switch(e){case"BYTERANGE":_?A.setByteRange(a,_):A.setByteRange(a);break;case"PROGRAM-DATE-TIME":A.rawProgramDateTime=a,A.tagList.push(["PROGRAM-DATE-TIME",a]),-1===S&&(S=m.length);break;case"PLAYLIST-TYPE":c.type&&ar(c,e,o),c.type=a.toUpperCase();break;case"MEDIA-SEQUENCE":0!==c.startSN?ar(c,e,o):m.length>0&&aa(c,e,o),g=c.startSN=parseInt(a);break;case"SKIP":{c.skippedSegments&&ar(c,e,o);let t=new rP(a,c),i=t.decimalInteger("SKIPPED-SEGMENTS");if(tP(i)){c.skippedSegments+=i;for(let e=i;e--;)m.push(null);g+=i}let r=t.enumeratedString("RECENTLY-REMOVED-DATERANGES");r&&(c.recentlyRemovedDateranges=(c.recentlyRemovedDateranges||[]).concat(r.split("	")));break}case"TARGETDURATION":0!==c.targetduration&&ar(c,e,o),c.targetduration=Math.max(parseInt(a),1);break;case"VERSION":null!==c.version&&ar(c,e,o),c.version=parseInt(a);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":c.live||ar(c,e,o),c.live=!1;break;case"#":(a||s)&&A.tagList.push(s?[a,s]:[a]);break;case"DISCONTINUITY":b++,A.tagList.push(["DIS"]);break;case"GAP":A.gap=!0,A.tagList.push([e]);break;case"BITRATE":A.tagList.push([e,a]),tP(T=1e3*parseInt(a))?A.bitrate=T:T=0;break;case"DATERANGE":{let e=new rP(a,c),t=new rx(e,c.dateRanges[e.ID],c.dateRangeTagCount);c.dateRangeTagCount++,t.isValid||c.skippedSegments?c.dateRanges[t.id]=t:tJ.warn('Ignoring invalid DATERANGE tag: "'.concat(a,'"')),A.tagList.push(["EXT-X-DATERANGE",a]);break}case"DEFINE":{let e=new rP(a,c);"IMPORT"in e?function(e,t,i){let r=t.IMPORT;if(i&&r in i){let t=e.variableList;t||(e.variableList=t={}),t[r]=i[r]}else e.playlistParsingError||(e.playlistParsingError=Error('EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "'.concat(r,'"')))}(c,e,n):rC(c,e,t)}break;case"DISCONTINUITY-SEQUENCE":0!==c.startCC?ar(c,e,o):m.length>0&&aa(c,e,o),c.startCC=b=parseInt(a);break;case"KEY":{let e=r8(a,t,c);if(e.isSupported()){if("NONE"===e.method){d=void 0;break}d||(d={});let t=d[e.keyFormat];null!=t&&t.matches(e)||(t&&(d=tW({},d)),d[e.keyFormat]=e)}else tJ.warn('[Keys] Ignoring unsupported EXT-X-KEY tag: "'.concat(a,'"'));break}case"START":c.startTimeOffset=r9(a);break;case"MAP":{let e=new rP(a,c);if(A.duration){let t=new ie(r,h);at(t,e,i,d),p=t,A.initSegment=p,p.rawProgramDateTime&&!A.rawProgramDateTime&&(A.rawProgramDateTime=p.rawProgramDateTime)}else{let t=A.byteRangeEndOffset;if(t){let e=A.byteRangeStartOffset;R="".concat(t-e,"@").concat(e)}else R=null;at(A,e,i,d),p=A,I=!0}p.cc=b;break}case"SERVER-CONTROL":u&&ar(c,e,o),c.canBlockReload=(u=new rP(a)).bool("CAN-BLOCK-RELOAD"),c.canSkipUntil=u.optionalFloat("CAN-SKIP-UNTIL",0),c.canSkipDateRanges=c.canSkipUntil>0&&u.bool("CAN-SKIP-DATERANGES"),c.partHoldBack=u.optionalFloat("PART-HOLD-BACK",0),c.holdBack=u.optionalFloat("HOLD-BACK",0);break;case"PART-INF":c.partTarget&&ar(c,e,o),c.partTarget=new rP(a).decimalFloatingPoint("PART-TARGET");break;case"PART":{let e=c.partList;e||(e=c.partList=[]);let t=E>0?e[e.length-1]:void 0,i=E++,r=new it(new rP(a,c),A,h,i,t);e.push(r),A.duration+=r.duration;break}case"PRELOAD-HINT":{let e=new rP(a,c);c.preloadHint=e;break}case"RENDITION-REPORT":{let e=new rP(a,c);c.renditionReports=c.renditionReports||[],c.renditionReports.push(e);break}default:tJ.warn("line parsed but not handled: ".concat(o))}}}_&&!_.relurl?(m.pop(),y-=_.duration,c.partList&&(c.fragmentHint=_)):c.partList&&(ae(A,_,f),A.cc=b,c.fragmentHint=A,d&&ai(A,d,c)),c.targetduration||(c.playlistParsingError=Error("Missing Target Duration"));let k=m.length,L=m[0],D=m[k-1];if((y+=c.skippedSegments*c.targetduration)>0&&k&&D){c.averagetargetduration=y/k;let e=D.sn;c.endSN="initSegment"!==e?e:0,c.live||(D.endList=!0),S>0&&(function(e,t){let i=e[t];for(let r=t;r--;){let t=e[r];if(!t)return;t.programDateTime=i.programDateTime-1e3*t.duration,i=t}}(m,S),L&&f.unshift(L))}return c.fragmentHint&&(y+=c.fragmentHint.duration),c.totalduration=y,f.length&&c.dateRangeTagCount&&L&&r5(f,c),c.endCC=b,c}}function r5(e,t){let i=e.length;if(!i)if(!t.hasProgramDateTime)return;else{let r=t.fragments[t.fragments.length-1];e.push(r),i++}let r=e[i-1],a=t.live?1/0:t.totalduration,n=Object.keys(t.dateRanges);for(let o=n.length;o--;){let l=t.dateRanges[n[o]],d=l.startDate.getTime();l.tagAnchor=r.ref;for(let r=i;r--;){var s;if((null==(s=e[r])?void 0:s.sn)<t.startSN)break;let i=function(e,t,i,r,a){let n=i[r];if(n){let o=n.programDateTime;if(t>=o||0===r){var s;if(t<=o+1e3*(((null==(s=i[r+1])?void 0:s.start)||a)-n.start)){let a=i[r].sn-e.startSN;if(a<0)return -1;let n=e.fragments;if(n.length>i.length){let s=(i[r+1]||n[n.length-1]).sn-e.startSN;for(let e=s;e>a;e--){let i=n[e].programDateTime;if(t>=i&&t<i+1e3*n[e].duration)return e}}return a}}}return -1}(t,d,e,r,a);if(-1!==i){l.tagAnchor=t.fragments[i].ref;break}}}}function r8(e,t,i){var r,a;let n=new rP(e,i),s=null!=(r=n.METHOD)?r:"",o=n.URI,l=n.hexadecimalInteger("IV"),d=n.KEYFORMATVERSIONS,u=null!=(a=n.KEYFORMAT)?a:"identity";return o&&n.IV&&!l&&tJ.error("Invalid IV: ".concat(n.IV)),new rJ(s,o?r4.resolve(o,t):"",u,(d||"1").split("/").map(Number).filter(Number.isFinite),l,n.KEYID)}function r9(e){let t=new rP(e).decimalFloatingPoint("TIME-OFFSET");return tP(t)?t:null}function r6(e,t){let i=(e||"").split(/[ ,]+/).filter(e=>e);["video","audio","text"].forEach(e=>{let r=i.filter(t=>iI(t,e));r.length&&(t["".concat(e,"Codec")]=r.map(e=>e.split("/")[0]).join(","),i=i.filter(e=>-1===r.indexOf(e)))}),t.unknownCodecs=i}function r7(e,t,i){let r=t[i];r&&(e[i]=r)}function ae(e,t,i){e.rawProgramDateTime?i.push(e):null!=t&&t.programDateTime&&(e.programDateTime=t.endProgramDateTime)}function at(e,t,i,r){e.relurl=t.URI,t.BYTERANGE&&e.setByteRange(t.BYTERANGE),e.level=i,e.sn="initSegment",r&&(e.levelkeys=r),e.initSegment=null}function ai(e,t,i){e.levelkeys=t;let{encryptedFragments:r}=i;(!r.length||r[r.length-1].levelkeys!==t)&&Object.keys(t).some(e=>t[e].isCommonEncryption)&&r.push(e)}function ar(e,t,i){e.playlistParsingError=Error("#EXT-X-".concat(t," must not appear more than once (").concat(i[0],")"))}function aa(e,t,i){e.playlistParsingError=Error("#EXT-X-".concat(t," must appear before the first Media Segment (").concat(i[0],")"))}function an(e,t){let i=t.startPTS;if(tP(i)){let r,a=0;t.sn>e.sn?(a=i-e.start,r=e):(a=e.start-i,r=t),r.duration!==a&&r.setDuration(a)}else t.sn>e.sn?e.cc===t.cc&&e.minEndPTS?t.setStart(e.start+(e.minEndPTS-e.start)):t.setStart(e.start+e.duration):t.setStart(Math.max(e.start-t.duration,0))}function as(e,t,i,r,a,n,s){let o;r-i<=0&&(s.warn("Fragment should have a positive duration",t),r=i+t.duration,n=a+t.duration);let l=i,d=r,u=t.startPTS,h=t.endPTS;if(tP(u)){let o=Math.abs(u-i);e&&o>e.totalduration?s.warn("media timestamps and playlist times differ by ".concat(o,"s for level ").concat(t.level," ").concat(e.url)):tP(t.deltaPTS)?t.deltaPTS=Math.max(o,t.deltaPTS):t.deltaPTS=o,l=Math.max(i,u),i=Math.min(i,u),a=void 0!==t.startDTS?Math.min(a,t.startDTS):a,d=Math.min(r,h),r=Math.max(r,h),n=void 0!==t.endDTS?Math.max(n,t.endDTS):n}let c=i-t.start;0!==t.start&&t.setStart(i),t.setDuration(r-t.start),t.startPTS=i,t.maxStartPTS=l,t.startDTS=a,t.endPTS=r,t.minEndPTS=d,t.endDTS=n;let m=t.sn;if(!e||m<e.startSN||m>e.endSN)return 0;let f=m-e.startSN,p=e.fragments;for(p[f]=t,o=f;o>0;o--)an(p[o],p[o-1]);for(o=f;o<p.length-1;o++)an(p[o],p[o+1]);return e.fragmentHint&&an(p[p.length-1],e.fragmentHint),e.PTSKnown=e.alignedSliding=!0,c}function ao(e,t,i,r,a){return Error("".concat(e," ").concat(a.url,"\nPlaylist starting @").concat(t.startSN,"\n").concat(t.m3u8,"\n\nPlaylist starting @").concat(i.startSN,"\n").concat(i.m3u8))}function al(e,t){let i=!(arguments.length>2)||void 0===arguments[2]||arguments[2],r=t.startSN+t.skippedSegments-e.startSN,a=e.fragments,n=r>=0,s=0;if(n&&r<a.length)s=a[r].start;else if(n&&t.startSN===e.endSN+1)s=e.fragmentEnd;else if(n&&i)s=e.fragmentStart+r*t.levelTargetDuration;else{if(t.skippedSegments||0!==t.fragmentStart)return;s=e.fragmentStart}ad(t,s)}function ad(e,t){if(t){let i=e.fragments;for(let r=e.skippedSegments;r<i.length;r++)i[r].addStart(t);e.fragmentHint&&e.fragmentHint.addStart(t)}}function au(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,i=1e3*e.targetduration;if(e.updated){let r=e.fragments;if(r.length&&4*i>t){let e=1e3*r[r.length-1].duration;e<i&&(i=e)}}else i/=2;return Math.round(i)}function ah(e,t,i){if(!e)return null;let r=e.fragments[t-e.startSN];return r||(r=e.fragmentHint)&&r.sn===t?r:t<e.startSN&&i&&i.sn===t?i:null}function ac(e,t,i){return e?am(e.partList,t,i):null}function am(e,t,i){if(e)for(let r=e.length;r--;){let a=e[r];if(a.index===i&&a.fragment.sn===t)return a}return null}function af(e){e.forEach((e,t)=>{var i;null==(i=e.details)||i.fragments.forEach(e=>{e.level=t,e.initSegment&&(e.initSegment.level=t)})})}function ap(e){return e.replace(/\?[^?]*$/,"")}function ag(e,t){for(let r=0,a=e.length;r<a;r++){var i;if((null==(i=e[r])?void 0:i.cc)===t)return e[r]}return null}function av(e,t){let i=e.start+t;e.startPTS=i,e.setStart(i),e.endPTS=i+e.duration}function aE(e,t){let i=t.fragments;for(let t=0,r=i.length;t<r;t++)av(i[t],e);t.fragmentHint&&av(t.fragmentHint,e),t.alignedSliding=!0}function ay(e,t){if((!t||!(e.startCC<t.endCC)||!(e.endCC>t.startCC))&&1)return;let i=Math.min(t.endCC,e.endCC),r=ag(t.fragments,i),a=ag(e.fragments,i);r&&a&&(tJ.log("Aligning playlist at start of dicontinuity sequence ".concat(i)),aE(r.start-a.start,e))}function ab(e,t){let i,r;if(!e.hasProgramDateTime||!t.hasProgramDateTime)return;let a=e.fragments,n=t.fragments;if(!a.length||!n.length)return;let s=Math.min(t.endCC,e.endCC);t.startCC<s&&e.startCC<s&&(i=ag(n,s),r=ag(a,s)),i&&r||(r=ag(a,(i=n[Math.floor(n.length/2)]).cc)||a[Math.floor(a.length/2)]);let o=i.programDateTime,l=r.programDateTime;o&&l&&aE((l-o)/1e3-(r.start-i.start),e)}function aT(e,t,i){a_(e,t,i),e.addEventListener(t,i)}function a_(e,t,i){e.removeEventListener(t,i)}let aA={toString:function(e){let t="",i=e.length;for(let r=0;r<i;r++)t+="[".concat(e.start(r).toFixed(3),"-").concat(e.end(r).toFixed(3),"]");return t}},aS={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class aI extends rS{registerListeners(){let{hls:e}=this;e.on(tB.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(tB.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(tB.MANIFEST_LOADING,this.onManifestLoading,this),e.on(tB.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(tB.ERROR,this.onError,this)}unregisterListeners(){let{hls:e}=this;e.off(tB.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(tB.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(tB.MANIFEST_LOADING,this.onManifestLoading,this),e.off(tB.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(tB.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===aS.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);let e=this.fragCurrent;null!=e&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=aS.STOPPED}get startPositionValue(){let{nextLoadPosition:e,startPosition:t}=this;return -1===t&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;let i=e.end||0,r=this.config.timelineOffset||0;if(i<=r)return!1;let a=e.buffered;this.config.maxBufferHole&&a&&a.length>1&&(e=rL.bufferedInfo(a,e.start,0));let n=e.nextStart;if(n&&n>r&&n<t.edge||this.media.currentTime<e.start)return!1;let s=t.partList;if(null!=s&&s.length){let e=s[s.length-1];return rL.isBuffered(this.media,e.start+e.duration/2)}let o=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(o)}getLevelDetails(){if(this.levels&&null!==this.levelLastLoaded)return this.levelLastLoaded.details}get timelineOffset(){let e=this.config.timelineOffset;if(e){var t;return(null==(t=this.getLevelDetails())?void 0:t.appliedTimelineOffset)||e}return 0}onMediaAttached(e,t){let i=this.media=this.mediaBuffer=t.media;aT(i,"seeking",this.onMediaSeeking),aT(i,"ended",this.onMediaEnded);let r=this.config;this.levels&&r.autoStartLoad&&this.state===aS.STOPPED&&this.startLoad(r.startPosition)}onMediaDetaching(e,t){let i=!!t.transferMedia,r=this.media;if(null!==r){if(r.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),a_(r,"seeking",this.onMediaSeeking),a_(r,"ended",this.onMediaEnded),this.keyLoader&&!i&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,i){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=aS.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,i){this.startFragRequested=!0,this._loadFragForPlayback(e,t,i)}_loadFragForPlayback(e,t,i){let r=e=>{let t=e.frag;if(this.fragContextChanged(t)){this.warn("".concat(t.type," sn: ").concat(t.sn).concat(e.part?" part: "+e.part.index:""," of ").concat(this.fragInfo(t,!1,e.part),") was dropped during download.")),this.fragmentTracker.removeFragment(t);return}t.stats.chunkCount++,this._handleFragmentLoadProgress(e)};this._doFragLoad(e,t,i,r).then(e=>{if(!e)return;let t=this.state,i=e.frag;if(this.fragContextChanged(i)){t!==aS.FRAG_LOADING&&(this.fragCurrent||t!==aS.PARSING)||(this.fragmentTracker.removeFragment(i),this.state=aS.IDLE);return}"payload"in e&&(this.log("Loaded ".concat(i.type," sn: ").concat(i.sn," of ").concat(this.playlistLabel()," ").concat(i.level)),this.hls.trigger(tB.FRAG_LOADED,e)),this._handleFragmentLoadComplete(e)}).catch(t=>{this.state!==aS.STOPPED&&this.state!==aS.ERROR&&(this.warn("Frag error: ".concat((null==t?void 0:t.message)||t)),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;let{fragmentTracker:i}=this;if(i.getState(e)===ru.APPENDING){let t=e.type,r=this.getFwdBufferInfo(this.mediaBuffer,t),a=Math.max(e.duration,r?r.len:this.config.maxBufferLength),n=this.backtrackFragment;(1==(n?e.sn-n.sn:0)||this.reduceMaxBufferLength(a,e.duration))&&i.removeFragment(e)}else(null==(t=this.mediaBuffer)?void 0:t.buffered.length)===0?i.removeAllFragments():i.hasParts(e.type)&&(i.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),i.getState(e)===ru.PARTIAL&&i.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){let t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){let t=e.details;return(null==t?void 0:t.live)&&"EVENT"!==t.type&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e-t&&this.hls.trigger(tB.BUFFER_FLUSHING,{startOffset:e,endOffset:t,type:i})}_loadInitSegment(e,t){this._doFragLoad(e,t).then(e=>{let t=null==e?void 0:e.frag;if(!t||this.fragContextChanged(t)||!this.levels)throw Error("init load aborted");return e}).then(e=>{let{hls:t}=this,{frag:i,payload:r}=e,a=i.decryptdata;if(r&&r.byteLength>0&&null!=a&&a.key&&a.iv&&rB(a.method)){let n=self.performance.now();return this.decrypter.decrypt(new Uint8Array(r),a.key.buffer,a.iv.buffer,rH(a.method)).catch(e=>{throw t.trigger(tB.ERROR,{type:tU.MEDIA_ERROR,details:tF.FRAG_DECRYPT_ERROR,fatal:!1,error:e,reason:e.message,frag:i}),e}).then(r=>{let a=self.performance.now();return t.trigger(tB.FRAG_DECRYPTED,{frag:i,payload:r,stats:{tstart:n,tdecrypt:a}}),e.payload=r,this.completeInitSegmentLoad(e)})}return this.completeInitSegmentLoad(e)}).catch(t=>{this.state!==aS.STOPPED&&this.state!==aS.ERROR&&(this.warn(t),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){let{levels:t}=this;if(!t)throw Error("init load aborted, missing levels");let i=e.frag.stats;this.state!==aS.STOPPED&&(this.state=aS.IDLE),e.frag.data=new Uint8Array(e.payload),i.parsing.start=i.buffering.start=self.performance.now(),i.parsing.end=i.buffering.end=self.performance.now(),this.tick()}unhandledEncryptionError(e,t){var i,r;let a=e.tracks;if(a&&!t.encrypted&&(null!=(i=a.audio)&&i.encrypted||null!=(r=a.video)&&r.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){let e=this.media,i=Error("Encrypted track with no key in ".concat(this.fragInfo(t)," (media ").concat(e?"attached mediaKeys: "+e.mediaKeys:"detached",")"));return this.warn(i.message),!!e&&!e.mediaKeys&&(this.hls.trigger(tB.ERROR,{type:tU.KEY_SYSTEM_ERROR,details:tF.KEY_SYSTEM_NO_KEYS,fatal:!1,error:i,frag:t}),this.resetTransmuxer(),!0)}return!1}fragContextChanged(e){let{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){let i=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log("Buffered ".concat(e.type," sn: ").concat(e.sn).concat(t?" part: "+t.index:""," of ").concat(this.fragInfo(e,!1,t)," > buffer:").concat(i?aA.toString(rL.getBuffered(i)):"(detached)",")")),t7(e)){var r;if(e.type!==tG.SUBTITLE){let t=e.elementaryStreams;if(!Object.keys(t).some(e=>!!t[e])){this.state=aS.IDLE;return}}let t=null==(r=this.levels)?void 0:r[e.level];null!=t&&t.fragmentError&&(this.log("Resetting level fragment error count of ".concat(t.fragmentError," on frag buffered")),t.fragmentError=0)}this.state=aS.IDLE}_handleFragmentLoadComplete(e){let{transmuxer:t}=this;if(!t)return;let{frag:i,part:r,partsLoaded:a}=e,n=!a||0===a.length||a.some(e=>!e),s=new rI(i.level,i.sn,i.stats.chunkCount+1,0,r?r.index:-1,!n);t.flush(s)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t){var i,r;let a,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3?arguments[3]:void 0;this.fragCurrent=e;let o=t.details;if(!this.levels||!o)throw Error("frag load aborted, missing level".concat(o?"":" detail","s"));let l=null;if(e.encrypted&&!(null!=(i=e.decryptdata)&&i.key)){if(this.log("Loading key for ".concat(e.sn," of [").concat(o.startSN,"-").concat(o.endSN,"], ").concat(this.playlistLabel()," ").concat(e.level)),this.state=aS.KEY_LOADING,this.fragCurrent=e,l=this.keyLoader.load(e).then(e=>{if(!this.fragContextChanged(e.frag))return this.hls.trigger(tB.KEY_LOADED,e),this.state===aS.KEY_LOADING&&(this.state=aS.IDLE),e}),this.hls.trigger(tB.KEY_LOADING,{frag:e}),null===this.fragCurrent)return this.log("context changed in KEY_LOADING"),Promise.resolve(null)}else!e.encrypted&&(l=this.keyLoader.loadClear(e,o.encryptedFragments,this.startFragRequested))&&this.log("[eme] blocking frag load until media-keys acquired");let d=this.fragPrevious;if(t7(e)&&(!d||e.sn!==d.sn)){let i=this.shouldLoadParts(t.details,e.end);i!==this.loadingParts&&(this.log("LL-Part loading ".concat(i?"ON":"OFF"," loading sn ").concat(null==d?void 0:d.sn,"->").concat(e.sn)),this.loadingParts=i)}if(n=Math.max(e.start,n||0),this.loadingParts&&t7(e)){let i=o.partList;if(i&&s){n>o.fragmentEnd&&o.fragmentHint&&(e=o.fragmentHint);let r=this.getNextPart(i,e,n);if(r>-1){let a,d=i[r];return(e=this.fragCurrent=d.fragment,this.log("Loading ".concat(e.type," sn: ").concat(e.sn," part: ").concat(d.index," (").concat(r,"/").concat(i.length-1,") of ").concat(this.fragInfo(e,!1,d),") cc: ").concat(e.cc," [").concat(o.startSN,"-").concat(o.endSN,"], target: ").concat(parseFloat(n.toFixed(3)))),this.nextLoadPosition=d.start+d.duration,this.state=aS.FRAG_LOADING,a=l?l.then(i=>!i||this.fragContextChanged(i.frag)?null:this.doFragPartsLoad(e,d,t,s)).catch(e=>this.handleFragLoadError(e)):this.doFragPartsLoad(e,d,t,s).catch(e=>this.handleFragLoadError(e)),this.hls.trigger(tB.FRAG_LOADING,{frag:e,part:d,targetBufferTime:n}),null===this.fragCurrent)?Promise.reject(Error("frag load aborted, context changed in FRAG_LOADING parts")):a}if(!e.url||this.loadedEndOfParts(i,n))return Promise.resolve(null)}}if(t7(e)&&this.loadingParts)this.log("LL-Part loading OFF after next part miss @".concat(n.toFixed(2)," Check buffer at sn: ").concat(e.sn," loaded parts: ").concat(null==(r=o.partList)?void 0:r.filter(e=>e.loaded).map(e=>"[".concat(e.start,"-").concat(e.end,"]")))),this.loadingParts=!1;else if(!e.url)return Promise.resolve(null);this.log("Loading ".concat(e.type," sn: ").concat(e.sn," of ").concat(this.fragInfo(e,!1),") cc: ").concat(e.cc," ").concat("["+o.startSN+"-"+o.endSN+"]",", target: ").concat(parseFloat(n.toFixed(3)))),tP(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=aS.FRAG_LOADING;let u=this.config.progressive;return(a=u&&l?l.then(t=>!t||this.fragContextChanged(t.frag)?null:this.fragmentLoader.load(e,s)).catch(e=>this.handleFragLoadError(e)):Promise.all([this.fragmentLoader.load(e,u?s:void 0),l]).then(e=>{let[t]=e;return!u&&s&&s(t),t}).catch(e=>this.handleFragLoadError(e)),this.hls.trigger(tB.FRAG_LOADING,{frag:e,targetBufferTime:n}),null===this.fragCurrent)?Promise.reject(Error("frag load aborted, context changed in FRAG_LOADING")):a}doFragPartsLoad(e,t,i,r){return new Promise((a,n)=>{var s;let o=[],l=null==(s=i.details)?void 0:s.partList,d=t=>{this.fragmentLoader.loadPart(e,t,r).then(r=>{o[t.index]=r;let n=r.part;this.hls.trigger(tB.FRAG_LOADED,r);let s=ac(i.details,e.sn,t.index+1)||am(l,e.sn,t.index+1);if(!s)return a({frag:e,part:n,partsLoaded:o});d(s)}).catch(n)};d(t)})}handleFragLoadError(e){if("data"in e){let t=e.data;t.frag&&t.details===tF.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):t.frag&&t.type===tU.KEY_SYSTEM_ERROR?(t.frag.abortRequests(),this.resetStartWhenNotLoaded(),this.resetFragmentLoading(t.frag)):this.hls.trigger(tB.ERROR,t)}else this.hls.trigger(tB.ERROR,{type:tU.OTHER_ERROR,details:tF.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){let t=this.getCurrentContext(e);if(!t||this.state!==aS.PARSING){this.fragCurrent||this.state===aS.STOPPED||this.state===aS.ERROR||(this.state=aS.IDLE);return}let{frag:i,part:r,level:a}=t,n=self.performance.now();i.stats.parsing.end=n,r&&(r.stats.parsing.end=n);let s=this.getLevelDetails(),o=s&&i.sn>s.endSN||this.shouldLoadParts(s,i.end);o!==this.loadingParts&&(this.log("LL-Part loading ".concat(o?"ON":"OFF"," after parsing segment ending @").concat(i.end.toFixed(2))),this.loadingParts=o),this.updateLevelTiming(i,r,a,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e.partList){var i,r;let a=e.partList[0];if(a.fragment.type===tG.SUBTITLE)return!1;if(t>=a.end+((null==(i=e.fragmentHint)?void 0:i.duration)||0)&&(this.hls.hasEnoughToStart?(null==(r=this.media)?void 0:r.currentTime)||this.lastCurrentTime:this.getLoadPosition())>a.start-a.fragment.duration)return!0}}return!1}getCurrentContext(e){let{levels:t,fragCurrent:i}=this,{level:r,sn:a,part:n}=e;if(!(null!=t&&t[r]))return this.warn("Levels object was unset while buffering fragment ".concat(a," of ").concat(this.playlistLabel()," ").concat(r,". The current chunk will not be buffered.")),null;let s=t[r],o=s.details,l=n>-1?ac(o,a,n):null,d=l?l.fragment:ah(o,a,i);return d?(i&&i!==d&&(d.stats=i.stats),{frag:d,part:l,level:s}):null}bufferFragmentData(e,t,i,r,a){if(this.state!==aS.PARSING)return;let{data1:n,data2:s}=e,o=n;if(s&&(o=iE(n,s)),!o.length)return;let l=this.initPTS[t.cc],d=l?-l.baseTime/l.timescale:void 0,u={type:e.type,frag:t,part:i,chunkMeta:r,offset:d,parent:t.type,data:o};if(this.hls.trigger(tB.BUFFER_APPENDING,u),e.dropped&&e.independent&&!i){if(a)return;this.flushBufferGap(t)}}flushBufferGap(e){let t=this.media;if(!t)return;if(!rL.isBuffered(t,t.currentTime))return void this.flushMainBuffer(0,e.start);let i=t.currentTime,r=rL.bufferInfo(t,i,0),a=e.duration,n=Math.min(2*this.config.maxFragLookUpTolerance,.25*a),s=Math.max(Math.min(e.start-n,r.end-n),i+n);e.start-s>n&&this.flushMainBuffer(s,e.start)}getFwdBufferInfo(e,t){var i;let r=this.getLoadPosition();if(!tP(r))return null;let a=this.lastCurrentTime>r||null!=(i=this.media)&&i.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,r,t,a)}getFwdBufferInfoAtPos(e,t,i,r){let a=rL.bufferInfo(e,t,r);if(0===a.len&&void 0!==a.nextStart){let n=this.fragmentTracker.getBufferedFrag(t,i);if(n&&(a.nextStart<=n.end||n.gap)){let i=Math.max(Math.min(a.nextStart,n.end)-t,r);return rL.bufferInfo(e,t,i)}}return a}getMaxBufferLength(e){let{config:t}=this;return Math.min(e?Math.max(8*t.maxBufferSize/e,t.maxBufferLength):t.maxBufferLength,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){let i=this.config,r=Math.max(Math.min(e-t,i.maxBufferLength),t),a=Math.max(e-3*t,i.maxMaxBufferLength/2,r);return a>=r&&(i.maxMaxBufferLength=a,this.warn("Reduce max buffer length to ".concat(a,"s")),!0)}getAppendedFrag(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:tG.MAIN,i=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(e,t):null;return i&&"fragment"in i?i.fragment:i}getNextFragment(e,t){let i=t.fragments,r=i.length;if(!r)return null;let{config:a}=this,n=i[0].start,s=a.lowLatencyMode&&!!t.partList,o=null;if(t.live){let i=a.initialLiveManifestSize;if(r<i)return this.warn("Not enough fragments to start playback (have: ".concat(r,", need: ").concat(i,")")),null;if(!t.PTSKnown&&!this.startFragRequested&&-1===this.startPosition||e<n){var l;s&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),o=this.getInitialLiveFragment(t);let i=this.hls.startPosition,r=this.hls.liveSyncPosition,a=o?(-1!==i&&i>=n?i:r)||o.start:e;this.log("Setting startPosition to ".concat(a," to match start frag at live edge. mainStart: ").concat(i," liveSyncPosition: ").concat(r," frag.start: ").concat(null==(l=o)?void 0:l.start)),this.startPosition=this.nextLoadPosition=a}}else e<=n&&(o=i[0]);if(!o){let i=this.loadingParts?t.partEnd:t.fragmentEnd;o=this.getFragmentAtPosition(e,i,t)}let d=this.filterReplacedPrimary(o,t);if(!d&&o){let e=o.sn-t.startSN;d=this.filterReplacedPrimary(i[e+1]||null,t)}return this.mapToInitFragWhenRequired(d)}isLoopLoading(e,t){let i=this.fragmentTracker.getState(e);return(i===ru.OK||i===ru.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,i,r,a){let n=null;if(e.gap&&(n=this.getNextFragment(this.nextLoadPosition,t))&&!n.gap&&i.nextStart){let e=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,i.nextStart,r,0);if(null!==e&&i.len+e.len>=a){let e=n.sn;return this.loopSn!==e&&(this.log('buffer full after gaps in "'.concat(r,'" playlist starting at sn: ').concat(e)),this.loopSn=e),null}}return this.loopSn=void 0,n}get primaryPrefetch(){if(aR(this.config)){var e;if(null==(e=this.hls.interstitialsManager)||null==(e=e.playingItem)?void 0:e.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(aR(this.config)&&e.type!==tG.SUBTITLE){let i=this.hls.interstitialsManager,r=null==i?void 0:i.bufferingItem;if(r){let i=r.event;if(i){if(i.appendInPlace||Math.abs(e.start-r.start)>1||0===r.start)return null}else if(e.end<=r.start&&(null==t?void 0:t.live)===!1||e.start>r.end&&r.nextEvent&&(r.nextEvent.appendInPlace||e.start-r.end>1))return null}let a=null==i?void 0:i.playerQueue;if(a)for(let t=a.length;t--;){let i=a[t].interstitial;if(i.appendInPlace&&e.start>=i.startTime&&e.end<=i.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return null==e||!e.initSegment||e.initSegment.data||this.bitrateTest?e:e.initSegment}getNextPart(e,t,i){let r=-1,a=!1,n=!0;for(let s=0,o=e.length;s<o;s++){let o=e[s];if(n=n&&!o.independent,r>-1&&i<o.start)break;let l=o.loaded;l?r=-1:(a||(o.independent||n)&&o.fragment===t)&&(o.fragment!==t&&this.warn("Need buffer at ".concat(i," but next unloaded part starts at ").concat(o.start)),r=s),a=l}return r}loadedEndOfParts(e,t){let i;for(let r=e.length;r--&&(i=e[r]).loaded;)if(t>i.start)return!0;return!1}getInitialLiveFragment(e){let t=e.fragments,i=this.fragPrevious,r=null;if(i){if(e.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: ".concat(i.programDateTime)),r=function(e,t,i){if(null===t||!Array.isArray(e)||!e.length||!tP(t)||t<(e[0].programDateTime||0)||t>=(e[e.length-1].endProgramDateTime||0))return null;for(let r=0;r<e.length;++r){let a=e[r];if(function(e,t,i){let r=1e3*Math.min(t,i.duration+(i.deltaPTS?i.deltaPTS:0));return(i.endProgramDateTime||0)-r>e}(t,i,a))return a}return null}(t,i.endProgramDateTime,this.config.maxFragLookUpTolerance)),!r){let a=i.sn+1;if(a>=e.startSN&&a<=e.endSN){let n=t[a-e.startSN];i.cc===n.cc&&(r=n,this.log("Live playlist, switching playlist, load frag with next SN: ".concat(r.sn)))}!r&&(r=i6(e,i.cc,i.end))&&this.log("Live playlist, switching playlist, load frag with same CC: ".concat(r.sn))}}else{let t=this.hls.liveSyncPosition;null!==t&&(r=this.getFragmentAtPosition(t,this.bitrateTest?e.fragmentEnd:e.edge,e))}return r}getFragmentAtPosition(e,t,i){let r,{config:a}=this,{fragPrevious:n}=this,{fragments:s,endSN:o}=i,{fragmentHint:l}=i,{maxFragLookUpTolerance:d}=a,u=i.partList,h=!!(this.loadingParts&&null!=u&&u.length&&l);if(h&&!this.bitrateTest&&u[u.length-1].fragment.sn===l.sn&&(s=s.concat(l),o=l.sn),e<t){var c;let i=e<this.lastCurrentTime||e>t-d||null!=(c=this.media)&&c.paused||!this.startFragRequested?0:d;r=i8(n,s,e,i)}else r=s[s.length-1];if(r){let e=r.sn-i.startSN,t=this.fragmentTracker.getState(r);if((t===ru.OK||t===ru.PARTIAL&&r.gap)&&(n=r),n&&r.sn===n.sn&&(!h||u[0].fragment.sn>r.sn||!i.live)&&r.level===n.level){let t=s[e+1];r=r.sn<o&&this.fragmentTracker.getState(t)!==ru.OK?t:null}}return r}alignPlaylists(e,t,i){let r=e.fragments.length;if(!r)return this.warn("No fragments in live playlist"),0;let a=e.fragmentStart,n=!t,s=e.alignedSliding&&tP(a);if(n||!s&&!a){i&&(ay(e,i),e.alignedSliding||ab(e,i),e.alignedSliding||e.skippedSegments||al(i,e,!1));let a=e.fragmentStart;return this.log("Live playlist sliding: ".concat(a.toFixed(2)," start-sn: ").concat(t?t.startSN:"na","->").concat(e.startSN," fragments: ").concat(r)),a}return a}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,3*e.partTarget)}setStartPosition(e,t){let i=this.startPosition;i<t&&(i=-1);let r=this.timelineOffset;if(-1===i){let a=null!==this.startTimeOffset,n=a?this.startTimeOffset:e.startTimeOffset;null!==n&&tP(n)?(i=t+n,n<0&&(i+=e.edge),i=Math.min(Math.max(t,i),t+e.totalduration),this.log("Setting startPosition to ".concat(i," for start time offset ").concat(n," found in ").concat(a?"multivariant":"media"," playlist")),this.startPosition=i):e.live?(i=this.hls.liveSyncPosition||t,this.log("Setting startPosition to -1 to start at live edge ".concat(i)),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=i=0),this.lastCurrentTime=i+r}this.nextLoadPosition=i+r}getLoadPosition(){var e;let{media:t}=this,i=0;return null!=(e=this.hls)&&e.hasEnoughToStart&&t?i=t.currentTime:this.nextLoadPosition>=0&&(i=this.nextLoadPosition),i}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&t7(e)&&e.stats.aborted&&(this.log("Fragment ".concat(e.sn).concat(t?" part "+t.index:""," of ").concat(this.playlistLabel()," ").concat(e.level," was aborted")),this.resetFragmentLoading(e))}resetFragmentLoading(e){this.fragCurrent&&(this.fragContextChanged(e)||this.state===aS.FRAG_LOADING_WAITING_RETRY)||(this.state=aS.IDLE)}onFragmentOrKeyLoadError(e,t){var i,r,a;if(t.chunkMeta&&!t.frag){let e=this.getCurrentContext(t.chunkMeta);e&&(t.frag=e.frag)}let n=t.frag;if(!n||n.type!==e||!this.levels)return;if(this.fragContextChanged(n))return void this.warn("Frag load error must match current frag to retry ".concat(n.url," > ").concat(null==(r=this.fragCurrent)?void 0:r.url));let s=t.details===tF.FRAG_GAP;s&&this.fragmentTracker.fragBuffered(n,!0);let o=t.errorAction;if(!o){this.state=aS.ERROR;return}let{action:l,flags:d,retryCount:u=0,retryConfig:h}=o,c=!!h,m=c&&l===ro.RetryRequest,f=c&&!o.resolved&&d===rl.MoveAllAlternatesMatchingHost,p=null==(i=this.hls.latestLevelDetails)?void 0:i.live;if(!m&&f&&t7(n)&&!n.endList&&p&&!rt(t))this.resetFragmentErrors(e),this.treatAsGap(n),o.resolved=!0;else if((m||f)&&u<h.maxNumRetry){let i=rs(null==(a=t.response)?void 0:a.code),r=rr(h,u);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+r,this.state=aS.FRAG_LOADING_WAITING_RETRY,o.resolved=!0,i){this.log("Waiting for connection (offline)"),this.retryDate=1/0,t.reason="offline";return}this.warn("Fragment ".concat(n.sn," of ").concat(e," ").concat(n.level," errored with ").concat(t.details,", retrying loading ").concat(u+1,"/").concat(h.maxNumRetry," in ").concat(r,"ms"))}else if(h){if(this.resetFragmentErrors(e),!(u<h.maxNumRetry))return void this.warn("".concat(t.details," reached or exceeded max retry (").concat(u,")"));s||l===ro.RemoveAlternatePermanently||(o.resolved=!0)}else l===ro.SendAlternateToPenaltyBox?this.state=aS.WAITING_LEVEL:this.state=aS.ERROR;this.tickImmediate()}checkRetryDate(){let e=self.performance.now(),t=this.retryDate,i=t===1/0;(!t||e>=t||i&&!rs(0))&&(i&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state=aS.IDLE)}reduceLengthAndFlushBuffer(e){if(this.state===aS.PARSING||this.state===aS.PARSED){let t=e.frag,i=e.parent,r=this.getFwdBufferInfo(this.mediaBuffer,i),a=r&&r.len>.5;a&&this.reduceMaxBufferLength(r.len,(null==t?void 0:t.duration)||10);let n=!a;return n&&this.warn("Buffer full error while media.currentTime (".concat(this.getLoadPosition(),") is not buffered, flush ").concat(i," buffer")),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),n}return!1}resetFragmentErrors(e){e===tG.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==aS.STOPPED&&(this.state=aS.IDLE)}afterBufferFlushed(e,t,i){if(!e)return;let r=rL.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,r,i),this.state===aS.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==aS.STOPPED&&(this.state=aS.IDLE)}resetStartWhenNotLoaded(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;let e=this.levelLastLoaded,t=e?e.details:null;null!=t&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.log("Loading context changed while buffering sn ".concat(e.sn," of ").concat(this.playlistLabel()," ").concat(-1===e.level?"<removed>":e.level,". This chunk will not be buffered.")),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()}removeUnbufferedFrags(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,i,r){let a=i.details;if(!a)return void this.warn("level.details undefined");if(!Object.keys(e.elementaryStreams).reduce((t,n)=>{let s=e.elementaryStreams[n];if(s){let o=s.endPTS-s.startPTS;if(o<=0)return this.warn("Could not parse fragment ".concat(e.sn," ").concat(n," duration reliably (").concat(o,")")),t||!1;let l=r?0:as(a,e,s.startPTS,s.endPTS,s.startDTS,s.endDTS,this);return this.hls.trigger(tB.LEVEL_PTS_UPDATED,{details:a,level:i,drift:l,type:n,frag:e,start:s.startPTS,end:s.endPTS}),!0}return t},!1)){var n;if(0===i.fragmentError&&this.treatAsGap(e,i),(null==(n=this.transmuxer)?void 0:n.error)===null){let t=Error("Found no media in fragment ".concat(e.sn," of ").concat(this.playlistLabel()," ").concat(e.level," resetting transmuxer to fallback to playlist timing"));if(this.warn(t.message),this.hls.trigger(tB.ERROR,{type:tU.MEDIA_ERROR,details:tF.FRAG_PARSING_ERROR,fatal:!1,error:t,frag:e,reason:"Found no media in msn ".concat(e.sn," of ").concat(this.playlistLabel(),' "').concat(i.url,'"')}),!this.hls)return;this.resetTransmuxer()}}this.state=aS.PARSED,this.log("Parsed ".concat(e.type," sn: ").concat(e.sn).concat(t?" part: "+t.index:""," of ").concat(this.fragInfo(e,!1,t),")")),this.hls.trigger(tB.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===tG.MAIN?"level":"track"}fragInfo(e){var t,i;let r=!(arguments.length>1)||void 0===arguments[1]||arguments[1],a=arguments.length>2?arguments[2]:void 0;return"".concat(this.playlistLabel()," ").concat(e.level," (").concat(a?"part":"frag",":[").concat((null!=(t=r&&!a?e.startPTS:(a||e).start)?t:NaN).toFixed(3),"-").concat((null!=(i=r&&!a?e.endPTS:(a||e).end)?i:NaN).toFixed(3),"]").concat(a&&"main"===e.type?"INDEPENDENT="+(a.independent?"YES":"NO"):"")}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;null==(e=this.transmuxer)||e.reset()}recoverWorkerError(e){"demuxerWorker"===e.event&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())}set state(e){let t=this._state;t!==e&&(this._state=e,this.log("".concat(t,"->").concat(e)))}get state(){return this._state}constructor(e,t,i,r,a){super(r,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=aS.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{let{config:e,fragCurrent:t,media:i,mediaBuffer:r,state:a}=this,n=i?i.currentTime:0,s=rL.bufferInfo(r||i,n,e.maxBufferHole),o=!s.len;if(this.log("Media seeking to ".concat(tP(n)?n.toFixed(3):n,", state: ").concat(a,", ").concat(o?"out of":"in"," buffer")),this.state===aS.ENDED)this.resetLoadingState();else if(t){let i=e.maxFragLookUpTolerance,r=t.start-i,a=t.start+t.duration+i;if(o||a<s.start||r>s.end){let e=n>a;(n<r||e)&&(e&&t.loader&&(this.log("Cancelling fragment load for seek (sn: ".concat(t.sn,")")),t.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(i&&(this.fragmentTracker.removeFragmentsInRange(n,1/0,this.playlistType,!0),n>this.lastCurrentTime&&(this.lastCurrentTime=n),!this.loadingParts)){let e=Math.max(s.end,n),t=this.shouldLoadParts(this.getLevelDetails(),e);t&&(this.log("LL-Part loading ON after seeking to ".concat(n.toFixed(2)," with buffer @").concat(e.toFixed(2))),this.loadingParts=t)}!this.hls.hasEnoughToStart&&(this.log("Setting ".concat(o?"startPosition":"nextLoadPosition"," to ").concat(n," for seek without enough to start")),this.nextLoadPosition=n,o&&(this.startPosition=n)),o&&this.state===aS.IDLE&&this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=a,this.hls=e,this.fragmentLoader=new rb(e.config),this.keyLoader=i,this.fragmentTracker=t,this.config=e.config,this.decrypter=new ry(e.config)}}function aR(e){return!!e.interstitialsController&&!1!==e.enableInterstitialPlayback}class ak{push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){let e,{chunks:t,dataLength:i}=this;return t.length?(e=1===t.length?t[0]:function(e,t){let i=new Uint8Array(t),r=0;for(let t=0;t<e.length;t++){let a=e[t];i.set(a,r),r+=a.length}return i}(t,i),this.reset(),e):new Uint8Array(0)}reset(){this.chunks.length=0,this.dataLength=0}constructor(){this.chunks=[],this.dataLength=0}}var aL={exports:{}},aD=function(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}((lO||(lO=1,!function(e){var t=Object.prototype.hasOwnProperty,i="~";function r(){}function a(e,t,i){this.fn=e,this.context=t,this.once=i||!1}function n(e,t,r,n,s){if("function"!=typeof r)throw TypeError("The listener must be a function");var o=new a(r,n||e,s),l=i?i+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],o]:e._events[l].push(o):(e._events[l]=o,e._eventsCount++),e}function s(e,t){0==--e._eventsCount?e._events=new r:delete e._events[t]}function o(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(i=!1)),o.prototype.eventNames=function(){var e,r,a=[];if(0===this._eventsCount)return a;for(r in e=this._events)t.call(e,r)&&a.push(i?r.slice(1):r);return Object.getOwnPropertySymbols?a.concat(Object.getOwnPropertySymbols(e)):a},o.prototype.listeners=function(e){var t=i?i+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var a=0,n=r.length,s=Array(n);a<n;a++)s[a]=r[a].fn;return s},o.prototype.listenerCount=function(e){var t=i?i+e:e,r=this._events[t];return r?r.fn?1:r.length:0},o.prototype.emit=function(e,t,r,a,n,s){var o=i?i+e:e;if(!this._events[o])return!1;var l,d,u=this._events[o],h=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),h){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,r),!0;case 4:return u.fn.call(u.context,t,r,a),!0;case 5:return u.fn.call(u.context,t,r,a,n),!0;case 6:return u.fn.call(u.context,t,r,a,n,s),!0}for(d=1,l=Array(h-1);d<h;d++)l[d-1]=arguments[d];u.fn.apply(u.context,l)}else{var c,m=u.length;for(d=0;d<m;d++)switch(u[d].once&&this.removeListener(e,u[d].fn,void 0,!0),h){case 1:u[d].fn.call(u[d].context);break;case 2:u[d].fn.call(u[d].context,t);break;case 3:u[d].fn.call(u[d].context,t,r);break;case 4:u[d].fn.call(u[d].context,t,r,a);break;default:if(!l)for(c=1,l=Array(h-1);c<h;c++)l[c-1]=arguments[c];u[d].fn.apply(u[d].context,l)}}return!0},o.prototype.on=function(e,t,i){return n(this,e,t,i,!1)},o.prototype.once=function(e,t,i){return n(this,e,t,i,!0)},o.prototype.removeListener=function(e,t,r,a){var n=i?i+e:e;if(!this._events[n])return this;if(!t)return s(this,n),this;var o=this._events[n];if(o.fn)o.fn!==t||a&&!o.once||r&&o.context!==r||s(this,n);else{for(var l=0,d=[],u=o.length;l<u;l++)(o[l].fn!==t||a&&!o[l].once||r&&o[l].context!==r)&&d.push(o[l]);d.length?this._events[n]=1===d.length?d[0]:d:s(this,n)}return this},o.prototype.removeAllListeners=function(e){var t;return e?(t=i?i+e:e,this._events[t]&&s(this,t)):(this._events=new r,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=i,o.EventEmitter=o,e.exports=o}(aL)),aL.exports));let aw="1.6.12",aC={};function aM(e,t){return t+10<=e.length&&51===e[t]&&68===e[t+1]&&73===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128||!1}function aO(e,t){return t+10<=e.length&&73===e[t]&&68===e[t+1]&&51===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128||!1}function aP(e,t){return(127&e[t])<<21|(127&e[t+1])<<14|(127&e[t+2])<<7|127&e[t+3]}function ax(e,t){let i=t,r=0;for(;aO(e,t);)r+=10,r+=aP(e,t+6),aM(e,t+10)&&(r+=10),t+=r;if(r>0)return e.subarray(i,i+r)}function aN(e,t){return 255===e[t]&&(246&e[t+1])==240}function aU(e,t){return 1&e[t+1]?7:9}function aF(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}function aB(e,t){return t+1<e.length&&aN(e,t)}function aH(e,t,i,r,a){if(!e.samplerate){let n=function(e,t,i,r){let a=t[i+2],n=a>>2&15;if(n>12){let t=Error("invalid ADTS sampling index:".concat(n));e.emit(tB.ERROR,tB.ERROR,{type:tU.MEDIA_ERROR,details:tF.FRAG_PARSING_ERROR,fatal:!0,error:t,reason:t.message});return}let s=(a>>6&3)+1,o=t[i+3]>>6&3|(1&a)<<2,l="mp4a.40."+s,d=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350][n],u=n;(5===s||29===s)&&(u-=3);let h=[s<<3|(14&u)>>1,(1&u)<<7|o<<3];return tJ.log("manifest codec:".concat(r,", parsed codec:").concat(l,", channels:").concat(o,", rate:").concat(d," (ADTS object type:").concat(s," sampling index:").concat(n,")")),{config:h,samplerate:d,channelCount:o,codec:l,parsedCodec:l,manifestCodec:r}}(t,i,r,a);n&&tW(e,n)}}function aG(e,t,i,r,a){let n,s=r+a*(9216e4/e.samplerate),o=function(e,t){let i=aU(e,t);if(t+i<=e.length){let r=aF(e,t)-i;if(r>0)return{headerLength:i,frameLength:r}}}(t,i);if(o){let{frameLength:r,headerLength:a}=o,l=a+r,d=Math.max(0,i+l-t.length);d?(n=new Uint8Array(l-a)).set(t.subarray(i+a,t.length),0):n=t.subarray(i+a,i+l);let u={unit:n,pts:s};return d||e.samples.push(u),{sample:u,length:l,missing:d}}let l=t.length-i;return(n=new Uint8Array(l)).set(t.subarray(i,t.length),0),{sample:{unit:n,pts:s},length:l,missing:-1}}function aK(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/0;return function(e,t,i,r){var a,n;let s=(a=e)instanceof ArrayBuffer?a:a.buffer,o=1;"BYTES_PER_ELEMENT"in r&&(o=r.BYTES_PER_ELEMENT);let l=(n=e)&&n.buffer instanceof ArrayBuffer&&void 0!==n.byteLength&&void 0!==n.byteOffset?e.byteOffset:0,d=(l+e.byteLength)/o,u=Math.floor(Math.max(0,Math.min((l+t)/o,d))),h=Math.floor(Math.min(u+Math.max(i,0),d));return new r(s,u,h-u)}(e,t,i,Uint8Array)}function aV(e){let t=0,i=[];for(;aO(e,t);){let r=aP(e,t+6);e[t+5]>>6&1&&(t+=10);let a=(t+=10)+r;for(;t+10<a;){let r=function(e){let t=String.fromCharCode(e[0],e[1],e[2],e[3]),i=aP(e,4);return{type:t,size:i,data:e.subarray(10,10+i)}}(e.subarray(t)),a=function(e){if("PRIV"===e.type){if(e.size<2)return;let t=t1(e.data,!0),i=new Uint8Array(e.data.subarray(t.length+1));return{key:e.type,info:t,data:i.buffer}}if("W"===e.type[0]){if("WXXX"===e.type){if(e.size<2)return;let t=1,i=t1(e.data.subarray(t),!0);t+=i.length+1;let r=t1(e.data.subarray(t));return{key:e.type,info:i,data:r}}let t=t1(e.data);return{key:e.type,info:"",data:t}}if("APIC"===e.type)return function(e){let t,i={key:e.type,description:"",data:"",mimeType:null,pictureType:null};if(e.size<2)return;if(3!==e.data[0])return void console.log("Ignore frame with unrecognized character encoding");let r=e.data.subarray(1).indexOf(0);if(-1===r)return;let a=t1(aK(e.data,1,r)),n=e.data[2+r],s=e.data.subarray(3+r).indexOf(0);if(-1===s)return;let o=t1(aK(e.data,3+r,s));if("-->"===a)t=t1(aK(e.data,4+r+s));else{var l;t=(l=e.data.subarray(4+r+s))instanceof ArrayBuffer?l:0==l.byteOffset&&l.byteLength==l.buffer.byteLength?l.buffer:new Uint8Array(l).buffer}return i.mimeType=a,i.pictureType=n,i.description=o,i.data=t,i}(e);if(e.size<2)return;if("TXXX"===e.type){let t=1,i=t1(e.data.subarray(t),!0);t+=i.length+1;let r=t1(e.data.subarray(t));return{key:e.type,info:i,data:r}}let t=t1(e.data.subarray(1));return{key:e.type,info:"",data:t}}(r);a&&i.push(a),t+=r.size+10}aM(e,t)&&(t+=10)}return i}function aW(e){return e&&"PRIV"===e.key&&"com.apple.streaming.transportStreamTimestamp"===e.info}function aq(e){let t=aV(e);for(let e=0;e<t.length;e++){let i=t[e];if(aW(i))return function(e){if(8===e.data.byteLength){let t=new Uint8Array(e.data),i=1&t[3],r=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return r/=45,i&&(r+=47721858.84),Math.round(r)}}(i)}}let aY=function(e){return e.audioId3="org.id3",e.dateRange="com.apple.quicktime.HLS",e.emsg="https://aomedia.org/emsg/ID3",e.misbklv="urn:misb:KLV:bin:1910.1",e}({});function aj(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:9e4;return{type:e,id:-1,pid:-1,inputTimeScale:t,sequenceNumber:-1,samples:[],dropped:0}}class aQ{resetInitSegment(e,t,i,r){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,i){}demux(e,t){let i;this.cachedData&&(e=iE(this.cachedData,e),this.cachedData=null);let r=ax(e,0),a=r?r.length:0,n=this._audioTrack,s=this._id3Track,o=r?aq(r):void 0,l=e.length;for((null===this.basePTS||0===this.frameIndex&&tP(o))&&(this.basePTS=az(o,t,this.initPTS),this.lastPTS=this.basePTS),null===this.lastPTS&&(this.lastPTS=this.basePTS),r&&r.length>0&&s.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:aY.audioId3,duration:1/0});a<l;){if(this.canParse(e,a)){let t=this.appendFrame(n,e,a);t?(this.frameIndex++,this.lastPTS=t.sample.pts,a+=t.length,i=a):a=l}else{var d,u;aO(d=e,u=a)&&aP(d,u+6)+10<=d.length-u?(r=ax(e,a),s.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:aY.audioId3,duration:1/0}),a+=r.length,i=a):a++}if(a===l&&i!==l){let t=e.slice(i);this.cachedData?this.cachedData=iE(this.cachedData,t):this.cachedData=t}}return{audioTrack:n,videoTrack:aj(),id3Track:s,textTrack:aj()}}demuxSampleAes(e,t,i){return Promise.reject(Error("[".concat(this,"] This demuxer does not support Sample-AES decryption")))}flush(e){let t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:aj(),id3Track:this._id3Track,textTrack:aj()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}}let az=(e,t,i)=>tP(e)?90*e:9e4*t+(i?9e4*i.baseTime/i.timescale:0),aX=null,aZ=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],aJ=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],a$=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],a0=[0,1,1,4];function a1(e,t,i,r,a){if(i+24>t.length)return;let n=a2(t,i);if(n&&i+n.frameLength<=t.length){let s=r+a*(9e4*n.samplesPerFrame/n.sampleRate),o={unit:t.subarray(i,i+n.frameLength),pts:s,dts:s};return e.config=[],e.channelCount=n.channelCount,e.samplerate=n.sampleRate,e.samples.push(o),{sample:o,length:n.frameLength,missing:0}}}function a2(e,t){let i=e[t+1]>>3&3,r=e[t+1]>>1&3,a=e[t+2]>>4&15,n=e[t+2]>>2&3;if(1!==i&&0!==a&&15!==a&&3!==n){let s=e[t+2]>>1&1,o=e[t+3]>>6,l=1e3*aZ[14*(3===i?3-r:3===r?3:4)+a-1],d=aJ[3*(3===i?0:2===i?1:2)+n],u=a$[i][r],h=a0[r],c=Math.floor(u*l/d+s)*h;if(null===aX){let e=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);aX=e?parseInt(e[1]):0}return aX&&aX<=87&&2===r&&l>=224e3&&0===o&&(e[t+3]=128|e[t+3]),{sampleRate:d,channelCount:3===o?1:2,frameLength:c,samplesPerFrame:8*u*h}}}function a3(e,t){return 255===e[t]&&(224&e[t+1])==224&&(6&e[t+1])!=0}function a4(e,t){return t+1<e.length&&a3(e,t)}function a5(e,t){if(t+1<e.length&&a3(e,t)){let i=a2(e,t),r=4;null!=i&&i.frameLength&&(r=i.frameLength);let a=t+r;return a===e.length||a4(e,a)}return!1}let a8=(e,t)=>{let i=0,r=5;t+=5;let a=new Uint32Array(1),n=new Uint32Array(1),s=new Uint8Array(1);for(;r>0;){s[0]=e[t];let o=Math.min(r,8),l=8-o;n[0]=0xff000000>>>24+l<<l,a[0]=(s[0]&n[0])>>l,i=i?i<<o|a[0]:a[0],t+=1,r-=o}return i};function a9(e,t,i,r,a){if(i+8>t.length||11!==t[i]||119!==t[i+1])return -1;let n=t[i+4]>>6;if(n>=3)return -1;let s=[48e3,44100,32e3][n],o=63&t[i+4],l=2*[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][3*o+n];if(i+l>t.length)return -1;let d=t[i+6]>>5,u=0;2===d?u+=2:(1&d&&1!==d&&(u+=2),4&d&&(u+=2));let h=(t[i+6]<<8|t[i+7])>>12-u&1,c=[2,1,2,3,3,4,4,5][d]+h,m=t[i+5]>>3,f=7&t[i+5],p=new Uint8Array([n<<6|m<<1|f>>2,(3&f)<<6|d<<3|h<<2|o>>4,o<<4&224]),g=t.subarray(i,i+l);return e.config=p,e.channelCount=c,e.samplerate=s,e.samples.push({unit:g,pts:r+1536/s*9e4*a}),l}let a6=/\/emsg[-/]ID3/i;function a7(e,t){return tP(e.presentationTime)?e.presentationTime/e.timeScale:t+e.presentationTimeDelta/e.timeScale}class ne{decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,rp.cbc)}decryptAacSample(e,t,i){let r=e[t].unit;if(r.length<=16)return;let a=r.subarray(16,r.length-r.length%16),n=a.buffer.slice(a.byteOffset,a.byteOffset+a.length);this.decryptBuffer(n).then(a=>{let n=new Uint8Array(a);r.set(n,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,i)}).catch(i)}decryptAacSamples(e,t,i){for(;;t++){if(t>=e.length)return void i();if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,i),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){let t=new Int8Array(16*Math.floor((e.length-48)/160)+16),i=0;for(let r=32;r<e.length-16;r+=160,i+=16)t.set(e.subarray(r,r+16),i);return t}getAvcDecryptedUnit(e,t){let i=new Uint8Array(t),r=0;for(let t=32;t<e.length-16;t+=160,r+=16)e.set(i.subarray(r,r+16),t);return e}decryptAvcSample(e,t,i,r,a){let n=i_(a.data),s=this.getAvcEncryptedData(n);this.decryptBuffer(s.buffer).then(s=>{a.data=this.getAvcDecryptedUnit(n,s),this.decrypter.isSync()||this.decryptAvcSamples(e,t,i+1,r)}).catch(r)}decryptAvcSamples(e,t,i,r){if(e instanceof Uint8Array)throw Error("Cannot decrypt samples of type Uint8Array");for(;;t++,i=0){if(t>=e.length)return void r();let a=e[t].units;for(;!(i>=a.length);i++){let n=a[i];if(!(n.data.length<=48)&&(1===n.type||5===n.type)&&(this.decryptAvcSample(e,t,i,r,n),!this.decrypter.isSync()))return}}}constructor(e,t,i){this.keyData=void 0,this.decrypter=void 0,this.keyData=i,this.decrypter=new ry(t,{removePKCS7Padding:!1})}}class nt{createVideoSample(e,t,i){return{key:e,frame:!1,pts:t,dts:i,units:[],length:0}}getLastNalUnit(e){var t;let i,r=this.VideoSample;if(r&&0!==r.units.length||(r=e[e.length-1]),null!=(t=r)&&t.units){let e=r.units;i=e[e.length-1]}return i}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(void 0===e.pts){let i=t.samples,r=i.length;if(!r)return void t.dropped++;{let t=i[r-1];e.pts=t.pts,e.dts=t.dts}}t.samples.push(e)}}parseNALu(e,t,i){let r,a,n,s=t.byteLength,o=e.naluState||0,l=o,d=[],u=0,h=-1,c=0;for(-1===o&&(h=0,c=this.getNALuType(t,0),o=0,u=1);u<s;){if(r=t[u++],!o){o=+!r;continue}if(1===o){o=2*!r;continue}if(r)if(1===r){if(a=u-o-1,h>=0){let e={data:t.subarray(h,a),type:c};d.push(e)}else{let i=this.getLastNalUnit(e.samples);i&&(l&&u<=4-l&&i.state&&(i.data=i.data.subarray(0,i.data.byteLength-l)),a>0&&(i.data=iE(i.data,t.subarray(0,a)),i.state=0))}u<s?(n=this.getNALuType(t,u),h=u,c=n,o=0):o=-1}else o=0;else o=3}if(h>=0&&o>=0){let e={data:t.subarray(h,s),type:c,state:o};d.push(e)}if(0===d.length){let i=this.getLastNalUnit(e.samples);i&&(i.data=iE(i.data,t))}return e.naluState=o,d}constructor(){this.VideoSample=null}}class ni{loadWord(){let e=this.data,t=this.bytesAvailable,i=e.byteLength-t,r=new Uint8Array(4),a=Math.min(4,t);if(0===a)throw Error("no bytes available");r.set(e.subarray(i,i+a)),this.word=new DataView(r.buffer).getUint32(0),this.bitsAvailable=8*a,this.bytesAvailable-=a}skipBits(e){let t;e=Math.min(e,8*this.bytesAvailable+this.bitsAvailable),this.bitsAvailable>e||(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord()),this.word<<=e,this.bitsAvailable-=e}readBits(e){let t=Math.min(this.bitsAvailable,e),i=this.word>>>32-t;if(e>32&&tJ.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw Error("no bits available");return(t=e-t)>0&&this.bitsAvailable?i<<t|this.readBits(t):i}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if((this.word&0x80000000>>>e)!=0)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){let e=this.skipLZ();return this.readBits(e+1)-1}readEG(){let e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return 1===this.readBits(1)}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}}class nr extends nt{parsePES(e,t,i,r){let a,n=this.parseNALu(e,i.data,r),s=this.VideoSample,o=!1;i.data=null,s&&n.length&&!e.audFound&&(this.pushAccessUnit(s,e),s=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),n.forEach(r=>{var n,l,d,u,h;switch(r.type){case 1:{let t=!1;a=!0;let n=r.data;if(o&&n.length>4){let e=this.readSliceType(n);(2===e||4===e||7===e||9===e)&&(t=!0)}t&&null!=(d=s)&&d.frame&&!s.key&&(this.pushAccessUnit(s,e),s=this.VideoSample=null),s||(s=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),s.frame=!0,s.key=t;break}case 5:a=!0,null!=(n=s)&&n.frame&&!s.key&&(this.pushAccessUnit(s,e),s=this.VideoSample=null),s||(s=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),s.key=!0,s.frame=!0;break;case 6:a=!0,iT(r.data,1,i.pts,t.samples);break;case 7:{a=!0,o=!0;let t=r.data,i=this.readSPS(t);if(!e.sps||e.width!==i.width||e.height!==i.height||(null==(u=e.pixelRatio)?void 0:u[0])!==i.pixelRatio[0]||(null==(h=e.pixelRatio)?void 0:h[1])!==i.pixelRatio[1]){e.width=i.width,e.height=i.height,e.pixelRatio=i.pixelRatio,e.sps=[t];let r=t.subarray(1,4),a="avc1.";for(let e=0;e<3;e++){let t=r[e].toString(16);t.length<2&&(t="0"+t),a+=t}e.codec=a}break}case 8:a=!0,e.pps=[r.data];break;case 9:a=!0,e.audFound=!0,null!=(l=s)&&l.frame&&(this.pushAccessUnit(s,e),s=null),s||(s=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts));break;case 12:a=!0;break;default:a=!1}s&&a&&s.units.push(r)}),r&&s&&(this.pushAccessUnit(s,e),this.VideoSample=null)}getNALuType(e,t){return 31&e[t]}readSliceType(e){let t=new ni(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let i=8,r=8;for(let a=0;a<e;a++)0!==r&&(r=(i+t.readEG()+256)%256),i=0===r?i:r}readSPS(e){let t,i,r,a=new ni(e),n=0,s=0,o=0,l=0,d=a.readUByte.bind(a),u=a.readBits.bind(a),h=a.readUEG.bind(a),c=a.readBoolean.bind(a),m=a.skipBits.bind(a),f=a.skipEG.bind(a),p=a.skipUEG.bind(a),g=this.skipScalingList.bind(this);d();let E=d();if(u(5),m(3),d(),p(),100===E||110===E||122===E||244===E||44===E||83===E||86===E||118===E||128===E){let e=h();if(3===e&&m(1),p(),p(),m(1),c())for(r=0,i=3!==e?8:12;r<i;r++)c()&&g(r<6?16:64,a)}p();let y=h();if(0===y)h();else if(1===y)for(m(1),f(),f(),t=h(),r=0;r<t;r++)f();p(),m(1);let b=h(),T=h(),_=u(1);0===_&&m(1),m(1),c()&&(n=h(),s=h(),o=h(),l=h());let A=[1,1];if(c()&&c())switch(d()){case 1:A=[1,1];break;case 2:A=[12,11];break;case 3:A=[10,11];break;case 4:A=[16,11];break;case 5:A=[40,33];break;case 6:A=[24,11];break;case 7:A=[20,11];break;case 8:A=[32,11];break;case 9:A=[80,33];break;case 10:A=[18,11];break;case 11:A=[15,11];break;case 12:A=[64,33];break;case 13:A=[160,99];break;case 14:A=[4,3];break;case 15:A=[3,2];break;case 16:A=[2,1];break;case 255:A=[d()<<8|d(),d()<<8|d()]}return{width:Math.ceil((b+1)*16-2*n-2*s),height:(2-_)*(T+1)*16-(_?2:4)*(o+l),pixelRatio:A}}}class na extends nt{parsePES(e,t,i,r){let a,n=this.parseNALu(e,i.data,r),s=this.VideoSample,o=!1;i.data=null,s&&n.length&&!e.audFound&&(this.pushAccessUnit(s,e),s=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),n.forEach(r=>{var n,l,d;switch(r.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:s||(s=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),s.frame=!0,a=!0;break;case 16:case 17:case 18:case 21:a=!0,o&&null!=(d=s)&&d.frame&&!s.key&&(this.pushAccessUnit(s,e),s=this.VideoSample=null),s||(s=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),s.key=!0,s.frame=!0;break;case 19:case 20:a=!0,null!=(n=s)&&n.frame&&!s.key&&(this.pushAccessUnit(s,e),s=this.VideoSample=null),s||(s=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),s.key=!0,s.frame=!0;break;case 39:a=!0,iT(r.data,2,i.pts,t.samples);break;case 32:a=!0,e.vps||("object"!=typeof e.params&&(e.params={}),e.params=tW(e.params,this.readVPS(r.data)),this.initVPS=r.data),e.vps=[r.data];break;case 33:if(a=!0,o=!0,void 0===e.vps||e.vps[0]===this.initVPS||void 0===e.sps||this.matchSPS(e.sps[0],r.data)||(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){let t=this.readSPS(r.data);for(let i in e.width=t.width,e.height=t.height,e.pixelRatio=t.pixelRatio,e.codec=t.codecString,e.sps=[],"object"!=typeof e.params&&(e.params={}),t.params)e.params[i]=t.params[i]}this.pushParameterSet(e.sps,r.data,e.vps),s||(s=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),s.key=!0;break;case 34:if(a=!0,"object"==typeof e.params){if(!e.pps){e.pps=[];let t=this.readPPS(r.data);for(let i in t)e.params[i]=t[i]}this.pushParameterSet(e.pps,r.data,e.vps)}break;case 35:a=!0,e.audFound=!0,null!=(l=s)&&l.frame&&(this.pushAccessUnit(s,e),s=null),s||(s=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts));break;default:a=!1}s&&a&&s.units.push(r)}),r&&s&&(this.pushAccessUnit(s,e),this.VideoSample=null)}pushParameterSet(e,t,i){(!i||i[0]!==this.initVPS)&&(i||e.length)||e.push(t)}getNALuType(e,t){return(126&e[t])>>>1}ebsp2rbsp(e){let t=new Uint8Array(e.byteLength),i=0;for(let r=0;r<e.byteLength;r++)(!(r>=2)||3!==e[r]||0!==e[r-1]||0!==e[r-2])&&(t[i]=e[r],i++);return new Uint8Array(t.buffer,0,i)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){let t=new ni(e);return t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6),{numTemporalLayers:t.readBits(3)+1,temporalIdNested:t.readBoolean()}}readSPS(e){let t=new ni(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);let i=t.readBits(3);t.readBoolean();let r=t.readBits(2),a=t.readBoolean(),n=t.readBits(5),s=t.readUByte(),o=t.readUByte(),l=t.readUByte(),d=t.readUByte(),u=t.readUByte(),h=t.readUByte(),c=t.readUByte(),m=t.readUByte(),f=t.readUByte(),p=t.readUByte(),g=t.readUByte(),E=[],y=[];for(let e=0;e<i;e++)E.push(t.readBoolean()),y.push(t.readBoolean());if(i>0)for(let e=i;e<8;e++)t.readBits(2);for(let e=0;e<i;e++)E[e]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),y[e]&&t.readUByte();t.readUEG();let b=t.readUEG();3==b&&t.skipBits(1);let T=t.readUEG(),_=t.readUEG(),A=t.readBoolean(),S=0,I=0,R=0,k=0;A&&(S+=t.readUEG(),I+=t.readUEG(),R+=t.readUEG(),k+=t.readUEG());let L=t.readUEG(),D=t.readUEG(),w=t.readUEG(),C=t.readBoolean();for(let e=C?0:i;e<=i;e++)t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.readBoolean()&&t.readBoolean())for(let e=0;e<4;e++)for(let i=0;i<(3===e?2:6);i++)if(t.readBoolean()){let i=Math.min(64,1<<4+(e<<1));e>1&&t.readEG();for(let e=0;e<i;e++)t.readEG()}else t.readUEG();t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());let M=t.readUEG(),O=0;for(let e=0;e<M;e++){let i=!1;if(0!==e&&(i=t.readBoolean()),i){e===M&&t.readUEG(),t.readBoolean(),t.readUEG();let i=0;for(let e=0;e<=O;e++){let e=t.readBoolean(),r=!1;e||(r=t.readBoolean()),(e||r)&&i++}O=i}else{let e=t.readUEG(),i=t.readUEG();O=e+i;for(let i=0;i<e;i++)t.readUEG(),t.readBoolean();for(let e=0;e<i;e++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){let e=t.readUEG();for(let i=0;i<e;i++){for(let e=0;e<w+4;e++)t.readBits(1);t.readBits(1)}}let P=0,x=1,N=1,U=!0,F=1,B=0;t.readBoolean(),t.readBoolean();if(t.readBoolean()){if(t.readBoolean()){let e=t.readUByte();e>0&&e<16?(x=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][e-1],N=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][e-1]):255===e&&(x=t.readBits(16),N=t.readBits(16))}if(t.readBoolean()&&t.readBoolean(),t.readBoolean()&&(t.readBits(3),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())),t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG()),t.readBoolean()&&(F=t.readBits(32),B=t.readBits(32),t.readBoolean()&&t.readUEG(),t.readBoolean())){let e=t.readBoolean(),r=t.readBoolean(),a=!1;(e||r)&&((a=t.readBoolean())&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),a&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let n=0;n<=i;n++){let i=(U=t.readBoolean())||t.readBoolean(),n=!1;i?t.readEG():n=t.readBoolean();let s=n?1:t.readUEG()+1;if(e)for(let e=0;e<s;e++)t.readUEG(),t.readUEG(),a&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(r)for(let e=0;e<s;e++)t.readUEG(),t.readUEG(),a&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),P=t.readUEG())}let H=T,G=_;if(A){let e=1,t=1;1===b?e=t=2:2==b&&(e=2),H=T-e*I-e*S,G=_-t*k-t*R}let K=r?["A","B","C"][r]:"",V=s<<24|o<<16|l<<8|d,W=0;for(let e=0;e<32;e++)W=(W|(V>>e&1)<<31-e)>>>0;let q=W.toString(16);return 1===n&&"2"===q&&(q="6"),{codecString:"hvc1.".concat(K).concat(n,".").concat(q,".").concat(a?"H":"L").concat(g,".B0"),params:{general_tier_flag:a,general_profile_idc:n,general_profile_space:r,general_profile_compatibility_flags:[s,o,l,d],general_constraint_indicator_flags:[u,h,c,m,f,p],general_level_idc:g,bit_depth:L+8,bit_depth_luma_minus8:L,bit_depth_chroma_minus8:D,min_spatial_segmentation_idc:P,chroma_format_idc:b,frame_rate:{fixed:U,fps:B/F}},width:H,height:G,pixelRatio:[x,N]}}readPPS(e){let t=new ni(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2),t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);let i=t.readBoolean(),r=t.readBoolean(),a=1;return r&&i?a=0:r?a=3:i&&(a=2),{parallelismType:a}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}constructor(...e){super(...e),this.initVPS=null}}class nn{static probe(e,t){let i=nn.syncOffset(e);return i>0&&t.warn("MPEG2-TS detected but first sync word found @ offset ".concat(i)),-1!==i}static syncOffset(e){let t=e.length,i=Math.min(940,t-188)+1,r=0;for(;r<i;){let a=!1,n=-1,s=0;for(let o=r;o<t;o+=188)if(71===e[o]&&(t-o==188||71===e[o+188])){if(s++,-1===n&&0!==(n=o)&&(i=Math.min(n+18612,e.length-188)+1),a||(a=0===ns(e,o)),a&&s>1&&(0===n&&s>2||o+188>i))return n}else if(s)return -1;else break;r++}return -1}static createTrack(e,t){return{container:"video"===e||"audio"===e?"video/mp2t":void 0,type:e,id:ir[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:"audio"===e?t:void 0}}resetInitSegment(e,t,i,r){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=nn.createTrack("video"),this._videoTrack.duration=r,this._audioTrack=nn.createTrack("audio",r),this._id3Track=nn.createTrack("id3"),this._txtTrack=nn.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=i}resetTimeStamp(){}resetContiguity(){let{_audioTrack:e,_videoTrack:t,_id3Track:i}=this;e&&(e.pesData=null),t&&(t.pesData=null),i&&(i.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t){let i,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];r||(this.sampleAes=null);let n=this._videoTrack,s=this._audioTrack,o=this._id3Track,l=this._txtTrack,d=n.pid,u=n.pesData,h=s.pid,c=o.pid,m=s.pesData,f=o.pesData,p=null,g=this.pmtParsed,E=this._pmtId,y=e.length;if(this.remainderData&&(y=(e=iE(this.remainderData,e)).length,this.remainderData=null),y<188&&!a)return this.remainderData=e,{audioTrack:s,videoTrack:n,id3Track:o,textTrack:l};let b=Math.max(0,nn.syncOffset(e));(y-=(y-b)%188)<e.byteLength&&!a&&(this.remainderData=new Uint8Array(e.buffer,y,e.buffer.byteLength-y));let T=0;for(let t=b;t<y;t+=188)if(71===e[t]){let a,y=!!(64&e[t+1]),T=ns(e,t);if((48&e[t+3])>>4>1){if((a=t+5+e[t+4])===t+188)continue}else a=t+4;switch(T){case d:y&&(u&&(i=nd(u,this.logger))&&(this.readyVideoParser(n.segmentCodec),null!==this.videoParser&&this.videoParser.parsePES(n,l,i,!1)),u={data:[],size:0}),u&&(u.data.push(e.subarray(a,t+188)),u.size+=t+188-a);break;case h:if(y){if(m&&(i=nd(m,this.logger)))switch(s.segmentCodec){case"aac":this.parseAACPES(s,i);break;case"mp3":this.parseMPEGPES(s,i);break;case"ac3":this.parseAC3PES(s,i)}m={data:[],size:0}}m&&(m.data.push(e.subarray(a,t+188)),m.size+=t+188-a);break;case c:y&&(f&&(i=nd(f,this.logger))&&this.parseID3PES(o,i),f={data:[],size:0}),f&&(f.data.push(e.subarray(a,t+188)),f.size+=t+188-a);break;case 0:var _,A;y&&(a+=e[a]+1),E=this._pmtId=(31&(_=e)[(A=a)+10])<<8|_[A+11];break;case E:{y&&(a+=e[a]+1);let i=function(e,t,i,r,a,n){let s={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},o=(15&e[t+1])<<8|e[t+2],l=t+3+o-4,d=(15&e[t+10])<<8|e[t+11];for(t+=12+d;t<l;){let o=ns(e,t),l=(15&e[t+3])<<8|e[t+4];switch(e[t]){case 207:if(!r){nl("ADTS AAC",n);break}case 15:-1===s.audioPid&&(s.audioPid=o);break;case 21:-1===s.id3Pid&&(s.id3Pid=o);break;case 219:if(!r){nl("H.264",n);break}case 27:-1===s.videoPid&&(s.videoPid=o);break;case 3:case 4:i.mpeg||i.mp3?-1===s.audioPid&&(s.audioPid=o,s.segmentAudioCodec="mp3"):n.log("MPEG audio found, not supported in this browser");break;case 193:if(!r){nl("AC-3",n);break}case 129:i.ac3?-1===s.audioPid&&(s.audioPid=o,s.segmentAudioCodec="ac3"):n.log("AC-3 audio found, not supported in this browser");break;case 6:if(-1===s.audioPid&&l>0){let r=t+5,a=l;for(;a>2;){106===e[r]&&(!0!==i.ac3?n.log("AC-3 audio found, not supported in this browser for now"):(s.audioPid=o,s.segmentAudioCodec="ac3"));let t=e[r+1]+2;r+=t,a-=t}}break;case 194:case 135:return no(a,Error("Unsupported EC-3 in M2TS found"),void 0,n),s;case 36:-1===s.videoPid&&(s.videoPid=o,s.segmentVideoCodec="hevc",n.log("HEVC in M2TS found"))}t+=l+5}return s}(e,a,this.typeSupported,r,this.observer,this.logger);(d=i.videoPid)>0&&(n.pid=d,n.segmentCodec=i.segmentVideoCodec),(h=i.audioPid)>0&&(s.pid=h,s.segmentCodec=i.segmentAudioCodec),(c=i.id3Pid)>0&&(o.pid=c),null===p||g||(this.logger.warn("MPEG-TS PMT found at ".concat(t," after unknown PID '").concat(p,"'. Backtracking to sync byte @").concat(b," to parse all TS packets.")),p=null,t=b-188),g=this.pmtParsed=!0;break}case 17:case 8191:break;default:p=T}}else T++;T>0&&no(this.observer,Error("Found ".concat(T," TS packet/s that do not start with 0x47")),void 0,this.logger),n.pesData=u,s.pesData=m,o.pesData=f;let S={audioTrack:s,videoTrack:n,id3Track:o,textTrack:l};return a&&this.extractRemainingSamples(S),S}flush(){let e,{remainderData:t}=this;return(this.remainderData=null,e=t?this.demux(t,-1,!1,!0):{videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(e),this.sampleAes)?this.decrypt(e,this.sampleAes):e}extractRemainingSamples(e){let t,{audioTrack:i,videoTrack:r,id3Track:a,textTrack:n}=e,s=r.pesData,o=i.pesData,l=a.pesData;if(s&&(t=nd(s,this.logger))?(this.readyVideoParser(r.segmentCodec),null!==this.videoParser&&(this.videoParser.parsePES(r,n,t,!0),r.pesData=null)):r.pesData=s,o&&(t=nd(o,this.logger))){switch(i.segmentCodec){case"aac":this.parseAACPES(i,t);break;case"mp3":this.parseMPEGPES(i,t);break;case"ac3":this.parseAC3PES(i,t)}i.pesData=null}else null!=o&&o.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),i.pesData=o;l&&(t=nd(l,this.logger))?(this.parseID3PES(a,t),a.pesData=null):a.pesData=l}demuxSampleAes(e,t,i){let r=this.demux(e,i,!0,!this.config.progressive),a=this.sampleAes=new ne(this.observer,this.config,t);return this.decrypt(r,a)}readyVideoParser(e){null===this.videoParser&&("avc"===e?this.videoParser=new nr:"hevc"===e&&(this.videoParser=new na))}decrypt(e,t){return new Promise(i=>{let{audioTrack:r,videoTrack:a}=e;r.samples&&"aac"===r.segmentCodec?t.decryptAacSamples(r.samples,0,()=>{a.samples?t.decryptAvcSamples(a.samples,0,0,()=>{i(e)}):i(e)}):a.samples&&t.decryptAvcSamples(a.samples,0,0,()=>{i(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let i,r,a,n,s=0,o=this.aacOverFlow,l=t.data;if(o){this.aacOverFlow=null;let t=o.missing,i=o.sample.unit.byteLength;-1===t?l=iE(o.sample.unit,l):(o.sample.unit.set(l.subarray(0,t),i-t),e.samples.push(o.sample),s=o.missing)}for(i=s,r=l.length;i<r-1&&!aB(l,i);i++);if(i!==s){let e,t=i<r-1;if(e=t?"AAC PES did not start with ADTS header,offset:".concat(i):"No ADTS header found in AAC PES",no(this.observer,Error(e),t,this.logger),!t)return}if(aH(e,this.observer,l,i,this.audioCodec),void 0!==t.pts)a=t.pts;else{if(!o)return void this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");let t=9216e4/e.samplerate;a=o.sample.pts+t}let d=0;for(;i<r;){if(n=aG(e,l,i,a,d),i+=n.length,n.missing){this.aacOverFlow=n;break}for(d++;i<r-1&&!aB(l,i);i++);}}parseMPEGPES(e,t){let i=t.data,r=i.length,a=0,n=0,s=t.pts;if(void 0===s)return void this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");for(;n<r;)if(a4(i,n)){let t=a1(e,i,n,s,a);if(t)n+=t.length,a++;else break}else n++}parseAC3PES(e,t){{let i,r=t.data,a=t.pts;if(void 0===a)return void this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");let n=r.length,s=0,o=0;for(;o<n&&(i=a9(e,r,o,a,s++))>0;)o+=i}}parseID3PES(e,t){if(void 0===t.pts)return void this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");let i=tW({},t,{type:this._videoTrack?aY.emsg:aY.audioId3,duration:1/0});e.samples.push(i)}constructor(e,t,i,r){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=i,this.logger=r,this.videoParser=null}}function ns(e,t){return((31&e[t+1])<<8)+e[t+2]}function no(e,t,i,r){r.warn("parsing error: ".concat(t.message)),e.emit(tB.ERROR,tB.ERROR,{type:tU.MEDIA_ERROR,details:tF.FRAG_PARSING_ERROR,fatal:!1,levelRetry:i,error:t,reason:t.message})}function nl(e,t){t.log("".concat(e," with AES-128-CBC encryption found in unencrypted stream"))}function nd(e,t){let i,r,a,n,s,o=0,l=e.data;if(!e||0===e.size)return null;for(;l[0].length<19&&l.length>1;)l[0]=iE(l[0],l[1]),l.splice(1,1);if(1===((i=l[0])[0]<<16)+(i[1]<<8)+i[2]){if((r=(i[4]<<8)+i[5])&&r>e.size-6)return null;let d=i[7];192&d&&(n=(14&i[9])*0x20000000+(255&i[10])*4194304+(254&i[11])*16384+(255&i[12])*128+(254&i[13])/2,64&d?n-(s=(14&i[14])*0x20000000+(255&i[15])*4194304+(254&i[16])*16384+(255&i[17])*128+(254&i[18])/2)>54e5&&(t.warn("".concat(Math.round((n-s)/9e4),"s delta between PTS and DTS, align them")),n=s):s=n);let u=(a=i[8])+9;if(e.size<=u)return null;e.size-=u;let h=new Uint8Array(e.size);for(let e=0,t=l.length;e<t;e++){let t=(i=l[e]).byteLength;if(u)if(u>t){u-=t;continue}else i=i.subarray(u),t-=u,u=0;h.set(i,o),o+=t}return r&&(r-=a+3),{data:h,pts:n,dts:s,len:r}}return null}class nu{static getSilentFrame(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);else if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);else if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);else if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}}}class nh{static init(){let e;for(e in nh.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},nh.types)nh.types.hasOwnProperty(e)&&(nh.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);nh.HDLR_TYPES={video:new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),audio:new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0])};let t=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]);nh.STTS=nh.STSC=nh.STCO=new Uint8Array([0,0,0,0,0,0,0,0]),nh.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),nh.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),nh.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),nh.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);let i=new Uint8Array([105,115,111,109]),r=new Uint8Array([97,118,99,49]),a=new Uint8Array([0,0,0,1]);nh.FTYP=nh.box(nh.types.ftyp,i,a,i,r),nh.DINF=nh.box(nh.types.dinf,nh.box(nh.types.dref,t))}static box(e){for(var t=arguments.length,i=Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];let a=8,n=i.length,s=n;for(;n--;)a+=i[n].byteLength;let o=new Uint8Array(a);for(o[0]=a>>24&255,o[1]=a>>16&255,o[2]=a>>8&255,o[3]=255&a,o.set(e,4),n=0,a=8;n<s;n++)o.set(i[n],a),a+=i[n].byteLength;return o}static hdlr(e){return nh.box(nh.types.hdlr,nh.HDLR_TYPES[e])}static mdat(e){return nh.box(nh.types.mdat,e)}static mdhd(e,t){let i=Math.floor((t*=e)/0x100000000),r=Math.floor(t%0x100000000);return nh.box(nh.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,i>>24,i>>16&255,i>>8&255,255&i,r>>24,r>>16&255,r>>8&255,255&r,85,196,0,0]))}static mdia(e){return nh.box(nh.types.mdia,nh.mdhd(e.timescale||0,e.duration||0),nh.hdlr(e.type),nh.minf(e))}static mfhd(e){return nh.box(nh.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e]))}static minf(e){return"audio"===e.type?nh.box(nh.types.minf,nh.box(nh.types.smhd,nh.SMHD),nh.DINF,nh.stbl(e)):nh.box(nh.types.minf,nh.box(nh.types.vmhd,nh.VMHD),nh.DINF,nh.stbl(e))}static moof(e,t,i){return nh.box(nh.types.moof,nh.mfhd(e),nh.traf(i,t))}static moov(e){let t=e.length,i=[];for(;t--;)i[t]=nh.trak(e[t]);return nh.box.apply(null,[nh.types.moov,nh.mvhd(e[0].timescale||0,e[0].duration||0)].concat(i).concat(nh.mvex(e)))}static mvex(e){let t=e.length,i=[];for(;t--;)i[t]=nh.trex(e[t]);return nh.box.apply(null,[nh.types.mvex,...i])}static mvhd(e,t){let i=Math.floor((t*=e)/0x100000000),r=Math.floor(t%0x100000000),a=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,i>>24,i>>16&255,i>>8&255,255&i,r>>24,r>>16&255,r>>8&255,255&r,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return nh.box(nh.types.mvhd,a)}static sdtp(e){let t,i,r=e.samples||[],a=new Uint8Array(4+r.length);for(t=0;t<r.length;t++)i=r[t].flags,a[t+4]=i.dependsOn<<4|i.isDependedOn<<2|i.hasRedundancy;return nh.box(nh.types.sdtp,a)}static stbl(e){return nh.box(nh.types.stbl,nh.stsd(e),nh.box(nh.types.stts,nh.STTS),nh.box(nh.types.stsc,nh.STSC),nh.box(nh.types.stsz,nh.STSZ),nh.box(nh.types.stco,nh.STCO))}static avc1(e){let t,i,r,a=[],n=[];for(t=0;t<e.sps.length;t++)r=(i=e.sps[t]).byteLength,a.push(r>>>8&255),a.push(255&r),a=a.concat(Array.prototype.slice.call(i));for(t=0;t<e.pps.length;t++)r=(i=e.pps[t]).byteLength,n.push(r>>>8&255),n.push(255&r),n=n.concat(Array.prototype.slice.call(i));let s=nh.box(nh.types.avcC,new Uint8Array([1,a[3],a[4],a[5],255,224|e.sps.length].concat(a).concat([e.pps.length]).concat(n))),o=e.width,l=e.height,d=e.pixelRatio[0],u=e.pixelRatio[1];return nh.box(nh.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,o>>8&255,255&o,l>>8&255,255&l,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),s,nh.box(nh.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),nh.box(nh.types.pasp,new Uint8Array([d>>24,d>>16&255,d>>8&255,255&d,u>>24,u>>16&255,u>>8&255,255&u])))}static esds(e){return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...e.config,6,1,2])}static audioStsd(e){let t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,255&t,0,0])}static mp4a(e){return nh.box(nh.types.mp4a,nh.audioStsd(e),nh.box(nh.types.esds,nh.esds(e)))}static mp3(e){return nh.box(nh.types[".mp3"],nh.audioStsd(e))}static ac3(e){return nh.box(nh.types["ac-3"],nh.audioStsd(e),nh.box(nh.types.dac3,e.config))}static stsd(e){let{segmentCodec:t}=e;if("audio"===e.type){if("aac"===t)return nh.box(nh.types.stsd,nh.STSD,nh.mp4a(e));if("ac3"===t&&e.config)return nh.box(nh.types.stsd,nh.STSD,nh.ac3(e));if("mp3"===t&&"mp3"===e.codec)return nh.box(nh.types.stsd,nh.STSD,nh.mp3(e))}else if(e.pps&&e.sps){if("avc"===t)return nh.box(nh.types.stsd,nh.STSD,nh.avc1(e));if("hevc"===t&&e.vps)return nh.box(nh.types.stsd,nh.STSD,nh.hvc1(e))}else throw Error("video track missing pps or sps");throw Error("unsupported ".concat(e.type," segment codec (").concat(t,"/").concat(e.codec,")"))}static tkhd(e){let t=e.id,i=(e.duration||0)*(e.timescale||0),r=e.width||0,a=e.height||0,n=Math.floor(i/0x100000000),s=Math.floor(i%0x100000000);return nh.box(nh.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n,s>>24,s>>16&255,s>>8&255,255&s,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>8&255,255&r,0,0,a>>8&255,255&a,0,0]))}static traf(e,t){let i=nh.sdtp(e),r=e.id,a=Math.floor(t/0x100000000),n=Math.floor(t%0x100000000);return nh.box(nh.types.traf,nh.box(nh.types.tfhd,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r])),nh.box(nh.types.tfdt,new Uint8Array([1,0,0,0,a>>24,a>>16&255,a>>8&255,255&a,n>>24,n>>16&255,n>>8&255,255&n])),nh.trun(e,i.length+16+20+8+16+8+8),i)}static trak(e){return e.duration=e.duration||0xffffffff,nh.box(nh.types.trak,nh.tkhd(e),nh.mdia(e))}static trex(e){let t=e.id;return nh.box(nh.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){let i,r,a,n,s,o,l=e.samples||[],d=l.length,u=12+16*d,h=new Uint8Array(u);for(t+=8+u,h.set([+("video"===e.type),0,15,1,d>>>24&255,d>>>16&255,d>>>8&255,255&d,t>>>24&255,t>>>16&255,t>>>8&255,255&t],0),i=0;i<d;i++)a=(r=l[i]).duration,n=r.size,s=r.flags,o=r.cts,h.set([a>>>24&255,a>>>16&255,a>>>8&255,255&a,n>>>24&255,n>>>16&255,n>>>8&255,255&n,s.isLeading<<2|s.dependsOn,s.isDependedOn<<6|s.hasRedundancy<<4|s.paddingValue<<1|s.isNonSync,61440&s.degradPrio,15&s.degradPrio,o>>>24&255,o>>>16&255,o>>>8&255,255&o],12+16*i);return nh.box(nh.types.trun,h)}static initSegment(e){nh.types||nh.init();let t=nh.moov(e);return iE(nh.FTYP,t)}static hvc1(e){let t=e.params,i=[e.vps,e.sps,e.pps],r=new Uint8Array([1,t.general_profile_space<<6|32*!!t.general_tier_flag|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),3|t.temporal_id_nested<<2|t.num_temporal_layers<<3|64*!!t.frame_rate.fixed,i.length]),a=r.length;for(let e=0;e<i.length;e+=1){a+=3;for(let t=0;t<i[e].length;t+=1)a+=2+i[e][t].length}let n=new Uint8Array(a);n.set(r,0),a=r.length;let s=i.length-1;for(let e=0;e<i.length;e+=1){n.set(new Uint8Array([32+e|128*(e===s),0,i[e].length]),a),a+=3;for(let t=0;t<i[e].length;t+=1)n.set(new Uint8Array([i[e][t].length>>8,255&i[e][t].length]),a),a+=2,n.set(i[e][t],a),a+=i[e][t].length}let o=nh.box(nh.types.hvcC,n),l=e.width,d=e.height,u=e.pixelRatio[0],h=e.pixelRatio[1];return nh.box(nh.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,255&l,d>>8&255,255&d,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,nh.box(nh.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),nh.box(nh.types.pasp,new Uint8Array([u>>24,u>>16&255,u>>8&255,255&u,h>>24,h>>16&255,h>>8&255,255&h])))}}function nc(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=e*t*i;return r?Math.round(a):a}function nm(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return nc(e,1e3,11111111111111112e-21,t)}nh.types=void 0,nh.HDLR_TYPES=void 0,nh.STTS=void 0,nh.STSC=void 0,nh.STCO=void 0,nh.STSZ=void 0,nh.VMHD=void 0,nh.SMHD=void 0,nh.STSD=void 0,nh.FTYP=void 0,nh.DINF=void 0;let nf=null,np=null;function ng(e,t,i,r){return{duration:t,size:i,cts:r,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:e?2:1,isNonSync:+!e}}}class nv extends tj{destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){this.log("initPTS & initDTS reset"),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1,i=e[0].pts,r=e.reduce((e,r)=>{let a=r.pts,n=a-e;return(n<-0x100000000&&(t=!0,n=(a=nE(a,i))-e),n>0)?e:a},i);return t&&this.debug("PTS rollover detected"),r}remux(e,t,i,r,a,n,s,o){let l,d,u,h,c,m,f=a,p=a,g=e.pid>-1,E=t.pid>-1,y=t.samples.length,b=e.samples.length>0,T=s&&y>0||y>1;if((!g||b)&&(!E||T)||this.ISGenerated||s){let i;if(this.ISGenerated){var _,A,S,I;let e=this.videoTrackConfig;(e&&(t.width!==e.width||t.height!==e.height||(null==(_=t.pixelRatio)?void 0:_[0])!==(null==(A=e.pixelRatio)?void 0:A[0])||(null==(S=t.pixelRatio)?void 0:S[1])!==(null==(I=e.pixelRatio)?void 0:I[1]))||!e&&T||null===this.nextAudioTs&&b)&&this.resetInitSegment()}this.ISGenerated||(u=this.generateIS(e,t,a,n));let r=this.isVideoContiguous,s=-1;if(T&&(s=function(e){for(let t=0;t<e.length;t++)if(e[t].key)return t;return -1}(t.samples),!r&&this.config.forceKeyFrameOnDiscontinuity))if(m=!0,s>0){this.warn("Dropped ".concat(s," out of ").concat(y," video samples due to a missing keyframe"));let e=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(s),t.dropped+=s,p+=(t.samples[0].pts-e)/t.inputTimeScale,i=p}else -1===s&&(this.warn("No keyframe found out of ".concat(y," video samples")),m=!1);if(this.ISGenerated){if(b&&T){let i=this.getVideoStartPts(t.samples),r=(nE(e.samples[0].pts,i)-i)/t.inputTimeScale;f+=Math.max(0,r),p+=Math.max(0,-r)}if(b){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),u=this.generateIS(e,t,a,n)),d=this.remuxAudio(e,f,this.isAudioContiguous,n,E||T||o===tG.AUDIO?p:void 0),T){let i=d?d.endPTS-d.startPTS:0;t.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),u=this.generateIS(e,t,a,n)),l=this.remuxVideo(t,p,r,i)}}else T&&(l=this.remuxVideo(t,p,r,0));l&&(l.firstKeyFrame=s,l.independent=-1!==s,l.firstKeyFramePTS=i)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(i.samples.length&&(c=ny(i,a,this._initPTS,this._initDTS)),r.samples.length&&(h=nb(r,a,this._initPTS))),{audio:d,video:l,initSegment:u,independent:m,text:h,id3:c}}generateIS(e,t,i,r){let a,n,s,o=e.samples,l=t.samples,d=this.typeSupported,u={},h=this._initPTS,c=!h||r,m="audio/mp4",f=-1;if(c&&(a=n=1/0),e.config&&o.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":d.mpeg?(m="audio/mpeg",e.codec=""):d.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3"}u.audio={id:"audio",container:m,codec:e.codec,initSegment:"mp3"===e.segmentCodec&&d.mpeg?new Uint8Array(0):nh.initSegment([e]),metadata:{channelCount:e.channelCount}},c&&(f=e.id,s=e.inputTimeScale,h&&s===h.timescale?c=!1:a=n=o[0].pts-Math.round(s*i))}if(t.sps&&t.pps&&l.length){if(t.timescale=t.inputTimeScale,u.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:nh.initSegment([t]),metadata:{width:t.width,height:t.height}},c)if(f=t.id,s=t.inputTimeScale,h&&s===h.timescale)c=!1;else{let e=this.getVideoStartPts(l),t=Math.round(s*i);n=Math.min(n,nE(l[0].dts,e)-t),a=Math.min(a,e-t)}this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(u).length)return this.ISGenerated=!0,c?(h&&this.warn("Timestamps at playlist time: ".concat(r?"":"~").concat(i," ").concat(a/s," != initPTS: ").concat(h.baseTime/h.timescale," (").concat(h.baseTime,"/").concat(h.timescale,") trackId: ").concat(h.trackId)),this.log("Found initPTS at playlist time: ".concat(i," offset: ").concat(a/s," (").concat(a,"/").concat(s,") trackId: ").concat(f)),this._initPTS={baseTime:a,timescale:s,trackId:f},this._initDTS={baseTime:n,timescale:s,trackId:f}):a=s=void 0,{tracks:u,initPTS:a,timescale:s,trackId:f}}remuxVideo(e,t,i,r){let a,n,s,o=e.inputTimeScale,l=e.samples,d=[],u=l.length,h=this._initPTS,c=h.baseTime*o/h.timescale,m=this.nextVideoTs,f=8,p=this.videoSampleDuration,g=1/0,E=-1/0,y=!1;if(!i||null===m){let e=c+t*o,r=l[0].pts-nE(l[0].dts,l[0].pts);nf&&null!==m&&15e3>Math.abs(e-r-(m+c))?i=!0:m=e-r-c}let b=m+c;for(let e=0;e<u;e++){let t=l[e];t.pts=nE(t.pts,b),t.dts=nE(t.dts,b),t.dts<l[e>0?e-1:e].dts&&(y=!0)}y&&l.sort(function(e,t){let i=e.dts-t.dts,r=e.pts-t.pts;return i||r}),a=l[0].dts;let T=(n=l[l.length-1].dts)-a,_=T?Math.round(T/(u-1)):p||e.inputTimeScale/30;if(i){let i=a-b,r=i>_,n=i<-1;if((r||n)&&(r?this.warn("".concat((e.segmentCodec||"").toUpperCase(),": ").concat(nm(i,!0)," ms (").concat(i,"dts) hole between fragments detected at ").concat(t.toFixed(3))):this.warn("".concat((e.segmentCodec||"").toUpperCase(),": ").concat(nm(-i,!0)," ms (").concat(i,"dts) overlapping between fragments detected at ").concat(t.toFixed(3))),!n||b>=l[0].pts||nf)){a=b;let e=l[0].pts-i;if(r)l[0].dts=a,l[0].pts=e;else{let t=!0;for(let r=0;r<l.length&&(!(l[r].dts>e)||!t);r++){let e=l[r].pts;if(l[r].dts-=i,l[r].pts-=i,r<l.length-1){let i=l[r+1].pts;t=i<=l[r].pts==i<=e}}}this.log("Video: Initial PTS/DTS adjusted: ".concat(nm(e,!0),"/").concat(nm(a,!0),", delta: ").concat(nm(i,!0)," ms"))}}let A=0,S=0,I=a=Math.max(0,a);for(let e=0;e<u;e++){let t=l[e],i=t.units,r=i.length,a=0;for(let e=0;e<r;e++)a+=i[e].data.length;S+=a,A+=r,t.length=a,t.dts<I?(t.dts=I,I+=_/4|0||1):I=t.dts,g=Math.min(t.pts,g),E=Math.max(t.pts,E)}n=l[u-1].dts;let R=S+4*A+8;try{s=new Uint8Array(R)}catch(e){this.observer.emit(tB.ERROR,tB.ERROR,{type:tU.MUX_ERROR,details:tF.REMUX_ALLOC_ERROR,fatal:!1,error:e,bytes:R,reason:"fail allocating video mdat ".concat(R)});return}let k=new DataView(s.buffer);k.setUint32(0,R),s.set(nh.types.mdat,4);let L=!1,D=1/0,w=1/0,C=-1/0,M=-1/0;for(let e=0;e<u;e++){let t,i=l[e],a=i.units,n=0;for(let e=0,t=a.length;e<t;e++){let t=a[e],i=t.data,r=t.data.byteLength;k.setUint32(f,r),f+=4,s.set(i,f),f+=r,n+=4+r}if(e<u-1)p=l[e+1].dts-i.dts,t=l[e+1].pts-i.pts;else{let a=this.config,n=e>0?i.dts-l[e-1].dts:_;if(t=e>0?i.pts-l[e-1].pts:_,a.stretchShortVideoTrack&&null!==this.nextAudioTs){let e=Math.floor(a.maxBufferHole*o),t=(r?g+r*o:this.nextAudioTs+c)-i.pts;t>e?((p=t-n)<0?p=n:L=!0,this.log("It is approximately ".concat(t/90," ms to the next segment; using duration ").concat(p/90," ms for the last video frame."))):p=n}else p=n}let h=Math.round(i.pts-i.dts);D=Math.min(D,p),C=Math.max(C,p),w=Math.min(w,t),M=Math.max(M,t),d.push(ng(i.key,p,n,h))}if(d.length){if(nf){if(nf<70){let e=d[0].flags;e.dependsOn=2,e.isNonSync=0}}else if(np&&M-w<C-D&&_/C<.025&&0===d[0].cts){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let e=a;for(let t=0,i=d.length;t<i;t++){let r=e+d[t].duration,a=e+d[t].cts;if(t<i-1){let e=r+d[t+1].cts;d[t].duration=e-a}else d[t].duration=t?d[t-1].duration:_;d[t].cts=0,e=r}}}let O=n+(p=L||!p?_:p);this.nextVideoTs=m=O-c,this.videoSampleDuration=p,this.isVideoContiguous=!0;let P={data1:nh.moof(e.sequenceNumber++,a,tW(e,{samples:d})),data2:s,startPTS:(g-c)/o,endPTS:(E+p-c)/o,startDTS:(a-c)/o,endDTS:m/o,type:"video",hasAudio:!1,hasVideo:!0,nb:d.length,dropped:e.dropped};return e.samples=[],e.dropped=0,P}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return 1152;case"ac3":return 1536;default:return 1024}}remuxAudio(e,t,i,r,a){let n,s=e.inputTimeScale,o=e.samplerate?e.samplerate:s,l=s/o,d=this.getSamplesPerFrame(e),u=d*l,h=this._initPTS,c="mp3"===e.segmentCodec&&this.typeSupported.mpeg,m=[],f=void 0!==a,p=e.samples,g=8*!c,E=this.nextAudioTs||-1,y=h.baseTime*s/h.timescale,b=y+t*s;if(this.isAudioContiguous=i=i||p.length&&E>0&&(r&&9e3>Math.abs(b-(E+y))||Math.abs(nE(p[0].pts,b)-(E+y))<20*u),p.forEach(function(e){e.pts=nE(e.pts,b)}),!i||E<0){if(!(p=p.filter(e=>e.pts>=0)).length)return;E=0===a?0:r&&!f?Math.max(0,b-y):p[0].pts-y}if("aac"===e.segmentCodec){let t=this.config.maxAudioFramesDrift;for(let i=0,r=E+y;i<p.length;i++){let a=p[i],n=a.pts,o=n-r,l=Math.abs(1e3*o/s);if(o<=-t*u&&f)0===i&&(this.warn("Audio frame @ ".concat((n/s).toFixed(3),"s overlaps marker by ").concat(Math.round(1e3*o/s)," ms.")),this.nextAudioTs=E=n-y,r=n);else if(o>=t*u&&l<1e4&&f){let t=Math.round(o/u);for(r=n-t*u;r<0&&t&&u;)t--,r+=u;0===i&&(this.nextAudioTs=E=r-y),this.warn("Injecting ".concat(t," audio frames @ ").concat(((r-y)/s).toFixed(3),"s due to ").concat(Math.round(1e3*o/s)," ms gap."));for(let n=0;n<t;n++){let t=nu.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);t||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),t=a.unit.subarray()),p.splice(i,0,{unit:t,pts:r}),r+=u,i++}}a.pts=r,r+=u}}let T=null,_=null,A=0,S=p.length;for(;S--;)A+=p[S].unit.byteLength;for(let t=0,r=p.length;t<r;t++){let r=p[t],a=r.unit,s=r.pts;if(null!==_)m[t-1].duration=Math.round((s-_)/l);else{if(i&&"aac"===e.segmentCodec&&(s=E+y),T=s,!(A>0))return;A+=g;try{n=new Uint8Array(A)}catch(e){this.observer.emit(tB.ERROR,tB.ERROR,{type:tU.MUX_ERROR,details:tF.REMUX_ALLOC_ERROR,fatal:!1,error:e,bytes:A,reason:"fail allocating audio mdat ".concat(A)});return}c||(new DataView(n.buffer).setUint32(0,A),n.set(nh.types.mdat,4))}n.set(a,g);let o=a.byteLength;g+=o,m.push(ng(!0,d,o,0)),_=s}let I=m.length;if(!I)return;let R=m[m.length-1];E=_-y,this.nextAudioTs=E+l*R.duration;let k=c?new Uint8Array(0):nh.moof(e.sequenceNumber++,T/l,tW({},e,{samples:m}));e.samples=[];let L=(T-y)/s,D=E/s,w={data1:k,data2:n,startPTS:L,endPTS:D,startDTS:L,endDTS:D,type:"audio",hasAudio:!0,hasVideo:!1,nb:I};return this.isAudioContiguous=!0,w}constructor(e,t,i,r){if(super("mp4-remuxer",r),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=i,this.ISGenerated=!1,null===nf){let e=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);nf=e?parseInt(e[1]):0}if(null===np){let e=navigator.userAgent.match(/Safari\/(\d+)/i);np=e?parseInt(e[1]):0}}}function nE(e,t){let i;if(null===t)return e;for(i=t<e?-0x200000000:0x200000000;Math.abs(e-t)>0x100000000;)e+=i;return e}function ny(e,t,i,r){let a=e.samples.length;if(!a)return;let n=e.inputTimeScale;for(let s=0;s<a;s++){let a=e.samples[s];a.pts=nE(a.pts-i.baseTime*n/i.timescale,t*n)/n,a.dts=nE(a.dts-r.baseTime*n/r.timescale,t*n)/n}let s=e.samples;return e.samples=[],{samples:s}}function nb(e,t,i){let r=e.samples.length;if(!r)return;let a=e.inputTimeScale;for(let n=0;n<r;n++){let r=e.samples[n];r.pts=nE(r.pts-i.baseTime*a/i.timescale,t*a)/a}e.samples.sort((e,t)=>e.pts-t.pts);let n=e.samples;return e.samples=[],{samples:n}}function nT(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return(null==e?void 0:e.start)!==void 0?(e.start+(i?e.duration:0))/e.timescale:t}function n_(e,t,i){let r=e.codec;return r&&r.length>4?r:t===t9.AUDIO?"ec-3"===r||"ac-3"===r||"alac"===r?r:"fLaC"===r||"Opus"===r?iO(r,!1):(i.warn('Unhandled audio codec "'.concat(r,'" in mp4 MAP')),r||"mp4a"):(i.warn('Unhandled video codec "'.concat(r,'" in mp4 MAP')),r||"avc1")}try{t=self.performance.now.bind(self.performance)}catch(e){t=Date.now}let nA=[{demux:class{resetTimeStamp(){}resetInitSegment(e,t,i,r){let a=this.videoTrack=aj("video",1),n=this.audioTrack=aj("audio",1),s=this.txtTrack=aj("text",1);if(this.id3Track=aj("id3",1),this.timeOffset=0,!(null!=e&&e.byteLength))return;let o=ih(e);if(o.video){let{id:e,timescale:t,codec:i,supplemental:r}=o.video;a.id=e,a.timescale=s.timescale=t,a.codec=i,a.supplemental=r}if(o.audio){let{id:e,timescale:t,codec:i}=o.audio;n.id=e,n.timescale=t,n.codec=i}s.id=ir.text,a.sampleDuration=0,a.duration=n.duration=r}resetContiguity(){this.remainderData=null}static probe(e){let t=e.byteLength;for(let i=0;i<t;){let r=io(e,i);if(r>8&&109===e[i+4]&&111===e[i+5]&&111===e[i+6]&&102===e[i+7])return!0;i=r>1?i+r:t}return!1}demux(e,t){this.timeOffset=t;let i=e,r=this.videoTrack,a=this.txtTrack;if(this.config.progressive){this.remainderData&&(i=iE(this.remainderData,e));let t=function(e){let t={valid:null,remainder:null},i=iu(e,["moof"]);if(i.length<2)return t.remainder=e,t;let r=i[i.length-1];return t.valid=e.slice(0,r.byteOffset-8),t.remainder=e.slice(r.byteOffset-8),t}(i);this.remainderData=t.remainder,r.samples=t.valid||new Uint8Array}else r.samples=i;let n=this.extractID3Track(r,t);return a.samples=iy(t,r),{videoTrack:r,audioTrack:this.audioTrack,id3Track:n,textTrack:this.txtTrack}}flush(){let e=this.timeOffset,t=this.videoTrack,i=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;let r=this.extractID3Track(t,this.timeOffset);return i.samples=iy(e,t),{videoTrack:t,audioTrack:aj(),id3Track:r,textTrack:aj()}}extractID3Track(e,t){let i=this.id3Track;return e.samples.length&&iu(e.samples,["emsg"]).forEach(e=>{let r=function(e){let t=e[0],i="",r="",a=0,n=0,s=0,o=0,l=0,d=0;if(0===t){for(;"\0"!==ia(e.subarray(d,d+1));)i+=ia(e.subarray(d,d+1)),d+=1;for(i+=ia(e.subarray(d,d+1)),d+=1;"\0"!==ia(e.subarray(d,d+1));)r+=ia(e.subarray(d,d+1)),d+=1;r+=ia(e.subarray(d,d+1)),d+=1,a=io(e,12),n=io(e,16),o=io(e,20),l=io(e,24),d=28}else if(1===t){d+=4,a=io(e,d);let t=io(e,d+=4),n=io(e,d+=4);for(d+=4,tx(s=0x100000000*t+n)||(s=Number.MAX_SAFE_INTEGER,tJ.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),o=io(e,d),d+=4,l=io(e,d),d+=4;"\0"!==ia(e.subarray(d,d+1));)i+=ia(e.subarray(d,d+1)),d+=1;for(i+=ia(e.subarray(d,d+1)),d+=1;"\0"!==ia(e.subarray(d,d+1));)r+=ia(e.subarray(d,d+1)),d+=1;r+=ia(e.subarray(d,d+1)),d+=1}return{schemeIdUri:i,value:r,timeScale:a,presentationTime:s,presentationTimeDelta:n,eventDuration:o,id:l,payload:e.subarray(d,e.byteLength)}}(e);if(a6.test(r.schemeIdUri)){let e=a7(r,t),a=0xffffffff===r.eventDuration?1/0:r.eventDuration/r.timeScale;a<=.001&&(a=1/0);let n=r.payload;i.samples.push({data:n,len:n.byteLength,dts:e,pts:e,type:aY.emsg,duration:a})}else if(this.config.enableEmsgKLVMetadata&&r.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){let e=a7(r,t);i.samples.push({data:r.payload,len:r.payload.byteLength,dts:e,pts:e,type:aY.misbklv,duration:1/0})}}),i}demuxSampleAes(e,t,i){return Promise.reject(Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}},remux:class extends tj{destroy(){}resetTimeStamp(e){this.lastEndTime=null;let t=this.initPTS;t&&e&&t.baseTime===e.baseTime&&t.timescale===e.timescale||(this.initPTS=e)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,t,i,r){this.audioCodec=t,this.videoCodec=i,this.generateInitSegment(e,r),this.emitInitSegment=!0}generateInitSegment(e,t){let{audioCodec:i,videoCodec:r}=this;if(!(null!=e&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}let{audio:a,video:n}=this.initData=ih(e);if(t)!function(e,t){if(!e||!t)return;let i=t.keyId;i&&t.isCommonEncryption&&iu(e,["moov","trak"]).forEach(e=>{let t=iu(e,["mdia","minf","stbl","stsd"])[0].subarray(8),r=iu(t,["enca"]),a=r.length>0;a||(r=iu(t,["encv"])),r.forEach(e=>{iu(a?e.subarray(28):e.subarray(78),["sinf"]).forEach(e=>{let t=iv(e);if(t){let e=t.subarray(8,24);e.some(e=>0!==e)||(tJ.log("[eme] Patching keyId in 'enc".concat(a?"a":"v",">sinf>>tenc' box: ").concat(t2(e)," -> ").concat(t2(i))),t.set(i,8))}})})})}(e,t);else{let e=a||n;null!=e&&e.encrypted&&this.warn('Init segment with encrypted track with has no key ("'.concat(e.codec,'")!'))}a&&(i=n_(a,t9.AUDIO,this)),n&&(r=n_(n,t9.VIDEO,this));let s={};a&&n?s.audiovideo={container:"video/mp4",codec:i+","+r,supplemental:n.supplemental,encrypted:n.encrypted,initSegment:e,id:"main"}:a?s.audio={container:"audio/mp4",codec:i,encrypted:a.encrypted,initSegment:e,id:"audio"}:n?s.video={container:"video/mp4",codec:r,supplemental:n.supplemental,encrypted:n.encrypted,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=s}remux(e,t,i,r,a,n){var s,o;let{initPTS:l,lastEndTime:d}=this,u={audio:void 0,video:void 0,text:r,id3:i,initSegment:void 0};tP(d)||(d=this.lastEndTime=a||0);let h=t.samples;if(!h.length)return u;let c={initPTS:void 0,timescale:void 0,trackId:void 0},m=this.initData;if(null!=(s=m)&&s.length||(this.generateInitSegment(h),m=this.initData),!(null!=(o=m)&&o.length))return this.warn("Failed to generate initSegment."),u;this.emitInitSegment&&(c.tracks=this.initTracks,this.emitInitSegment=!1);let f=function(e,t,i){let r={},a=iu(e,["moof","traf"]);for(let e=0;e<a.length;e++){let n=a[e],s=iu(n,["tfhd"])[0],o=io(s,4),l=t[o];if(!l)continue;r[o]||(r[o]={start:NaN,duration:0,sampleCount:0,timescale:l.timescale,type:l.type});let d=r[o],u=iu(n,["tfdt"])[0];if(u){let e=u[0],t=io(u,4);1===e&&(0xffffffff===t?i.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(t*=0x100000000,t+=io(u,8))),tP(t)&&(!tP(d.start)||t<d.start)&&(d.start=t)}let h=l.default,c=io(s,0)|(null==h?void 0:h.flags),m=(null==h?void 0:h.duration)||0;8&c&&(m=2&c?io(s,12):io(s,8));let f=iu(n,["trun"]),p=d.start||0,g=0,E=m;for(let e=0;e<f.length;e++){let t=f[e],i=io(t,4),r=d.sampleCount;d.sampleCount+=i;let a=1&t[3],n=4&t[3],s=1&t[2],o=2&t[2],l=4&t[2],u=8&t[2],h=8,c=i;for(a&&(h+=4),n&&i&&(1&t[h+1]||void 0!==d.keyFrameIndex||(d.keyFrameIndex=r),h+=4,s?(E=io(t,h),h+=4):E=m,o&&(h+=4),u&&(h+=4),p+=E,g+=E,c--);c--;)s?(E=io(t,h),h+=4):E=m,o&&(h+=4),l&&(1&t[h+1]||void 0!==d.keyFrameIndex||(d.keyFrameIndex=d.sampleCount-(c+1),d.keyFrameStart=p),h+=4),u&&(h+=4),p+=E,g+=E;!g&&m&&(g+=m*i)}d.duration+=g}if(!Object.keys(r).some(e=>r[e].duration)){let t=1/0,i=0,a=iu(e,["sidx"]);for(let e=0;e<a.length;e++){let r=function(e){let t=[],i=e[0],r=8,a=io(e,8);r+=4;let n=0,s=0;0===i?(n=io(e,r),s=io(e,r+4),r+=8):(n=il(e,r),s=il(e,r+8),r+=16),r+=2;let o=e.length+s,l=is(e,r);r+=2;for(let i=0;i<l;i++){let i=r,n=io(e,i);i+=4;let s=0x7fffffff&n;if(1==(0x80000000&n)>>>31)return tJ.warn("SIDX has hierarchical references (not supported)"),null;let l=io(e,i);i+=4,t.push({referenceSize:s,subsegmentDuration:l,info:{duration:l/a,start:o,end:o+s-1}}),o+=s,i+=4,r=i}return{earliestPresentationTime:n,timescale:a,version:i,referencesCount:l,references:t}}(a[e]);if(null!=r&&r.references){t=Math.min(t,r.earliestPresentationTime/r.timescale);let e=r.references.reduce((e,t)=>e+t.info.duration||0,0);i=Math.max(i,e+r.earliestPresentationTime/r.timescale)}}i&&tP(i)&&Object.keys(r).forEach(e=>{r[e].duration||(r[e].duration=i*r[e].timescale-r[e].start)})}return r}(h,m,this),p=m.audio?f[m.audio.id]:null,g=m.video?f[m.video.id]:null,E=nT(g,1/0),y=nT(p,1/0),b=nT(g,0,!0),T=nT(p,0,!0),_=a,A=0,S=p&&(!g||!l&&y<E||l&&l.trackId===m.audio.id),I=S?p:g;if(I){let e=I.timescale,t=I.start-a*e,i=S?m.audio.id:m.video.id;_=I.start/e,A=S?T-y:b-E,(n||!l)&&(function(e,t,i,r){if(null===e)return!0;let a=Math.max(r,1);return Math.abs(t-e.baseTime/e.timescale-i)>a}(l,_,a,A)||e!==l.timescale)&&(l&&this.warn("Timestamps at playlist time: ".concat(n?"":"~").concat(a," ").concat(t/e," != initPTS: ").concat(l.baseTime/l.timescale," (").concat(l.baseTime,"/").concat(l.timescale,") trackId: ").concat(l.trackId)),this.log("Found initPTS at playlist time: ".concat(a," offset: ").concat(_-a," (").concat(t,"/").concat(e,") trackId: ").concat(i)),l=null,c.initPTS=t,c.timescale=e,c.trackId=i)}else this.warn("No audio or video samples found for initPTS at playlist time: ".concat(a));l?(c.initPTS=l.baseTime,c.timescale=l.timescale,c.trackId=l.trackId):(c.timescale&&void 0!==c.trackId&&void 0!==c.initPTS||(this.warn("Could not set initPTS"),c.initPTS=_,c.timescale=1,c.trackId=-1),this.initPTS=l={baseTime:c.initPTS,timescale:c.timescale,trackId:c.trackId});let R=_-l.baseTime/l.timescale,k=R+A;A>0?this.lastEndTime=k:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());let L=!!m.audio,D=!!m.video,w="";L&&(w+="audio"),D&&(w+="video");let C={data1:h,startPTS:R,startDTS:R,endPTS:k,endDTS:k,type:w,hasAudio:L,hasVideo:D,nb:1,dropped:0,encrypted:!!m.audio&&m.audio.encrypted||!!m.video&&m.video.encrypted};u.audio=L&&!D?C:void 0,u.video=D?C:void 0;let M=null==g?void 0:g.sampleCount;if(M){let e=g.keyFrameIndex,t=-1!==e;C.nb=M,C.dropped=0===e||this.isVideoContiguous?0:t?e:M,C.independent=t,C.firstKeyFrame=e,t&&g.keyFrameStart&&(C.firstKeyFramePTS=(g.keyFrameStart-l.baseTime)/l.timescale),this.isVideoContiguous||(u.independent=t),this.isVideoContiguous||(this.isVideoContiguous=t),C.dropped&&this.warn("fmp4 does not start with IDR: firstIDR ".concat(e,"/").concat(M," dropped: ").concat(C.dropped," start: ").concat(C.firstKeyFramePTS||"NA"))}return u.initSegment=c,u.id3=ny(i,a,l,l),r.samples.length&&(u.text=nb(r,a,l)),u}constructor(e,t,i,r){super("passthrough-remuxer",r),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}}},{demux:nn,remux:nv},{demux:class extends aQ{resetInitSegment(e,t,i,r){super.resetInitSegment(e,t,i,r),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;let i=ax(e,0),r=(null==i?void 0:i.length)||0;if(a5(e,r))return!1;for(let i=e.length;r<i;r++)if(function(e,t){if(aB(e,t)){let i=aU(e,t);if(t+i>=e.length)return!1;let r=aF(e,t);if(r<=i)return!1;let a=t+r;return a===e.length||aB(e,a)}return!1}(e,r))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return t+5<e.length&&aN(e,t)&&aF(e,t)<=e.length-t}appendFrame(e,t,i){aH(e,this.observer,t,i,e.manifestCodec);let r=aG(e,t,i,this.basePTS,this.frameIndex);if(r&&0===r.missing)return r}constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}},remux:nv},{demux:class extends aQ{resetInitSegment(e,t,i,r){super.resetInitSegment(e,t,i,r),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;let t=ax(e,0),i=(null==t?void 0:t.length)||0;if(t&&11===e[i]&&119===e[i+1]&&void 0!==aq(t)&&16>=a8(e,i))return!1;for(let t=e.length;i<t;i++)if(a5(e,i))return tJ.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return a3(e,t)&&4<=e.length-t}appendFrame(e,t,i){if(null!==this.basePTS)return a1(e,t,i,this.basePTS,this.frameIndex)}},remux:nv}];nA.splice(2,0,{demux:class extends aQ{resetInitSegment(e,t,i,r){super.resetInitSegment(e,t,i,r),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,i){let r=a9(e,t,i,this.basePTS,this.frameIndex);if(-1!==r)return{sample:e.samples[e.samples.length-1],length:r,missing:0}}static probe(e){if(!e)return!1;let t=ax(e,0);if(!t)return!1;let i=t.length;return!!(11===e[i]&&119===e[i+1]&&void 0!==aq(t)&&16>a8(e,i))}constructor(e){super(),this.observer=void 0,this.observer=e}},remux:nv});class nS{configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,i,r,a){var n,s;let o,l=r.transmuxing;l.executeStart=t();let d=new Uint8Array(e),{currentTransmuxState:u,transmuxConfig:h}=this;a&&(this.currentTransmuxState=a);let{contiguous:c,discontinuity:m,trackSwitch:f,accurateTimeOffset:p,timeOffset:g,initSegmentChange:E}=a||u,{audioCodec:y,videoCodec:b,defaultInitPts:T,duration:_,initSegmentData:A}=h,S=(n=d,s=i,o=null,n.byteLength>0&&(null==s?void 0:s.key)!=null&&null!==s.iv&&null!=s.method&&(o=s),o);if(S&&rB(S.method)){let e=this.getDecrypter(),i=rH(S.method);if(!e.isSync())return this.asyncResult=!0,this.decryptionPromise=e.webCryptoDecrypt(d,S.key.buffer,S.iv.buffer,i).then(e=>{let t=this.push(e,null,r);return this.decryptionPromise=null,t}),this.decryptionPromise;{let a=e.softwareDecrypt(d,S.key.buffer,S.iv.buffer,i);if(r.part>-1){let t=e.flush();a=t?t.buffer:t}if(!a)return l.executeEnd=t(),nI(r);d=new Uint8Array(a)}}let I=this.needsProbing(m,f);if(I){let e=this.configureTransmuxer(d);if(e)return this.logger.warn("[transmuxer] ".concat(e.message)),this.observer.emit(tB.ERROR,tB.ERROR,{type:tU.MEDIA_ERROR,details:tF.FRAG_PARSING_ERROR,fatal:!1,error:e,reason:e.message}),l.executeEnd=t(),nI(r)}(m||f||E||I)&&this.resetInitSegment(A,y,b,_,i),(m||E||I)&&this.resetInitialTimestamp(T),c||this.resetContiguity();let R=this.transmux(d,S,g,p,r);this.asyncResult=nR(R);let k=this.currentTransmuxState;return k.contiguous=!0,k.discontinuity=!1,k.trackSwitch=!1,l.executeEnd=t(),R}flush(e){let i=e.transmuxing;i.executeStart=t();let{decrypter:r,currentTransmuxState:a,decryptionPromise:n}=this;if(n)return this.asyncResult=!0,n.then(()=>this.flush(e));let s=[],{timeOffset:o}=a;if(r){let t=r.flush();t&&s.push(this.push(t.buffer,null,e))}let{demuxer:l,remuxer:d}=this;if(!l||!d){i.executeEnd=t();let r=[nI(e)];return this.asyncResult?Promise.resolve(r):r}let u=l.flush(o);return nR(u)?(this.asyncResult=!0,u.then(t=>(this.flushRemux(s,t,e),s))):(this.flushRemux(s,u,e),this.asyncResult)?Promise.resolve(s):s}flushRemux(e,i,r){let{audioTrack:a,videoTrack:n,id3Track:s,textTrack:o}=i,{accurateTimeOffset:l,timeOffset:d}=this.currentTransmuxState;this.logger.log("[transmuxer.ts]: Flushed ".concat(this.id," sn: ").concat(r.sn).concat(r.part>-1?" part: "+r.part:""," of ").concat(this.id===tG.MAIN?"level":"track"," ").concat(r.level));let u=this.remuxer.remux(a,n,s,o,d,l,!0,this.id);e.push({remuxResult:u,chunkMeta:r}),r.transmuxing.executeEnd=t()}resetInitialTimestamp(e){let{demuxer:t,remuxer:i}=this;t&&i&&(t.resetTimeStamp(e),i.resetTimeStamp(e))}resetContiguity(){let{demuxer:e,remuxer:t}=this;e&&t&&(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,i,r,a){let{demuxer:n,remuxer:s}=this;n&&s&&(n.resetInitSegment(e,t,i,r),s.resetInitSegment(e,t,i,a))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,i,r,a){return t&&"SAMPLE-AES"===t.method?this.transmuxSampleAes(e,t,i,r,a):this.transmuxUnencrypted(e,i,r,a)}transmuxUnencrypted(e,t,i,r){let{audioTrack:a,videoTrack:n,id3Track:s,textTrack:o}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(a,n,s,o,t,i,!1,this.id),chunkMeta:r}}transmuxSampleAes(e,t,i,r,a){return this.demuxer.demuxSampleAes(e,t,i).then(e=>({remuxResult:this.remuxer.remux(e.audioTrack,e.videoTrack,e.id3Track,e.textTrack,i,r,!1,this.id),chunkMeta:a}))}configureTransmuxer(e){let t,{config:i,observer:r,typeSupported:a}=this;for(let i=0,r=nA.length;i<r;i++){var n;if(null!=(n=nA[i].demux)&&n.probe(e,this.logger)){t=nA[i];break}}if(!t)return Error("Failed to find demuxer by probing fragment data");let s=this.demuxer,o=this.remuxer,l=t.remux,d=t.demux;o&&o instanceof l||(this.remuxer=new l(r,i,a,this.logger)),s&&s instanceof d||(this.demuxer=new d(r,i,a,this.logger),this.probe=d.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new ry(this.config)),e}constructor(e,t,i,r,a,n){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=i,this.id=a,this.logger=n}}let nI=e=>({remuxResult:{},chunkMeta:e});function nR(e){return"then"in e&&e.then instanceof Function}class nk{constructor(e,t,i,r,a){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=i,this.duration=r,this.defaultInitPts=a||null}}class nL{constructor(e,t,i,r,a,n){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=i,this.trackSwitch=r,this.timeOffset=a,this.initSegmentChange=n}}let nD=0;class nw{reset(){if(this.frag=null,this.part=null,this.workerContext){let e=this.instanceNo;this.instanceNo=nD++;let t=this.hls.config,i=iN(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:i,id:this.id,config:iX(t)})}}terminateWorker(){if(this.workerContext){let{worker:t}=this.workerContext;this.workerContext=null,t.removeEventListener("message",this.onWorkerMessage),t.removeEventListener("error",this.onWorkerError);var e=this.hls.config.workerPath;let i=aC[e||aw];if(i&&1==i.clientCount--){let{worker:t,objectURL:r}=i;delete aC[e||aw],r&&self.URL.revokeObjectURL(r),t.terminate()}}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{let e=this.transmuxer;e&&(e.destroy(),this.transmuxer=null)}let e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,i,r,a,n,s,o,l,d){var u,h;l.transmuxing.start=self.performance.now();let{instanceNo:c,transmuxer:m}=this,f=n?n.start:a.start,p=a.decryptdata,g=this.frag,E=!(g&&a.cc===g.cc),y=!(g&&l.level===g.level),b=g?l.sn-g.sn:-1,T=this.part?l.part-this.part.index:-1,_=0===b&&l.id>1&&l.id===(null==g?void 0:g.stats.chunkCount),A=!y&&(1===b||0===b&&(1===T||_&&T<=0)),S=self.performance.now();(y||b||0===a.stats.parsing.start)&&(a.stats.parsing.start=S),n&&(T||!A)&&(n.stats.parsing.start=S);let I=!(g&&(null==(u=a.initSegment)?void 0:u.url)===(null==(h=g.initSegment)?void 0:h.url)),R=new nL(E,A,o,y,f,I);if(!A||E||I){this.hls.logger.log("[transmuxer-interface]: Starting new transmux session for ".concat(a.type," sn: ").concat(l.sn).concat(l.part>-1?" part: "+l.part:""," ").concat(this.id===tG.MAIN?"level":"track",": ").concat(l.level," id: ").concat(l.id,"\n        discontinuity: ").concat(E,"\n        trackSwitch: ").concat(y,"\n        contiguous: ").concat(A,"\n        accurateTimeOffset: ").concat(o,"\n        timeOffset: ").concat(f,"\n        initSegmentChange: ").concat(I));let e=new nk(i,r,t,s,d);this.configureTransmuxer(e)}if(this.frag=a,this.part=n,this.workerContext)this.workerContext.worker.postMessage({instanceNo:c,cmd:"demux",data:e,decryptdata:p,chunkMeta:l,state:R},e instanceof ArrayBuffer?[e]:[]);else if(m){let t=m.push(e,p,l,R);nR(t)?t.then(e=>{this.handleTransmuxComplete(e)}).catch(e=>{this.transmuxerError(e,l,"transmuxer-interface push error")}):this.handleTransmuxComplete(t)}}flush(e){e.transmuxing.start=self.performance.now();let{instanceNo:t,transmuxer:i}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(i){let t=i.flush(e);nR(t)?t.then(t=>{this.handleFlushResult(t,e)}).catch(t=>{this.transmuxerError(t,e,"transmuxer-interface flush error")}):this.handleFlushResult(t,e)}}transmuxerError(e,t,i){this.hls&&(this.error=e,this.hls.trigger(tB.ERROR,{type:tU.MEDIA_ERROR,details:tF.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:i}))}handleFlushResult(e,t){e.forEach(e=>{this.handleTransmuxComplete(e)}),this.onFlush(t)}configureTransmuxer(e){let{instanceNo:t,transmuxer:i}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):i&&i.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}constructor(e,t,i,r){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=nD++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=e=>{let t=e.data,i=this.hls;if(i&&null!=t&&t.event&&t.instanceNo===this.instanceNo)switch(t.event){case"init":{var r;let e=null==(r=this.workerContext)?void 0:r.objectURL;e&&self.URL.revokeObjectURL(e);break}case"transmuxComplete":this.handleTransmuxComplete(t.data);break;case"flush":this.onFlush(t.data);break;case"workerLog":i.logger[t.data.logType]&&i.logger[t.data.logType](t.data.message);break;default:t.data=t.data||{},t.data.frag=this.frag,t.data.part=this.part,t.data.id=this.id,i.trigger(t.event,t.data)}},this.onWorkerError=e=>{if(!this.hls)return;let t=Error("".concat(e.message,"  (").concat(e.filename,":").concat(e.lineno,")"));this.hls.config.enableWorker=!1,this.hls.logger.warn('Error in "'.concat(this.id,'" Web Worker, fallback to inline')),this.hls.trigger(tB.ERROR,{type:tU.OTHER_ERROR,details:tF.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:t})};let a=e.config;this.hls=e,this.id=t,this.useWorker=!!a.enableWorker,this.onTransmuxComplete=i,this.onFlush=r;let n=(e,t)=>{(t=t||{}).frag=this.frag||void 0,e===tB.ERROR&&(t.parent=this.id,t.part=this.part,this.error=t.error),this.hls.trigger(e,t)};this.observer=new aD,this.observer.on(tB.FRAG_DECRYPTED,n),this.observer.on(tB.ERROR,n);let s=iN(a.preferManagedMediaSource);if(this.useWorker&&"undefined"!=typeof Worker){let i=this.hls.logger;if(a.workerPath||"function"==typeof __HLS_WORKER_BUNDLE__){try{a.workerPath?(i.log("loading Web Worker ".concat(a.workerPath,' for "').concat(t,'"')),this.workerContext=function(e){let t=aC[e];if(t)return t.clientCount++,t;let i=new self.URL(e,self.location.href).href,r={worker:new self.Worker(i),scriptURL:i,clientCount:1};return aC[e]=r,r}(a.workerPath)):(i.log('injecting Web Worker for "'.concat(t,'"')),this.workerContext=function(){let e=aC[aw];if(e)return e.clientCount++,e;let t=new self.Blob(["var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(".concat(__HLS_WORKER_BUNDLE__.toString(),")(true);")],{type:"text/javascript"}),i=self.URL.createObjectURL(t),r={worker:new self.Worker(i),objectURL:i,clientCount:1};return aC[aw]=r,r}());let{worker:e}=this.workerContext;e.addEventListener("message",this.onWorkerMessage),e.addEventListener("error",this.onWorkerError),e.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:s,id:t,config:iX(a)})}catch(r){i.warn('Error setting up "'.concat(t,'" Web Worker, fallback to inline'),r),this.terminateWorker(),this.error=null,this.transmuxer=new nS(this.observer,s,a,"",t,e.logger)}return}}this.transmuxer=new nS(this.observer,s,a,"",t,e.logger)}}class nC extends tj{destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){-1!==this.timer&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,i){let r=null==t?void 0:t.renditionReports;if(r){let a=-1;for(let i=0;i<r.length;i++){let n,s=r[i];try{n=new self.URL(s.URI,t.url).href}catch(e){this.warn("Could not construct new URL for Rendition Report: ".concat(e)),n=s.URI||""}if(n===e){a=i;break}n===e.substring(0,n.length)&&(a=i)}if(-1!==a){let e=r[a],n=parseInt(e["LAST-MSN"])||t.lastPartSn,s=parseInt(e["LAST-PART"])||t.lastPartIndex;if(this.hls.config.lowLatencyMode){let e=Math.min(t.age-t.partTarget,t.targetduration);s>=0&&e>t.partTarget&&(s+=1)}return new ij(n,s>=0?s:void 0,i&&iY(i))}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(e){this.warn("Could not construct new URL with HLS Delivery Directives: ".concat(e))}return e}playlistLoaded(e,t,i){let{details:r,stats:a}=t,n=self.performance.now(),s=a.loading.first?Math.max(0,n-a.loading.first):0;r.advancedDateTime=Date.now()-s;let o=this.hls.config.timelineOffset;if(o!==r.appliedTimelineOffset){let e=Math.max(o||0,0);r.appliedTimelineOffset=e,r.fragments.forEach(t=>{t.setStart(t.playlistOffset+e)})}if(r.live||null!=i&&i.live){let o,d,u,h="levelInfo"in t?t.levelInfo:t.track;if(r.reloaded(i),i&&r.fragments.length>0){!function(e,t,i){let r;if(e===t)return;let a=null,n=e.fragments;for(let e=n.length-1;e>=0;e--){let t=n[e].initSegment;if(t){a=t;break}}e.fragmentHint&&delete e.fragmentHint.endPTS,function(e,t,i){let r=t.skippedSegments,a=Math.max(e.startSN,t.startSN)-t.startSN,n=+!!e.fragmentHint+(r?t.endSN:Math.min(e.endSN,t.endSN))-t.startSN,s=t.startSN-e.startSN,o=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,l=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments;for(let h=a;h<=n;h++){let a=l[s+h],n=o[h];if(r&&!n&&a&&(n=t.fragments[h]=a),a&&n){var d,u;i(a,n,h,o);let r=a.relurl,s=n.relurl;if(r&&(d=r)!==(u=s)&&u&&ap(d)!==ap(u)){t.playlistParsingError=ao("media sequence mismatch ".concat(n.sn,":"),e,t,a,n);return}if(a.cc!==n.cc){t.playlistParsingError=ao("discontinuity sequence mismatch (".concat(a.cc,"!=").concat(n.cc,")"),e,t,a,n);return}}}}(e,t,(e,i,n,s)=>{if((!t.startCC||t.skippedSegments)&&i.cc!==e.cc){let r=e.cc-i.cc;for(let e=n;e<s.length;e++)s[e].cc+=r;t.endCC=s[s.length-1].cc}tP(e.startPTS)&&tP(e.endPTS)&&(i.setStart(i.startPTS=e.startPTS),i.startDTS=e.startDTS,i.maxStartPTS=e.maxStartPTS,i.endPTS=e.endPTS,i.endDTS=e.endDTS,i.minEndPTS=e.minEndPTS,i.setDuration(e.endPTS-e.startPTS),i.duration&&(r=i),t.PTSKnown=t.alignedSliding=!0),e.hasStreams&&(i.elementaryStreams=e.elementaryStreams),i.loader=e.loader,e.hasStats&&(i.stats=e.stats),e.initSegment&&(i.initSegment=e.initSegment,a=e.initSegment)});let s=t.fragments,o=t.fragmentHint?s.concat(t.fragmentHint):s;if(a&&o.forEach(e=>{var t;e&&(!e.initSegment||e.initSegment.relurl===(null==(t=a)?void 0:t.relurl))&&(e.initSegment=a)}),t.skippedSegments){if(t.deltaUpdateFailed=s.some(e=>!e),t.deltaUpdateFailed){i.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let e=t.skippedSegments;e--;)s.shift();t.startSN=s[0].sn}else{t.canSkipDateRanges&&(t.dateRanges=function(e,t,i){let{dateRanges:r,recentlyRemovedDateranges:a}=t,n=tW({},e);a&&a.forEach(e=>{delete n[e]});let s=Object.keys(n).length;return s?(Object.keys(r).forEach(e=>{let t=n[e],a=new rx(r[e].attr,t);a.isValid?(n[e]=a,t||(a.tagOrder+=s)):i.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'.concat(iX(r[e].attr),'"'))}),n):r}(e.dateRanges,t,i));let r=e.fragments.filter(e=>e.rawProgramDateTime);if(e.hasProgramDateTime&&!t.hasProgramDateTime)for(let e=1;e<o.length;e++)null===o[e].programDateTime&&ae(o[e],o[e-1],r);r5(r,t)}t.endCC=s[s.length-1].cc}if(!t.startCC){var l;let i=ah(e,t.startSN-1);t.startCC=null!=(l=null==i?void 0:i.cc)?l:s[0].cc}(function(e,t,i){if(e&&t){let r=0;for(let a=0,n=e.length;a<=n;a++){let n=e[a],s=t[a+r];n&&s&&n.index===s.index&&n.fragment.sn===s.fragment.sn?i(n,s):r--}}})(e.partList,t.partList,(e,t)=>{t.elementaryStreams=e.elementaryStreams,t.stats=e.stats}),r?as(t,r,r.startPTS,r.endPTS,r.startDTS,r.endDTS,i):al(e,t),s.length&&(t.totalduration=t.edge-s[0].start),t.driftStartTime=e.driftStartTime,t.driftStart=e.driftStart;let d=t.advancedDateTime;if(t.advanced&&d){let e=t.edge;t.driftStart||(t.driftStartTime=d,t.driftStart=e),t.driftEndTime=d,t.driftEnd=e}else t.driftEndTime=e.driftEndTime,t.driftEnd=e.driftEnd,t.advancedDateTime=e.advancedDateTime;-1===t.requestScheduled&&(t.requestScheduled=e.requestScheduled)}(i,r,this);let e=r.playlistParsingError;if(e){this.warn(e);let i=this.hls;if(!i.config.ignorePlaylistParsingErrors){var l;let{networkDetails:n}=t;i.trigger(tB.ERROR,{type:tU.NETWORK_ERROR,details:tF.LEVEL_PARSING_ERROR,fatal:!1,url:r.url,error:e,reason:e.message,level:t.level||void 0,parent:null==(l=r.fragments[0])?void 0:l.type,networkDetails:n,stats:a});return}r.playlistParsingError=null}}-1===r.requestScheduled&&(r.requestScheduled=a.loading.start);let c=this.hls.mainForwardBufferInfo,m=c?c.end-c.len:0,f=(r.edge-m)*1e3,p=au(r,f);if(r.requestScheduled+p<n?r.requestScheduled=n:r.requestScheduled+=p,this.log("live playlist ".concat(e," ").concat(r.advanced?"REFRESHED "+r.lastPartSn+"-"+r.lastPartIndex:r.updated?"UPDATED":"MISSED")),!this.canLoad||!r.live)return;if(r.canBlockReload&&r.endSN&&r.advanced){let e=this.hls.config.lowLatencyMode,a=r.lastPartSn,s=r.endSN,l=r.lastPartIndex,c=a===s;-1!==l?c?(d=s+1,u=e?0:l):(d=a,u=e?l+1:r.maxPartIndex):d=s+1;let m=r.age,f=m+r.ageHeader,p=Math.min(f-r.partTarget,1.5*r.targetduration);if(p>0){if(f>3*r.targetduration)this.log("Playlist last advanced ".concat(m.toFixed(2),"s ago. Omitting segment and part directives.")),d=void 0,u=void 0;else if(null!=i&&i.tuneInGoal&&f-r.partTarget>i.tuneInGoal)this.warn("CDN Tune-in goal increased from: ".concat(i.tuneInGoal," to: ").concat(p," with playlist age: ").concat(r.age)),p=0;else{let e=Math.floor(p/r.targetduration);d+=e,void 0!==u&&(u+=Math.round(p%r.targetduration/r.partTarget)),this.log("CDN Tune-in age: ".concat(r.ageHeader,"s last advanced ").concat(m.toFixed(2),"s goal: ").concat(p," skip sn ").concat(e," to part ").concat(u))}r.tuneInGoal=p}if(o=this.getDeliveryDirectives(r,t.deliveryDirectives,d,u),e||!c){r.requestScheduled=n,this.loadingPlaylist(h,o);return}}else(r.canBlockReload||r.canSkipUntil)&&(o=this.getDeliveryDirectives(r,t.deliveryDirectives,d,u));o&&void 0!==d&&r.canBlockReload&&(r.requestScheduled=a.loading.first+Math.max(p-2*s,p/2)),this.scheduleLoading(h,o,r)}else this.clearTimer()}scheduleLoading(e,t,i){let r=i||e.details;if(!r)return void this.loadingPlaylist(e,t);let a=self.performance.now(),n=r.requestScheduled;if(a>=n)return void this.loadingPlaylist(e,t);let s=n-a;this.log("reload live playlist ".concat(e.name||e.bitrate+"bps"," in ").concat(Math.round(s)," ms")),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),s)}getDeliveryDirectives(e,t,i,r){let a=iY(e);return null!=t&&t.skip&&e.deltaUpdateFailed&&(i=t.msn,r=t.part,a=iq.No),new ij(i,r,a)}checkRetry(e){let t=e.details,i=i7(e),r=e.errorAction,{action:a,retryCount:n=0,retryConfig:s}=r||{},o=!!r&&!!s&&(a===ro.RetryRequest||!r.resolved&&a===ro.SendAlternateToPenaltyBox);if(o){var l;if(n>=s.maxNumRetry)return!1;if(i&&null!=(l=e.context)&&l.deliveryDirectives)this.warn("Retrying playlist loading ".concat(n+1,"/").concat(s.maxNumRetry,' after "').concat(t,'" without delivery-directives')),this.loadPlaylist();else{let e=rr(s,n);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),e),this.warn("Retrying playlist loading ".concat(n+1,"/").concat(s.maxNumRetry,' after "').concat(t,'" in ').concat(e,"ms"))}e.levelRetry=!0,r.resolved=!0}return o}constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}}function nM(e,t){if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(!nO(e[i].attrs,t[i].attrs))return!1;return!0}function nO(e,t,i){let r=e["STABLE-RENDITION-ID"];return r&&!i?r===t["STABLE-RENDITION-ID"]:!(i||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(i=>e[i]!==t[i])}function nP(e,t){return t.label.toLowerCase()===e.name.toLowerCase()&&(!t.language||t.language.toLowerCase()===(e.lang||"").toLowerCase())}class nx{destroy(){this.tracks=this.queues=null}append(e,t,i){if(null===this.queues||null===this.tracks)return;let r=this.queues[t];r.push(e),1!==r.length||i||this.executeNext(t)}appendBlocker(e){return new Promise(t=>{this.append({label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}},e)})}prependBlocker(e){return new Promise(t=>{this.queues&&this.queues[e].unshift({label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}})})}removeBlockers(){null!==this.queues&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;let i=null==(t=e[0])?void 0:t.label;("async-blocker"===i||"async-blocker-prepend"===i)&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){null!==this.queues&&this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(null===this.queues||null===this.tracks)return;let t=this.queues[e];if(t.length){let r=t[0];try{r.execute()}catch(a){var i;if(r.onError(a),null===this.queues||null===this.tracks)return;let t=null==(i=this.tracks[e])?void 0:i.buffer;null!=t&&t.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){null!==this.queues&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return(null==(t=this.queues)?void 0:t[e][0])||null}toString(){let{queues:e,tracks:t}=this;return null===e||null===t?"<destroyed>":"\n".concat(this.list("video"),"\n").concat(this.list("audio"),"\n").concat(this.list("audiovideo"),"}")}list(e){var t,i;return null!=(t=this.queues)&&t[e]||null!=(i=this.tracks)&&i[e]?"".concat(e,": (").concat(this.listSbInfo(e),") ").concat(this.listOps(e)):""}listSbInfo(e){var t;let i=null==(t=this.tracks)?void 0:t[e],r=null==i?void 0:i.buffer;return r?"SourceBuffer".concat(r.updating?" updating":"").concat(i.ended?" ended":"").concat(i.ending?" ending":""):"none"}listOps(e){var t;return(null==(t=this.queues)?void 0:t[e].map(e=>e.label).join(", "))||""}constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}}let nN=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,nU="HlsJsTrackRemovedError";class nF extends Error{constructor(e){super(e),this.name=nU}}function nB(e){let t=e.querySelectorAll("source");[].slice.call(t).forEach(t=>{e.removeChild(t)})}function nH(e){return+("audio"===e)}class nG{setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){let{hls:e}=this;e.on(tB.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(tB.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(tB.MANIFEST_PARSED,this.onManifestParsed,this),e.on(tB.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(tB.BUFFER_CODECS,this.onBufferCodecs,this),e.on(tB.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){let{hls:e}=this;e.off(tB.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(tB.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(tB.MANIFEST_PARSED,this.onManifestParsed,this),e.off(tB.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(tB.BUFFER_CODECS,this.onBufferCodecs,this),e.off(tB.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){let i=this.hls.levels[t.droppedLevel];this.isLevelAllowed(i)&&this.restrictedLevels.push({bitrate:i.bitrate,height:i.height,width:i.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){let i=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,i.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&tP(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}let e=this.hls.levels;if(e.length){let t=this.hls,i=this.getMaxLevel(e.length-1);i!==this.autoLevelCapping&&t.logger.log("Setting autoLevelCapping to ".concat(i,": ").concat(e[i].height,"p@").concat(e[i].bitrate," for media ").concat(this.mediaWidth,"x").concat(this.mediaHeight)),t.autoLevelCapping=i,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){let t=this.hls.levels;if(!t.length)return -1;let i=t.filter((t,i)=>this.isLevelAllowed(t)&&i<=e);return this.clientRect=null,nG.getMaxLevelByMediaSize(i,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=1/0,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=1/0,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;let e=this.media,t={width:0,height:0};if(e){let i=e.getBoundingClientRect();t.width=i.width,t.height=i.height,t.width||t.height||(t.width=i.right-i.left||e.width||0,t.height=i.bottom-i.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch(e){}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(t=>e.bitrate===t.bitrate&&e.width===t.width&&e.height===t.height)}static getMaxLevelByMediaSize(e,t,i){if(!(null!=e&&e.length))return -1;let r=(e,t)=>!t||e.width!==t.width||e.height!==t.height,a=e.length-1,n=Math.max(t,i);for(let t=0;t<e.length;t+=1){let i=e[t];if((i.width>=n||i.height>=n)&&r(i,e[t+1])){a=t;break}}return a}constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=1/0,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}}let nK={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",TIMED_TEXT:"tt"},nV={HLS:"h"};class nW{constructor(e,t){Array.isArray(e)&&(e=e.map(e=>e instanceof nW?e:new nW(e))),this.value=e,this.params=t}}function nq(e,t,i){return Error("failed to ".concat("serialize",' "').concat(Array.isArray(e)?JSON.stringify(e):e instanceof Map?"Map{}":e instanceof Set?"Set{}":"object"==typeof e?JSON.stringify(e):String(e),'" as ').concat(t),{cause:i})}class nY{constructor(e){this.description=e}}let nj="Bare Item";function nQ(e){if(e<-0x38d7ea4c67fff||0x38d7ea4c67fff<e)throw nq(e,"Integer");return e.toString()}let nz=/[\x00-\x1f\x7f]+/;function nX(e){let t=e.description||e.toString().slice(7,-1);if(!1===/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(t))throw nq(t,"Token");return t}function nZ(e){switch(typeof e){case"number":if(!tP(e))throw nq(e,nj);if(Number.isInteger(e))return nQ(e);let t=function e(t,i){if(t<0)return-e(-t,i);let r=Math.pow(10,i);if(!(Math.abs(t*r%1-.5)<Number.EPSILON))return Math.round(t*r)/r;{let e=Math.floor(t*r);return(e%2==0?e:e+1)/r}}(e,3);if(Math.floor(Math.abs(t)).toString().length>12)throw nq(e,"Decimal");let i=t.toString();return i.includes(".")?i:"".concat(i,".0");case"string":if(nz.test(e))throw nq(e,"String");return'"'.concat(e.replace(/\\/g,"\\\\").replace(/"/g,'\\"'),'"');case"symbol":return nX(e);case"boolean":if("boolean"!=typeof e)throw nq(e,"Boolean");return e?"?1":"?0";case"object":if(e instanceof Date)return"@".concat(nQ(e.getTime()/1e3));if(e instanceof Uint8Array){if(!1===ArrayBuffer.isView(e))throw nq(e,"Byte Sequence");return":".concat(btoa(String.fromCharCode(...e)),":")}if(e instanceof nY)return nX(e);default:throw nq(e,nj)}}function nJ(e){if(!1===/^[a-z*][a-z0-9\-_.*]*$/.test(e))throw nq(e,"Key");return e}function n$(e){return null==e?"":Object.entries(e).map(e=>{let[t,i]=e;return!0===i?";".concat(nJ(t)):";".concat(nJ(t),"=").concat(nZ(i))}).join("")}function n0(e){return e instanceof nW?"".concat(nZ(e.value)).concat(n$(e.params)):nZ(e)}function n1(e,t){return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{whitespace:!0};if("object"!=typeof e||null==e)throw nq(e,"Dict");let i=e instanceof Map?e.entries():Object.entries(e),r=(null==t?void 0:t.whitespace)?" ":"";return Array.from(i).map(e=>{let[t,i]=e;i instanceof nW==!1&&(i=new nW(i));let r=nJ(t);if(!0===i.value)r+=n$(i.params);else if(r+="=",Array.isArray(i.value)){var a;r+=(a=i,"(".concat(a.value.map(n0).join(" "),")").concat(n$(a.params)))}else r+=n0(i);return r}).join(",".concat(r))}(e,t)}let n2="CMCD-Object",n3="CMCD-Request",n4="CMCD-Session",n5="CMCD-Status",n8={br:n2,ab:n2,d:n2,ot:n2,tb:n2,tpb:n2,lb:n2,tab:n2,lab:n2,url:n2,pb:n3,bl:n3,tbl:n3,dl:n3,ltc:n3,mtp:n3,nor:n3,nrr:n3,rc:n3,sn:n3,sta:n3,su:n3,ttfb:n3,ttfbb:n3,ttlb:n3,cmsdd:n3,cmsds:n3,smrt:n3,df:n3,cs:n3,ts:n3,cid:n4,pr:n4,sf:n4,sid:n4,st:n4,v:n4,msd:n4,bs:n5,bsd:n5,cdn:n5,rtp:n5,bg:n5,pt:n5,ec:n5,e:n5},n9={REQUEST:n3},n6="event",n7=e=>Math.round(e),se=(e,t)=>Array.isArray(e)?e.map(e=>se(e,t)):e instanceof nW&&"string"==typeof e.value?new nW(se(e.value,t),e.params):(t.baseUrl&&(e=function(e,t){let i=new URL(e),r=new URL(t);if(i.origin!==r.origin)return e;let a=i.pathname.split("/").slice(1),n=r.pathname.split("/").slice(1,-1);for(;a[0]===n[0];)a.shift(),n.shift();for(;n.length;)n.shift(),a.unshift("..");return a.join("/")+i.search+i.hash}(e,t.baseUrl)),1===t.version?encodeURIComponent(e):e),st=e=>100*n7(e/100),si={br:n7,d:n7,bl:st,dl:st,mtp:st,nor:(e,t)=>{let i=e;return t.version>=2&&(e instanceof nW&&"string"==typeof e.value?i=new nW([e]):"string"==typeof e&&(i=[e])),se(i,t)},rtp:st,tb:n7},sr="request",sa="response",sn=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],ss=["e"],so=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function sl(e){return so.test(e)}let sd=["d","dl","nor","ot","rtp","su"],su=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"],sh=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function sc(e){return sh.includes(e)||sl(e)}let sm={[sa]:function(e){return sn.includes(e)||sd.includes(e)||su.includes(e)||sl(e)},[n6]:function(e){return sn.includes(e)||ss.includes(e)||sl(e)},[sr]:function(e){return sn.includes(e)||sd.includes(e)||sl(e)}};function sf(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i={};if(null==e||"object"!=typeof e)return i;let r=t.version||e.v||1,a=t.reportingMode||sr,n=1===r?sc:sm[a],s=Object.keys(e).filter(n),o=t.filter;"function"==typeof o&&(s=s.filter(o));let l=a===sa||a===n6;l&&!s.includes("ts")&&s.push("ts"),r>1&&!s.includes("v")&&s.push("v");let d=tW({},si,t.formatters),u={version:r,reportingMode:a,baseUrl:t.baseUrl};return s.sort().forEach(t=>{var a;let n=e[t],s=d[t];if("function"==typeof s&&(n=s(n,u)),"v"===t)if(1===r)return;else n=r;("pr"!=t||1!==n)&&(l&&"ts"===t&&!tP(n)&&(n=Date.now()),("number"==typeof(a=n)?tP(a):null!=a&&""!==a&&!1!==a)&&(["ot","sf","st","e","sta"].includes(t)&&"string"==typeof n&&(n=new nY(n)),i[t]=n))}),i}let sp=/CMCD=[^&#]+/;function sg(e,t,i,r){e&&Object.keys(t).forEach(a=>{let n=e.filter(e=>e.groupId===a).map(e=>{let n=tW({},e);return n.details=void 0,n.attrs=new rP(n.attrs),n.url=n.attrs.URI=sv(e.url,e.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",i),n.groupId=n.attrs["GROUP-ID"]=t[a],n.attrs["PATHWAY-ID"]=r,n});e.push(...n)})}function sv(e,t,i,r){let a,{HOST:n,PARAMS:s,[i]:o}=r;t&&(a=null==o?void 0:o[t])&&(e=a);let l=new self.URL(e);return n&&!a&&(l.host=n),s&&Object.keys(s).sort().forEach(e=>{e&&l.searchParams.set(e,s[e])}),l.href}class sE extends tj{destroy(){this.onDestroying(),this.onMediaDetached();let e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(tB.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(tB.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(tB.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(tB.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(tB.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(tB.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(tB.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(tB.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(tB.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(tB.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){let{drmSystems:t,widevineLicenseUrl:i}=this.config,r=null==t?void 0:t[e];return r?r.licenseUrl:e===rq.WIDEVINE&&i?i:void 0}getLicenseServerUrlOrThrow(e){let t=this.getLicenseServerUrl(e);if(void 0===t)throw Error('no license server URL configured for key-system "'.concat(e,'"'));return t}getServerCertificateUrl(e){let{drmSystems:t}=this.config,i=null==t?void 0:t[e];if(i)return i.serverCertificateUrl;this.log('No Server Certificate in config.drmSystems["'.concat(e,'"]'))}attemptKeySystemAccess(e){let t=this.hls.levels,i=(e,t,i)=>!!e&&i.indexOf(e)===t,r=t.map(e=>e.audioCodec).filter(i),a=t.map(e=>e.videoCodec).filter(i);return r.length+a.length===0&&a.push("avc1.42e01e"),new Promise((t,i)=>{let n=e=>{let s=e.shift();this.getMediaKeysPromise(s,r,a).then(e=>t({keySystem:s,mediaKeys:e})).catch(t=>{e.length?n(e):t instanceof sb?i(t):i(new sb({type:tU.KEY_SYSTEM_ERROR,details:tF.KEY_SYSTEM_NO_ACCESS,error:t,fatal:!0},t.message))})};n(e)})}requestMediaKeySystemAccess(e,t){let{requestMediaKeySystemAccessFunc:i}=this.config;if("function"!=typeof i){let e="Configured requestMediaKeySystemAccess is not a function ".concat(i);return null===rX&&"http:"===self.location.protocol&&(e="navigator.requestMediaKeySystemAccess is not available over insecure protocol ".concat(location.protocol)),Promise.reject(Error(e))}return i(e,t)}getMediaKeysPromise(e,t,i){var r;let a=function(e,t,i,r){var a,n,s,o;let l;switch(e){case rq.FAIRPLAY:l=["cenc","sinf"];break;case rq.WIDEVINE:case rq.PLAYREADY:l=["cenc"];break;case rq.CLEARKEY:l=["cenc","keyids"];break;default:throw Error("Unknown key-system: ".concat(e))}return a=l,n=t,s=i,[{initDataTypes:a,persistentState:(o=r).persistentState||"optional",distinctiveIdentifier:o.distinctiveIdentifier||"optional",sessionTypes:o.sessionTypes||[o.sessionType||"temporary"],audioCapabilities:n.map(e=>({contentType:"audio/mp4; codecs=".concat(e),robustness:o.audioRobustness||"",encryptionScheme:o.audioEncryptionScheme||null})),videoCapabilities:s.map(e=>({contentType:"video/mp4; codecs=".concat(e),robustness:o.videoRobustness||"",encryptionScheme:o.videoEncryptionScheme||null}))}]}(e,t,i,this.config.drmSystemOptions||{}),n=this.keySystemAccessPromises[e],s=null==(r=n)?void 0:r.keySystemAccess;if(!s){this.log('Requesting encrypted media "'.concat(e,'" key-system access with config: ').concat(iX(a))),s=this.requestMediaKeySystemAccess(e,a);let t=n=this.keySystemAccessPromises[e]={keySystemAccess:s};return s.catch(t=>{this.log('Failed to obtain access to key-system "'.concat(e,'": ').concat(t))}),s.then(i=>{this.log('Access for key-system "'.concat(i.keySystem,'" obtained'));let r=this.fetchServerCertificate(e);this.log('Create media-keys for "'.concat(e,'"'));let a=t.mediaKeys=i.createMediaKeys().then(i=>(this.log('Media-keys created for "'.concat(e,'"')),t.hasMediaKeys=!0,r.then(t=>t?this.setMediaKeysServerCertificate(i,e,t):i)));return a.catch(t=>{this.error('Failed to create media-keys for "'.concat(e,'"}: ').concat(t))}),a})}return s.then(()=>n.mediaKeys)}createMediaKeySessionContext(e){let{decryptdata:t,keySystem:i,mediaKeys:r}=e;this.log('Creating key-system session "'.concat(i,'" keyId: ').concat(t2(t.keyId||[])," keyUri: ").concat(t.uri));let a=r.createSession(),n={decryptdata:t,keySystem:i,mediaKeys:r,mediaKeysSession:a,keyStatus:"status-pending"};return this.mediaKeySessions.push(n),n}renewKeySession(e){let t=e.decryptdata;if(t.pssh){let i=this.createMediaKeySessionContext(e),r=sy(t);this.keyIdToKeySessionPromise[r]=this.generateRequestWithPreferredKeySession(i,"cenc",t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}updateKeySession(e,t){let i=e.mediaKeysSession;return this.log('Updating key-session "'.concat(i.sessionId,'" for keyId ').concat(t2(e.decryptdata.keyId||[]),"\n      } (data length: ").concat(t.byteLength,")")),i.update(t)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(e=>{let{hasMediaKeys:t}=e;return!!t}).map(e=>{let{keySystem:t}=e;return rQ(t)}).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(e=>{let{keySystem:t,mediaKeys:i}=e;return this.attemptSetMediaKeys(t,i)})}selectKeySystem(e){return new Promise((t,i)=>{this.getKeySystemSelectionPromise(e).then(e=>{let{keySystem:r}=e,a=rQ(r);a?t(a):i(Error('Unable to find format for key-system "'.concat(r,'"')))}).catch(i)})}selectKeySystemFormat(e){let t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log("Selecting key-system from fragment (sn: ".concat(e.sn," ").concat(e.type,": ").concat(e.level,") key formats ").concat(t.join(", "))),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){let t=rz(this.config),i=e.map(rj).filter(e=>!!e&&-1!==t.indexOf(e));return this.selectKeySystem(i)}getKeyStatus(e){let{mediaKeySessions:t}=this;for(let a=0;a<t.length;a++){var i,r;let n=(i=e,r=t[a],i.keyId&&r.mediaKeysSession.keyStatuses.has(i.keyId)?r.mediaKeysSession.keyStatuses.get(i.keyId):i.matches(r.decryptdata)?r.keyStatus:void 0);if(n)return n}}loadKey(e){let t=e.keyInfo.decryptdata,i=sy(t),r=this.bannedKeyIds[i];if(r||"internal-error"===this.getKeyStatus(t)){let i=sT(r||"internal-error",t);return this.handleError(i,e.frag),Promise.reject(i)}let a="(keyId: ".concat(i,' format: "').concat(t.keyFormat,'" method: ').concat(t.method," uri: ").concat(t.uri,")");this.log("Starting session for key ".concat(a));let n=this.keyIdToKeySessionPromise[i];if(!n){let r=this.getKeySystemForKeyPromise(t).then(i=>{let{keySystem:r,mediaKeys:n}=i;return this.throwIfDestroyed(),this.log("Handle encrypted media sn: ".concat(e.frag.sn," ").concat(e.frag.type,": ").concat(e.frag.level," using key ").concat(a)),this.attemptSetMediaKeys(r,n).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:r,mediaKeys:n,decryptdata:t})))}).then(e=>{let i=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(e,"cenc",i,"playlist-key")});return r.catch(t=>this.handleError(t,e.frag)),this.keyIdToKeySessionPromise[i]=r,r}return n.catch(i=>{if(i instanceof sb){let r=tY({},i.data);"internal-error"===this.getKeyStatus(t)&&(r.decryptdata=t);let a=new sb(r,i.message);this.handleError(a,e.frag)}}),n}throwIfDestroyed(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0],!this.hls)throw Error("invalid state")}handleError(e,t){if(this.hls)if(e instanceof sb){t&&(e.data.frag=t);let i=e.data.decryptdata;this.error("".concat(e.message).concat(i?" (".concat(t2(i.keyId||[]),")"):"")),this.hls.trigger(tB.ERROR,e.data)}else this.error(e.message),this.hls.trigger(tB.ERROR,{type:tU.KEY_SYSTEM_ERROR,details:tF.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0})}getKeySystemForKeyPromise(e){let t=sy(e),i=this.keyIdToKeySessionPromise[t];if(!i){let t=rj(e.keyFormat),i=t?[t]:rz(this.config);return this.attemptKeySystemAccess(i)}return i}getKeySystemSelectionPromise(e){if(e.length||(e=rz(this.config)),0===e.length)throw new sb({type:tU.KEY_SYSTEM_ERROR,details:tF.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},"Missing key-system license configuration options ".concat(iX({drmSystems:this.config.drmSystems})));return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){if(this.mediaKeys===t)return Promise.resolve();let i=this.setMediaKeysQueue.slice();this.log('Setting media-keys for "'.concat(e,'"'));let r=Promise.all(i).then(()=>{if(!this.media)throw this.mediaKeys=null,Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(t)});return this.mediaKeys=t,this.setMediaKeysQueue.push(r),r.then(()=>{this.log('Media-keys set for "'.concat(e,'"')),i.push(r),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(e=>-1===i.indexOf(e))})}generateRequestWithPreferredKeySession(e,t,i,r){var a;let n=null==(a=this.config.drmSystems)||null==(a=a[e.keySystem])?void 0:a.generateRequest;if(n)try{let r=n.call(this.hls,t,i,e);if(!r)throw Error("Invalid response from configured generateRequest filter");t=r.initDataType,i=r.initData?r.initData:null,e.decryptdata.pssh=i?new Uint8Array(i):null}catch(e){if(this.warn(e.message),this.hls&&this.hls.config.debug)throw e}if(null===i)return this.log('Skipping key-session request for "'.concat(r,'" (no initData)')),Promise.resolve(e);let s=sy(e.decryptdata),o=e.decryptdata.uri;this.log('Generating key-session request for "'.concat(r,'" keyId: ').concat(s," URI: ").concat(o," (init data type: ").concat(t," length: ").concat(i.byteLength,")"));let l=new aD,d=e._onmessage=t=>{let i=e.mediaKeysSession;if(!i)return void l.emit("error",Error("invalid state"));let{messageType:r,message:a}=t;this.log('"'.concat(r,'" message event for session "').concat(i.sessionId,'" message size: ').concat(a.byteLength)),"license-request"===r||"license-renewal"===r?this.renewLicense(e,a).catch(e=>{l.eventNames().length?l.emit("error",e):this.handleError(e)}):"license-release"===r?e.keySystem===rq.FAIRPLAY&&this.updateKeySession(e,rK("acknowledged")).then(()=>this.removeSession(e)).catch(e=>this.handleError(e)):this.warn('unhandled media key message type "'.concat(r,'"'))},u=(e,t)=>{let i;t.keyStatus=e,e.startsWith("usable")?l.emit("resolved"):"internal-error"===e||"output-restricted"===e||"output-downscaled"===e?i=sT(e,t.decryptdata):"expired"===e?i=Error("key expired (keyId: ".concat(s,")")):"released"===e?i=Error("key released"):"status-pending"===e||this.warn('unhandled key status change "'.concat(e,'" (keyId: ').concat(s,")")),i&&(l.eventNames().length?l.emit("error",i):this.handleError(i))},h=e._onkeystatuseschange=t=>{if(!e.mediaKeysSession)return void l.emit("error",Error("invalid state"));let i=this.getKeyStatuses(e);if(!Object.keys(i).some(e=>"status-pending"!==i[e]))return;if("expired"===i[s]){this.log("Expired key ".concat(iX(i),' in key-session "').concat(e.mediaKeysSession.sessionId,'"')),this.renewKeySession(e);return}let r=i[s];if(r)u(r,e);else{var a;e.keyStatusTimeouts||(e.keyStatusTimeouts={}),(a=e.keyStatusTimeouts)[s]||(a[s]=self.setTimeout(()=>{if(!e.mediaKeysSession||!this.mediaKeys)return;let t=this.getKeyStatus(e.decryptdata);if(t&&"status-pending"!==t)return this.log("No status for keyId ".concat(s,' in key-session "').concat(e.mediaKeysSession.sessionId,'". Using session key-status ').concat(t," from other session.")),u(t,e);this.log("key status for ".concat(s,' in key-session "').concat(e.mediaKeysSession.sessionId,'" timed out after ').concat(0,"ms")),u(r="internal-error",e)},0)),this.log("No status for keyId ".concat(s," (").concat(iX(i),")."))}};aT(e.mediaKeysSession,"message",d),aT(e.mediaKeysSession,"keystatuseschange",h);let c=new Promise((e,t)=>{l.on("error",t),l.on("resolved",e)});return e.mediaKeysSession.generateRequest(t,i).then(()=>{this.log('Request generated for key-session "'.concat(e.mediaKeysSession.sessionId,'" keyId: ').concat(s," URI: ").concat(o))}).catch(t=>{throw new sb({type:tU.KEY_SYSTEM_ERROR,details:tF.KEY_SYSTEM_NO_SESSION,error:t,decryptdata:e.decryptdata,fatal:!1},"Error generating key-session request: ".concat(t))}).then(()=>c).catch(t=>(l.removeAllListeners(),this.removeSession(e).then(()=>{throw t}))).then(()=>(l.removeAllListeners(),e))}getKeyStatuses(e){let t={};return e.mediaKeysSession.keyStatuses.forEach((i,r)=>{if("string"==typeof r&&"object"==typeof i){let e=r;r=i,i=e}let a="buffer"in r?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):new Uint8Array(r);e.keySystem===rq.PLAYREADY&&16===a.length&&rV(a);let n=t2(a);"internal-error"===i&&(this.bannedKeyIds[n]=i),this.log('key status change "'.concat(i,'" for keyStatuses keyId: ').concat(n,' key-session "').concat(e.mediaKeysSession.sessionId,'"')),t[n]=i}),t}fetchServerCertificate(e){let t=this.config,i=new t.loader(t),r=this.getServerCertificateUrl(e);return r?(this.log('Fetching server certificate for "'.concat(e,'"')),new Promise((a,n)=>{let s={responseType:"arraybuffer",url:r},o=t.certLoadPolicy.default,l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0};i.load(s,l,{onSuccess:(e,t,i,r)=>{a(e.data)},onError:(t,i,a,o)=>{n(new sb({type:tU.KEY_SYSTEM_ERROR,details:tF.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:a,response:tY({url:s.url,data:void 0},t)},'"'.concat(e,'" certificate request failed (').concat(r,"). Status: ").concat(t.code," (").concat(t.text,")")))},onTimeout:(t,i,a)=>{n(new sb({type:tU.KEY_SYSTEM_ERROR,details:tF.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:a,response:{url:s.url,data:void 0}},'"'.concat(e,'" certificate request timed out (').concat(r,")")))},onAbort:(e,t,i)=>{n(Error("aborted"))}})})):Promise.resolve()}setMediaKeysServerCertificate(e,t,i){return new Promise((r,a)=>{e.setServerCertificate(i).then(a=>{this.log("setServerCertificate ".concat(a?"success":"not supported by CDM"," (").concat(i.byteLength,') on "').concat(t,'"')),r(e)}).catch(e=>{a(new sb({type:tU.KEY_SYSTEM_ERROR,details:tF.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:e,fatal:!0},e.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(t=>this.updateKeySession(e,new Uint8Array(t)).catch(t=>{throw new sb({type:tU.KEY_SYSTEM_ERROR,details:tF.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:e.decryptdata,error:t,fatal:!1},t.message)}))}unpackPlayReadyKeyMessage(e,t){let i=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!i.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;let r=new DOMParser().parseFromString(i,"application/xml"),a=r.querySelectorAll("HttpHeader");if(a.length>0){let t;for(let i=0,r=a.length;i<r;i++){var n,s;let r=null==(n=(t=a[i]).querySelector("name"))?void 0:n.textContent,o=null==(s=t.querySelector("value"))?void 0:s.textContent;r&&o&&e.setRequestHeader(r,o)}}let o=r.querySelector("Challenge"),l=null==o?void 0:o.textContent;if(!l)throw Error("Cannot find <Challenge> in key message");return rK(atob(l))}setupLicenseXHR(e,t,i,r){let a=this.config.licenseXhrSetup;return a?Promise.resolve().then(()=>{if(!i.decryptdata)throw Error("Key removed");return a.call(this.hls,e,t,i,r)}).catch(n=>{if(!i.decryptdata)throw n;return e.open("POST",t,!0),a.call(this.hls,e,t,i,r)}).then(i=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:i||r})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:r}))}requestLicense(e,t){let i=this.config.keyLoadPolicy.default;return new Promise((r,a)=>{let n=this.getLicenseServerUrlOrThrow(e.keySystem);this.log("Sending license request to URL: ".concat(n));let s=new XMLHttpRequest;s.responseType="arraybuffer",s.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return a(Error("invalid state"));if(4===s.readyState)if(200===s.status){this._requestLicenseFailureCount=0;let t=s.response;this.log("License received ".concat(t instanceof ArrayBuffer?t.byteLength:t));let i=this.config.licenseResponseCallback;if(i)try{t=i.call(this.hls,s,n,e)}catch(e){this.error(e)}r(t)}else{let o=i.errorRetry,l=o?o.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>l||s.status>=400&&s.status<500)a(new sb({type:tU.KEY_SYSTEM_ERROR,details:tF.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:e.decryptdata,fatal:!0,networkDetails:s,response:{url:n,data:void 0,code:s.status,text:s.statusText}},"License Request XHR failed (".concat(n,"). Status: ").concat(s.status," (").concat(s.statusText,")")));else{let i=l-this._requestLicenseFailureCount+1;this.warn("Retrying license request, ".concat(i," attempts left")),this.requestLicense(e,t).then(r,a)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=s,this.setupLicenseXHR(s,n,e,t).then(t=>{let{xhr:i,licenseChallenge:r}=t;e.keySystem==rq.PLAYREADY&&(r=this.unpackPlayReadyKeyMessage(i,r)),i.send(r)}).catch(a)})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,t){if(!this.config.emeEnabled)return;let i=t.media;this.media=i,aT(i,"encrypted",this.onMediaEncrypted),aT(i,"waitingforkey",this.onWaitingForKey)}onMediaDetached(){let e=this.media;e&&(a_(e,"encrypted",this.onMediaEncrypted),a_(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;if(this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={},!this.mediaKeys&&!this.mediaKeySessions.length)return;let t=this.media,i=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,rJ.clearKeyUriToKeyIdMap();let r=i.length;sE.CDMCleanupPromise=Promise.all(i.map(e=>this.removeSession(e)).concat((null==t||null==(e=t.setMediaKeys(null))?void 0:e.catch(e=>{this.log("Could not clear media keys: ".concat(e)),this.hls&&this.hls.trigger(tB.ERROR,{type:tU.OTHER_ERROR,details:tF.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:Error("Could not clear media keys: ".concat(e))})}))||Promise.resolve())).catch(e=>{this.log("Could not close sessions and clear media keys: ".concat(e)),this.hls&&this.hls.trigger(tB.ERROR,{type:tU.OTHER_ERROR,details:tF.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:Error("Could not close sessions and clear media keys: ".concat(e))})}).then(()=>{r&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this.keyFormatPromise=null,this.bannedKeyIds={}}onManifestLoaded(e,t){let{sessionKeys:i}=t;if(i&&this.config.emeEnabled&&!this.keyFormatPromise){let e=i.reduce((e,t)=>(-1===e.indexOf(t.keyFormat)&&e.push(t.keyFormat),e),[]);this.log("Selecting key-system from session-keys ".concat(e.join(", "))),this.keyFormatPromise=this.getKeyFormatPromise(e)}}removeSession(e){let{mediaKeysSession:t,licenseXhr:i,decryptdata:r}=e;if(t){var a;this.log('Remove licenses and keys and close session "'.concat(t.sessionId,'" keyId: ').concat(t2((null==r?void 0:r.keyId)||[]))),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),i&&i.readyState!==XMLHttpRequest.DONE&&i.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;let n=this.mediaKeySessions.indexOf(e);n>-1&&this.mediaKeySessions.splice(n,1);let{keyStatusTimeouts:s}=e;s&&Object.keys(s).forEach(e=>self.clearTimeout(s[e]));let{drmSystemOptions:o}=this.config;return(o&&("persistent-license"===o.sessionType||null!=(a=o.sessionTypes)&&a.some(e=>"persistent-license"===e))?new Promise((e,i)=>{self.setTimeout(()=>i(Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(e).catch(i)}):Promise.resolve()).catch(e=>{this.log("Could not remove session: ".concat(e)),this.hls&&this.hls.trigger(tB.ERROR,{type:tU.OTHER_ERROR,details:tF.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:Error("Could not remove session: ".concat(e))})}).then(()=>t.close()).catch(e=>{this.log("Could not close session: ".concat(e)),this.hls&&this.hls.trigger(tB.ERROR,{type:tU.OTHER_ERROR,details:tF.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:Error("Could not close session: ".concat(e))})})}return Promise.resolve()}constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=sE.CDMCleanupPromise?[sE.CDMCleanupPromise]:[],this.bannedKeyIds={},this.onMediaEncrypted=e=>{let{initDataType:t,initData:i}=e,r='"'.concat(e.type,'" event: init data type: "').concat(t,'"');if(this.debug(r),null!==i){if(!this.keyFormatPromise){let e=Object.keys(this.keySystemAccessPromises);e.length||(e=rz(this.config));let t=e.map(rQ).filter(e=>!!e);this.keyFormatPromise=this.getKeyFormatPromise(t)}this.keyFormatPromise.then(a=>{let n,s=rj(a);if("sinf"!==t||s!==rq.FAIRPLAY)return void this.log('Ignoring "'.concat(e.type,'" event with init data type: "').concat(t,'" for selected key-system ').concat(s));try{let e=ia(new Uint8Array(i)),t=rG(JSON.parse(e).sinf),r=iv(t);if(!r)throw Error("'schm' box missing or not cbcs/cenc with schi > tenc");n=new Uint8Array(r.subarray(8,24))}catch(e){this.warn("".concat(r," Failed to parse sinf: ").concat(e));return}let o=t2(n),{keyIdToKeySessionPromise:l,mediaKeySessions:d}=this,u=l[o];for(let e=0;e<d.length;e++){let r=d[e],a=r.decryptdata;if(!a.keyId)continue;let s=t2(a.keyId);if(rU(n,a.keyId)||-1!==a.uri.replace(/-/g,"").indexOf(o)){if(!(u=l[s]))continue;if(a.pssh)break;delete l[s],a.pssh=new Uint8Array(i),a.keyId=n,(u=l[o]=u.then(()=>this.generateRequestWithPreferredKeySession(r,t,i,"encrypted-event-key-match"))).catch(e=>this.handleError(e));break}}u||this.handleError(Error("Key ID ".concat(o," not encountered in playlist. Key-system sessions ").concat(d.length,".")))}).catch(e=>this.handleError(e))}},this.onWaitingForKey=e=>{this.log('"'.concat(e.type,'" event'))},this.hls=e,this.config=e.config,this.registerListeners()}}function sy(e){if(!e)throw Error("Could not read keyId of undefined decryptdata");if(null===e.keyId)throw Error("keyId is null");return t2(e.keyId)}sE.CDMCleanupPromise=void 0;class sb extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=Error(t)),this.data=e,e.err=e.error}}function sT(e,t){let i="output-restricted"===e,r=i?tF.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:tF.KEY_SYSTEM_STATUS_INTERNAL_ERROR;return new sb({type:tU.KEY_SYSTEM_ERROR,details:r,fatal:!1,decryptdata:t},i?"HDCP level output restricted":'key status changed to "'.concat(e,'"'))}function s_(e,t){let i;try{i=new Event("addtrack")}catch(e){(i=document.createEvent("Event")).initEvent("addtrack",!1,!1)}i.track=e,t.dispatchEvent(i)}function sA(e,t){let i=e.mode;if("disabled"===i&&(e.mode="hidden"),e.cues&&!e.cues.getCueById(t.id))try{if(e.addCue(t),!e.cues.getCueById(t.id))throw Error("addCue is failed for: ".concat(t))}catch(i){tJ.debug("[texttrack-utils]: ".concat(i));try{let i=new self.TextTrackCue(t.startTime,t.endTime,t.text);i.id=t.id,e.addCue(i)}catch(e){tJ.debug("[texttrack-utils]: Legacy TextTrackCue fallback failed: ".concat(e))}}"disabled"===i&&(e.mode=i)}function sS(e,t){let i=e.mode;if("disabled"===i&&(e.mode="hidden"),e.cues)for(let i=e.cues.length;i--;)t&&e.cues[i].removeEventListener("enter",t),e.removeCue(e.cues[i]);"disabled"===i&&(e.mode=i)}function sI(e,t,i,r){let a=e.mode;if("disabled"===a&&(e.mode="hidden"),e.cues&&e.cues.length>0){let a=function(e,t,i){let r=[],a=function(e,t){let i;if(t<=e[0].startTime)return 0;let r=e.length-1;if(t>e[r].endTime)return -1;let a=0,n=r;for(;a<=n;)if(t<e[i=Math.floor((n+a)/2)].startTime)n=i-1;else{if(!(t>e[i].startTime)||!(a<r))return i;a=i+1}return e[a].startTime-t<t-e[n].startTime?a:n}(e,t);if(a>-1)for(let n=a,s=e.length;n<s;n++){let a=e[n];if(a.startTime>=t&&a.endTime<=i)r.push(a);else if(a.startTime>i)break}return r}(e.cues,t,i);for(let t=0;t<a.length;t++)(!r||r(a[t]))&&e.removeCue(a[t])}"disabled"===a&&(e.mode=a)}function sR(e){let t=[];for(let i=0;i<e.length;i++){let r=e[i];("subtitles"===r.kind||"captions"===r.kind)&&r.label&&t.push(e[i])}return t}function sk(e){let t=5381,i=e.length;for(;i;)t=33*t^e.charCodeAt(--i);return(t>>>0).toString()}let sL=function(e){return e[e.Point=0]="Point",e[e.Range=1]="Range",e}({});class sD{setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,null==(e=this.assetListLoader)||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var t;if(e>0&&e>=this.assetList.length)return!0;let i=this.playoutLimit;return!(e<=0||isNaN(i))&&(0===i||((null==(t=this.assetList[e])?void 0:t.startOffset)||0)>i)}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){let e=this.dateRange.startTime;if(this.snapOptions.out){let t=this.dateRange.tagAnchor;if(t)return sw(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(0===this.startTime||this.snapOptions.out)return!0;let e=this.dateRange.tagAnchor;if(e){let t=this.dateRange.startTime,i=sw(t,e);return t-i<.1}return!1}get resumptionOffset(){let e=this.resumeOffset,t=tP(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){let e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){let t=this.resumeAnchor;if(t)return sw(e,t)}return e}get appendInPlace(){return!!this.appendInPlaceStarted||!this.appendInPlaceDisabled&&!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&.025>Math.abs(this.resumeOffset-this.duration)))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return null!==this._timelineStart?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){let e,t=this.playoutLimit;return e=null!==this._duration?this._duration:this.dateRange.duration?this.dateRange.duration:this.dateRange.plannedDuration||0,!isNaN(t)&&t<e&&(e=t),e}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return"RANGE"===this.dateRange.attr["X-TIMELINE-OCCUPIES"]?sL.Range:sL.Point}get supplementsPrimary(){return"PRIMARY"===this.dateRange.attr["X-TIMELINE-STYLE"]}get contentMayVary(){return"NO"!==this.dateRange.attr["X-CONTENT-MAY-VARY"]}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||null!==this.assetListResponse}toString(){var e;return e=this,'["'.concat(e.identifier,'" ').concat(e.cue.pre?"<pre>":e.cue.post?"<post>":"").concat(e.timelineStart.toFixed(2),"-").concat(e.resumeTime.toFixed(2),"]")}constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}}function sw(e,t){return e-t.start<t.duration/2&&!(.025>Math.abs(e-(t.start+t.duration)))?t.start:t.start+t.duration}function sC(e,t,i){let r=new self.URL(e,i);return"data:"!==r.protocol&&r.searchParams.set("_HLS_primary_id",t),r}function sM(e,t){for(;null!=(i=e.assetList[++t])&&i.error;)var i;return t}function sO(e){let t=e.timelineStart,i=e.duration||0;return'["'.concat(e.identifier,'" ').concat(t.toFixed(2),"-").concat((t+i).toFixed(2),"]")}class sP{get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){let e=this.hls;if(e)if(e.url)e.levels.length&&!e.started&&e.startLoad(-1,!0);else{let t=this.assetItem.uri;try{t=sC(t,e.config.primarySessionId||"").href}catch(e){}e.loadSource(t)}}bufferedInPlaceToEnd(e){var t;if(!this.appendInPlace)return!1;if(null!=(t=this.hls)&&t.bufferedToEnd)return!0;if(!e)return!1;let i=Math.min(this._bufferedEosTime||1/0,this.duration),r=this.timelineOffset,a=rL.bufferInfo(e,r,0);return this.getAssetTime(a.end)>=i-.02}reachedPlayout(e){let t=this.interstitial.playoutLimit;return this.startOffset+e>=t}get destroyed(){var e;return!(null!=(e=this.hls)&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return(null==(e=this.hls)?void 0:e.media)||null}get bufferedEnd(){let e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;let t=rL.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){let e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){let e=this.assetItem.duration;if(!e)return 0;let t=this.interstitial.playoutLimit;if(t){let i=t-this.startOffset;if(i>0&&i<e)return i}return e}get remaining(){let e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return(null==(e=this.hls)?void 0:e.config.timelineOffset)||0}set timelineOffset(e){let t=this.timelineOffset;if(e!==t&&Math.abs(e-t)>1/9e4&&this.hls){if(this.hasDetails)throw Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}getAssetTime(e){return Math.min(Math.max(0,e-this.timelineOffset),this.duration)}removeMediaListeners(){let e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;null!=(e=this.hls)&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){var t;this.loadSource(),null==(t=this.hls)||t.attachMedia(e)}detachMedia(){var e;this.removeMediaListeners(),this.mediaAttached=null,null==(e=this.hls)||e.detachMedia()}resumeBuffering(){var e;null==(e=this.hls)||e.resumeBuffering()}pauseBuffering(){var e;null==(e=this.hls)||e.pauseBuffering()}transferMedia(){var e;return this.bufferSnapShot(),(null==(e=this.hls)?void 0:e.transferMedia())||null}resetDetails(){let e=this.hls;if(e&&this.hasDetails){e.stopLoad();let t=e=>delete e.details;e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}on(e,t,i){var r;null==(r=this.hls)||r.on(e,t)}once(e,t,i){var r;null==(r=this.hls)||r.once(e,t)}off(e,t,i){var r;null==(r=this.hls)||r.off(e,t)}toString(){var e;return"HlsAssetPlayer: ".concat(sO(this.assetItem)," ").concat(null==(e=this.hls)?void 0:e.sessionId," ").concat(this.appendInPlace?"append-in-place":"")}constructor(e,t,i,r){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger(tB.PLAYOUT_LIMIT_REACHED,{})};let a=this.hls=new e(t);this.interstitial=i,this.assetItem=r;let n=()=>{this.hasDetails=!0};a.once(tB.LEVEL_LOADED,n),a.once(tB.AUDIO_TRACK_LOADED,n),a.once(tB.SUBTITLE_TRACK_LOADED,n),a.on(tB.MEDIA_ATTACHING,(e,t)=>{let{media:i}=t;this.removeMediaListeners(),this.mediaAttached=i,this.interstitial.playoutLimit&&(i.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&a.on(tB.BUFFER_APPENDED,()=>{let e=this.bufferedEnd;this.reachedPlayout(e)&&(this._bufferedEosTime=e,a.trigger(tB.BUFFERED_TO_END,void 0))}))})}}class sx extends tj{destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((i,r)=>e<=r.startOffset&&t>r.startOffset?(delete r.error,i+1):i,0):0}get duration(){let e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let i=-1;e.nextEvent?i=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(i=this.findEventIndex(e.previousEvent.identifier)+1);let r=this.items;if(r)for(r[i]||(void 0===t&&(t=e.start),i=this.findItemIndexAtTime(t));i>=0&&null!=(a=r[i])&&a.event;){var a;i--}return i}findItemIndexAtTime(e,t){let i=this.items;if(i)for(let r=0;r<i.length;r++){let a=i[r];if(t&&"primary"!==t&&(a=a[t]),e===a.start||e>a.start&&e<a.end)return r}return -1}findJumpRestrictedIndex(e,t){let i=this.items;if(i)for(let r=e;r<=t&&i[r];r++){let e=i[r].event;if(null!=e&&e.restrictions.jump&&!e.appendInPlace)return r}return -1}findEventIndex(e){let t=this.items;if(t)for(let r=t.length;r--;){var i;if((null==(i=t[r].event)?void 0:i.identifier)===e)return r}return -1}findAssetIndex(e,t){let i=e.assetList,r=i.length;if(r>1)for(let e=0;e<r;e++){let a=i[e];if(!a.error){let i=a.timelineStart;if(t===i||t>i&&(t<i+(a.duration||0)||e===r-1))return e}}return 0}get assetIdAtEnd(){var e;let t=null==(e=this.items)||null==(e=e[this.length-1])?void 0:e.event;if(t){let e=t.assetList,i=e[e.length-1];if(i)return i.identifier}return null}parseInterstitialDateRanges(e,t){let i=e.main.details,{dateRanges:r}=i,a=this.events,n=this.parseDateRanges(r,{url:i.url},t),s=Object.keys(r),o=a?a.filter(e=>!s.includes(e.identifier)):[];n.length&&n.sort((e,t)=>{let i=e.cue.pre,r=e.cue.post,a=t.cue.pre,n=t.cue.post;if(i&&!a)return -1;if(a&&!i||r&&!n)return 1;if(n&&!r)return -1;if(!i&&!a&&!r&&!n){let i=e.startTime,r=t.startTime;if(i!==r)return i-r}return e.dateRange.tagOrder-t.dateRange.tagOrder}),this.events=n,o.forEach(e=>{this.removeEvent(e)}),this.updateSchedule(e,o)}updateSchedule(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=this.events||[];if(r.length||t.length||this.length<2){let a=this.items,n=this.parseSchedule(r,e);(i||t.length||(null==a?void 0:a.length)!==n.length||n.some((e,t)=>Math.abs(e.playout.start-a[t].playout.start)>.005||Math.abs(e.playout.end-a[t].playout.end)>.005))&&(this.items=n,this.onScheduleUpdate(t,a))}}parseDateRanges(e,t,i){let r=[],a=Object.keys(e);for(let n=0;n<a.length;n++){let s=a[n],o=e[s];if(o.isInterstitial){let e=this.eventMap[s];e?e.setDateRange(o):(e=new sD(o,t),this.eventMap[s]=e,!1===i&&(e.appendInPlace=i)),r.push(e)}}return r}parseSchedule(e,t){let i=[],r=t.main.details,a=r.live?1/0:r.edge,n=0;if((e=e.filter(e=>!e.error&&!(e.cue.once&&e.hasPlayed))).length){this.resolveOffsets(e,t);let r=0,o=0;if(e.forEach((t,s)=>{let l=t.cue.pre,d=t.cue.post,u=e[s-1]||null,h=t.appendInPlace,c=d?a:t.startOffset,m=t.duration,f=t.timelineOccupancy===sL.Range?m:0,p=t.resumptionOffset,g=(null==u?void 0:u.startTime)===c,E=c+t.cumulativeDuration,y=h?E+m:c+p;if(l||!d&&c<=0){let e=o;o+=f,t.timelineStart=E;let r=n;n+=m,i.push({event:t,start:E,end:y,playout:{start:r,end:n},integrated:{start:e,end:o}})}else{if(!(c<=a))return;if(!g){let a=c-r;if(a>.033){let l=r,d=o;o+=a;let u=n;n+=a;let h={previousEvent:e[s-1]||null,nextEvent:t,start:l,end:l+a,playout:{start:u,end:n},integrated:{start:d,end:o}};i.push(h)}else a>0&&u&&(u.cumulativeDuration+=a,i[i.length-1].end=c)}d&&(y=E),t.timelineStart=E;let l=o;o+=f;let h=n;n+=m,i.push({event:t,start:E,end:y,playout:{start:h,end:n},integrated:{start:l,end:o}})}let b=t.resumeTime;r=d||b>a?a:b}),r<a){var s;let e=r,t=o,l=a-r;o+=l;let d=n;n+=l,i.push({previousEvent:(null==(s=i[i.length-1])?void 0:s.event)||null,nextEvent:null,start:r,end:e+l,playout:{start:d,end:n},integrated:{start:t,end:o}})}this.setDurations(a,n,o)}else i.push({previousEvent:null,nextEvent:null,start:0,end:a,playout:{start:0,end:a},integrated:{start:0,end:a}}),this.setDurations(a,a,a);return i}setDurations(e,t,i){this.durations={primary:e,playout:t,integrated:i}}resolveOffsets(e,t){let i=t.main.details,r=i.live?1/0:i.edge,a=0,n=-1;e.forEach((s,o)=>{let l=s.cue.pre,d=s.cue.post,u=l?0:d?r:s.startTime;this.updateAssetDurations(s),n===u?s.cumulativeDuration=a:(a=0,n=u),!d&&s.snapOptions.in&&(s.resumeAnchor=i8(null,i.fragments,s.startOffset+s.resumptionOffset,0,0)||void 0),s.appendInPlace&&!s.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(s,t)||(s.appendInPlace=!1)),!s.appendInPlace&&o+1<e.length&&e[o+1].startTime-e[o].resumeTime<.033&&(e[o+1].appendInPlace=!1,e[o+1].appendInPlace&&this.warn("Could not change append strategy for abutting event ".concat(s)));let h=tP(s.resumeOffset)?s.resumeOffset:s.duration;a+=h})}primaryCanResumeInPlaceAt(e,t){let i=e.resumeTime,r=e.startTime+e.resumptionOffset;return Math.abs(i-r)>.025?(this.log('"'.concat(e.identifier,'" resumption ').concat(i," not aligned with estimated timeline end ").concat(r)),!1):!Object.keys(t).some(r=>{let a=t[r].details,n=a.edge;if(i>=n)return this.log('"'.concat(e.identifier,'" resumption ').concat(i," past ").concat(r," playlist end ").concat(n)),!1;let s=i8(null,a.fragments,i);if(!s)return this.log('"'.concat(e.identifier,'" resumption ').concat(i," does not align with any fragments in ").concat(r," playlist (").concat(a.fragStart,"-").concat(a.fragmentEnd,")")),!0;let o=.175*("audio"===r);return!(Math.abs(s.start-i)<.025+o||Math.abs(s.end-i)<.025+o)&&(this.log('"'.concat(e.identifier,'" resumption ').concat(i," not aligned with ").concat(r," fragment bounds (").concat(s.start,"-").concat(s.end," sn: ").concat(s.sn," cc: ").concat(s.cc,")")),!0)})}updateAssetDurations(e){if(!e.assetListLoaded)return;let t=e.timelineStart,i=0,r=!1,a=!1;for(let n=0;n<e.assetList.length;n++){let s=e.assetList[n],o=t+i;s.startOffset=i,s.timelineStart=o,r||(r=null===s.duration),a||(a=!!s.error),i+=s.error?0:s.duration||0}r&&!a?e.duration=Math.max(i,e.duration):e.duration=i}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}}function sN(e){return"[".concat(e.event?'"'+e.event.identifier+'"':"primary",": ").concat(e.start.toFixed(2),"-").concat(e.end.toFixed(2),"]")}class sU{destroy(){this.hls=null}loadAssetList(e,t){let i,r=e.assetListUrl;try{i=sC(r,this.hls.sessionId,e.baseUrl)}catch(i){let t=this.assignAssetListError(e,tF.ASSET_LIST_LOAD_ERROR,i,r);this.hls.trigger(tB.ERROR,t);return}t&&"data:"!==i.protocol&&i.searchParams.set("_HLS_start_offset",""+t);let a=this.hls.config,n=new a.loader(a),s={responseType:"json",url:i.href},o=a.interstitialAssetListLoadPolicy.default,l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0};return n.load(s,l,{onSuccess:(t,i,r,a)=>{let n=t.data;if(!Array.isArray(null==n?void 0:n.ASSETS)){let t=this.assignAssetListError(e,tF.ASSET_LIST_PARSING_ERROR,Error("Invalid interstitial asset list"),r.url,i,a);this.hls.trigger(tB.ERROR,t);return}e.assetListResponse=n,this.hls.trigger(tB.ASSET_LIST_LOADED,{event:e,assetListResponse:n,networkDetails:a})},onError:(t,i,r,a)=>{let n=this.assignAssetListError(e,tF.ASSET_LIST_LOAD_ERROR,Error("Error loading X-ASSET-LIST: HTTP status ".concat(t.code," ").concat(t.text," (").concat(i.url,")")),i.url,a,r);this.hls.trigger(tB.ERROR,n)},onTimeout:(t,i,r)=>{let a=this.assignAssetListError(e,tF.ASSET_LIST_LOAD_TIMEOUT,Error("Timeout loading X-ASSET-LIST (".concat(i.url,")")),i.url,t,r);this.hls.trigger(tB.ERROR,a)}}),this.hls.trigger(tB.ASSET_LIST_LOADING,{event:e}),n}assignAssetListError(e,t,i,r,a,n){return e.error=i,{type:tU.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:r,error:i,networkDetails:n,stats:a}}constructor(e){this.hls=void 0,this.hls=e}}function sF(e){null==e||e.play().catch(()=>{})}function sB(e,t){return"[".concat(e,"] Advancing timeline position to ").concat(t)}class sH{constructor(e){this.buffered=void 0;let t=(t,i,r)=>{if((i>>>=0)>r-1)throw new DOMException("Failed to execute '".concat(t,"' on 'TimeRanges': The index provided (").concat(i,") is greater than the maximum bound (").concat(r,")"));return e[i][t]};this.buffered={get length(){return e.length},end:i=>t("end",i,e.length),start:i=>t("start",i,e.length)}}}let sG={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},sK=e=>String.fromCharCode(sG[e]||e),sV={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},sW={17:2,18:4,21:6,22:8,23:10,19:13,20:15},sq={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},sY={25:2,26:4,29:6,30:8,31:10,27:13,28:15},sj=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class sQ{log(e,t){if(this.verboseLevel>=e){let i="function"==typeof t?t():t;tJ.log("".concat(this.time," [").concat(e,"] ").concat(i))}}constructor(){this.time=null,this.verboseLevel=0}}let sz=function(e){let t=[];for(let i=0;i<e.length;i++)t.push(e[i].toString(16));return t};class sX{reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){let t=["foreground","underline","italics","background","flash"];for(let i=0;i<t.length;i++){let r=t[i];e.hasOwnProperty(r)&&(this[r]=e[r])}}isDefault(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}}class sZ{reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return" "===this.uchar&&this.penState.isDefault()}constructor(){this.uchar=" ",this.penState=new sX}}class sJ{equals(e){for(let t=0;t<100;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<100;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<100;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>100&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=100)}moveCursor(e){let t=this.pos+e;if(e>1)for(let e=this.pos+1;e<t+1;e++)this.chars[e].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();let t=sK(e);if(this.pos>=100)return void this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<100;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){let e=[],t=!0;for(let i=0;i<100;i++){let r=this.chars[i].uchar;" "!==r&&(t=!1),e.push(r)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}constructor(e){this.chars=[],this.pos=0,this.currPenState=new sX,this.cueStartTime=null,this.logger=void 0;for(let e=0;e<100;e++)this.chars.push(new sZ);this.logger=e}}class s${reset(){for(let e=0;e<15;e++)this.rows[e].clear();this.currRow=14}equals(e){let t=!0;for(let i=0;i<15;i++)if(!this.rows[i].equals(e.rows[i])){t=!1;break}return t}copy(e){for(let t=0;t<15;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<15;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+iX(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let e=0;e<15;e++)this.rows[e].clear();let e=this.currRow+1-this.nrRollUpRows,i=this.lastOutputScreen;if(i){let r=i.rows[e].cueStartTime,a=this.logger.time;if(null!==r&&null!==a&&r<a)for(let r=0;r<this.nrRollUpRows;r++)this.rows[t-this.nrRollUpRows+r+1].copy(i.rows[e+r])}}this.currRow=t;let i=this.rows[this.currRow];if(null!==e.indent){let t=Math.max(e.indent-1,0);i.setCursor(e.indent),e.color=i.chars[t].penState.foreground}let r={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(r)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+iX(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(null===this.nrRollUpRows)return void this.logger.log(3,"roll_up but nrRollUpRows not set yet");this.logger.log(1,()=>this.getDisplayText());let e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;let t=[],i="",r=-1;for(let i=0;i<15;i++){let a=this.rows[i].getTextString();a&&(r=i+1,e?t.push("Row "+r+": '"+a+"'"):t.push(a.trim()))}return t.length>0&&(i=e?"["+t.join(" | ")+"]":t.join("\n")),i}getTextAndFormat(){return this.rows}constructor(e){this.rows=[],this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<15;t++)this.rows.push(new sJ(e));this.logger=e}}class s0{reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let t=0;t<e.length;t++)this.writeScreen.insertChar(e[t]);let t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),("MODE_PAINT-ON"===this.mode||"MODE_ROLL-UP"===this.mode)&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode){let e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){let t={flash:!1};(t.underline=e%2==1,t.italics=e>=46,t.italics)?t.foreground="white":t.foreground=["white","green","blue","cyan","red","yellow","magenta"][Math.floor(e/2)-16],this.logger.log(2,"MIDROW: "+iX(t)),this.writeScreen.setPen(t)}outputDataUpdate(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.logger.time;null!==t&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&!this.displayedMemory.isEmpty()&&(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e)}constructor(e,t,i){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new s$(i),this.nonDisplayedMemory=new s$(i),this.lastOutputScreen=new s$(i),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=i}}class s1{getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let e=0;e<t.length;e+=2){var i,r,a,n,s,o,l,d;let u=127&t[e],h=127&t[e+1],c=!1,m=null;if(0===u&&0===h)continue;this.logger.log(3,()=>"["+sz([t[e],t[e+1]])+"] -> ("+sz([u,h])+")");let f=this.cmdHistory;if(u>=16&&u<=31){if(i=u,r=h,(a=f).a===i&&a.b===r){(n=f).a=null,n.b=null,this.logger.log(3,()=>"Repeated command ("+sz([u,h])+") is dropped");continue}s=u,o=h,(l=this.cmdHistory).a=s,l.b=o,(c=this.parseCmd(u,h))||(c=this.parseMidrow(u,h)),c||(c=this.parsePAC(u,h)),c||(c=this.parseBackgroundAttributes(u,h))}else{(d=f).a=null,d.b=null}if(!c&&(m=this.parseChars(u,h))){let e=this.currentChannel;e&&e>0?this.channels[e].insertChars(m):this.logger.log(2,"No channel found yet. TEXT-MODE?")}c||m||this.logger.log(2,()=>"Couldn't parse cleaned data "+sz([u,h])+" orig: "+sz([t[e],t[e+1]]))}}parseCmd(e,t){if(!((20===e||28===e||21===e||29===e)&&t>=32&&t<=47||(23===e||31===e)&&t>=33&&t<=35))return!1;let i=20===e||21===e||23===e?1:2,r=this.channels[i];return 20===e||21===e||28===e||29===e?32===t?r.ccRCL():33===t?r.ccBS():34===t?r.ccAOF():35===t?r.ccAON():36===t?r.ccDER():37===t?r.ccRU(2):38===t?r.ccRU(3):39===t?r.ccRU(4):40===t?r.ccFON():41===t?r.ccRDC():42===t?r.ccTR():43===t?r.ccRTD():44===t?r.ccEDM():45===t?r.ccCR():46===t?r.ccENM():47===t&&r.ccEOC():r.ccTO(t-32),this.currentChannel=i,!0}parseMidrow(e,t){let i=0;if((17===e||25===e)&&t>=32&&t<=47){if((i=17===e?1:2)!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;let r=this.channels[i];return!!r&&(r.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+sz([e,t])+")"),!0)}return!1}parsePAC(e,t){let i,r=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,a=(16===e||24===e)&&t>=64&&t<=95;if(!(r||a))return!1;let n=e<=23?1:2;i=t>=64&&t<=95?1===n?sV[e]:sq[e]:1===n?sW[e]:sY[e];let s=this.channels[n];return!!s&&(s.setPAC(this.interpretPAC(i,t)),this.currentChannel=n,!0)}interpretPAC(e,t){let i,r={color:null,italics:!1,indent:null,underline:!1,row:e};return r.underline=(1&(i=t>95?t-96:t-64))==1,i<=13?r.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(i/2)]:i<=15?(r.italics=!0,r.color="white"):r.indent=4*Math.floor((i-16)/2),r}parseChars(e,t){let i,r=null,a=null;if(e>=25?(i=2,a=e-8):(i=1,a=e),a>=17&&a<=19){let e;e=17===a?t+80:18===a?t+112:t+144,this.logger.log(2,()=>"Special char '"+sK(e)+"' in channel "+i),r=[e]}else e>=32&&e<=127&&(r=0===t?[e]:[e,t]);return r&&this.logger.log(3,()=>"Char codes =  "+sz(r).join(",")),r}parseBackgroundAttributes(e,t){if(!((16===e||24===e)&&t>=32&&t<=47||(23===e||31===e)&&t>=45&&t<=47))return!1;let i={};return 16===e||24===e?(i.background=sj[Math.floor((t-32)/2)],t%2==1&&(i.background=i.background+"_semi")):45===t?i.background="transparent":(i.foreground="black",47===t&&(i.underline=!0)),this.channels[e<=23?1:2].setBkgData(i),!0}reset(){var e;for(let e=0;e<Object.keys(this.channels).length;e++){let t=this.channels[e];t&&t.reset()}(e=this.cmdHistory).a=null,e.b=null}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){let i=this.channels[t];i&&i.cueSplitAtTime(e)}}constructor(e,t,i){this.channels=void 0,this.currentChannel=0,this.cmdHistory={a:null,b:null},this.logger=void 0;let r=this.logger=new sQ;this.channels=[null,new s0(e,t,r),new s0(e+1,i,r)]}}var s2=function(){if(null!=rW&&rW.VTTCue)return self.VTTCue;let e=["","lr","rl"],t=["start","middle","end","left","right"];function i(e,t){if("string"!=typeof t||!Array.isArray(e))return!1;let i=t.toLowerCase();return!!~e.indexOf(i)&&i}function r(e){for(var t=arguments.length,i=Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];let a=1;for(;a<arguments.length;a++){let t=arguments[a];for(let i in t)e[i]=t[i]}return e}function a(a,n,s){let o={enumerable:!0};this.hasBeenReset=!1;let l="",d=!1,u=a,h=n,c=s,m=null,f="",p=!0,g="auto",E="start",y=50,b="middle",T=50,_="middle";Object.defineProperty(this,"id",r({},o,{get:function(){return l},set:function(e){l=""+e}})),Object.defineProperty(this,"pauseOnExit",r({},o,{get:function(){return d},set:function(e){d=!!e}})),Object.defineProperty(this,"startTime",r({},o,{get:function(){return u},set:function(e){if("number"!=typeof e)throw TypeError("Start time must be set to a number.");u=e,this.hasBeenReset=!0}})),Object.defineProperty(this,"endTime",r({},o,{get:function(){return h},set:function(e){if("number"!=typeof e)throw TypeError("End time must be set to a number.");h=e,this.hasBeenReset=!0}})),Object.defineProperty(this,"text",r({},o,{get:function(){return c},set:function(e){c=""+e,this.hasBeenReset=!0}})),Object.defineProperty(this,"region",r({},o,{get:function(){return m},set:function(e){m=e,this.hasBeenReset=!0}})),Object.defineProperty(this,"vertical",r({},o,{get:function(){return f},set:function(t){let r=i(e,t);if(!1===r)throw SyntaxError("An invalid or illegal string was specified.");f=r,this.hasBeenReset=!0}})),Object.defineProperty(this,"snapToLines",r({},o,{get:function(){return p},set:function(e){p=!!e,this.hasBeenReset=!0}})),Object.defineProperty(this,"line",r({},o,{get:function(){return g},set:function(e){if("number"!=typeof e&&"auto"!==e)throw SyntaxError("An invalid number or illegal string was specified.");g=e,this.hasBeenReset=!0}})),Object.defineProperty(this,"lineAlign",r({},o,{get:function(){return E},set:function(e){let r=i(t,e);if(!r)throw SyntaxError("An invalid or illegal string was specified.");E=r,this.hasBeenReset=!0}})),Object.defineProperty(this,"position",r({},o,{get:function(){return y},set:function(e){if(e<0||e>100)throw Error("Position must be between 0 and 100.");y=e,this.hasBeenReset=!0}})),Object.defineProperty(this,"positionAlign",r({},o,{get:function(){return b},set:function(e){let r=i(t,e);if(!r)throw SyntaxError("An invalid or illegal string was specified.");b=r,this.hasBeenReset=!0}})),Object.defineProperty(this,"size",r({},o,{get:function(){return T},set:function(e){if(e<0||e>100)throw Error("Size must be between 0 and 100.");T=e,this.hasBeenReset=!0}})),Object.defineProperty(this,"align",r({},o,{get:function(){return _},set:function(e){let r=i(t,e);if(!r)throw SyntaxError("An invalid or illegal string was specified.");_=r,this.hasBeenReset=!0}})),this.displayState=void 0}return a.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},a}();class s3{decode(e,t){if(!e)return"";if("string"!=typeof e)throw Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function s4(e){function t(e,t,i,r){return(0|e)*3600+(0|t)*60+(0|i)+parseFloat(r||0)}let i=e.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return i?parseFloat(i[2])>59?t(i[2],i[3],0,i[4]):t(i[1],i[2],i[3],i[4]):null}class s5{set(e,t){this.get(e)||""===t||(this.values[e]=t)}get(e,t,i){return i?this.has(e)?this.values[e]:t[i]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,i){for(let r=0;r<i.length;++r)if(t===i[r]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){let i=parseFloat(t);if(i>=0&&i<=100)return this.set(e,i),!0}return!1}constructor(){this.values=Object.create(null)}}function s8(e,t,i,r){let a=r?e.split(r):[e];for(let e in a){if("string"!=typeof a[e])continue;let r=a[e].split(i);if(2===r.length)t(r[0],r[1])}}let s9=new s2(0,0,""),s6="middle"===s9.align?"middle":"center";function s7(e){return e.replace(/<br(?: \/)?>/gi,"\n")}class oe{parse(e){let t=this;function i(){let e=t.buffer,i=0;for(e=s7(e);i<e.length&&"\r"!==e[i]&&"\n"!==e[i];)++i;let r=e.slice(0,i);return"\r"===e[i]&&++i,"\n"===e[i]&&++i,t.buffer=e.slice(i),r}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{let e="";if("INITIAL"===t.state){if(!/\r\n|\n/.test(t.buffer))return this;let r=(e=i()).match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!(null!=r&&r[0]))throw Error("Malformed WebVTT signature.");t.state="HEADER"}let a=!1;for(;t.buffer&&/\r\n|\n/.test(t.buffer);)switch(a?a=!1:e=i(),t.state){case"HEADER":if(/:/.test(e)){var r;r=e,s8(r,function(e,t){},/:/)}else e||(t.state="ID");continue;case"NOTE":e||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(e)){t.state="NOTE";break}if(!e)continue;if(t.cue=new s2(0,0,""),t.state="CUE",-1===e.indexOf("-->")){t.cue.id=e;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{!function(e,t,i){let r=e;function a(){let t=s4(e);if(null===t)throw Error("Malformed timestamp: "+r);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function n(){e=e.replace(/^\s+/,"")}if(n(),t.startTime=a(),n(),"-->"!==e.slice(0,3))throw Error("Malformed time stamp (time stamps must be separated by '-->'): "+r);e=e.slice(3),n(),t.endTime=a(),n();var s=e;let o=new s5;s8(s,function(e,t){let r;switch(e){case"region":for(let r=i.length-1;r>=0;r--)if(i[r].id===t){o.set(e,i[r].region);break}break;case"vertical":o.alt(e,t,["rl","lr"]);break;case"line":r=t.split(","),o.integer(e,r[0]),o.percent(e,r[0])&&o.set("snapToLines",!1),o.alt(e,r[0],["auto"]),2===r.length&&o.alt("lineAlign",r[1],["start",s6,"end"]);break;case"position":r=t.split(","),o.percent(e,r[0]),2===r.length&&o.alt("positionAlign",r[1],["start",s6,"end","line-left","line-right","auto"]);break;case"size":o.percent(e,t);break;case"align":o.alt(e,t,["start",s6,"end","left","right"])}},/:/,/\s/),t.region=o.get("region",null),t.vertical=o.get("vertical","");let l=o.get("line","auto");"auto"===l&&-1===s9.line&&(l=-1),t.line=l,t.lineAlign=o.get("lineAlign","start"),t.snapToLines=o.get("snapToLines",!0),t.size=o.get("size",100),t.align=o.get("align",s6);let d=o.get("position","auto");"auto"===d&&50===s9.position&&(d="start"===t.align||"left"===t.align?0:"end"===t.align||"right"===t.align?100:50),t.position=d}(e,t.cue,t.regionList)}catch(e){t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{let i=-1!==e.indexOf("-->");if(!e||i&&(a=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(null===t.cue)continue;t.cue.text&&(t.cue.text+="\n"),t.cue.text+=e}continue;case"BADCUE":e||(t.state="ID")}}catch(e){"CUETEXT"===t.state&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state="INITIAL"===t.state?"BADWEBVTT":"BADCUE"}return this}flush(){try{if((this.cue||"HEADER"===this.state)&&(this.buffer+="\n\n",this.parse()),"INITIAL"===this.state||"BADWEBVTT"===this.state)throw Error("Malformed WebVTT signature.")}catch(e){this.onparsingerror&&this.onparsingerror(e)}return this.onflush&&this.onflush(),this}constructor(){this.state="INITIAL",this.buffer="",this.decoder=new s3,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}}let ot=/\r\n|\n\r|\n|\r/g,oi=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return e.slice(i,i+t.length)===t},or=function(e){let t=parseInt(e.slice(-3)),i=parseInt(e.slice(-6,-4)),r=parseInt(e.slice(-9,-7)),a=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!tP(t)||!tP(i)||!tP(r)||!tP(a))throw Error("Malformed X-TIMESTAMP-MAP: Local:".concat(e));return t+=1e3*i,t+=6e4*r,t+=36e5*a};function oa(e,t,i){return sk(e.toString())+sk(t.toString())+sk(i)}let on=function(e,t,i){let r=e[t],a=e[r.prevCC];if(!a||!a.new&&r.new){e.ccOffset=e.presentationOffset=r.start,r.new=!1;return}for(;null!=(n=a)&&n.new;){var n;e.ccOffset+=r.start-a.start,r.new=!1,a=e[(r=a).prevCC]}e.presentationOffset=i},os="stpp.ttml.im1t",oo=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,ol=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,od={left:"start",center:"center",right:"end",start:"start",end:"end"};function ou(e,t,i,r){let a=iu(new Uint8Array(e),["mdat"]);if(0===a.length)return void r(Error("Could not parse IMSC1 mdat"));let n=a.map(e=>t1(e)),s=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return nc(e,t,1/i,r)}(t.baseTime,1,t.timescale);try{n.forEach(e=>i(function(e,t){let i=new DOMParser().parseFromString(e,"text/xml").getElementsByTagName("tt")[0];if(!i)throw Error("Invalid ttml");let r={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},a=Object.keys(r).reduce((e,t)=>(e[t]=i.getAttribute("ttp:".concat(t))||r[t],e),{}),n="preserve"!==i.getAttribute("xml:space"),s=oc(oh(i,"styling","style")),o=oc(oh(i,"layout","region")),l=oh(i,"body","[begin]");return[].map.call(l,e=>{let i=function e(t,i){return[].slice.call(t.childNodes).reduce((t,r,a)=>{var n;return"br"===r.nodeName&&a?t+"\n":null!=(n=r.childNodes)&&n.length?e(r,i):i?t+r.textContent.trim().replace(/\s+/g," "):t+r.textContent},"")}(e,n);if(!i||!e.hasAttribute("begin"))return null;let r=op(e.getAttribute("begin"),a),l=op(e.getAttribute("dur"),a),d=op(e.getAttribute("end"),a);if(null===r)throw of(e);if(null===d){if(null===l)throw of(e);d=r+l}let u=new s2(r-t,d-t,i);u.id=oa(u.startTime,u.endTime,u.text);let h=o[e.getAttribute("region")],c=function(e,t,i){let r="http://www.w3.org/ns/ttml#styling",a=null,n=null!=e&&e.hasAttribute("style")?e.getAttribute("style"):null;return n&&i.hasOwnProperty(n)&&(a=i[n]),["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"].reduce((i,n)=>{let s=om(t,r,n)||om(e,r,n)||om(a,r,n);return s&&(i[n]=s),i},{})}(h,s[e.getAttribute("style")],s),{textAlign:m}=c;if(m){let e=od[m];e&&(u.lineAlign=e),u.align=m}return tW(u,c),u}).filter(e=>null!==e)}(e,s)))}catch(e){r(e)}}function oh(e,t,i){let r=e.getElementsByTagName(t)[0];return r?[].slice.call(r.querySelectorAll(i)):[]}function oc(e){return e.reduce((e,t)=>{let i=t.getAttribute("xml:id");return i&&(e[i]=t),e},{})}function om(e,t,i){return e&&e.hasAttributeNS(t,i)?e.getAttributeNS(t,i):null}function of(e){return Error("Could not parse ttml timestamp ".concat(e))}function op(e,t){if(!e)return null;let i=s4(e);return null===i&&(oo.test(e)?i=function(e,t){let i=oo.exec(e),r=(0|i[4])+(0|i[5])/t.subFrameRate;return(0|i[1])*3600+(0|i[2])*60+(0|i[3])+r/t.frameRate}(e,t):ol.test(e)&&(i=function(e,t){let i=ol.exec(e),r=Number(i[1]);switch(i[2]){case"h":return 3600*r;case"m":return 60*r;case"ms":return 1e3*r;case"f":return r/t.frameRate;case"t":return r/t.tickRate}return r}(e,t))),i}class og{dispatchCue(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,i){(null===this.startTime||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=i,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}}function ov(e){return e.characteristics&&/transcribes-spoken-dialog/gi.test(e.characteristics)&&/describes-music-and-sound/gi.test(e.characteristics)?"captions":"subtitles"}function oE(e,t){return!!e&&e.kind===ov(t)&&nP(t,e)}function oy(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}let ob=/\s/,oT={newCue(e,t,i,r){let a,n,s,o,l,d=[],u=self.VTTCue||self.TextTrackCue;for(let c=0;c<r.rows.length;c++)if(a=r.rows[c],s=!0,o=0,l="",!a.isEmpty()){var h;for(let e=0;e<a.chars.length;e++)ob.test(a.chars[e].uchar)&&s?o++:(l+=a.chars[e].uchar,s=!1);a.cueStartTime=t,t===i&&(i+=1e-4),o>=16?o--:o++;let r=s7(l.trim()),m=oa(t,i,r);null!=e&&null!=(h=e.cues)&&h.getCueById(m)||((n=new u(t,i,r)).id=m,n.line=c+1,n.align="left",n.position=10+Math.min(80,10*Math.floor(8*o/32)),d.push(n))}return e&&d.length&&(d.sort((e,t)=>"auto"===e.line||"auto"===t.line?0:e.line>8&&t.line>8?t.line-e.line:e.line-t.line),d.forEach(t=>sA(e,t))),d}},o_=/(\d+)-(\d+)\/(\d+)/;class oA{destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,i){let r=this.stats;if(r.loading.start)throw Error("Loader can only be used once.");r.loading.start=self.performance.now();let a=function(e,t){let i={method:"GET",mode:"cors",credentials:"same-origin",signal:t,headers:new self.Headers(tW({},e.headers))};return e.rangeEnd&&i.headers.set("Range","bytes="+e.rangeStart+"-"+String(e.rangeEnd-1)),i}(e,this.controller.signal),n="arraybuffer"===e.responseType,s=n?"byteLength":"length",{maxTimeToFirstByteMs:o,maxLoadTimeMs:l}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=i,this.request=this.fetchSetup(e,a),self.clearTimeout(this.requestTimeout),t.timeout=o&&tP(o)?o:l,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(r,e,this.response))},t.timeout),(nR(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(i=>{var a;this.response=this.loader=i;let s=Math.max(self.performance.now(),r.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=l,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(r,e,this.response))},l-(s-r.loading.start)),!i.ok){let{status:e,statusText:t}=i;throw new oI(t||"fetch, bad network response",e,i)}r.loading.first=s,r.total=function(e){let t=e.get("Content-Range");if(t){let e=function(e){let t=o_.exec(e);if(t)return parseInt(t[2])-parseInt(t[1])+1}(t);if(tP(e))return e}let i=e.get("Content-Length");if(i)return parseInt(i)}(i.headers)||r.total;let o=null==(a=this.callbacks)?void 0:a.onProgress;return o&&tP(t.highWaterMark)?this.loadProgressively(i,r,e,t.highWaterMark,o):n?i.arrayBuffer():"json"===e.responseType?i.json():i.text()}).then(i=>{var a,n;let o=this.response;if(!o)throw Error("loader destroyed");self.clearTimeout(this.requestTimeout),r.loading.end=Math.max(self.performance.now(),r.loading.first);let l=i[s];l&&(r.loaded=r.total=l);let d={url:o.url,data:i,code:o.status},u=null==(a=this.callbacks)?void 0:a.onProgress;u&&!tP(t.highWaterMark)&&u(r,e,i,o),null==(n=this.callbacks)||n.onSuccess(d,r,e,o)}).catch(t=>{var i;if(self.clearTimeout(this.requestTimeout),r.aborted)return;let a=t&&t.code||0,n=t?t.message:null;null==(i=this.callbacks)||i.onError({code:a,text:n},e,t?t.details:null,r)})}getCacheAge(){let e=null;if(this.response){let t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4?arguments[4]:void 0,n=new ak,s=e.body.getReader(),o=()=>s.read().then(s=>{if(s.done)return n.dataLength&&a(t,i,n.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));let l=s.value,d=l.length;return t.loaded+=d,d<r||n.dataLength?(n.push(l),n.dataLength>=r&&a(t,i,n.flush().buffer,e)):a(t,i,l.buffer,e),o()}).catch(()=>Promise.reject());return o()}constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||oS,this.controller=new self.AbortController,this.stats=new t8}}function oS(e,t){return new self.Request(e.url,t)}class oI extends Error{constructor(e,t,i){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=i}}let oR=/^age:\s*[\d.]+\s*$/im;class ok{destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){let e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,4!==e.readyState&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,i){if(this.stats.loading.start)throw Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=i,this.loadInternal()}loadInternal(){let{config:e,context:t}=this;if(!e||!t)return;let i=this.loader=new self.XMLHttpRequest,r=this.stats;r.loading.first=0,r.loaded=0,r.aborted=!1;let a=this.xhrSetup;a?Promise.resolve().then(()=>{if(this.loader===i&&!this.stats.aborted)return a(i,t.url)}).catch(e=>{if(this.loader===i&&!this.stats.aborted)return i.open("GET",t.url,!0),a(i,t.url)}).then(()=>{this.loader!==i||this.stats.aborted||this.openAndSendXhr(i,t,e)}).catch(e=>{var a;null==(a=this.callbacks)||a.onError({code:i.status,text:e.message},t,i,r)}):this.openAndSendXhr(i,t,e)}openAndSendXhr(e,t,i){e.readyState||e.open("GET",t.url,!0);let r=t.headers,{maxTimeToFirstByteMs:a,maxLoadTimeMs:n}=i.loadPolicy;if(r)for(let t in r)e.setRequestHeader(t,r[t]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),i.timeout=a&&tP(a)?a:n,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),i.timeout),e.send()}readystatechange(){let{context:e,loader:t,stats:i}=this;if(!e||!t)return;let r=t.readyState,a=this.config;if(!i.aborted&&r>=2&&(0===i.loading.first&&(i.loading.first=Math.max(self.performance.now(),i.loading.start),a.timeout!==a.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),a.timeout=a.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),a.loadPolicy.maxLoadTimeMs-(i.loading.first-i.loading.start)))),4===r)){var n,s,o;self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;let r=t.status,l="text"===t.responseType?t.responseText:null;if(r>=200&&r<300){let a=null!=l?l:t.response;if(null!=a){i.loading.end=Math.max(self.performance.now(),i.loading.first),i.loaded=i.total="arraybuffer"===t.responseType?a.byteLength:a.length,i.bwEstimate=8e3*i.total/(i.loading.end-i.loading.first);let o=null==(n=this.callbacks)?void 0:n.onProgress;o&&o(i,e,a,t);let l={url:t.responseURL,data:a,code:r};null==(s=this.callbacks)||s.onSuccess(l,i,e,t);return}}let d=a.loadPolicy.errorRetry;rn(d,i.retry,!1,{url:e.url,data:void 0,code:r})?this.retry(d):(tJ.error("".concat(r," while loading ").concat(e.url)),null==(o=this.callbacks)||o.onError({code:r,text:t.statusText},e,t,i))}}loadtimeout(){if(!this.config)return;let e=this.config.loadPolicy.timeoutRetry;if(rn(e,this.stats.retry,!0))this.retry(e);else{var t;tJ.warn("timeout while loading ".concat(null==(t=this.context)?void 0:t.url));let e=this.callbacks;e&&(this.abortInternal(),e.onTimeout(this.stats,this.context,this.loader))}}retry(e){let{context:t,stats:i}=this;this.retryDelay=rr(e,i.retry),i.retry++,tJ.warn("".concat(status?"HTTP Status "+status:"Timeout"," while loading ").concat(null==t?void 0:t.url,", retrying ").concat(i.retry,"/").concat(e.maxNumRetry," in ").concat(this.retryDelay,"ms")),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){let t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&oR.test(this.loader.getAllResponseHeaders())){let t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&RegExp("^".concat(e,":\\s*[\\d.]+\\s*$"),"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new t8,this.retryDelay=0}}let oL=tY(tY({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:1/0,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:6e7,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:ok,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:class extends tj{resetEstimator(e){e&&(this.log("setting initial bwe to ".concat(e)),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){let e=this.hls.config;return new tV(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){let{hls:e}=this;e.on(tB.MANIFEST_LOADING,this.onManifestLoading,this),e.on(tB.FRAG_LOADING,this.onFragLoading,this),e.on(tB.FRAG_LOADED,this.onFragLoaded,this),e.on(tB.FRAG_BUFFERED,this.onFragBuffered,this),e.on(tB.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(tB.LEVEL_LOADED,this.onLevelLoaded,this),e.on(tB.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(tB.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(tB.ERROR,this.onError,this)}unregisterListeners(){let{hls:e}=this;e&&(e.off(tB.MANIFEST_LOADING,this.onManifestLoading,this),e.off(tB.FRAG_LOADING,this.onFragLoading,this),e.off(tB.FRAG_LOADED,this.onFragLoaded,this),e.off(tB.FRAG_BUFFERED,this.onFragBuffered,this),e.off(tB.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(tB.LEVEL_LOADED,this.onLevelLoaded,this),e.off(tB.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(tB.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(tB.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){let i=t.frag;if(!this.ignoreFragment(i)){if(!i.bitrateTest){var r;this.fragCurrent=i,this.partCurrent=null!=(r=t.part)?r:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case tF.BUFFER_ADD_CODEC_ERROR:case tF.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case tF.FRAG_LOAD_TIMEOUT:{let e=t.frag,{fragCurrent:i,partCurrent:r}=this;if(e&&i&&e.sn===i.sn&&e.level===i.level){let t=performance.now(),i=r?r.stats:e.stats,a=t-i.loading.start,n=i.loading.first?i.loading.first-i.loading.start:-1;if(i.loaded&&n>-1){let e=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(a-Math.min(e,n),i.loaded)}else this.bwEstimator.sampleTTFB(a)}}}}getTimeToLoadFrag(e,t,i,r){let a=r?e+this.lastLevelLoadSec:0;return e+i/t+a}onLevelLoaded(e,t){let i=this.hls.config,{loading:r}=t.stats,a=r.end-r.first;tP(a)&&(this.lastLevelLoadSec=a/1e3),t.details.live?this.bwEstimator.update(i.abrEwmaSlowLive,i.abrEwmaFastLive):this.bwEstimator.update(i.abrEwmaSlowVoD,i.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,t){let{frag:i,part:r}=t,a=r?r.stats:i.stats;if(i.type===tG.MAIN&&this.bwEstimator.sampleTTFB(a.loading.first-a.loading.start),!this.ignoreFragment(i)){if(this.clearTimer(),i.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){let e=r?r.duration:i.duration,t=this.hls.levels[i.level],n=(t.loaded?t.loaded.bytes:0)+a.loaded,s=(t.loaded?t.loaded.duration:0)+e;t.loaded={bytes:n,duration:s},t.realBitrate=Math.round(8*n/s)}if(i.bitrateTest){let e={stats:a,frag:i,part:r,id:i.type};this.onFragBuffered(tB.FRAG_BUFFERED,e),i.bitrateTest=!1}else this.lastLoadedFragLevel=i.level}}onFragBuffered(e,t){let{frag:i,part:r}=t,a=null!=r&&r.stats.loaded?r.stats:i.stats;if(a.aborted||this.ignoreFragment(i))return;let n=a.parsing.end-a.loading.start-Math.min(a.loading.first-a.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(n,a.loaded),a.bwEstimate=this.getBwEstimate(),i.bitrateTest?this.bitrateTestDelay=n/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==tG.MAIN||"initSegment"===e.sn}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){let{maxAutoLevel:e,minAutoLevel:t}=this.hls,i=this.getBwEstimate(),r=this.hls.config.maxStarvationDelay,a=this.findBestLevel(i,t,e,0,r,1,1);if(a>-1)return a;let n=this.hls.firstLevel,s=Math.min(Math.max(n,t),e);return this.warn("Could not find best starting auto level. Defaulting to first in playlist ".concat(n," clamped to ").concat(s)),s}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){let e=this.forcedAutoLevel,t=this.bwEstimator.canEstimate(),i=this.lastLoadedFragLevel>-1;if(-1!==e&&(!t||!i||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;let r=t&&i?this.getNextABRAutoLevel():this.firstAutoLevel;if(-1!==e){let t=this.hls.levels;if(t.length>Math.max(e,r)&&t[e].loadError<=t[r].loadError)return e}return this._nextAutoLevel=r,this.nextAutoLevelKey=this.getAutoLevelKey(),r}getAutoLevelKey(){return"".concat(this.getBwEstimate(),"_").concat(this.getStarvationDelay().toFixed(2))}getNextABRAutoLevel(){let{fragCurrent:e,partCurrent:t,hls:i}=this;if(i.levels.length<=1)return i.loadLevel;let{maxAutoLevel:r,config:a,minAutoLevel:n}=i,s=t?t.duration:e?e.duration:0,o=this.getBwEstimate(),l=this.getStarvationDelay(),d=a.abrBandWidthFactor,u=a.abrBandWidthUpFactor;if(l){let e=this.findBestLevel(o,n,r,l,0,d,u);if(e>=0)return this.rebufferNotice=-1,e}let h=s?Math.min(s,a.maxStarvationDelay):a.maxStarvationDelay;if(!l){let e=this.bitrateTestDelay;e&&(h=(s?Math.min(s,a.maxLoadingDelay):a.maxLoadingDelay)-e,this.info("bitrate test took ".concat(Math.round(1e3*e),"ms, set first fragment max fetchDuration to ").concat(Math.round(1e3*h)," ms")),d=u=1)}let c=this.findBestLevel(o,n,r,l,h,d,u);if(this.rebufferNotice!==c&&(this.rebufferNotice=c,this.info("".concat(l?"rebuffering expected":"buffer is empty",", optimal quality level ").concat(c))),c>-1)return c;let m=i.levels[n],f=i.loadLevelObj;return f&&(null==m?void 0:m.bitrate)<f.bitrate?n:i.loadLevel}getStarvationDelay(){let e=this.hls,t=e.media;if(!t)return 1/0;let i=t&&0!==t.playbackRate?Math.abs(t.playbackRate):1,r=e.mainForwardBufferInfo;return(r?r.len:0)/i}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,i,r,a,n,s){var o,l;let d,u=r+a,h=this.lastLoadedFragLevel,c=-1===h?this.hls.firstLevel:h,{fragCurrent:m,partCurrent:f}=this,{levels:p,allAudioTracks:g,loadLevel:E,config:y}=this.hls;if(1===p.length)return 0;let b=p[c],T=!!(null!=(o=this.hls.latestLevelDetails)&&o.live),_=-1===E||-1===h,A="SDR",S=(null==b?void 0:b.frameRate)||0,{audioPreference:I,videoPreference:R}=y,k=this.audioTracksByGroup||(this.audioTracksByGroup=iJ(g)),L=-1;if(_){if(-1!==this.firstSelection)return this.firstSelection;let r=function(e,t,i,r,a){let n=Object.keys(e),s=null==r?void 0:r.channels,o=null==r?void 0:r.audioCodec,l=null==a?void 0:a.videoCodec,d=s&&2===parseInt(s),u=!1,h=!1,c=1/0,m=1/0,f=1/0,p=1/0,g=0,E=[],{preferHDR:y,allowedVideoRanges:b}=function(e,t){let i=!1,r=[];if(e&&(i="SDR"!==e,r=[e]),t){let e="SDR"!==(r=t.allowedVideoRanges||iW.slice(0)).join("")&&!t.videoCodec;(i=void 0!==t.preferHDR?t.preferHDR:e&&function(){if("function"==typeof matchMedia){let e=matchMedia("(dynamic-range: high)"),t=matchMedia("bad query");if(e.media!==t.media)return!0===e.matches}return!1}())||(r=["SDR"])}return{preferHDR:i,allowedVideoRanges:r}}(t,a);for(let t=n.length;t--;){let i=e[n[t]];u||(u=i.channels[2]>0),c=Math.min(c,i.minHeight),m=Math.min(m,i.minFramerate),f=Math.min(f,i.minBitrate),b.filter(e=>i.videoRanges[e]>0).length>0&&(h=!0)}c=tP(c)?c:0,m=tP(m)?m:0;let T=Math.max(1080,c),_=Math.max(30,m);i=Math.max(f=tP(f)?f:i,i),h||(t=void 0);let A=n.length>1;return{codecSet:n.reduce((t,r)=>{let a=e[r];if(r===t)return t;if(E=h?b.filter(e=>a.videoRanges[e]>0):[],A){if(a.minBitrate>i)return iZ(r,"min bitrate of ".concat(a.minBitrate," > current estimate of ").concat(i)),t;if(!a.hasDefaultAudio)return iZ(r,"no renditions with default or auto-select sound found"),t;if(o&&r.indexOf(o.substring(0,4))%5!=0)return iZ(r,'audio codec preference "'.concat(o,'" not found')),t;if(s&&!d){if(!a.channels[s])return iZ(r,"no renditions with ".concat(s," channel sound found (channels options: ").concat(Object.keys(a.channels),")")),t}else if((!o||d)&&u&&0===a.channels["2"])return iZ(r,"no renditions with stereo sound found"),t;if(a.minHeight>T)return iZ(r,"min resolution of ".concat(a.minHeight," > maximum of ").concat(T)),t;if(a.minFramerate>_)return iZ(r,"min framerate of ".concat(a.minFramerate," > maximum of ").concat(_)),t;if(!E.some(e=>a.videoRanges[e]>0))return iZ(r,"no variants with VIDEO-RANGE of ".concat(iX(E)," found")),t;if(l&&r.indexOf(l.substring(0,4))%5!=0)return iZ(r,'video codec preference "'.concat(l,'" not found')),t;if(a.maxScore<g)return iZ(r,"max score of ".concat(a.maxScore," < selected max of ").concat(g)),t}return t&&(iw(r)>=iw(t)||a.fragmentError>e[t].fragmentError)?t:(p=a.minIndex,g=a.maxScore,r)},void 0),videoRanges:E,preferHDR:y,minFramerate:m,minBitrate:f,minIndex:p}}(this.codecTiers||(this.codecTiers=p.slice(t,i+1).reduce((e,t,i)=>{if(!t.codecSet)return e;let r=t.audioGroups,a=e[t.codecSet];a||(e[t.codecSet]=a={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:i,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!r,fragmentError:0}),a.minBitrate=Math.min(a.minBitrate,t.bitrate);let n=Math.min(t.height,t.width);return a.minHeight=Math.min(a.minHeight,n),a.minFramerate=Math.min(a.minFramerate,t.frameRate),a.minIndex=Math.min(a.minIndex,i),a.maxScore=Math.max(a.maxScore,t.score),a.fragmentError+=t.fragmentError,a.videoRanges[t.videoRange]=(a.videoRanges[t.videoRange]||0)+1,r&&r.forEach(e=>{if(!e)return;let t=k.groups[e];t&&(a.hasDefaultAudio=a.hasDefaultAudio||k.hasDefaultAudio?t.hasDefault:t.hasAutoSelect||!k.hasDefaultAudio&&!k.hasAutoSelectAudio,Object.keys(t.channels).forEach(e=>{a.channels[e]=(a.channels[e]||0)+t.channels[e]}))}),e},{})),A,e,I,R),{codecSet:a,videoRanges:n,minFramerate:s,minBitrate:o,minIndex:l,preferHDR:u}=r;L=l,d=a,A=u?n[n.length-1]:n[0],S=s,e=Math.max(e,o),this.log("picked start tier ".concat(iX(r)))}else d=null==b?void 0:b.codecSet,A=null==b?void 0:b.videoRange;let D=f?f.duration:m?m.duration:0,w=this.bwEstimator.getEstimateTTFB()/1e3,C=[];for(let o=i;o>=t;o--){let t,m=p[o],g=o>c;if(!m)continue;if(y.useMediaCapabilities&&!m.supportedResult&&!m.supportedPromise){let t=navigator.mediaCapabilities;"function"==typeof(null==t?void 0:t.decodingInfo)&&function(e,t,i,r,a,n){let s=e.videoCodec,o=e.audioCodec?e.audioGroups:null,l=null==n?void 0:n.audioCodec,d=null==n?void 0:n.channels,u=d?parseInt(d):l?1/0:2,h=null;if(null!=o&&o.length)try{h=1===o.length&&o[0]?t.groups[o[0]].channels:o.reduce((e,i)=>{if(i){let r=t.groups[i];if(!r)throw Error("Audio track group ".concat(i," not found"));Object.keys(r.channels).forEach(t=>{e[t]=(e[t]||0)+r.channels[t]})}return e},{2:0})}catch(e){return!0}return void 0!==s&&(s.split(",").some(e=>ib(e))||e.width>1920&&e.height>1088||e.height>1920&&e.width>1088||e.frameRate>Math.max(r,30)||"SDR"!==e.videoRange&&e.videoRange!==i||e.bitrate>Math.max(a,8e6))||!!h&&tP(u)&&Object.keys(h).some(e=>parseInt(e)>u)}(m,k,A,S,e,I)?(m.supportedPromise=iG(m,k,t,this.supportedCache),m.supportedPromise.then(e=>{if(!this.hls)return;m.supportedResult=e;let t=this.hls.levels,i=t.indexOf(m);e.error?this.warn('MediaCapabilities decodingInfo error: "'.concat(e.error,'" for level ').concat(i," ").concat(iX(e))):e.supported?e.decodingInfoResults.some(e=>!1===e.smooth||!1===e.powerEfficient)&&this.log("MediaCapabilities decodingInfo for level ".concat(i," not smooth or powerEfficient: ").concat(iX(e))):(this.warn("Unsupported MediaCapabilities decodingInfo result for level ".concat(i," ").concat(iX(e))),i>-1&&t.length>1&&(this.log("Removing unsupported level ".concat(i)),this.hls.removeLevel(i),-1===this.hls.loadLevel&&(this.hls.nextLoadLevel=0)))}).catch(e=>{this.warn("Error handling MediaCapabilities decodingInfo: ".concat(e))})):m.supportedResult=iB}if((d&&m.codecSet!==d||A&&m.videoRange!==A||g&&S>m.frameRate||!g&&S>0&&S<m.frameRate||null!=(l=m.supportedResult)&&null!=(l=l.decodingInfoResults)&&l.some(e=>!1===e.smooth))&&(!_||o!==L)){C.push(o);continue}let b=m.details,R=(f?null==b?void 0:b.partTarget:null==b?void 0:b.averagetargetduration)||D;t=g?s*e:n*e;let M=D&&r>=2*D&&0===a?m.averageBitrate:m.maxBitrate,O=this.getTimeToLoadFrag(w,t,M*R,void 0===b);if(t>=M&&(o===h||0===m.loadError&&0===m.fragmentError)&&(O<=w||!tP(O)||T&&!this.bitrateTestDelay||O<u)){let e=this.forcedAutoLevel;return o!==E&&(-1===e||e!==E)&&(C.length&&this.trace("Skipped level(s) ".concat(C.join(",")," of ").concat(i,' max with CODECS and VIDEO-RANGE:"').concat(p[C[0]].codecs,'" ').concat(p[C[0]].videoRange,'; not compatible with "').concat(d,'" ').concat(A)),this.info("switch candidate:".concat(c,"->").concat(o," adjustedbw(").concat(Math.round(t),")-bitrate=").concat(Math.round(t-M)," ttfb:").concat(w.toFixed(1)," avgDuration:").concat(R.toFixed(1)," maxFetchDuration:").concat(u.toFixed(1)," fetchDuration:").concat(O.toFixed(1)," firstSelection:").concat(_," codecSet:").concat(m.codecSet," videoRange:").concat(m.videoRange," hls.loadLevel:").concat(E))),_&&(this.firstSelection=o),o}}return -1}set nextAutoLevel(e){let t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){let{maxAutoLevel:t,minAutoLevel:i}=this.hls;return Math.min(Math.max(e,i),t)}constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=e=>{var t;let i,{fragCurrent:r,partCurrent:a,hls:n}=this,{autoLevelEnabled:s,media:o}=n;if(!r||!o)return;let l=performance.now(),d=a?a.stats:r.stats,u=a?a.duration:r.duration,h=l-d.loading.start,c=n.minAutoLevel,m=r.level,f=this._nextAutoLevel;if(d.aborted||d.loaded&&d.loaded===d.total||m<=c){this.clearTimer(),this._nextAutoLevel=-1;return}if(!s)return;let p=f>-1&&f!==m,g=!!e||p;if(!g&&(o.paused||!o.playbackRate||!o.readyState))return;let E=n.mainForwardBufferInfo;if(!g&&null===E)return;let y=this.bwEstimator.getEstimateTTFB(),b=Math.abs(o.playbackRate);if(h<=Math.max(y,u/(2*b)*1e3))return;let T=E?E.len/b:0,_=d.loading.first?d.loading.first-d.loading.start:-1,A=d.loaded&&_>-1,S=this.getBwEstimate(),I=n.levels,R=I[m],k=Math.max(d.loaded,Math.round(u*(r.bitrate||R.averageBitrate)/8)),L=A?h-_:h;L<1&&A&&(L=Math.min(h,8*d.loaded/S));let D=A?1e3*d.loaded/L:0,w=y/1e3,C=D?(k-d.loaded)/D:8*k/S+w;if(C<=T)return;let M=D?8*D:S,O=(null==(t=(null==e?void 0:e.details)||this.hls.latestLevelDetails)?void 0:t.live)===!0,P=this.hls.config.abrBandWidthUpFactor,x=1/0;for(i=m-1;i>c;i--){let e=I[i].maxBitrate,t=!I[i].details||O;if((x=this.getTimeToLoadFrag(w,M,u*e,t))<Math.min(T,u+w))break}if(x>=C||x>10*u)return;A?this.bwEstimator.sample(h-Math.min(y,_),d.loaded):this.bwEstimator.sampleTTFB(h);let N=I[i].maxBitrate;this.getBwEstimate()*P>N&&this.resetEstimator(N);let U=this.findBestLevel(N,c,i,0,T,1,1);U>-1&&(i=U),this.warn("Fragment ".concat(r.sn).concat(a?" part "+a.index:""," of level ").concat(m," is loading too slowly;\n      Fragment duration: ").concat(r.duration.toFixed(3),"\n      Time to underbuffer: ").concat(T.toFixed(3)," s\n      Estimated load time for current fragment: ").concat(C.toFixed(3)," s\n      Estimated load time for down switch fragment: ").concat(x.toFixed(3)," s\n      TTFB estimate: ").concat(0|_," ms\n      Current BW estimate: ").concat(tP(S)?0|S:"Unknown"," bps\n      New BW estimate: ").concat(0|this.getBwEstimate()," bps\n      Switching to level ").concat(i," @ ").concat(0|N," bps")),n.nextLoadLevel=n.nextAutoLevel=i,this.clearTimer();let F=()=>{if(this.clearTimer(),this.fragCurrent===r&&this.hls.loadLevel===i&&i>0){let e=this.getStarvationDelay();if(this.warn("Aborting inflight request ".concat(i>0?"and switching down":"","\n      Fragment duration: ").concat(r.duration.toFixed(3)," s\n      Time to underbuffer: ").concat(e.toFixed(3)," s")),r.abortRequests(),this.fragCurrent=this.partCurrent=null,i>c){let t=this.findBestLevel(this.hls.levels[c].bitrate,c,i,0,e,1,1);-1===t&&(t=c),this.hls.nextLoadLevel=this.hls.nextAutoLevel=t,this.resetEstimator(this.hls.levels[t].bitrate)}}};p||C>2*x?F():this.timer=self.setInterval(F,1e3*x),n.trigger(tB.FRAG_LOAD_EMERGENCY_ABORTED,{frag:r,part:a,stats:d})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}},bufferController:class extends tj{hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){let{hls:e}=this;e.on(tB.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(tB.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(tB.MANIFEST_LOADING,this.onManifestLoading,this),e.on(tB.MANIFEST_PARSED,this.onManifestParsed,this),e.on(tB.BUFFER_RESET,this.onBufferReset,this),e.on(tB.BUFFER_APPENDING,this.onBufferAppending,this),e.on(tB.BUFFER_CODECS,this.onBufferCodecs,this),e.on(tB.BUFFER_EOS,this.onBufferEos,this),e.on(tB.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(tB.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(tB.FRAG_PARSED,this.onFragParsed,this),e.on(tB.FRAG_CHANGED,this.onFragChanged,this),e.on(tB.ERROR,this.onError,this)}unregisterListeners(){let{hls:e}=this;e.off(tB.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(tB.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(tB.MANIFEST_LOADING,this.onManifestLoading,this),e.off(tB.MANIFEST_PARSED,this.onManifestParsed,this),e.off(tB.BUFFER_RESET,this.onBufferReset,this),e.off(tB.BUFFER_APPENDING,this.onBufferAppending,this),e.off(tB.BUFFER_CODECS,this.onBufferCodecs,this),e.off(tB.BUFFER_EOS,this.onBufferEos,this),e.off(tB.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(tB.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(tB.FRAG_PARSED,this.onFragParsed,this),e.off(tB.FRAG_CHANGED,this.onFragChanged,this),e.off(tB.ERROR,this.onError,this)}transferMedia(){let{media:e,mediaSource:t}=this;if(!e)return null;let i={};if(this.operationQueue){let e=this.isUpdating();e||this.operationQueue.removeBlockers();let t=this.isQueued();(e||t)&&this.warn("Transfering MediaSource with".concat(t?" operations in queue":"").concat(e?" updating SourceBuffer(s)":""," ").concat(this.operationQueue)),this.operationQueue.destroy()}let r=this.transferData;return!this.sourceBufferCount&&r&&r.mediaSource===t?tW(i,r.tracks):this.sourceBuffers.forEach(e=>{let[t]=e;t&&(i[t]=tW({},this.tracks[t]),this.removeBuffer(t)),e[0]=e[1]=null}),{media:e,mediaSource:t,tracks:i}}initTracks(){this.sourceBuffers=[[null,null],[null,null]],this.tracks={},this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var i;let r=2;(!t.audio||t.video)&&t.altAudio||(r=1),this.bufferCodecEventsTotal=r,this.log("".concat(r," bufferCodec event(s) expected.")),null!=(i=this.transferData)&&i.mediaSource&&this.sourceBufferCount&&r&&this.bufferCreated()}onMediaAttaching(e,t){let i=this.media=t.media;this.transferData=this.overrides=void 0;let r=t$(this.appendSource);if(r){let e=!!t.mediaSource;(e||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);let a=this.mediaSource=t.mediaSource||new r;if(this.assignMediaSource(a),e)this._objectUrl=i.src,this.attachTransferred();else{let e=this._objectUrl=self.URL.createObjectURL(a);if(this.appendSource)try{i.removeAttribute("src");let t=self.ManagedMediaSource;i.disableRemotePlayback=i.disableRemotePlayback||t&&a instanceof t,nB(i),function(e,t){let i=self.document.createElement("source");i.type="video/mp4",i.src=t,e.appendChild(i)}(i,e),i.load()}catch(t){i.src=e}else i.src=e}i.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,i;this.log("".concat((null==(t=this.transferData)?void 0:t.mediaSource)===e?"transferred":"created"," media source: ").concat(null==(i=e.constructor)?void 0:i.name)),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){let e=this.media,t=this.transferData;if(!t||!e)return;let i=this.tracks,r=t.tracks,a=r?Object.keys(r):null,n=a?a.length:0,s=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(r&&a&&n){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log("attachTransferred: (bufferCodecEventsTotal ".concat(this.bufferCodecEventsTotal,")\nrequired tracks: ").concat(iX(i,(e,t)=>"initSegment"===e?void 0:t),";\ntransfer tracks: ").concat(iX(r,(e,t)=>"initSegment"===e?void 0:t),"}")),!t0(r,i)){t.mediaSource=null,t.tracks=void 0;let a=e.currentTime,n=this.details,s=Math.max(a,(null==n?void 0:n.fragments[0].start)||0);return s-a>1?void this.log("attachTransferred: waiting for playback to reach new tracks start time ".concat(a," -> ").concat(s)):(this.warn('attachTransferred: resetting MediaSource for incompatible tracks ("'.concat(Object.keys(r),'"->"').concat(Object.keys(i),'") start time: ').concat(s," currentTime: ").concat(a)),this.onMediaDetaching(tB.MEDIA_DETACHING,{}),this.onMediaAttaching(tB.MEDIA_ATTACHING,t),void(e.currentTime=s))}this.transferData=void 0,a.forEach(e=>{let t=r[e];if(t){let i=t.buffer;if(i){let r=this.fragmentTracker,a=t.id;if(r.hasFragments(a)||r.hasParts(a)){let t=rL.getBuffered(i);r.detectEvictedFragments(e,t,a,null,!0)}let n=nH(e),s=[e,i];this.sourceBuffers[n]=s,i.updating&&this.operationQueue&&this.operationQueue.prependBlocker(e),this.trackSourceBuffer(e,t)}}}),s(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),s()}get mediaSourceOpenOrEnded(){var e;let t=null==(e=this.mediaSource)?void 0:e.readyState;return"open"===t||"ended"===t}onMediaDetaching(e,t){let i=!!t.transferMedia;this.transferData=this.overrides=void 0;let{media:r,mediaSource:a,_objectUrl:n}=this;if(a){if(this.log("media source ".concat(i?"transferring":"detaching")),i)this.sourceBuffers.forEach(e=>{let[t]=e;t&&this.removeBuffer(t)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){let e="open"===a.readyState;try{let t=a.sourceBuffers;for(let i=t.length;i--;)e&&t[i].abort(),a.removeSourceBuffer(t[i]);e&&a.endOfStream()}catch(e){this.warn("onMediaDetaching: ".concat(e.message," while calling endOfStream"))}}this.sourceBufferCount&&this.onBufferReset()}a.removeEventListener("sourceopen",this._onMediaSourceOpen),a.removeEventListener("sourceended",this._onMediaSourceEnded),a.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(a.removeEventListener("startstreaming",this._onStartStreaming),a.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}r&&(r.removeEventListener("emptied",this._onMediaEmptied),i||(n&&self.URL.revokeObjectURL(n),this.mediaSrc===n?(r.removeAttribute("src"),this.appendSource&&nB(r),r.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(tB.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(e=>{let[t]=e;t&&this.resetBuffer(t)}),this.initTracks()}resetBuffer(e){var t,i;let r=null==(t=this.tracks[e])?void 0:t.buffer;if(this.removeBuffer(e),r)try{null!=(i=this.mediaSource)&&i.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(r)}catch(t){this.warn("onBufferReset ".concat(e),t)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[nH(e)]=[null,null];let t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new nx(this.tracks)}onBufferCodecs(e,t){var i;let r=this.tracks,a=Object.keys(t);this.log('BUFFER_CODECS: "'.concat(a,'" (current SB count ').concat(this.sourceBufferCount,")"));let n="audiovideo"in t&&(r.audio||r.video)||r.audiovideo&&("audio"in t||"video"in t),s=!n&&this.sourceBufferCount&&this.media&&a.some(e=>!r[e]);if(n||s)return void this.warn('Unsupported transition between "'.concat(Object.keys(r),'" and "').concat(a,'" SourceBuffers'));a.forEach(e=>{var i,a;let{id:n,codec:s,levelCodec:o,container:l,metadata:d,supplemental:u}=t[e],h=r[e],c=null==(i=this.transferData)||null==(i=i.tracks)?void 0:i[e],m=null!=c&&c.buffer?c:h,f=(null==m?void 0:m.pendingCodec)||(null==m?void 0:m.codec),p=null==m?void 0:m.levelCodec;h||(h=r[e]={buffer:void 0,listeners:[],codec:s,supplemental:u,container:l,levelCodec:o,metadata:d,id:n});let g=iP(f,p),E=null==g?void 0:g.replace(nN,"$1"),y=iP(s,o),b=null==(a=y)?void 0:a.replace(nN,"$1");y&&g&&E!==b&&("audio"===e.slice(0,5)&&(y=iO(y,this.appendSource)),this.log("switching codec ".concat(f," to ").concat(y)),y!==(h.pendingCodec||h.codec)&&(h.pendingCodec=y),h.container=l,this.appendChangeType(e,l,y))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&(!(this.bufferCodecEventsTotal>1)||this.tracks.video||t.video||(null==(i=t.audio)?void 0:i.id)!=="main"||(this.log("Main audio-only"),this.bufferCodecEventsTotal=1),this.mediaSourceOpenOrEnded&&this.checkPendingTracks())}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{let i=this.tracks[t];return e[t]={id:i.id,container:i.container,codec:i.codec,levelCodec:i.levelCodec},e},{})}appendChangeType(e,t,i){let r="".concat(t,";codecs=").concat(i);this.append({label:"change-type=".concat(r),execute:()=>{let a=this.tracks[e];if(a){let n=a.buffer;null!=n&&n.changeType&&(this.log("changing ".concat(e," sourceBuffer type to ").concat(r)),n.changeType(r),a.codec=i,a.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:t=>{this.warn("Failed to change ".concat(e," SourceBuffer type"),t)}},e,this.isPending(this.tracks[e]))}blockAudio(e){var t;let i=e.start,r=i+.05*e.duration;if((null==(t=this.fragmentTracker.getAppendedFrag(i,tG.MAIN))?void 0:t.gap)===!0)return;let a={label:"block-audio",execute:()=>{var e;let t=this.tracks.video;(this.lastVideoAppendEnd>r||null!=t&&t.buffer&&rL.isBuffered(t.buffer,r)||(null==(e=this.fragmentTracker.getAppendedFrag(r,tG.MAIN))?void 0:e.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:e=>{this.warn("Error executing block-audio operation",e)}};this.blockedAudioAppend={op:a,frag:e},this.append(a,"audio",!0)}unblockAudio(){let{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){let{tracks:i}=this,{data:r,type:a,parent:n,frag:s,part:o,chunkMeta:l,offset:d}=t,u=l.buffering[a],{sn:h,cc:c}=s,m=self.performance.now();u.start=m;let f=s.stats.buffering,p=o?o.stats.buffering:null;0===f.start&&(f.start=m),p&&0===p.start&&(p.start=m);let g=i.audio,E=!1;"audio"===a&&(null==g?void 0:g.container)==="audio/mpeg"&&(E=!this.lastMpegAudioChunk||1===l.id||this.lastMpegAudioChunk.sn!==l.sn,this.lastMpegAudioChunk=l);let y=i.video,b=null==y?void 0:y.buffer;if(b&&"initSegment"!==h){let e=o||s,t=this.blockedAudioAppend;if("audio"!==a||"main"===n||this.blockedAudioAppend||y.ending||y.ended){if("video"===a){let i=e.end;if(t){let e=t.frag.start;(i>e||i<this.lastVideoAppendEnd||rL.isBuffered(b,e))&&this.unblockAudio()}this.lastVideoAppendEnd=i}}else{let t=e.start+.05*e.duration,i=b.buffered,r=this.currentOp("video");(i.length||r)&&(r||rL.isBuffered(b,t)||!(this.lastVideoAppendEnd<t))||this.blockAudio(e)}}let T=(o||s).start;this.log('queuing "'.concat(a,'" append sn: ').concat(h).concat(o?" p: "+o.index:""," of ").concat(s.type===tG.MAIN?"level":"track"," ").concat(s.level," cc: ").concat(c)),this.append({label:"append-".concat(a),execute:()=>{var e;u.executeStart=self.performance.now();let t=null==(e=this.tracks[a])?void 0:e.buffer;t&&(E?this.updateTimestampOffset(t,T,.1,a,h,c):void 0!==d&&tP(d)&&this.updateTimestampOffset(t,d,1e-6,a,h,c)),this.appendExecutor(r,a)},onStart:()=>{},onComplete:()=>{let e=self.performance.now();u.executeEnd=u.end=e,0===f.first&&(f.first=e),p&&0===p.first&&(p.first=e);let t={};this.sourceBuffers.forEach(e=>{let[i,r]=e;i&&(t[i]=rL.getBuffered(r))}),this.appendErrors[a]=0,"audio"===a||"video"===a?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(tB.BUFFER_APPENDED,{type:a,frag:s,part:o,chunkMeta:l,parent:s.type,timeRanges:t})},onError:e=>{var t;let i={type:tU.MEDIA_ERROR,parent:s.type,details:tF.BUFFER_APPEND_ERROR,sourceBufferName:a,frag:s,part:o,chunkMeta:l,error:e,err:e,fatal:!1},r=null==(t=this.media)?void 0:t.error;if(e.code===DOMException.QUOTA_EXCEEDED_ERR||"QuotaExceededError"==e.name||"quota"in e)i.details=tF.BUFFER_FULL_ERROR;else if(e.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!r)i.errorAction=rd(!0);else if(e.name===nU&&0===this.sourceBufferCount)i.errorAction=rd(!0);else{let e=++this.appendErrors[a];this.warn("Failed ".concat(e,"/").concat(this.hls.config.appendErrorMaxRetry,' times to append segment in "').concat(a,'" sourceBuffer (').concat(r||"no media error",")")),(e>=this.hls.config.appendErrorMaxRetry||r)&&(i.fatal=!0)}this.hls.trigger(tB.ERROR,i)}},a,this.isPending(this.tracks[a]))}getFlushOp(e,t,i){return this.log('queuing "'.concat(e,'" remove ').concat(t,"-").concat(i)),{label:"remove",execute:()=>{this.removeExecutor(e,t,i)},onStart:()=>{},onComplete:()=>{this.hls.trigger(tB.BUFFER_FLUSHED,{type:e})},onError:r=>{this.warn("Failed to remove ".concat(t,"-").concat(i,' from "').concat(e,'" SourceBuffer'),r)}}}onBufferFlushing(e,t){let{type:i,startOffset:r,endOffset:a}=t;i?this.append(this.getFlushOp(i,r,a),i):this.sourceBuffers.forEach(e=>{let[t]=e;t&&this.append(this.getFlushOp(t,r,a),t)})}onFragParsed(e,t){let{frag:i,part:r}=t,a=[],n=r?r.elementaryStreams:i.elementaryStreams;n[t9.AUDIOVIDEO]?a.push("audiovideo"):(n[t9.AUDIO]&&a.push("audio"),n[t9.VIDEO]&&a.push("video"));let s=()=>{let e=self.performance.now();i.stats.buffering.end=e,r&&(r.stats.buffering.end=e);let t=r?r.stats:i.stats;this.hls.trigger(tB.FRAG_BUFFERED,{frag:i,part:r,stats:t,id:i.type})};0===a.length&&this.warn("Fragments must have at least one ElementaryStreamType set. type: ".concat(i.type," level: ").concat(i.level," sn: ").concat(i.sn)),this.blockBuffers(s,a).catch(e=>{this.warn("Fragment buffered callback ".concat(e)),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(e=>{let[t]=e;if(t){let e=this.tracks[t];if(e)return!e.ended||e.ending}return!1})}onBufferEos(e,t){var i;this.sourceBuffers.forEach(e=>{let[i]=e;if(i){let e=this.tracks[i];(!t.type||t.type===i)&&(e.ending=!0,e.ended||(e.ended=!0,this.log("".concat(i," buffer reached EOS"))))}});let r=(null==(i=this.overrides)?void 0:i.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(e=>{var t;let[i]=e;return i&&!(null!=(t=this.tracks[i])&&t.ended)})?r?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();let{mediaSource:e}=this;if(!e||"open"!==e.readyState){e&&this.log("Could not call mediaSource.endOfStream(). mediaSource.readyState: ".concat(e.readyState));return}this.log("Calling mediaSource.endOfStream()"),e.endOfStream(),this.hls.trigger(tB.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(tB.BUFFERED_TO_END,void 0)):"video"===t.type&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(e=>{let[t]=e;if(null!==t){let e=this.tracks[t];e&&(e.ending=!1)}})}onLevelUpdated(e,t){let{details:i}=t;i.fragments.length&&(this.details=i,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{let e=this.getDurationAndRange();e&&this.updateMediaSource(e)})}onError(e,t){if(t.details===tF.BUFFER_APPEND_ERROR&&t.frag){var i;let e=null==(i=t.errorAction)?void 0:i.nextAutoLevel;tP(e)&&e!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){let{hls:e,details:t,media:i}=this;if(!i||null===t||!this.sourceBufferCount)return;let r=e.config,a=i.currentTime,n=t.levelTargetDuration,s=t.live&&null!==r.liveBackBufferLength?r.liveBackBufferLength:r.backBufferLength;if(tP(s)&&s>=0){let e=Math.max(s,n),t=Math.floor(a/n)*n-e;this.flushBackBuffer(a,n,t)}let o=r.frontBufferFlushThreshold;if(tP(o)&&o>0){let e=Math.max(Math.max(r.maxBufferLength,o),n),t=Math.floor(a/n)*n+e;this.flushFrontBuffer(a,n,t)}}flushBackBuffer(e,t,i){this.sourceBuffers.forEach(e=>{let[t,r]=e;if(r){let e=rL.getBuffered(r);if(e.length>0&&i>e.start(0)){var a;this.hls.trigger(tB.BACK_BUFFER_REACHED,{bufferEnd:i});let e=this.tracks[t];if(null!=(a=this.details)&&a.live)this.hls.trigger(tB.LIVE_BACK_BUFFER_REACHED,{bufferEnd:i});else if(null!=e&&e.ended)return void this.log("Cannot flush ".concat(t," back buffer while SourceBuffer is in ended state"));this.hls.trigger(tB.BUFFER_FLUSHING,{startOffset:0,endOffset:i,type:t})}}})}flushFrontBuffer(e,t,i){this.sourceBuffers.forEach(t=>{let[r,a]=t;if(a){let t=rL.getBuffered(a),n=t.length;if(n<2)return;let s=t.start(n-1),o=t.end(n-1);if(i>s||e>=s&&e<=o)return;this.hls.trigger(tB.BUFFER_FLUSHING,{startOffset:s,endOffset:1/0,type:r})}})}getDurationAndRange(){var e;let{details:t,mediaSource:i}=this;if(!t||!this.media||(null==i?void 0:i.readyState)!=="open")return null;let r=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&i.setLiveSeekableRange){let e=Math.max(0,t.fragmentStart),i=Math.max(e,r);return{duration:1/0,start:e,end:i}}return{duration:1/0}}let a=null==(e=this.overrides)?void 0:e.duration;if(a)return tP(a)?{duration:a}:null;let n=this.media.duration;return r>(tP(i.duration)?i.duration:0)&&r>n||!tP(n)?{duration:r}:null}updateMediaSource(e){let{duration:t,start:i,end:r}=e,a=this.mediaSource;this.media&&a&&"open"===a.readyState&&(a.duration!==t&&(tP(t)&&this.log("Updating MediaSource duration to ".concat(t.toFixed(3))),a.duration=t),void 0!==i&&void 0!==r&&(this.log("MediaSource duration is set to ".concat(a.duration,". Setting seekable range to ").concat(i,"-").concat(r,".")),a.setLiveSeekableRange(i,r)))}get tracksReady(){let e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){let{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:i}=this;if(this.log("checkPendingTracks (pending: ".concat(t," codec events expected: ").concat(e,") ").concat(iX(i))),this.tracksReady){var r;let e=null==(r=this.transferData)?void 0:r.tracks;e&&Object.keys(e).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){let e={};this.sourceBuffers.forEach(t=>{let[i,r]=t;if(i){let t=this.tracks[i];e[i]={buffer:r,container:t.container,codec:t.codec,supplemental:t.supplemental,levelCodec:t.levelCodec,id:t.id,metadata:t.metadata}}}),this.hls.trigger(tB.BUFFER_CREATED,{tracks:e}),this.log("SourceBuffers created. Running queue: ".concat(this.operationQueue)),this.sourceBuffers.forEach(e=>{let[t]=e;this.executeNext(t)})}else{let e=Error("could not create source buffer for media codec(s)");this.hls.trigger(tB.ERROR,{type:tU.MEDIA_ERROR,details:tF.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){let{tracks:e,sourceBuffers:t,mediaSource:i}=this;if(!i)throw Error("createSourceBuffers called when mediaSource was null");for(let a in e){let n=e[a];if(this.isPending(n)){let e=this.getTrackCodec(n,a),s="".concat(n.container,";codecs=").concat(e);n.codec=e,this.log("creating sourceBuffer(".concat(s,")").concat(this.currentOp(a)?" Queued":""," ").concat(iX(n)));try{let e=i.addSourceBuffer(s),r=nH(a),o=[a,e];t[r]=o,n.buffer=e}catch(e){var r;this.error("error while trying to add sourceBuffer: ".concat(e.message)),this.shiftAndExecuteNext(a),null==(r=this.operationQueue)||r.removeBlockers(),delete this.tracks[a],this.hls.trigger(tB.ERROR,{type:tU.MEDIA_ERROR,details:tF.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:e,sourceBufferName:a,mimeType:s,parent:n.id});return}this.trackSourceBuffer(a,n)}}this.bufferCreated()}getTrackCodec(e,t){let i=e.supplemental,r=e.codec;i&&("video"===t||"audiovideo"===t)&&iR(i,"video")&&(r=function(e,t){let i=[];if(e){let t=e.split(",");for(let e=0;e<t.length;e++)iI(t[e],"video")||i.push(t[e])}return t&&i.push(t),i.join(",")}(r,i));let a=iP(r,e.levelCodec);return a?"audio"===t.slice(0,5)?iO(a,this.appendSource):a:""}trackSourceBuffer(e,t){let i=t.buffer;if(!i)return;let r=this.getTrackCodec(t,e);this.tracks[e]={buffer:i,codec:r,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(e,t)=>{let i=t.removedRanges;null!=i&&i.length&&this.hls.trigger(tB.BUFFER_FLUSHED,{type:e})})}get mediaSrc(){var e,t;let i=(null==(e=this.media)||null==(t=e.querySelector)?void 0:t.call(e,"source"))||this.media;return null==i?void 0:i.src}onSBUpdateStart(e){let t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if((null==(t=this.mediaSource)?void 0:t.readyState)==="closed")return void this.resetBuffer(e);let i=this.currentOp(e);i&&(i.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var i;let r=Error("".concat(e," SourceBuffer error. MediaSource readyState: ").concat(null==(i=this.mediaSource)?void 0:i.readyState));this.error("".concat(r),t),this.hls.trigger(tB.ERROR,{type:tU.MEDIA_ERROR,details:tF.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:r,fatal:!1});let a=this.currentOp(e);a&&a.onError(r)}updateTimestampOffset(e,t,i,r,a,n){Math.abs(t-e.timestampOffset)>=i&&(this.log("Updating ".concat(r," SourceBuffer timestampOffset to ").concat(t," (sn: ").concat(a," cc: ").concat(n,")")),e.timestampOffset=t)}removeExecutor(e,t,i){let{media:r,mediaSource:a}=this,n=this.tracks[e],s=null==n?void 0:n.buffer;if(!r||!a||!s){this.warn("Attempting to remove from the ".concat(e," SourceBuffer, but it does not exist")),this.shiftAndExecuteNext(e);return}let o=tP(r.duration)?r.duration:1/0,l=tP(a.duration)?a.duration:1/0,d=Math.max(0,t),u=Math.min(i,o,l);u>d&&(!n.ending||n.ended)?(n.ended=!1,this.log("Removing [".concat(d,",").concat(u,"] from the ").concat(e," SourceBuffer")),s.remove(d,u)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){let i=this.tracks[t],r=null==i?void 0:i.buffer;if(!r)throw new nF("Attempting to append to the ".concat(t," SourceBuffer, but it does not exist"));i.ending=!1,i.ended=!1,r.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(e=>{this.warn("SourceBuffer blocked callback ".concat(e)),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(e){this.warn("Callback run without blocking ".concat(this.operationQueue," ").concat(e))}}isUpdating(){return this.sourceBuffers.some(e=>{let[t,i]=e;return t&&i.updating})}isQueued(){return this.sourceBuffers.some(e=>{let[t]=e;return t&&!!this.currentOp(t)})}isPending(e){return!!e&&!e.buffer}blockBuffers(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.sourceBufferTypes;if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);let{operationQueue:i}=this,r=t.map(e=>this.appendBlocker(e));return t.length>1&&this.blockedAudioAppend&&this.unblockAudio(),Promise.all(r).then(t=>{i===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(e=>{var t;let i=null==(t=this.tracks[e])?void 0:t.buffer;i&&!i.updating&&this.shiftAndExecuteNext(e)})}append(e,t,i){this.operationQueue&&this.operationQueue.append(e,t,i)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+ +!!this.isPending(this.tracks[t]),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,t)=>{let[i]=t;return e+ +!!i},0)}get sourceBufferTypes(){return this.sourceBuffers.map(e=>{let[t]=e;return t}).filter(e=>!!e)}addBufferListener(e,t,i){let r=this.tracks[e];if(!r)return;let a=r.buffer;if(!a)return;let n=i.bind(this,e);r.listeners.push({event:t,listener:n}),a.addEventListener(t,n)}removeBufferListeners(e){let t=this.tracks[e];if(!t)return;let i=t.buffer;i&&(t.listeners.forEach(e=>{i.removeEventListener(e.event,e.listener)}),t.listeners.length=0)}constructor(e,t){var i;super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=e=>{var t;this.hls&&(null==(t=this.mediaSource)?void 0:t.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=e=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=e=>{let{media:t,mediaSource:i}=this;e&&this.log("Media source opened"),t&&i&&(i.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(tB.MEDIA_ATTACHED,{media:t,mediaSource:i}),null!==this.mediaSource&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{let{mediaSrc:e,_objectUrl:t}=this;e!==t&&this.error("Media element src was set while attaching MediaSource (".concat(t," > ").concat(e,")"))},this.hls=e,this.fragmentTracker=t,this.appendSource=(i=t$(e.config.preferManagedMediaSource),"undefined"!=typeof self&&i===self.ManagedMediaSource),this.initTracks(),this.registerListeners()}},capLevelController:nG,errorController:class extends tj{registerListeners(){let e=this.hls;e.on(tB.ERROR,this.onError,this),e.on(tB.MANIFEST_LOADING,this.onManifestLoading,this),e.on(tB.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){let e=this.hls;e&&(e.off(tB.ERROR,this.onError,this),e.off(tB.ERROR,this.onErrorOut,this),e.off(tB.MANIFEST_LOADING,this.onManifestLoading,this),e.off(tB.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return(null==e?void 0:e.type)===tG.MAIN?e.level:this.getVariantIndex()}getVariantIndex(){var e;let t=this.hls,i=t.currentLevel;return null!=(e=t.loadLevelObj)&&e.details||-1===i?t.loadLevel:i}variantHasKey(e,t){if(e){var i;if(null!=(i=e.details)&&i.hasKey(t))return!0;let r=e.audioGroups;if(r)return this.hls.allAudioTracks.filter(e=>r.indexOf(e.groupId)>=0).some(e=>{var i;return null==(i=e.details)?void 0:i.hasKey(t)})}return!1}onManifestLoading(){this.playlistError=0}onLevelUpdated(){this.playlistError=0}onError(e,t){var i,r,a;if(t.fatal)return;let n=this.hls,s=t.context;switch(t.details){case tF.FRAG_LOAD_ERROR:case tF.FRAG_LOAD_TIMEOUT:case tF.KEY_LOAD_ERROR:case tF.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case tF.FRAG_PARSING_ERROR:if(null!=(i=t.frag)&&i.gap){t.errorAction=rd();return}case tF.FRAG_GAP:case tF.FRAG_DECRYPT_ERROR:t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=ro.SendAlternateToPenaltyBox;return;case tF.LEVEL_EMPTY_ERROR:case tF.LEVEL_PARSING_ERROR:{let e=t.parent===tG.MAIN?t.level:n.loadLevel;t.details===tF.LEVEL_EMPTY_ERROR&&null!=(r=t.context)&&null!=(r=r.levelDetails)&&r.live?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,e):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,e))}return;case tF.LEVEL_LOAD_ERROR:case tF.LEVEL_LOAD_TIMEOUT:"number"==typeof(null==s?void 0:s.level)&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,s.level));return;case tF.AUDIO_TRACK_LOAD_ERROR:case tF.AUDIO_TRACK_LOAD_TIMEOUT:case tF.SUBTITLE_LOAD_ERROR:case tF.SUBTITLE_TRACK_LOAD_TIMEOUT:if(s){let e=n.loadLevelObj;e&&(s.type===tH.AUDIO_TRACK&&e.hasAudioGroup(s.groupId)||s.type===tH.SUBTITLE_TRACK&&e.hasSubtitleGroup(s.groupId))&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,n.loadLevel),t.errorAction.action=ro.SendAlternateToPenaltyBox,t.errorAction.flags=rl.MoveAllAlternatesMatchingHost)}return;case tF.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:t.errorAction={action:ro.SendAlternateToPenaltyBox,flags:rl.MoveAllAlternatesMatchingHDCP};return;case tF.KEY_SYSTEM_SESSION_UPDATE_FAILED:case tF.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case tF.KEY_SYSTEM_NO_SESSION:t.errorAction={action:ro.SendAlternateToPenaltyBox,flags:rl.MoveAllAlternatesMatchingKey};return;case tF.BUFFER_ADD_CODEC_ERROR:case tF.REMUX_ALLOC_ERROR:case tF.BUFFER_APPEND_ERROR:t.errorAction||(t.errorAction=this.getLevelSwitchAction(t,null!=(a=t.level)?a:n.loadLevel));return;case tF.INTERNAL_EXCEPTION:case tF.BUFFER_APPENDING_ERROR:case tF.BUFFER_FULL_ERROR:case tF.LEVEL_SWITCH_ERROR:case tF.BUFFER_STALLED_ERROR:case tF.BUFFER_SEEK_OVER_HOLE:case tF.BUFFER_NUDGE_ON_STALL:t.errorAction=rd();return}t.type===tU.KEY_SYSTEM_ERROR&&(t.levelRetry=!1,t.errorAction=rd())}getPlaylistRetryOrSwitchAction(e,t){let i=ri(this.hls.config.playlistLoadPolicy,e),r=this.playlistError++;if(rn(i,r,i7(e),e.response))return{action:ro.RetryRequest,flags:rl.None,retryConfig:i,retryCount:r};let a=this.getLevelSwitchAction(e,t);return i&&(a.retryConfig=i,a.retryCount=r),a}getFragRetryOrSwitchAction(e){let t=this.hls,i=this.getVariantLevelIndex(e.frag),r=t.levels[i],{fragLoadPolicy:a,keyLoadPolicy:n}=t.config,s=ri(re(e)?n:a,e),o=t.levels.reduce((e,t)=>e+t.fragmentError,0);if(r&&(e.details!==tF.FRAG_GAP&&r.fragmentError++,!rt(e))&&rn(s,o,i7(e),e.response))return{action:ro.RetryRequest,flags:rl.None,retryConfig:s,retryCount:o};let l=this.getLevelSwitchAction(e,i);return s&&(l.retryConfig=s,l.retryCount=o),l}getLevelSwitchAction(e,t){let i=this.hls;null==t&&(t=i.loadLevel);let r=this.hls.levels[t];if(r){var a,n,s,o;let t=e.details;r.loadError++,t===tF.BUFFER_APPEND_ERROR&&r.fragmentError++;let l=-1,{levels:d,loadLevel:u,minAutoLevel:h,maxAutoLevel:c}=i;i.autoLevelEnabled||i.config.preserveManualLevelOnError||(i.loadLevel=-1);let m=null==(a=e.frag)?void 0:a.type,f=(m===tG.AUDIO&&t===tF.FRAG_PARSING_ERROR||"audio"===e.sourceBufferName&&(t===tF.BUFFER_ADD_CODEC_ERROR||t===tF.BUFFER_APPEND_ERROR))&&d.some(e=>{let{audioCodec:t}=e;return r.audioCodec!==t}),p="video"===e.sourceBufferName&&(t===tF.BUFFER_ADD_CODEC_ERROR||t===tF.BUFFER_APPEND_ERROR)&&d.some(e=>{let{codecSet:t,audioCodec:i}=e;return r.codecSet!==t&&r.audioCodec===i}),{type:g,groupId:E}=null!=(n=e.context)?n:{};for(let i=d.length;i--;){let a=(i+u)%d.length;if(a!==u&&a>=h&&a<=c&&0===d[a].loadError){let i=d[a];if(t===tF.FRAG_GAP&&m===tG.MAIN&&e.frag){let t=d[a].details;if(t){let i=i8(e.frag,t.fragments,e.frag.start);if(null!=i&&i.gap)continue}}else if(g===tH.AUDIO_TRACK&&i.hasAudioGroup(E)||g===tH.SUBTITLE_TRACK&&i.hasSubtitleGroup(E))continue;else if(m===tG.AUDIO&&null!=(s=r.audioGroups)&&s.some(e=>i.hasAudioGroup(e))||m===tG.SUBTITLE&&null!=(o=r.subtitleGroups)&&o.some(e=>i.hasSubtitleGroup(e))||f&&r.audioCodec===i.audioCodec||p&&r.codecSet===i.codecSet||!f&&r.codecSet!==i.codecSet)continue;l=a;break}}if(l>-1&&i.loadLevel!==l)return e.levelRetry=!0,this.playlistError=0,{action:ro.SendAlternateToPenaltyBox,flags:rl.None,nextAutoLevel:l}}return{action:ro.SendAlternateToPenaltyBox,flags:rl.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var i;switch(null==(i=t.errorAction)?void 0:i.action){case ro.DoNothing:break;case ro.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),t.errorAction.resolved||t.details===tF.FRAG_GAP?/MediaSource readyState: ended/.test(t.error.message)&&(this.warn('MediaSource ended after "'.concat(t.sourceBufferName,'" sourceBuffer append error. Attempting to recover from media error.')),this.hls.recoverMediaError()):t.fatal=!0;case ro.RetryRequest:}if(t.fatal)return void this.hls.stopLoad()}sendAlternateToPenaltyBox(e){let t=this.hls,i=e.errorAction;if(!i)return;let{flags:r}=i,a=i.nextAutoLevel;switch(r){case rl.None:this.switchLevel(e,a);break;case rl.MoveAllAlternatesMatchingHDCP:{let r=this.getVariantLevelIndex(e.frag),a=t.levels[r],n=null==a?void 0:a.attrs["HDCP-LEVEL"];if(i.hdcpLevel=n,"NONE"===n)this.warn("HDCP policy resticted output with HDCP-LEVEL=NONE");else if(n){t.maxHdcpLevel=iV[iV.indexOf(n)-1],i.resolved=!0,this.warn('Restricting playback to HDCP-LEVEL of "'.concat(t.maxHdcpLevel,'" or lower'));break}}case rl.MoveAllAlternatesMatchingKey:{let t=e.decryptdata;if(t){let r=this.hls.levels,a=r.length;for(let i=a;i--;)if(this.variantHasKey(r[i],t)){var n,s;this.log("Banned key found in level ".concat(i," (").concat(r[i].bitrate,'bps) or audio group "').concat(null==(n=r[i].audioGroups)?void 0:n.join(","),'" (').concat(null==(s=e.frag)?void 0:s.type," fragment) ").concat(t2(t.keyId||[]))),r[i].fragmentError++,r[i].loadError++,this.log("Removing level ".concat(i," with key error (").concat(e.error,")")),this.hls.removeLevel(i)}let o=e.frag;if(this.hls.levels.length<a)i.resolved=!0;else if(o&&o.type!==tG.MAIN){let e=o.decryptdata;e&&!t.matches(e)&&(i.resolved=!0)}}}}i.resolved||this.switchLevel(e,a)}switchLevel(e,t){if(void 0!==t&&e.errorAction&&(this.warn("switching to level ".concat(t," after ").concat(e.details)),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===tF.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&"audiovideo"!==e.sourceBufferName)){let t=iU(e.mimeType),i=this.hls.levels;for(let r=i.length;r--;)i[r]["".concat(e.sourceBufferName,"Codec")]===t&&(this.log("Removing level ".concat(r," for ").concat(e.details,' ("').concat(t,'" not supported)')),this.hls.removeLevel(r))}}constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.hls=e,this.registerListeners()}},fpsController:class{setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(tB.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(tB.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(tB.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(tB.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){let i=this.hls.config;if(i.capLevelOnFPSDrop){let e=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=e,e&&"function"==typeof e.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),i.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,i){let r=performance.now();if(t){if(this.lastTime){let e=r-this.lastTime,a=i-this.lastDroppedFrames,n=t-this.lastDecodedFrames,s=1e3*a/e,o=this.hls;if(o.trigger(tB.FPS_DROP,{currentDropped:a,currentDecoded:n,totalDroppedFrames:i}),s>0&&a>o.config.fpsDroppedMonitoringThreshold*n){let e=o.currentLevel;o.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+e),e>0&&(-1===o.autoLevelCapping||o.autoLevelCapping>=e)&&(e-=1,o.trigger(tB.FPS_DROP_LEVEL_CAPPING,{level:e,droppedLevel:o.currentLevel}),o.autoLevelCapping=e,this.streamController.nextLevelSwitch())}}this.lastTime=r,this.lastDroppedFrames=i,this.lastDecodedFrames=t}}checkFPSInterval(){let e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){let t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}},stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:rX,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null}},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},{cueHandler:oT,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:class extends aI{onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();let{hls:e}=this;e.on(tB.LEVEL_LOADED,this.onLevelLoaded,this),e.on(tB.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(tB.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(tB.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(tB.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(tB.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();let{hls:e}=this;e.off(tB.LEVEL_LOADED,this.onLevelLoaded,this),e.off(tB.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(tB.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(tB.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(tB.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(tB.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=aS.IDLE,this.setInterval(500),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){let i,{frag:r,success:a}=t;if(this.fragContextChanged(r)||(t7(r)&&(this.fragPrevious=r),this.state=aS.IDLE),!a)return;let n=this.tracksBuffered[this.currentTrackId];if(!n)return;let s=r.start;for(let e=0;e<n.length;e++)if(s>=n[e].start&&s<=n[e].end){i=n[e];break}let o=r.start+r.duration;i?i.end=o:(i={start:s,end:o},n.push(i)),this.fragmentTracker.fragBuffered(r),this.fragBufferedComplete(r,null),this.media&&this.tick()}onBufferFlushing(e,t){let{startOffset:i,endOffset:r}=t;if(0===i&&r!==1/0){let e=r-1;if(e<=0)return;t.endOffsetSubtitles=Math.max(0,e),this.tracksBuffered.forEach(t=>{for(let i=0;i<t.length;){if(t[i].end<=e){t.shift();continue}if(t[i].start<e)t[i].start=e;else break;i++}}),this.fragmentTracker.removeFragmentsInRange(i,e,tG.SUBTITLE)}}onError(e,t){let i=t.frag;(null==i?void 0:i.type)===tG.SUBTITLE&&(t.details===tF.FRAG_GAP&&this.fragmentTracker.fragBuffered(i,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==aS.STOPPED&&(this.state=aS.IDLE))}onSubtitleTracksUpdated(e,t){let{subtitleTracks:i}=t;if(this.levels&&nM(this.levels,i)){this.levels=i.map(e=>new iQ(e));return}this.tracksBuffered=[],this.levels=i.map(e=>{let t=new iQ(e);return this.tracksBuffered[t.id]=[],t}),this.fragmentTracker.removeFragmentsInRange(0,1/0,tG.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var i;if(this.currentTrackId=t.id,!(null!=(i=this.levels)&&i.length)||-1===this.currentTrackId)return void this.clearInterval();let r=this.levels[this.currentTrackId];null!=r&&r.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,r&&this.state!==aS.STOPPED&&this.setInterval(500)}onSubtitleTrackLoaded(e,t){var i,r;let{currentTrackId:a,levels:n}=this,{details:s,id:o}=t;if(!n)return void this.warn("Subtitle tracks were reset while loading level ".concat(o));let l=n[o];if(o>=n.length||!l)return;this.log("Subtitle track ".concat(o," loaded [").concat(s.startSN,",").concat(s.endSN,"]").concat(s.lastPartSn?"[part-".concat(s.lastPartSn,"-").concat(s.lastPartIndex,"]"):"",",duration:").concat(s.totalduration)),this.mediaBuffer=this.mediaBufferTimeRanges;let d=0;if(s.live||null!=(i=l.details)&&i.live){if(s.deltaUpdateFailed)return;let e=this.mainDetails;if(!e){this.startFragRequested=!1;return}let t=e.fragments[0];l.details?0===(d=this.alignPlaylists(s,l.details,null==(r=this.levelLastLoaded)?void 0:r.details))&&t&&ad(s,d=t.start):s.hasProgramDateTime&&e.hasProgramDateTime?(ab(s,e),d=s.fragmentStart):t&&ad(s,d=t.start),e&&!this.startFragRequested&&this.setStartPosition(e,d)}l.details=s,this.levelLastLoaded=l,o===a&&(this.hls.trigger(tB.SUBTITLE_TRACK_UPDATED,{details:s,id:o,groupId:t.groupId}),this.tick(),s.live&&!this.fragCurrent&&this.media&&this.state===aS.IDLE&&(i8(null,s.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),l.details=void 0)))}_handleFragmentLoadComplete(e){let{frag:t,payload:i}=e,r=t.decryptdata,a=this.hls;if(!this.fragContextChanged(t)&&i&&i.byteLength>0&&null!=r&&r.key&&r.iv&&rB(r.method)){let e=performance.now();this.decrypter.decrypt(new Uint8Array(i),r.key.buffer,r.iv.buffer,rH(r.method)).catch(e=>{throw a.trigger(tB.ERROR,{type:tU.MEDIA_ERROR,details:tF.FRAG_DECRYPT_ERROR,fatal:!1,error:e,reason:e.message,frag:t}),e}).then(i=>{let r=performance.now();a.trigger(tB.FRAG_DECRYPTED,{frag:t,payload:i,stats:{tstart:e,tdecrypt:r}})}).catch(e=>{this.warn("".concat(e.name,": ").concat(e.message)),this.state=aS.IDLE})}}doTick(){if(!this.media){this.state=aS.IDLE;return}if(this.state===aS.IDLE){let{currentTrackId:e,levels:t}=this,i=null==t?void 0:t[e];if(!i||!t.length||!i.details||this.waitForLive(i))return;let{config:r}=this,a=this.getLoadPosition(),{end:n,len:s}=rL.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],a,r.maxBufferHole),o=i.details;if(s>this.hls.maxBufferLength+o.levelTargetDuration)return;let l=o.fragments,d=l.length,u=o.edge,h=null,c=this.fragPrevious;if(n<u){let e=r.maxFragLookUpTolerance;(h=i8(c,l,Math.max(l[0].start,n),n>u-e?0:e))||!c||!(c.start<l[0].start)||(h=l[0])}else h=l[d-1];if(!(h=this.filterReplacedPrimary(h,i.details)))return;let m=l[h.sn-o.startSN-1];if(m&&m.cc===h.cc&&this.fragmentTracker.getState(m)===ru.NOT_LOADED&&(h=m),this.fragmentTracker.getState(h)===ru.NOT_LOADED){let e=this.mapToInitFragWhenRequired(h);e&&this.loadFragment(e,i,n)}}}loadFragment(e,t,i){t7(e)?super.loadFragment(e,t,i):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new sH(this.tracksBuffered[this.currentTrackId]||[])}constructor(e,t,i){super(e,t,i,"subtitle-stream-controller",tG.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}},subtitleTrackController:class extends nC{destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){let{hls:e}=this;e.on(tB.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(tB.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(tB.MANIFEST_LOADING,this.onManifestLoading,this),e.on(tB.MANIFEST_PARSED,this.onManifestParsed,this),e.on(tB.LEVEL_LOADING,this.onLevelLoading,this),e.on(tB.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(tB.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(tB.ERROR,this.onError,this)}unregisterListeners(){let{hls:e}=this;e.off(tB.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(tB.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(tB.MANIFEST_LOADING,this.onManifestLoading,this),e.off(tB.MANIFEST_PARSED,this.onManifestParsed,this),e.off(tB.LEVEL_LOADING,this.onLevelLoading,this),e.off(tB.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(tB.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(tB.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){let i=this.media;if(!i)return;let r=!!t.transferMedia;self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||i.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,r||sR(i.textTracks).forEach(e=>{sS(e)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){let{id:i,groupId:r,details:a}=t,n=this.tracksInGroup[i];if(!n||n.groupId!==r)return void this.warn("Subtitle track with id:".concat(i," and group:").concat(r," not found in active group ").concat(null==n?void 0:n.groupId));let s=n.details;n.details=t.details,this.log("Subtitle track ".concat(i,' "').concat(n.name,'" lang:').concat(n.lang," group:").concat(r," loaded [").concat(a.startSN,"-").concat(a.endSN,"]")),i===this.trackId&&this.playlistLoaded(i,t,s)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){let t=this.hls.levels[e];if(!t)return;let i=t.subtitleGroups||null,r=this.groupIds,a=this.currentTrack;if(!i||(null==r?void 0:r.length)!==(null==i?void 0:i.length)||null!=i&&i.some(e=>(null==r?void 0:r.indexOf(e))===-1)){this.groupIds=i,this.trackId=-1,this.currentTrack=null;let e=this.tracks.filter(e=>!i||-1!==i.indexOf(e.groupId));if(e.length)this.selectDefaultTrack&&!e.some(e=>e.default)&&(this.selectDefaultTrack=!1),e.forEach((e,t)=>{e.id=t});else if(!a&&!this.tracksInGroup.length)return;this.tracksInGroup=e;let t=this.hls.config.subtitlePreference;if(!a&&t){this.selectDefaultTrack=!1;let i=i0(t,e);if(i>-1)a=e[i];else{let e=i0(t,this.tracks);a=this.tracks[e]}}let r=this.findTrackId(a);-1===r&&a&&(r=this.findTrackId(null)),this.log("Updating subtitle tracks, ".concat(e.length,' track(s) found in "').concat(null==i?void 0:i.join(","),'" group-id')),this.hls.trigger(tB.SUBTITLE_TRACKS_UPDATED,{subtitleTracks:e}),-1!==r&&-1===this.trackId&&this.setSubtitleTrack(r)}}findTrackId(e){let t=this.tracksInGroup,i=this.selectDefaultTrack;for(let r=0;r<t.length;r++){let a=t[r];if((!i||a.default)&&(i||e)&&(!e||i1(a,e)))return r}if(e){for(let i=0;i<t.length;i++){let r=t[i];if(nO(e.attrs,r.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return i}for(let i=0;i<t.length;i++){let r=t[i];if(nO(e.attrs,r.attrs,["LANGUAGE"]))return i}}return -1}findTrackForTextTrack(e){if(e){let t=this.tracksInGroup;for(let i=0;i<t.length;i++)if(nP(t[i],e))return i}return -1}onError(e,t){!t.fatal&&t.context&&(t.context.type!==tH.SUBTITLE_TRACK||t.context.id!==this.trackId||this.groupIds&&-1===this.groupIds.indexOf(t.context.groupId)||this.checkRetry(t))}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(-1===e.id)return this.setSubtitleTrack(-1),null;let t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){let i=this.currentTrack;if(i&&i1(e,i))return i;let r=i0(e,this.tracksInGroup);if(r>-1){let e=this.tracksInGroup[r];return this.setSubtitleTrack(r),e}{if(i)return null;let r=i0(e,t);if(r>-1)return t[r]}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);let i=e.id,r=e.groupId,a=this.getUrlWithDirectives(e.url,t),n=e.details,s=null==n?void 0:n.age;this.log("Loading subtitle ".concat(i,' "').concat(e.name,'" lang:').concat(e.lang," group:").concat(r).concat((null==t?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:"").concat(s&&n.live?" age "+s.toFixed(1)+(n.type?" "+n.type:""):""," ").concat(a)),this.hls.trigger(tB.SUBTITLE_TRACK_LOADING,{url:a,id:i,groupId:r,deliveryDirectives:t||null,track:e})}toggleTrackModes(){let e,{media:t}=this;if(!t)return;let i=sR(t.textTracks),r=this.currentTrack;if(r&&((e=i.filter(e=>nP(r,e))[0])||this.warn('Unable to find subtitle TextTrack with name "'.concat(r.name,'" and language "').concat(r.lang,'"'))),[].slice.call(i).forEach(t=>{"disabled"!==t.mode&&t!==e&&(t.mode="disabled")}),e){let t=this.subtitleDisplay?"showing":"hidden";e.mode!==t&&(e.mode=t)}}setSubtitleTrack(e){let t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!tP(e))return void this.warn("Invalid subtitle track id: ".concat(e));this.selectDefaultTrack=!1;let i=this.currentTrack,r=t[e]||null;if(this.trackId=e,this.currentTrack=r,this.toggleTrackModes(),!r)return void this.hls.trigger(tB.SUBTITLE_TRACK_SWITCH,{id:e});let a=!!r.details&&!r.details.live;if(e===this.trackId&&r===i&&a)return;this.log("Switching to subtitle-track ".concat(e)+(r?' "'.concat(r.name,'" lang:').concat(r.lang," group:").concat(r.groupId):""));let{id:n,groupId:s="",name:o,type:l,url:d}=r;this.hls.trigger(tB.SUBTITLE_TRACK_SWITCH,{id:n,groupId:s,name:o,type:l,url:d});let u=this.switchParams(r.url,null==i?void 0:i.details,r.details);this.loadPlaylist(u)}constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let e=null,t=sR(this.media.textTracks);for(let i=0;i<t.length;i++)if("hidden"===t[i].mode)e=t[i];else if("showing"===t[i].mode){e=t[i];break}let i=this.findTrackForTextTrack(e);this.subtitleTrack!==i&&this.setSubtitleTrack(i)},this.registerListeners()}},timelineController:class{destroy(){let{hls:e}=this;e.off(tB.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(tB.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(tB.MANIFEST_LOADING,this.onManifestLoading,this),e.off(tB.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(tB.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(tB.FRAG_LOADING,this.onFragLoading,this),e.off(tB.FRAG_LOADED,this.onFragLoaded,this),e.off(tB.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(tB.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(tB.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(tB.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(tB.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){let e=new og(this,"textTrack1"),t=new og(this,"textTrack2"),i=new og(this,"textTrack3"),r=new og(this,"textTrack4");this.cea608Parser1=new s1(1,e,t),this.cea608Parser2=new s1(3,i,r)}addCues(e,t,i,r,a){let n=!1;for(let e=a.length;e--;){var s,o;let r=a[e],l=(s=r[0],o=r[1],Math.min(o,i)-Math.max(s,t));if(l>=0&&(r[0]=Math.min(r[0],t),r[1]=Math.max(r[1],i),n=!0,l/(i-t)>.5))return}if(n||a.push([t,i]),this.config.renderTextTracksNatively){let a=this.captionsTracks[e];this.Cues.newCue(a,t,i,r)}else{let a=this.Cues.newCue(null,t,i,r);this.hls.trigger(tB.CUES_PARSED,{type:"captions",cues:a,track:e})}}onInitPtsFound(e,t){let{frag:i,id:r,initPTS:a,timescale:n,trackId:s}=t,{unparsedVttFrags:o}=this;r===tG.MAIN&&(this.initPTS[i.cc]={baseTime:a,timescale:n,trackId:s}),o.length&&(this.unparsedVttFrags=[],o.forEach(e=>{this.initPTS[e.frag.cc]?this.onFragLoaded(tB.FRAG_LOADED,e):this.hls.trigger(tB.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e.frag,error:Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(e,t){let{media:i}=this;if(i)for(let r=0;r<i.textTracks.length;r++){let a=i.textTracks[r];if(oE(a,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return a}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;let{captionsProperties:t,captionsTracks:i,media:r}=this,{label:a,languageCode:n}=t[e],s=this.getExistingTrack(a,n);if(s)i[e]=s,sS(i[e]),s_(i[e],r);else{let t=this.createTextTrack("captions",a,n);t&&(t[e]=!0,i[e]=t)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;let t=this.captionsProperties[e];if(!t)return;let i={_id:e,label:t.label,kind:"captions",default:!!t.media&&!!t.media.default,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=i,this.hls.trigger(tB.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[i]})}createTextTrack(e,t,i){let r=this.media;if(r)return r.addTextTrack(e,t,i)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){let i=!!t.transferMedia;if(this.media=null,i)return;let{captionsTracks:r}=this;Object.keys(r).forEach(e=>{sS(r[e]),delete r[e]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=oy(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){let{media:e}=this;if(!e)return;let t=e.textTracks;if(t)for(let e=0;e<t.length;e++)sS(t[e])}onSubtitleTracksUpdated(e,t){let i=t.subtitleTracks||[],r=i.some(e=>e.textCodec===os);if(this.config.enableWebVTT||r&&this.config.enableIMSC1){if(nM(this.tracks,i)){this.tracks=i;return}if(this.textTracks=[],this.tracks=i,this.config.renderTextTracksNatively){let e=this.media,t=e?sR(e.textTracks):null;if(this.tracks.forEach((e,i)=>{let r;if(t){let i=null;for(let r=0;r<t.length;r++)if(t[r]&&oE(t[r],e)){i=t[r],t[r]=null;break}i&&(r=i)}if(r)sS(r);else{let t=ov(e);(r=this.createTextTrack(t,e.name,e.lang))&&(r.mode="disabled")}r&&this.textTracks.push(r)}),null!=t&&t.length){let e=t.filter(e=>null!==e).map(e=>e.label);e.length&&this.hls.logger.warn("Media element contains unused subtitle tracks: ".concat(e.join(", "),". Replace media element for each source to clear TextTracks and captions menu."))}}else if(this.tracks.length){let e=this.tracks.map(e=>({label:e.name,kind:e.type.toLowerCase(),default:e.default,subtitleTrack:e}));this.hls.trigger(tB.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:e})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(e=>{let t=/(?:CC|SERVICE)([1-4])/.exec(e.instreamId);if(!t)return;let i="textTrack".concat(t[1]),r=this.captionsProperties[i];r&&(r.label=e.name,e.lang&&(r.languageCode=e.lang),r.media=e)})}closedCaptionsForLevel(e){let t=this.hls.levels[e.level];return null==t?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===tG.MAIN){var i,r;let{cea608Parser1:e,cea608Parser2:a,lastSn:n}=this,{cc:s,sn:o}=t.frag,l=null!=(i=null==(r=t.part)?void 0:r.index)?i:-1;e&&a&&(o!==n+1||o===n&&l!==this.lastPartIndex+1||s!==this.lastCc)&&(e.reset(),a.reset()),this.lastCc=s,this.lastSn=o,this.lastPartIndex=l}}onFragLoaded(e,t){let{frag:i,payload:r}=t;if(i.type===tG.SUBTITLE)if(r.byteLength){let e=i.decryptdata,a="stats"in t;if(null==e||!e.encrypted||a){let e=this.tracks[i.level],a=this.vttCCs;a[i.cc]||(a[i.cc]={start:i.start,prevCC:this.prevCC,new:!0},this.prevCC=i.cc),e&&e.textCodec===os?this._parseIMSC1(i,r):this._parseVTTs(t)}}else this.hls.trigger(tB.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:Error("Empty subtitle payload")})}_parseIMSC1(e,t){let i=this.hls;ou(t,this.initPTS[e.cc],t=>{this._appendCues(t,e.level),i.trigger(tB.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},t=>{i.logger.log("Failed to parse IMSC1: ".concat(t)),i.trigger(tB.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:t})})}_parseVTTs(e){var t;let{frag:i,payload:r}=e,{initPTS:a,unparsedVttFrags:n}=this,s=a.length-1;if(!a[i.cc]&&-1===s)return void n.push(e);let o=this.hls;!function(e,t,i,r,a,n,s){let o,l=new oe,d=t1(new Uint8Array(e)).trim().replace(ot,"\n").split("\n"),u=[],h=t?function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return nc(e,9e4,1/t)}(t.baseTime,t.timescale):0,c="00:00.000",m=0,f=0,p=!0;l.oncue=function(e){let n=i[r],s=i.ccOffset,l=(m-h)/9e4;if(null!=n&&n.new&&(void 0!==f?s=i.ccOffset=n.start:on(i,r,l)),l){if(!t){o=Error("Missing initPTS for VTT MPEGTS");return}s=l-i.presentationOffset}let d=e.endTime-e.startTime,c=nE((e.startTime+s-f)*9e4,9e4*a)/9e4;e.startTime=Math.max(c,0),e.endTime=Math.max(c+d,0);let p=e.text.trim();e.text=decodeURIComponent(encodeURIComponent(p)),e.id||(e.id=oa(e.startTime,e.endTime,p)),e.endTime>0&&u.push(e)},l.onparsingerror=function(e){o=e},l.onflush=function(){if(o)return void s(o);n(u)},d.forEach(e=>{if(p)if(oi(e,"X-TIMESTAMP-MAP=")){p=!1,e.slice(16).split(",").forEach(e=>{oi(e,"LOCAL:")?c=e.slice(6):oi(e,"MPEGTS:")&&(m=parseInt(e.slice(7)))});try{f=or(c)/1e3}catch(e){o=e}return}else""===e&&(p=!1);l.parse(e+"\n")}),l.flush()}(null!=(t=i.initSegment)&&t.data?iE(i.initSegment.data,new Uint8Array(r)).buffer:r,this.initPTS[i.cc],this.vttCCs,i.cc,i.start,e=>{this._appendCues(e,i.level),o.trigger(tB.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:i})},t=>{let a="Missing initPTS for VTT MPEGTS"===t.message;a?n.push(e):this._fallbackToIMSC1(i,r),o.logger.log("Failed to parse VTT cue: ".concat(t)),a&&s>i.cc||o.trigger(tB.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:t})})}_fallbackToIMSC1(e,t){let i=this.tracks[e.level];i.textCodec||ou(t,this.initPTS[e.cc],()=>{i.textCodec=os,this._parseIMSC1(e,t)},()=>{i.textCodec="wvtt"})}_appendCues(e,t){let i=this.hls;if(this.config.renderTextTracksNatively){let i=this.textTracks[t];if(!i||"disabled"===i.mode)return;e.forEach(e=>sA(i,e))}else{let r=this.tracks[t];if(!r)return;let a=r.default?"default":"subtitles"+t;i.trigger(tB.CUES_PARSED,{type:"subtitles",cues:e,track:a})}}onFragDecrypted(e,t){let{frag:i}=t;i.type===tG.SUBTITLE&&this.onFragLoaded(tB.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;let{frag:i,samples:r}=t;if(i.type!==tG.MAIN||"NONE"!==this.closedCaptionsForLevel(i))for(let e=0;e<r.length;e++){let t=r[e].bytes;if(t){this.cea608Parser1||this.initCea608Parsers();let i=this.extractCea608Data(t);this.cea608Parser1.addData(r[e].pts,i[0]),this.cea608Parser2.addData(r[e].pts,i[1])}}}onBufferFlushing(e,t){let{startOffset:i,endOffset:r,endOffsetSubtitles:a,type:n}=t,{media:s}=this;if(s&&!(s.currentTime<r)){if(!n||"video"===n){let{captionsTracks:e}=this;Object.keys(e).forEach(t=>sI(e[t],i,r))}if(this.config.renderTextTracksNatively&&0===i&&void 0!==a){let{textTracks:e}=this;Object.keys(e).forEach(t=>sI(e[t],i,a))}}}extractCea608Data(e){let t=[[],[]],i=31&e[0],r=2;for(let a=0;a<i;a++){let i=e[r++],a=127&e[r++],n=127&e[r++];if((0!==a||0!==n)&&(4&i)!=0){let e=3&i;(0===e||1===e)&&(t[e].push(a),t[e].push(n))}}return t}constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=oy(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(tB.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(tB.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(tB.MANIFEST_LOADING,this.onManifestLoading,this),e.on(tB.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(tB.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(tB.FRAG_LOADING,this.onFragLoading,this),e.on(tB.FRAG_LOADED,this.onFragLoaded,this),e.on(tB.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(tB.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(tB.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(tB.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(tB.BUFFER_FLUSHING,this.onBufferFlushing,this)}},audioStreamController:class extends aI{onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();let{hls:e}=this;e.on(tB.LEVEL_LOADED,this.onLevelLoaded,this),e.on(tB.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(tB.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(tB.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(tB.BUFFER_RESET,this.onBufferReset,this),e.on(tB.BUFFER_CREATED,this.onBufferCreated,this),e.on(tB.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(tB.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(tB.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(tB.FRAG_LOADING,this.onFragLoading,this),e.on(tB.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){let{hls:e}=this;e&&(super.unregisterListeners(),e.off(tB.LEVEL_LOADED,this.onLevelLoaded,this),e.off(tB.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(tB.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(tB.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(tB.BUFFER_RESET,this.onBufferReset,this),e.off(tB.BUFFER_CREATED,this.onBufferCreated,this),e.off(tB.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(tB.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(tB.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(tB.FRAG_LOADING,this.onFragLoading,this),e.off(tB.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,t){let{frag:i,id:r,initPTS:a,timescale:n,trackId:s}=t;if(r===tG.MAIN){let e=i.cc,t=this.fragCurrent;if(this.initPTS[e]={baseTime:a,timescale:n,trackId:s},this.log("InitPTS for cc: ".concat(e," found from main: ").concat(a/n," (").concat(a,"/").concat(n,") trackId: ").concat(s)),this.mainAnchor=i,this.state===aS.WAITING_INIT_PTS){let t=this.waitingData;(t||this.loadingParts)&&(!t||t.frag.cc===e)||this.syncWithAnchor(i,null==t?void 0:t.frag)}else!this.hls.hasEnoughToStart&&t&&t.cc!==e?(t.abortRequests(),this.syncWithAnchor(i,t)):this.state===aS.IDLE&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,t){var i;let r=(null==(i=this.mainFragLoading)?void 0:i.frag)||null;if(t&&(null==r?void 0:r.cc)===t.cc)return;let a=(r||e).cc,n=i6(this.getLevelDetails(),a,this.getLoadPosition());n&&(this.log("Syncing with main frag at ".concat(n.start," cc ").concat(n.cc)),this.startFragRequested=!1,this.nextLoadPosition=n.start,this.resetLoadingState(),this.state===aS.IDLE&&this.doTickIdle())}startLoad(e,t){if(!this.levels){this.startPosition=e,this.state=aS.STOPPED;return}let i=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),i>0&&-1===e?(this.log("Override startPosition with lastCurrentTime @".concat(i.toFixed(3))),e=i,this.state=aS.IDLE):this.state=aS.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case aS.IDLE:this.doTickIdle();break;case aS.WAITING_TRACK:{let{levels:e,trackId:t}=this,i=null==e?void 0:e[t],r=null==i?void 0:i.details;if(r&&!this.waitForLive(i)){if(this.waitForCdnTuneIn(r))break;this.state=aS.WAITING_INIT_PTS}break}case aS.FRAG_LOADING_WAITING_RETRY:this.checkRetryDate();break;case aS.WAITING_INIT_PTS:{let e=this.waitingData;if(e){let{frag:t,part:i,cache:r,complete:a}=e,n=this.mainAnchor;if(void 0!==this.initPTS[t.cc]){this.waitingData=null,this.state=aS.FRAG_LOADING;let e={frag:t,part:i,payload:r.flush().buffer,networkDetails:null};this._handleFragmentLoadProgress(e),a&&super._handleFragmentLoadComplete(e)}else n&&n.cc!==e.frag.cc&&this.syncWithAnchor(n,e.frag)}else this.state=aS.IDLE}}this.onTickEnd()}resetLoadingState(){let e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){let{media:e}=this;null!=e&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;let{hls:t,levels:i,media:r,trackId:a}=this,n=t.config;if(!this.buffering||!r&&!this.primaryPrefetch&&(this.startFragRequested||!n.startFragPrefetch)||!(null!=i&&i[a]))return;let s=i[a],o=s.details;if(!o||this.waitForLive(s)||this.waitForCdnTuneIn(o)){this.state=aS.WAITING_TRACK,this.startFragRequested=!1;return}let l=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&l&&(this.bufferFlushed=!1,this.afterBufferFlushed(l,t9.AUDIO,tG.AUDIO));let d=this.getFwdBufferInfo(l,tG.AUDIO);if(null===d)return;if(!this.switchingTrack&&this._streamEnded(d,o)){t.trigger(tB.BUFFER_EOS,{type:"audio"}),this.state=aS.ENDED;return}let u=d.len,h=t.maxBufferLength,c=o.fragments,m=c[0].start,f=this.getLoadPosition(),p=this.flushing?f:d.end;if(this.switchingTrack&&r&&o.PTSKnown&&f<m&&(d.end>m||d.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),r.currentTime=m+.05),u>=h&&!this.switchingTrack&&p<c[c.length-1].start)return;let g=this.getNextFragment(p,o);if(g&&this.isLoopLoading(g,p)&&(g=this.getNextFragmentLoopLoading(g,o,d,tG.MAIN,h)),!g){this.bufferFlushed=!0;return}let E=(null==(e=this.mainFragLoading)?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&E&&t7(g)&&!g.endList&&(!o.live||!this.loadingParts&&p<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(E)===ru.OK&&(this.mainFragLoading=E=null),E&&t7(E))){if(g.start>E.end){let e=this.fragmentTracker.getFragAtPos(p,tG.MAIN);e&&e.end>E.end&&(E=e,this.mainFragLoading={frag:e,targetBufferTime:null})}if(g.start>E.end)return}this.loadFragment(g,s,p)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,t){let{audioTracks:i}=t;this.resetTransmuxer(),this.levels=i.map(e=>new iQ(e))}onAudioTrackSwitching(e,t){let i=!!t.url;this.trackId=t.id;let{fragCurrent:r}=this;r&&(r.abortRequests(),this.removeUnbufferedFrags(r.start)),this.resetLoadingState(),i?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==aS.STOPPED&&(this.setInterval(100),this.state=aS.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;let i=this.cachedTrackLoadedData;i&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(tB.AUDIO_TRACK_LOADED,i))}onAudioTrackLoaded(e,t){var i,r;let{levels:a}=this,{details:n,id:s,groupId:o,track:l}=t;if(!a)return void this.warn("Audio tracks reset while loading track ".concat(s,' "').concat(l.name,'" of "').concat(o,'"'));let d=this.mainDetails;if(!d||n.endCC>d.endCC||d.expired){this.cachedTrackLoadedData=t,this.state!==aS.STOPPED&&(this.state=aS.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log("Audio track ".concat(s,' "').concat(l.name,'" of "').concat(o,'" loaded [').concat(n.startSN,",").concat(n.endSN,"]").concat(n.lastPartSn?"[part-".concat(n.lastPartSn,"-").concat(n.lastPartIndex,"]"):"",",duration:").concat(n.totalduration));let u=a[s],h=0;if(n.live||null!=(i=u.details)&&i.live){if(this.checkLiveUpdate(n),n.deltaUpdateFailed)return;u.details&&(h=this.alignPlaylists(n,u.details,null==(r=this.levelLastLoaded)?void 0:r.details)),n.alignedSliding||(ay(n,d),n.alignedSliding||ab(n,d),h=n.fragmentStart)}u.details=n,this.levelLastLoaded=u,this.startFragRequested||this.setStartPosition(d,h),this.hls.trigger(tB.AUDIO_TRACK_UPDATED,{details:n,id:s,groupId:t.groupId}),this.state!==aS.WAITING_TRACK||this.waitForCdnTuneIn(n)||(this.state=aS.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;let i=e.frag,{part:r,payload:a}=e,{config:n,trackId:s,levels:o}=this;if(!o)return void this.warn("Audio tracks were reset while fragment load was in progress. Fragment ".concat(i.sn," of level ").concat(i.level," will not be buffered"));let l=o[s];if(!l)return void this.warn("Audio track is undefined on fragment load progress");let d=l.details;if(!d){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(i.start);return}let u=n.defaultAudioCodec||l.audioCodec||"mp4a.40.2",h=this.transmuxer;h||(h=this.transmuxer=new nw(this.hls,tG.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));let c=this.initPTS[i.cc],m=null==(t=i.initSegment)?void 0:t.data;if(void 0!==c){let e=r?r.index:-1,t=new rI(i.level,i.sn,i.stats.chunkCount,a.byteLength,e,-1!==e);h.push(a,m,u,"",i,r,d.totalduration,!1,t,c)}else{this.log("Unknown video PTS for cc ".concat(i.cc,", waiting for video PTS before demuxing audio frag ").concat(i.sn," of [").concat(d.startSN," ,").concat(d.endSN,"],track ").concat(s));let{cache:e}=this.waitingData=this.waitingData||{frag:i,part:r,cache:new ak,complete:!1};e.push(new Uint8Array(a)),this.state!==aS.STOPPED&&(this.state=aS.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;let i=t.tracks.audio;i&&(this.mediaBuffer=i.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===tG.MAIN&&t7(t.frag)&&(this.mainFragLoading=t,this.state===aS.IDLE&&this.tick())}onFragBuffered(e,t){let{frag:i,part:r}=t;if(i.type!==tG.AUDIO){this.audioOnly||i.type!==tG.MAIN||i.elementaryStreams.video||i.elementaryStreams.audiovideo||(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(i))return void this.warn("Fragment ".concat(i.sn).concat(r?" p: "+r.index:""," of level ").concat(i.level," finished buffering, but was aborted. state: ").concat(this.state,", audioSwitch: ").concat(this.switchingTrack?this.switchingTrack.name:"false"));if(t7(i)){this.fragPrevious=i;let e=this.switchingTrack;e&&(this.bufferedTrack=e,this.switchingTrack=null,this.hls.trigger(tB.AUDIO_TRACK_SWITCHED,tY({},e)))}this.fragBufferedComplete(i,r),this.media&&this.tick()}onError(e,t){var i;if(t.fatal){this.state=aS.ERROR;return}switch(t.details){case tF.FRAG_GAP:case tF.FRAG_PARSING_ERROR:case tF.FRAG_DECRYPT_ERROR:case tF.FRAG_LOAD_ERROR:case tF.FRAG_LOAD_TIMEOUT:case tF.KEY_LOAD_ERROR:case tF.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(tG.AUDIO,t);break;case tF.AUDIO_TRACK_LOAD_ERROR:case tF.AUDIO_TRACK_LOAD_TIMEOUT:case tF.LEVEL_PARSING_ERROR:t.levelRetry||this.state!==aS.WAITING_TRACK||(null==(i=t.context)?void 0:i.type)!==tH.AUDIO_TRACK||(this.state=aS.IDLE);break;case tF.BUFFER_ADD_CODEC_ERROR:case tF.BUFFER_APPEND_ERROR:if("audio"!==t.parent)return;this.reduceLengthAndFlushBuffer(t)||this.resetLoadingState();break;case tF.BUFFER_FULL_ERROR:if("audio"!==t.parent)return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,1/0,"audio"));break;case tF.INTERNAL_EXCEPTION:this.recoverWorkerError(t)}}onBufferFlushing(e,t){let{type:i}=t;i!==t9.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,t){let{type:i}=t;if(i!==t9.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===aS.ENDED&&(this.state=aS.IDLE);let e=this.mediaBuffer||this.media;e&&(this.afterBufferFlushed(e,i,tG.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;let i="audio",{hls:r}=this,{remuxResult:a,chunkMeta:n}=e,s=this.getCurrentContext(n);if(!s)return void this.resetWhenMissingContext(n);let{frag:o,part:l,level:d}=s,{details:u}=d,{audio:h,text:c,id3:m,initSegment:f}=a;if(this.fragContextChanged(o)||!u)return void this.fragmentTracker.removeFragment(o);if(this.state=aS.PARSING,this.switchingTrack&&h&&this.completeAudioSwitch(this.switchingTrack),null!=f&&f.tracks){let e=o.initSegment||o;if(this.unhandledEncryptionError(f,o))return;this._bufferInitSegment(d,f.tracks,e,n),r.trigger(tB.FRAG_PARSING_INIT_SEGMENT,{frag:e,id:i,tracks:f.tracks})}if(h){let{startPTS:e,endPTS:t,startDTS:i,endDTS:r}=h;l&&(l.elementaryStreams[t9.AUDIO]={startPTS:e,endPTS:t,startDTS:i,endDTS:r}),o.setElementaryStreamInfo(t9.AUDIO,e,t,i,r),this.bufferFragmentData(h,o,l,n)}if(null!=m&&null!=(t=m.samples)&&t.length){let e=tW({id:i,frag:o,details:u},m);r.trigger(tB.FRAG_PARSING_METADATA,e)}if(c){let e=tW({id:i,frag:o,details:u},c);r.trigger(tB.FRAG_PARSING_USERDATA,e)}}_bufferInitSegment(e,t,i,r){if(this.state!==aS.PARSING||(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio))return;let a=t.audio;a.id=tG.AUDIO;let n=e.audioCodec;this.log("Init audio buffer, container:".concat(a.container,", codecs[level/parsed]=[").concat(n,"/").concat(a.codec,"]")),n&&1===n.split(",").length&&(a.levelCodec=n),this.hls.trigger(tB.BUFFER_CODECS,t);let s=a.initSegment;if(null!=s&&s.byteLength){let e={type:"audio",frag:i,part:null,chunkMeta:r,parent:i.type,data:s};this.hls.trigger(tB.BUFFER_APPENDING,e)}this.tickImmediate()}loadFragment(e,t,i){let r=this.fragmentTracker.getState(e);if(this.switchingTrack||r===ru.NOT_LOADED||r===ru.PARTIAL){var a;if(t7(e))if(null!=(a=t.details)&&a.live&&!this.initPTS[e.cc]){this.log("Waiting for video PTS in continuity counter ".concat(e.cc," of live stream before loading audio fragment ").concat(e.sn," of level ").concat(this.trackId)),this.state=aS.WAITING_INIT_PTS;let i=this.mainDetails;i&&i.fragmentStart!==t.details.fragmentStart&&ab(t.details,i)}else super.loadFragment(e,t,i);else this._loadInitSegment(e,t)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){let{name:t,lang:i,assocLang:r,characteristics:a,audioCodec:n,channels:s}=this.bufferedTrack;i1({name:t,lang:i,assocLang:r,characteristics:a,audioCodec:n,channels:s},e,i2)||(i4(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,1/0,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){let{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(tB.AUDIO_TRACK_SWITCHED,tY({},e))}constructor(e,t,i){super(e,t,i,"audio-stream-controller",tG.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}},audioTrackController:class extends nC{registerListeners(){let{hls:e}=this;e.on(tB.MANIFEST_LOADING,this.onManifestLoading,this),e.on(tB.MANIFEST_PARSED,this.onManifestParsed,this),e.on(tB.LEVEL_LOADING,this.onLevelLoading,this),e.on(tB.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(tB.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(tB.ERROR,this.onError,this)}unregisterListeners(){let{hls:e}=this;e.off(tB.MANIFEST_LOADING,this.onManifestLoading,this),e.off(tB.MANIFEST_PARSED,this.onManifestParsed,this),e.off(tB.LEVEL_LOADING,this.onLevelLoading,this),e.off(tB.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(tB.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(tB.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){let{id:i,groupId:r,details:a}=t,n=this.tracksInGroup[i];if(!n||n.groupId!==r)return void this.warn("Audio track with id:".concat(i," and group:").concat(r," not found in active group ").concat(null==n?void 0:n.groupId));let s=n.details;n.details=t.details,this.log("Audio track ".concat(i,' "').concat(n.name,'" lang:').concat(n.lang," group:").concat(r," loaded [").concat(a.startSN,"-").concat(a.endSN,"]")),i===this.trackId&&this.playlistLoaded(i,t,s)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){let t=this.hls.levels[e];if(!t)return;let i=t.audioGroups||null,r=this.groupIds,a=this.currentTrack;if(!i||(null==r?void 0:r.length)!==(null==i?void 0:i.length)||null!=i&&i.some(e=>(null==r?void 0:r.indexOf(e))===-1)){this.groupIds=i,this.trackId=-1,this.currentTrack=null;let e=this.tracks.filter(e=>!i||-1!==i.indexOf(e.groupId));if(e.length)this.selectDefaultTrack&&!e.some(e=>e.default)&&(this.selectDefaultTrack=!1),e.forEach((e,t)=>{e.id=t});else if(!a&&!this.tracksInGroup.length)return;this.tracksInGroup=e;let t=this.hls.config.audioPreference;if(!a&&t){let i=i0(t,e,i2);if(i>-1)a=e[i];else{let e=i0(t,this.tracks);a=this.tracks[e]}}let r=this.findTrackId(a);-1===r&&a&&(r=this.findTrackId(null)),this.log("Updating audio tracks, ".concat(e.length," track(s) found in group(s): ").concat(null==i?void 0:i.join(","))),this.hls.trigger(tB.AUDIO_TRACKS_UPDATED,{audioTracks:e});let s=this.trackId;if(-1!==r&&-1===s)this.setAudioTrack(r);else if(e.length&&-1===s){var n;let t=Error("No audio track selected for current audio group-ID(s): ".concat(null==(n=this.groupIds)?void 0:n.join(",")," track count: ").concat(e.length));this.warn(t.message),this.hls.trigger(tB.ERROR,{type:tU.MEDIA_ERROR,details:tF.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:t})}}}onError(e,t){!t.fatal&&t.context&&(t.context.type!==tH.AUDIO_TRACK||t.context.id!==this.trackId||this.groupIds&&-1===this.groupIds.indexOf(t.context.groupId)||this.checkRetry(t))}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){let t=this.hls;if(t.config.audioPreference=e,e){let i=this.allAudioTracks;if(this.selectDefaultTrack=!1,i.length){let r=this.currentTrack;if(r&&i1(e,r,i2))return r;let a=i0(e,this.tracksInGroup,i2);if(a>-1){let e=this.tracksInGroup[a];return this.setAudioTrack(a),e}if(r){let r=t.loadLevel;-1===r&&(r=t.firstAutoLevel);let a=function(e,t,i,r,a){let n=t[r],s=t.reduce((e,t,i)=>{let r=t.uri;return(e[r]||(e[r]=[])).push(i),e},{})[n.uri];s.length>1&&(r=Math.max.apply(Math,s));let o=n.videoRange,l=n.frameRate,d=n.codecSet.substring(0,4),u=i3(t,r,t=>{if(t.videoRange!==o||t.frameRate!==l||t.codecSet.substring(0,4)!==d)return!1;let r=t.audioGroups;return i0(e,i.filter(e=>!r||-1!==r.indexOf(e.groupId)),a)>-1});return u>-1?u:i3(t,r,t=>{let r=t.audioGroups;return i0(e,i.filter(e=>!r||-1!==r.indexOf(e.groupId)),a)>-1})}(e,t.levels,i,r,i2);if(-1===a)return null;t.nextLoadLevel=a}if(e.channels||e.audioCodec){let t=i0(e,i);if(t>-1)return i[t]}}}return null}setAudioTrack(e){let t=this.tracksInGroup;if(e<0||e>=t.length)return void this.warn("Invalid audio track id: ".concat(e));this.selectDefaultTrack=!1;let i=this.currentTrack,r=t[e],a=r.details&&!r.details.live;if(e===this.trackId&&r===i&&a||(this.log("Switching to audio-track ".concat(e,' "').concat(r.name,'" lang:').concat(r.lang," group:").concat(r.groupId," channels:").concat(r.channels)),this.trackId=e,this.currentTrack=r,this.hls.trigger(tB.AUDIO_TRACK_SWITCHING,tY({},r)),a))return;let n=this.switchParams(r.url,null==i?void 0:i.details,r.details);this.loadPlaylist(n)}findTrackId(e){let t=this.tracksInGroup;for(let i=0;i<t.length;i++){let r=t[i];if((!this.selectDefaultTrack||r.default)&&(!e||i1(e,r,i2)))return i}if(e){let{name:i,lang:r,assocLang:a,characteristics:n,audioCodec:s,channels:o}=e;for(let e=0;e<t.length;e++)if(i1({name:i,lang:r,assocLang:a,characteristics:n,audioCodec:s,channels:o},t[e],i2))return e;for(let i=0;i<t.length;i++){let r=t[i];if(nO(e.attrs,r.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return i}for(let i=0;i<t.length;i++){let r=t[i];if(nO(e.attrs,r.attrs,["LANGUAGE"]))return i}}return -1}loadPlaylist(e){super.loadPlaylist();let t=this.currentTrack;this.shouldLoadPlaylist(t)&&i4(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);let i=e.id,r=e.groupId,a=this.getUrlWithDirectives(e.url,t),n=e.details,s=null==n?void 0:n.age;this.log("Loading audio-track ".concat(i,' "').concat(e.name,'" lang:').concat(e.lang," group:").concat(r).concat((null==t?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:"").concat(s&&n.live?" age "+s.toFixed(1)+(n.type?" "+n.type:""):""," ").concat(a)),this.hls.trigger(tB.AUDIO_TRACK_LOADING,{url:a,id:i,groupId:r,deliveryDirectives:t||null,track:e})}constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}},emeController:sE,cmcdController:class{registerListeners(){let e=this.hls;e.on(tB.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(tB.MEDIA_DETACHED,this.onMediaDetached,this),e.on(tB.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){let e=this.hls;e.off(tB.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(tB.MEDIA_DETACHED,this.onMediaDetached,this),e.off(tB.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var i,r;this.audioBuffer=null==(i=t.tracks.audio)?void 0:i.buffer,this.videoBuffer=null==(r=t.tracks.video)?void 0:r.buffer}createData(){var e;return{v:1,sf:nV.HLS,sid:this.sid,cid:this.cid,pr:null==(e=this.media)?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};tW(t,this.createData());let i=t.ot===nK.INIT||t.ot===nK.VIDEO||t.ot===nK.MUXED;this.starved&&i&&(t.bs=!0,t.su=!0,this.starved=!1),null==t.su&&(t.su=this.buffering);let{includeKeys:r}=this;r&&(t=Object.keys(t).reduce((e,i)=>(r.includes(i)&&(e[i]=t[i]),e),{}));let a={baseUrl:e.url};if(this.useHeaders){var n;e.headers||(e.headers={}),n=e.headers,tW(n,function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i={};return e?Object.entries(function(e,t){let i={};if(!e)return i;let r=Object.keys(e),a=t?Object.keys(t).reduce((e,i)=>{var r;return null==(r=t[i])||r.forEach(t=>e[t]=i),e},{}):{};return r.reduce((t,i)=>{var r;let n=n8[i]||a[i]||n9.REQUEST;return(null!=(r=t[n])?r:t[n]={})[i]=e[i],t},i)}(sf(e,t),null==t?void 0:t.customHeaderMap)).reduce((e,t)=>{let[i,r]=t,a=n1(r,{whitespace:!1});return a&&(e[i]=a),e},i):i}(t,a))}else e.url=function(e,t,i){let r=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)return"";let i=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e?encodeURIComponent(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e?n1(sf(e,t),{whitespace:!1}):""}(e,t)):""}(e,t);return"".concat("CMCD","=").concat(i)}(t,i);if(!r)return e;if(sp.test(e))return e.replace(sp,r);let a=e.includes("?")?"&":"?";return"".concat(e).concat(a).concat(r)}(e.url,t,a)}getNextFrag(e){var t;let i=null==(t=this.hls.levels[e.level])?void 0:t.details;if(i){let t=e.sn-i.startSN;return i.fragments[t+1]}}getNextPart(e){var t;let{index:i,fragment:r}=e,a=null==(t=this.hls.levels[r.level])||null==(t=t.details)?void 0:t.partList;if(a){let{sn:e}=r;for(let t=a.length-1;t>=0;t--){let r=a[t];if(r.index===i&&r.fragment.sn===e)return a[t+1]}}}getObjectType(e){let{type:t}=e;return"subtitle"===t?nK.TIMED_TEXT:"initSegment"===e.sn?nK.INIT:"audio"===t?nK.AUDIO:"main"===t?this.hls.audioTracks.length?nK.VIDEO:nK.MUXED:void 0}getTopBandwidth(e){let t,i=0,r=this.hls;if(e===nK.AUDIO)t=r.audioTracks;else{let e=r.maxAutoLevel,i=e>-1?e+1:r.levels.length;t=r.levels.slice(0,i)}return t.forEach(e=>{e.bitrate>i&&(i=e.bitrate)}),i>0?i:NaN}getBufferLength(e){let t=this.media,i=e===nK.AUDIO?this.audioBuffer:this.videoBuffer;return i&&t?1e3*rL.bufferInfo(i,t.currentTime,this.config.maxBufferHole).len:NaN}createPlaylistLoader(){let{pLoader:e}=this.config,t=this.applyPlaylistData,i=e||this.config.loader;return class{get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(e,i,r){t(e),this.loader.load(e,i,r)}constructor(e){this.loader=void 0,this.loader=new i(e)}}}createFragmentLoader(){let{fLoader:e}=this.config,t=this.applyFragmentData,i=e||this.config.loader;return class{get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(e,i,r){t(e),this.loader.load(e,i,r)}constructor(e){this.loader=void 0,this.loader=new i(e)}}}constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=e=>{try{this.apply(e,{ot:nK.MANIFEST,su:!this.initialized})}catch(e){this.hls.logger.warn("Could not generate manifest CMCD data.",e)}},this.applyFragmentData=e=>{try{let{frag:t,part:i}=e,r=this.hls.levels[t.level],a=this.getObjectType(t),n={d:1e3*(i||t).duration,ot:a};(a===nK.VIDEO||a===nK.AUDIO||a==nK.MUXED)&&(n.br=r.bitrate/1e3,n.tb=this.getTopBandwidth(a)/1e3,n.bl=this.getBufferLength(a));let s=i?this.getNextPart(i):this.getNextFrag(t);null!=s&&s.url&&s.url!==t.url&&(n.nor=s.url),this.apply(e,n)}catch(e){this.hls.logger.warn("Could not generate segment CMCD data.",e)}},this.hls=e;let t=this.config=e.config,{cmcd:i}=t;null!=i&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=i.sessionId||e.sessionId,this.cid=i.contentId,this.useHeaders=!0===i.useHeaders,this.includeKeys=i.includeKeys,this.registerListeners())}},contentSteeringController:class extends tj{registerListeners(){let e=this.hls;e.on(tB.MANIFEST_LOADING,this.onManifestLoading,this),e.on(tB.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(tB.MANIFEST_PARSED,this.onManifestParsed,this),e.on(tB.ERROR,this.onError,this)}unregisterListeners(){let e=this.hls;e&&(e.off(tB.MANIFEST_LOADING,this.onManifestLoading,this),e.off(tB.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(tB.MANIFEST_PARSED,this.onManifestParsed,this),e.off(tB.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(-1===e.indexOf(t.pathwayId)&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){let e=1e3*this.timeToLoad-(performance.now()-this.updated);if(e>0)return void this.scheduleRefresh(this.uri,e)}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){-1!==this.reloadTimer&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){let t=this.levels;t&&(this.levels=t.filter(t=>t!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){let{contentSteering:i}=t;null!==i&&(this.pathwayId=i.pathwayId,this.uri=i.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){let{errorAction:i}=t;if((null==i?void 0:i.action)===ro.SendAlternateToPenaltyBox&&i.flags===rl.MoveAllAlternatesMatchingHost){let e=this.levels,r=this._pathwayPriority,a=this.pathwayId;if(t.context){let{groupId:i,pathwayId:r,type:n}=t.context;i&&e?a=this.getPathwayForGroupId(i,n,a):r&&(a=r)}a in this.penalizedPathways||(this.penalizedPathways[a]=performance.now()),!r&&e&&(r=this.pathways()),r&&r.length>1&&(this.updatePathwayPriority(r),i.resolved=this.pathwayId!==a),t.details!==tF.BUFFER_APPEND_ERROR||t.fatal?i.resolved||this.warn("Could not resolve ".concat(t.details,' ("').concat(t.error.message,'") with content-steering for Pathway: ').concat(a," levels: ").concat(e?e.length:e," priorities: ").concat(iX(r)," penalized: ").concat(iX(this.penalizedPathways))):i.resolved=!0}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(0===t.length){let i=e[0].pathwayId;this.log("No levels found in Pathway ".concat(this.pathwayId,'. Setting initial Pathway to "').concat(i,'"')),t=this.getLevelsForPathway(i),this.pathwayId=i}return t.length!==e.length&&this.log("Found ".concat(t.length,"/").concat(e.length,' levels in Pathway "').concat(this.pathwayId,'"')),t}getLevelsForPathway(e){return null===this.levels?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){let t;this._pathwayPriority=e;let i=this.penalizedPathways,r=performance.now();Object.keys(i).forEach(e=>{r-i[e]>3e5&&delete i[e]});for(let r=0;r<e.length;r++){let a=e[r];if(a in i)continue;if(a===this.pathwayId)return;let n=this.hls.nextLoadLevel,s=this.hls.levels[n];if((t=this.getLevelsForPathway(a)).length>0){this.log('Setting Pathway to "'.concat(a,'"')),this.pathwayId=a,af(t),this.hls.trigger(tB.LEVELS_UPDATED,{levels:t});let e=this.hls.levels[n];s&&e&&this.levels&&(e.attrs["STABLE-VARIANT-ID"]!==s.attrs["STABLE-VARIANT-ID"]&&e.bitrate!==s.bitrate&&this.log("Unstable Pathways change from bitrate ".concat(s.bitrate," to ").concat(e.bitrate)),this.hls.nextLoadLevel=n);break}}}getPathwayForGroupId(e,t,i){let r=this.getLevelsForPathway(i).concat(this.levels||[]);for(let i=0;i<r.length;i++)if(t===tH.AUDIO_TRACK&&r[i].hasAudioGroup(e)||t===tH.SUBTITLE_TRACK&&r[i].hasSubtitleGroup(e))return r[i].pathwayId;return i}clonePathways(e){let t=this.levels;if(!t)return;let i={},r={};e.forEach(e=>{let{ID:a,"BASE-ID":n,"URI-REPLACEMENT":s}=e;if(t.some(e=>e.pathwayId===a))return;let o=this.getLevelsForPathway(n).map(e=>{let t=new rP(e.attrs);t["PATHWAY-ID"]=a;let n=t.AUDIO&&"".concat(t.AUDIO,"_clone_").concat(a),o=t.SUBTITLES&&"".concat(t.SUBTITLES,"_clone_").concat(a);n&&(i[t.AUDIO]=n,t.AUDIO=n),o&&(r[t.SUBTITLES]=o,t.SUBTITLES=o);let l=sv(e.uri,t["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",s),d=new iQ({attrs:t,audioCodec:e.audioCodec,bitrate:e.bitrate,height:e.height,name:e.name,url:l,videoCodec:e.videoCodec,width:e.width});if(e.audioGroups)for(let t=1;t<e.audioGroups.length;t++)d.addGroupId("audio","".concat(e.audioGroups[t],"_clone_").concat(a));if(e.subtitleGroups)for(let t=1;t<e.subtitleGroups.length;t++)d.addGroupId("text","".concat(e.subtitleGroups[t],"_clone_").concat(a));return d});t.push(...o),sg(this.audioTracks,i,s,a),sg(this.subtitleTracks,r,s,a)})}loadSteeringManifest(e){let t,i=this.hls.config,r=i.loader;this.loader&&this.loader.destroy(),this.loader=new r(i);try{t=new self.URL(e)}catch(t){this.enabled=!1,this.log("Failed to parse Steering Manifest URI: ".concat(e));return}if("data:"!==t.protocol){let e=0|(this.hls.bandwidthEstimate||i.abrEwmaDefaultEstimate);t.searchParams.set("_HLS_pathway",this.pathwayId),t.searchParams.set("_HLS_throughput",""+e)}let a={responseType:"json",url:t.href},n=i.steeringManifestLoadPolicy.default,s=n.errorRetry||n.timeoutRetry||{},o={loadPolicy:n,timeout:n.maxLoadTimeMs,maxRetry:s.maxNumRetry||0,retryDelay:s.retryDelayMs||0,maxRetryDelay:s.maxRetryDelayMs||0};this.log("Requesting steering manifest: ".concat(t)),this.loader.load(a,o,{onSuccess:(e,i,r,a)=>{this.log('Loaded steering manifest: "'.concat(t,'"'));let n=e.data;if((null==n?void 0:n.VERSION)!==1)return void this.log("Steering VERSION ".concat(n.VERSION," not supported!"));this.updated=performance.now(),this.timeToLoad=n.TTL;let{"RELOAD-URI":s,"PATHWAY-CLONES":o,"PATHWAY-PRIORITY":l}=n;if(s)try{this.uri=new self.URL(s,t).href}catch(e){this.enabled=!1,this.log("Failed to parse Steering Manifest RELOAD-URI: ".concat(s));return}this.scheduleRefresh(this.uri||r.url),o&&this.clonePathways(o);let d={steeringManifest:n,url:t.toString()};this.hls.trigger(tB.STEERING_MANIFEST_LOADED,d),l&&this.updatePathwayPriority(l)},onError:(e,t,i,r)=>{if(this.log("Error loading steering manifest: ".concat(e.code," ").concat(e.text," (").concat(t.url,")")),this.stopLoad(),410===e.code){this.enabled=!1,this.log("Steering manifest ".concat(t.url," no longer available"));return}let a=1e3*this.timeToLoad;if(429===e.code){let e=this.loader;if("function"==typeof(null==e?void 0:e.getResponseHeader)){let t=e.getResponseHeader("Retry-After");t&&(a=1e3*parseFloat(t))}this.log("Steering manifest ".concat(t.url," rate limited"));return}this.scheduleRefresh(this.uri||t.url,a)},onTimeout:(e,t,i)=>{this.log("Timeout loading steering manifest (".concat(t.url,")")),this.scheduleRefresh(this.uri||t.url)}})}scheduleRefresh(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3*this.timeToLoad;this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var t;let i=null==(t=this.hls)?void 0:t.media;if(i&&!i.ended)return void this.loadSteeringManifest(e);this.scheduleRefresh(e,1e3*this.timeToLoad)},t)}constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}},interstitialsController:class extends tj{registerListeners(){let e=this.hls;e&&(e.on(tB.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(tB.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(tB.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(tB.MANIFEST_LOADING,this.onManifestLoading,this),e.on(tB.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(tB.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(tB.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(tB.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(tB.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(tB.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(tB.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(tB.BUFFER_APPENDED,this.onBufferAppended,this),e.on(tB.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(tB.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(tB.MEDIA_ENDED,this.onMediaEnded,this),e.on(tB.ERROR,this.onError,this),e.on(tB.DESTROYING,this.onDestroying,this))}unregisterListeners(){let e=this.hls;e&&(e.off(tB.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(tB.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(tB.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(tB.MANIFEST_LOADING,this.onManifestLoading,this),e.off(tB.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(tB.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(tB.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(tB.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(tB.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(tB.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(tB.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(tB.BUFFER_CODECS,this.onBufferCodecs,this),e.off(tB.BUFFER_APPENDED,this.onBufferAppended,this),e.off(tB.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(tB.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(tB.MEDIA_ENDED,this.onMediaEnded,this),e.off(tB.ERROR,this.onError,this),e.off(tB.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;null==(e=this.getBufferingPlayer())||e.resumeBuffering()}pauseBuffering(){var e;null==(e=this.getBufferingPlayer())||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){let e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){a_(e,"play",this.onPlay),a_(e,"pause",this.onPause),a_(e,"seeking",this.onSeeking),a_(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){let i=this.media=t.media;aT(i,"seeking",this.onSeeking),aT(i,"timeupdate",this.onTimeupdate),aT(i,"play",this.onPlay),aT(i,"pause",this.onPause)}onMediaAttached(e,t){let i=this.effectivePlayingItem,r=this.detachedData;if(this.detachedData=null,null===i)this.checkStart();else if(!r){this.clearScheduleState();let e=this.findItemIndex(i);this.setSchedulePosition(e)}}clearScheduleState(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){let i=!!t.transferMedia,r=this.media;if(this.media=null,!i&&(r&&this.removeMediaListeners(r),this.detachedData)){let e=this.getBufferingPlayer();e&&(this.log("Removing schedule state for detachedData and ".concat(e)),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,e.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;let e=this,t=t=>t?e.getAssetPlayer(t.identifier):t,i=(i,a,n,s,o)=>{if(i){let l=i[a].start,d=i.event;if(d){if("playout"===a||d.timelineOccupancy!==sL.Point){let e=t(n);(null==e?void 0:e.interstitial)===d&&(l+=e.assetItem.startOffset+e[o])}}else l+=("bufferedPos"===s?r():e[s])-i.start;return l}return 0},r=()=>{let t=e.bufferedPos;return t===Number.MAX_VALUE?a("primary"):Math.max(t,0)},a=t=>{var i,r;return null!=(i=e.primaryDetails)&&i.live?e.primaryDetails.edge:(null==(r=e.schedule)?void 0:r.durations[t])||0},n=(r,a)=>{var n,s;let o=e.effectivePlayingItem;if(null!=o&&null!=(n=o.event)&&n.restrictions.skip||!e.schedule)return;e.log("seek to ".concat(r,' "').concat(a,'"'));let l=e.effectivePlayingItem,d=e.schedule.findItemIndexAtTime(r,a),u=null==(s=e.schedule.items)?void 0:s[d],h=e.getBufferingPlayer(),c=null==h?void 0:h.interstitial,m=null==c?void 0:c.appendInPlace,f=l&&e.itemsMatch(l,u);if(l&&(m||f)){let n=t(e.playingAsset),s=(null==n?void 0:n.media)||e.primaryMedia;if(s){let t="primary"===a?s.currentTime:i(l,a,e.playingAsset,"timelinePos","currentTime"),o=r-t,d=(m?t:s.currentTime)+o;if(d>=0&&(!n||m||d<=n.duration)){s.currentTime=d;return}}}if(u){let t=r;if("primary"!==a){let e=r-u[a].start;t=u.start+e}let i=!e.isInterstitial(u);if((!e.isInterstitial(l)||l.event.appendInPlace)&&(i||u.event.appendInPlace)){let i=e.media||(m?null==h?void 0:h.media:null);i&&(i.currentTime=t)}else if(l){let n=e.findItemIndex(l);if(d>n){let t=e.schedule.findJumpRestrictedIndex(n+1,d);if(t>n)return void e.setSchedulePosition(t)}let s=0;if(i)e.timelinePos=t,e.checkBuffer();else{let e=u.event.assetList,t=r-(u[a]||u).start;for(let i=e.length;i--;){let r=e[i];if(r.duration&&t>=r.startOffset&&t<r.startOffset+r.duration){s=i;break}}}e.setSchedulePosition(d,s)}}},s=()=>{let t=e.effectivePlayingItem;if(e.isInterstitial(t))return t;let i=e.bufferingItem||e.waitingItem;return e.isInterstitial(i)?i:null},o={get bufferedEnd(){let t=e.bufferingItem||e.waitingItem,r=e.bufferingItem;if(r&&r===t){var l;return i(r,"playout",e.bufferingAsset,"bufferedPos","bufferedEnd")-r.playout.start||(null==(l=e.bufferingAsset)?void 0:l.startOffset)||0}return 0},get currentTime(){let t=s(),r=e.effectivePlayingItem;if(r&&r===t)return i(r,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-r.playout.start;return 0},set currentTime(time){let t=s(),i=e.effectivePlayingItem;i&&i===t&&n(time+i.playout.start,"playout")},get duration(){let e=s();if(e)return e.playout.end-e.playout.start;return 0},get assetPlayers(){var d;let t=null==(d=s())?void 0:d.event.assetList;if(t)return t.map(t=>e.getAssetPlayer(t.identifier));return[]},get playingIndex(){var u;let t=null==(u=s())?void 0:u.event;if(t&&e.effectivePlayingAsset)return t.findAssetIndex(e.effectivePlayingAsset);return -1},get scheduleItem(){return s()}};return this.manager={get events(){var h;return(null==(h=e.schedule)||null==(h=h.events)?void 0:h.slice(0))||[]},get schedule(){var c;return(null==(c=e.schedule)||null==(c=c.items)?void 0:c.slice(0))||[]},get interstitialPlayer(){if(s())return o;return null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return e.bufferingItem||e.waitingItem},get bufferingIndex(){let t=e.bufferingItem||e.waitingItem;return e.findItemIndex(t)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){let t=e.effectivePlayingItem;return e.findItemIndex(t)},primary:{get bufferedEnd(){return r()},get currentTime(){let t=e.timelinePos;return t>0?t:0},set currentTime(time){n(time,"primary")},get duration(){return a("primary")},get seekableStart(){var m;return(null==(m=e.primaryDetails)?void 0:m.fragmentStart)||0}},integrated:{get bufferedEnd(){return i(e.bufferingItem||e.waitingItem,"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return i(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(time){n(time,"integrated")},get duration(){return a("integrated")},get seekableStart(){var f;return((t,i)=>{var r,a;if(0!==t&&"primary"!==i&&null!=(r=e.schedule)&&r.length){let r=e.schedule.findItemIndexAtTime(t),n=null==(a=e.schedule.items)?void 0:a[r];if(n)return t+(n[i].start-n.start)}return t})((null==(f=e.primaryDetails)?void 0:f.fragmentStart)||0,"integrated")}},skip:()=>{let t=e.effectivePlayingItem,i=null==t?void 0:t.event;if(i&&!i.restrictions.skip){let r=e.findItemIndex(t);i.appendInPlace?n(t.playout.start+t.event.duration+.001,"playout"):e.advanceAfterAssetEnded(i,r,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;let t=this.playingItem,i=null==(e=this.schedule)?void 0:e.items;return!!this.playbackStarted&&!!t&&!!i&&this.findItemIndex(t)===i.length-1}get playbackStarted(){return null!==this.effectivePlayingItem}get currentTime(){var e,t;if(null===this.mediaSelection)return;let i=this.waitingItem||this.playingItem;if(this.isInterstitial(i)&&!i.event.appendInPlace)return;let r=this.media;!r&&null!=(e=this.bufferingItem)&&null!=(e=e.event)&&e.appendInPlace&&(r=this.primaryMedia);let a=null==(t=r)?void 0:t.currentTime;if(void 0!==a&&tP(a))return a}get primaryMedia(){var e;return this.media||(null==(e=this.detachedData)?void 0:e.media)||null}isInterstitial(e){return!!(null!=e&&e.event)}retreiveMediaSource(e,t){let i=this.getAssetPlayer(e);i&&this.transferMediaFromPlayer(i,t)}transferMediaFromPlayer(e,t){let i=e.interstitial.appendInPlace,r=e.media;if(i&&r===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&r){this.detachedData={media:r};return}let i=e.transferMedia();this.log("transfer MediaSource from ".concat(e," ").concat(iX(i))),this.detachedData=i}else t&&r&&(this.shouldPlay||(this.shouldPlay=!r.paused))}transferMediaTo(e,t){var i,r;let a;if(e.media===t)return;let n=null,s=this.hls,o=e!==s,l=o&&e.interstitial.appendInPlace,d=null==(i=this.detachedData)?void 0:i.mediaSource;if(s.media)l&&(n=s.transferMedia(),this.detachedData=n),a="Primary";else if(d){let e=this.getBufferingPlayer();e?(n=e.transferMedia(),a="".concat(e)):a="detached MediaSource"}else a="detached media";if(!n){if(d)n=this.detachedData,this.log("using detachedData: MediaSource ".concat(iX(n)));else if(!this.detachedData||s.media===t){let e=this.playerQueue;e.length>1&&e.forEach(e=>{if(o&&e.interstitial.appendInPlace!==l){let t=e.interstitial;this.clearInterstitial(e.interstitial,null),t.appendInPlace=!1,t.appendInPlace&&this.warn("Could not change append strategy for queued assets ".concat(t))}}),this.hls.detachMedia(),this.detachedData={media:t}}}let u=n&&"mediaSource"in n&&(null==(r=n.mediaSource)?void 0:r.readyState)!=="closed",h=u&&n?n:t;this.log("".concat(u?"transfering MediaSource":"attaching media"," to ").concat(o?e:"Primary"," from ").concat(a," (media.currentTime: ").concat(t.currentTime,")"));let c=this.schedule;if(h===n&&c){let t=o&&e.assetId===c.assetIdAtEnd;h.overrides={duration:c.duration,endOfStream:!o||t,cueRemoval:!o}}e.attachMedia(h)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){let e=this.schedule,t=null==e?void 0:e.events;if(!t||this.playbackDisabled||!this.media)return;-1===this.bufferedPos&&(this.bufferedPos=0);let i=this.timelinePos,r=this.effectivePlayingItem;if(-1===i){let i=this.hls.startPosition;if(this.log(sB("checkStart",i)),this.timelinePos=i,t.length&&t[0].cue.pre){let i=e.findEventIndex(t[0].identifier);this.setSchedulePosition(i)}else if(i>=0||!this.primaryLive){let t=this.timelinePos=i>0?i:0,r=e.findItemIndexAtTime(t);this.setSchedulePosition(r)}}else if(r&&!this.playingItem){let t=e.findItemIndex(r);this.setSchedulePosition(t)}}advanceAssetBuffering(e,t){let i=e.event,r=i.findAssetIndex(t),a=sM(i,r);if(i.isAssetPastPlayoutLimit(a)){if(this.schedule){var n;let t=null==(n=this.schedule.items)?void 0:n[this.findItemIndex(e)+1];t&&this.bufferedToItem(t)}}else this.bufferedToEvent(e,a)}advanceAfterAssetEnded(e,t,i){let r=sM(e,i);if(e.isAssetPastPlayoutLimit(r)){if(this.schedule){let i=this.schedule.items;if(i){let r=t+1;if(r>=i.length)return void this.setSchedulePosition(-1);let a=e.resumeTime;this.timelinePos<a&&(this.log(sB("advanceAfterAssetEnded",a)),this.timelinePos=a,e.appendInPlace&&this.advanceInPlace(a),this.checkBuffer(this.bufferedPos<a)),this.setSchedulePosition(r)}}}else{if(e.appendInPlace){let t=e.assetList[r];t&&this.advanceInPlace(t.timelineStart)}this.setSchedulePosition(t,r)}}setScheduleToAssetAtTime(e,t){let i=this.schedule;if(!i)return;let r=t.parentIdentifier,a=i.getEvent(r);if(a){let t=i.findEventIndex(r),n=i.findAssetIndex(a,e);this.advanceAfterAssetEnded(a,t,n-1)}}setSchedulePosition(e,t){var i,r,a;let n=null==(i=this.schedule)?void 0:i.items;if(!n||this.playbackDisabled)return;let s=e>=0?n[e]:null;this.log("setSchedulePosition ".concat(e,", ").concat(t," (").concat(s?sN(s):s,") pos: ").concat(this.timelinePos));let o=this.waitingItem||this.playingItem,l=this.playingLastItem;if(this.isInterstitial(o)){let i=o.event,d=this.playingAsset,u=null==d?void 0:d.identifier,h=u?this.getAssetPlayer(u):null;if(h&&u&&(!this.eventItemsMatch(o,s)||void 0!==t&&u!==i.assetList[t].identifier)){let t=i.findAssetIndex(d);if(this.log("INTERSTITIAL_ASSET_ENDED ".concat(t+1,"/").concat(i.assetList.length," ").concat(sO(d))),this.endedAsset=d,this.playingAsset=null,this.hls.trigger(tB.INTERSTITIAL_ASSET_ENDED,{asset:d,assetListIndex:t,event:i,schedule:n.slice(0),scheduleIndex:e,player:h}),o!==this.playingItem){this.itemsMatch(o,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(i,this.findItemIndex(this.playingItem),t);return}this.retreiveMediaSource(u,s),h.media&&!(null!=(r=this.detachedData)&&r.mediaSource)&&h.detachMedia()}if(!this.eventItemsMatch(o,s)&&(this.endedItem=o,this.playingItem=null,this.log("INTERSTITIAL_ENDED ".concat(i," ").concat(sN(o))),i.hasPlayed=!0,this.hls.trigger(tB.INTERSTITIAL_ENDED,{event:i,schedule:n.slice(0),scheduleIndex:e}),i.cue.once)){this.updateSchedule();let e=null==(a=this.schedule)?void 0:a.items;if(s&&e){let i=this.findItemIndex(s);this.advanceSchedule(i,e,t,o,l)}return}}this.advanceSchedule(e,n,t,o,l)}advanceSchedule(e,t,i,r,a){let n=this.schedule;if(!n)return;let s=t[e]||null,o=this.primaryMedia,l=this.playerQueue;if(l.length&&l.forEach(t=>{let i=t.interstitial,r=n.findEventIndex(i.identifier);(r<e||r>e+1)&&this.clearInterstitial(i,s)}),this.isInterstitial(s)){this.timelinePos=Math.min(Math.max(this.timelinePos,s.start),s.end);let a=s.event;if(void 0===i){i=n.findAssetIndex(a,this.timelinePos);let t=sM(a,i-1);if(a.isAssetPastPlayoutLimit(t)||a.appendInPlace&&this.timelinePos===s.end)return void this.advanceAfterAssetEnded(a,e,i);i=t}let l=this.waitingItem;this.assetsBuffered(s,o)||this.setBufferingItem(s);let d=this.preloadAssets(a,i);if(this.eventItemsMatch(s,l||r)||(this.waitingItem=s,this.log("INTERSTITIAL_STARTED ".concat(sN(s)," ").concat(a.appendInPlace?"append in place":"")),this.hls.trigger(tB.INTERSTITIAL_STARTED,{event:a,schedule:t.slice(0),scheduleIndex:e})),!a.assetListLoaded)return void this.log("Waiting for ASSET-LIST to complete loading ".concat(a));if(a.assetListLoader&&(a.assetListLoader.destroy(),a.assetListLoader=void 0),!o)return void this.log("Waiting for attachMedia to start Interstitial ".concat(a));this.waitingItem=this.endedItem=null,this.playingItem=s;let u=a.assetList[i];if(!u)return void this.advanceAfterAssetEnded(a,e,i||0);if(d||(d=this.getAssetPlayer(u.identifier)),null===d||d.destroyed){let e=a.assetList.length;this.warn("asset ".concat(i+1,"/").concat(e," player destroyed ").concat(a)),(d=this.createAssetPlayer(a,u,i)).loadSource()}if(!this.eventItemsMatch(s,this.bufferingItem)&&a.appendInPlace&&this.isAssetBuffered(u))return;this.startAssetPlayer(d,i,t,e,o),this.shouldPlay&&sF(d.media)}else s?(this.resumePrimary(s,e,r),this.shouldPlay&&sF(this.hls.media)):a&&this.isInterstitial(r)&&(this.endedItem=null,this.playingItem=r,r.event.appendInPlace||this.attachPrimary(n.durations.primary,null))}get playbackDisabled(){return!1===this.hls.config.enableInterstitialPlayback}get primaryDetails(){var e;return null==(e=this.mediaSelection)?void 0:e.main.details}get primaryLive(){var e;return!!(null!=(e=this.primaryDetails)&&e.live)}resumePrimary(e,t,i){var r,a;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log("resuming ".concat(sN(e))),!(null!=(r=this.detachedData)&&r.mediaSource)){let i=this.timelinePos;(i<e.start||i>=e.end)&&(i=this.getPrimaryResumption(e,t),this.log(sB("resumePrimary",i)),this.timelinePos=i),this.attachPrimary(i,e)}if(!i)return;let n=null==(a=this.schedule)?void 0:a.items;n&&(this.log("INTERSTITIALS_PRIMARY_RESUMED ".concat(sN(e))),this.hls.trigger(tB.INTERSTITIALS_PRIMARY_RESUMED,{schedule:n.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){let i=e.start;if(this.primaryLive){let e=this.primaryDetails;if(0===t)return this.hls.startPosition;if(e&&(i<e.fragmentStart||i>e.edge))return this.hls.liveSyncPosition||-1}return i}isAssetBuffered(e){let t=this.getAssetPlayer(e.identifier);return null!=t&&t.hls?t.hls.bufferedToEnd:rL.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,i){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;let r=this.primaryMedia;if(!r)return;let a=this.hls;a.media?this.checkBuffer():(this.transferMediaTo(a,r),i&&this.startLoadingPrimaryAt(e,i)),i||(this.log(sB("attachPrimary",e)),this.timelinePos=e,this.startLoadingPrimaryAt(e,i))}startLoadingPrimaryAt(e,t){var i;let r=this.hls;!r.loadingEnabled||!r.media||Math.abs(((null==(i=r.mainForwardBufferInfo)?void 0:i.start)||r.media.currentTime)-e)>.5?r.startLoad(e,t):r.bufferingEnabled||r.resumeBuffering()}onManifestLoading(){var e;this.stopLoad(),null==(e=this.schedule)||e.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(tB.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(tB.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(-1===t.level||!this.schedule)return;let i=this.hls.levels[t.level];if(!i.details)return;let r=tY(tY({},this.mediaSelection||this.altSelection),{},{main:i});this.mediaSelection=r,this.schedule.parseInterstitialDateRanges(r,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){let i=this.hls.audioTracks[t.id],r=this.mediaSelection;if(!r){this.altSelection=tY(tY({},this.altSelection),{},{audio:i});return}let a=tY(tY({},r),{},{audio:i});this.mediaSelection=a}onSubtitleTrackUpdated(e,t){let i=this.hls.subtitleTracks[t.id],r=this.mediaSelection;if(!r){this.altSelection=tY(tY({},this.altSelection),{},{subtitles:i});return}let a=tY(tY({},r),{},{subtitles:i});this.mediaSelection=a}onAudioTrackSwitching(e,t){let i=i$(t);this.playerQueue.forEach(e=>{let{hls:r}=e;return r&&(r.setAudioOption(t)||r.setAudioOption(i))})}onSubtitleTrackSwitch(e,t){let i=i$(t);this.playerQueue.forEach(e=>{let{hls:r}=e;return r&&(r.setSubtitleOption(t)||-1!==t.id&&r.setSubtitleOption(i))})}onBufferCodecs(e,t){let i=t.tracks;i&&(this.requiredTracks=i)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){let i=this.playingItem;if(i&&!this.itemsMatch(i,this.bufferingItem)&&!this.isInterstitial(i)){let e=this.timelinePos;this.bufferedPos=e,this.checkBuffer()}}onBufferedToEnd(e){if(!this.schedule)return;let t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let e=0;e<t.length;e++){let r=t[e];if(r.cue.post){var i;let e=this.schedule.findEventIndex(r.identifier),t=null==(i=this.schedule.items)?void 0:i[e];this.isInterstitial(t)&&this.eventItemsMatch(t,this.bufferingItem)&&this.bufferedToItem(t,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){let t=this.playingItem;if(!this.playingLastItem&&t){let e=this.findItemIndex(t);this.setSchedulePosition(e+1)}else this.shouldPlay=!1}updateItem(e,t){var i;let r=null==(i=this.schedule)?void 0:i.items;return e&&r&&r[this.findItemIndex(e,t)]||null}trimInPlace(e,t){if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach((t,i)=>{e.event.isAssetPastPlayoutLimit(i)&&this.clearAssetPlayer(t.identifier,null)});let i=e.end+.25,r=rL.bufferInfo(this.primaryMedia,i,0);(r.end>i||(r.nextStart||0)>i)&&(this.log("trim buffered interstitial ".concat(sN(e)," (was ").concat(sN(t),")")),this.attachPrimary(i,null,!0),this.flushFrontBuffer(i))}}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var i;return!!t&&(e===t||e.event.identifier===(null==(i=t.event)?void 0:i.identifier))}findItemIndex(e,t){return e&&this.schedule?this.schedule.findItemIndex(e,t):-1}updateSchedule(){var e;let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=this.mediaSelection;i&&(null==(e=this.schedule)||e.updateSchedule(i,[],t))}checkBuffer(e){var t;let i=null==(t=this.schedule)?void 0:t.items;if(!i)return;let r=rL.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=r.len<1),this.updateBufferedPos(r.end,i,e)}updateBufferedPos(e,t,i){let r=this.schedule,a=this.bufferingItem;if(this.bufferedPos>e||!r)return;if(1===t.length&&this.itemsMatch(t[0],a)){this.bufferedPos=e;return}let n=this.playingItem,s=this.findItemIndex(n),o=r.findItemIndexAtTime(e);if(this.bufferedPos<e){var l;let i=this.findItemIndex(a),r=Math.min(i+1,t.length-1),n=t[r];if((-1===o&&a&&e>=a.end||null!=(l=n.event)&&l.appendInPlace&&e+.01>=n.start)&&(o=r),this.isInterstitial(a)){let e=a.event;if(r-s>1&&!1===e.appendInPlace||0===e.assetList.length&&e.assetListLoader)return}if(this.bufferedPos=e,o>i&&o>s)this.bufferedToItem(n);else{let t=this.primaryDetails;this.primaryLive&&t&&e>t.edge-t.targetduration&&n.start<t.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(n)&&this.preloadAssets(n.event,0)}}else i&&n&&!this.itemsMatch(n,a)&&(o===s?this.bufferedToItem(n):o===s+1&&this.bufferedToItem(t[o]))}assetsBuffered(e,t){return 0!==e.event.assetList.length&&!e.event.assetList.some(e=>{let i=this.getAssetPlayer(e.identifier);return!(null!=i&&i.bufferedInPlaceToEnd(t))})}setBufferingItem(e){let t=this.bufferingItem,i=this.schedule;if(!this.itemsMatch(e,t)&&i){let{items:r,events:a}=i;if(!r||!a)return t;let n=this.isInterstitial(e),s=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));let o=s?s.remaining:t?t.end-this.timelinePos:0;if(this.log("INTERSTITIALS_BUFFERED_TO_BOUNDARY ".concat(sN(e))+(t?" (".concat(o.toFixed(2)," remaining)"):"")),!this.playbackDisabled)if(n){let t=i.findAssetIndex(e.event,this.bufferedPos);e.event.assetList.forEach((e,i)=>{let r=this.getAssetPlayer(e.identifier);r&&(i===t&&r.loadSource(),r.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(e=>e.pauseBuffering());this.hls.trigger(tB.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:a.slice(0),schedule:r.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==e&&(this.bufferingItem=e);return t}bufferedToItem(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(null!==i){this.bufferingAsset=null;let t=this.detachedData;t&&t.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e)}}}preloadPrimary(e){let t=this.findItemIndex(e),i=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(i)}bufferedToEvent(e,t){let i=e.event,r=0===i.assetList.length&&!i.assetListLoader,a=i.cue.once;if(r||!a){let e=this.preloadAssets(i,t);if(null!=e&&e.interstitial.appendInPlace){let t=this.primaryMedia;t&&this.bufferAssetPlayer(e,t)}}}preloadAssets(e,t){let i=e.assetUrl,r=e.assetList.length,a=0===r&&!e.assetListLoader,n=e.cue.once;if(a){let a,n=e.timelineStart;if(e.appendInPlace){var s;let t=this.playingItem;this.isInterstitial(t)||(null==t||null==(s=t.nextEvent)?void 0:s.identifier)!==e.identifier||this.flushFrontBuffer(n+.25)}let o=0;if(!this.playingItem&&this.primaryLive&&-1===(o=this.hls.startPosition)&&(o=this.hls.liveSyncPosition||0),o&&!(e.cue.pre||e.cue.post)){let e=o-n;e>0&&(a=Math.round(1e3*e)/1e3)}if(this.log("Load interstitial asset ".concat(t+1,"/").concat(i?1:r," ").concat(e).concat(a?" live-start: ".concat(o," start-offset: ").concat(a):"")),i)return this.createAsset(e,0,0,n,e.duration,i);let l=this.assetListLoader.loadAssetList(e,a);l&&(e.assetListLoader=l)}else if(!n&&r){for(let i=t;i<r;i++){let t=e.assetList[i],r=this.getAssetPlayerQueueIndex(t.identifier);(-1===r||this.playerQueue[r].destroyed)&&!t.error&&this.createAssetPlayer(e,t,i)}let i=e.assetList[t];if(i){let e=this.getAssetPlayer(i.identifier);return e&&e.loadSource(),e}}return null}flushFrontBuffer(e){let t=this.requiredTracks;t&&(this.log("Removing front buffer starting at ".concat(e)),Object.keys(t).forEach(t=>{this.hls.trigger(tB.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:t})}))}getAssetPlayerQueueIndex(e){let t=this.playerQueue;for(let i=0;i<t.length;i++)if(e===t[i].assetId)return i;return -1}getAssetPlayer(e){let t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){let{playerQueue:e,primaryMedia:t}=this;if(t){for(let i=0;i<e.length;i++)if(e[i].media===t)return e[i]}return null}createAsset(e,t,i,r,a,n){let s={parentIdentifier:e.identifier,identifier:"".concat(e.identifier,"-").concat(t+1,"-").concat(sk(n)),duration:a,startOffset:i,timelineStart:r,uri:n};return this.createAssetPlayer(e,s,t)}createAssetPlayer(e,t,i){let r=this.hls,a=r.userConfig,n=a.videoPreference,s=r.loadLevelObj||r.levels[r.currentLevel];(n||s)&&(n=tW({},n),s.videoCodec&&(n.videoCodec=s.videoCodec),s.videoRange&&(n.allowedVideoRanges=[s.videoRange]));let o=r.audioTracks[r.audioTrack],l=r.subtitleTracks[r.subtitleTrack],d=0;if(this.primaryLive||e.appendInPlace){let e=this.timelinePos-t.timelineStart;if(e>1){let i=t.duration;i&&e<i&&(d=e)}}let u=t.identifier,h=tY(tY({},a),{},{maxMaxBufferLength:Math.min(180,r.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:r.sessionId,assetPlayerId:u,abrEwmaDefaultEstimate:r.bandwidthEstimate,interstitialsController:void 0,startPosition:d,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:n,audioPreference:o||a.audioPreference,subtitlePreference:l||a.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(h.timelineOffset=t.timelineStart));let c=h.cmcd;null!=c&&c.sessionId&&c.contentId&&(h.cmcd=tW({},c,{contentId:sk(t.uri)})),this.getAssetPlayer(u)&&this.warn("Duplicate date range identifier ".concat(e," and asset ").concat(u));let m=new sP(this.HlsPlayerClass,h,e,t);this.playerQueue.push(m),e.assetList[i]=t;let f=!0,p=r=>{if(r.live){var a;let t=Error("Interstitials MUST be VOD assets ".concat(e)),r={fatal:!0,type:tU.OTHER_ERROR,details:tF.INTERSTITIAL_ASSET_ITEM_ERROR,error:t},n=(null==(a=this.schedule)?void 0:a.findEventIndex(e.identifier))||-1;this.handleAssetItemError(r,e,n,i,t.message);return}let n=r.edge-r.fragmentStart,s=t.duration;(f||null===s||n>s)&&(f=!1,this.log('Interstitial asset "'.concat(u,'" duration change ').concat(s," > ").concat(n)),t.duration=n,this.updateSchedule())};m.on(tB.LEVEL_UPDATED,(e,t)=>{let{details:i}=t;return p(i)}),m.on(tB.LEVEL_PTS_UPDATED,(e,t)=>{let{details:i}=t;return p(i)}),m.on(tB.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());let g=(e,t)=>{let i=this.getAssetPlayer(u);if(i&&t.tracks){i.off(tB.BUFFER_CODECS,g),i.tracks=t.tracks;let e=this.primaryMedia;this.bufferingAsset===i.assetItem&&e&&!i.media&&this.bufferAssetPlayer(i,e)}};m.on(tB.BUFFER_CODECS,g);let E=()=>{var i;let r=this.getAssetPlayer(u);if(this.log("buffered to end of asset ".concat(r)),!r||!this.schedule)return;let a=this.schedule.findEventIndex(e.identifier),n=null==(i=this.schedule.items)?void 0:i[a];this.isInterstitial(n)&&this.advanceAssetBuffering(n,t)};m.on(tB.BUFFERED_TO_END,E);let y=t=>()=>{if(!this.getAssetPlayer(u)||!this.schedule)return;this.shouldPlay=!0;let i=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,i,t)};return m.once(tB.MEDIA_ENDED,y(i)),m.once(tB.PLAYOUT_LIMIT_REACHED,y(1/0)),m.on(tB.ERROR,(t,r)=>{if(!this.schedule)return;let a=this.getAssetPlayer(u);if(r.details===tF.BUFFER_STALLED_ERROR)return null!=a&&a.appendInPlace?void this.handleInPlaceStall(e):(this.onTimeupdate(),void this.checkBuffer(!0));this.handleAssetItemError(r,e,this.schedule.findEventIndex(e.identifier),i,"Asset player error ".concat(r.error," ").concat(e))}),m.on(tB.DESTROYING,()=>{if(!this.getAssetPlayer(u)||!this.schedule)return;let t=Error("Asset player destroyed unexpectedly ".concat(u)),r={fatal:!0,type:tU.OTHER_ERROR,details:tF.INTERSTITIAL_ASSET_ITEM_ERROR,error:t};this.handleAssetItemError(r,e,this.schedule.findEventIndex(e.identifier),i,t.message)}),this.log("INTERSTITIAL_ASSET_PLAYER_CREATED ".concat(sO(t))),this.hls.trigger(tB.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:i,event:e,player:m}),m}clearInterstitial(e,t){e.assetList.forEach(e=>{this.clearAssetPlayer(e.identifier,t)}),e.reset()}resetAssetPlayer(e){let t=this.getAssetPlayerQueueIndex(e);if(-1!==t){this.log('reset asset player "'.concat(e,'" after error'));let i=this.playerQueue[t];this.transferMediaFromPlayer(i,null),i.resetDetails()}}clearAssetPlayer(e,t){let i=this.getAssetPlayerQueueIndex(e);if(-1!==i){let e=this.playerQueue[i];this.log("clear ".concat(e," toSegment: ").concat(t?sN(t):t)),this.transferMediaFromPlayer(e,t),this.playerQueue.splice(i,1),e.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,i,r,a){let{interstitial:n,assetItem:s,assetId:o}=e,l=n.assetList.length,d=this.playingAsset;this.endedAsset=null,this.playingAsset=s,d&&d.identifier===o||(d&&(this.clearAssetPlayer(d.identifier,i[r]),delete d.error),this.log("INTERSTITIAL_ASSET_STARTED ".concat(t+1,"/").concat(l," ").concat(sO(s))),this.hls.trigger(tB.INTERSTITIAL_ASSET_STARTED,{asset:s,assetListIndex:t,event:n,schedule:i.slice(0),scheduleIndex:r,player:e})),this.bufferAssetPlayer(e,a)}bufferAssetPlayer(e,t){var i,r;if(!this.schedule)return;let{interstitial:a,assetItem:n}=e,s=this.schedule.findEventIndex(a.identifier),o=null==(i=this.schedule.items)?void 0:i[s];if(!o)return;e.loadSource(),this.setBufferingItem(o),this.bufferingAsset=n;let l=this.getBufferingPlayer();if(l===e)return;let d=a.appendInPlace;if(d&&(null==l?void 0:l.interstitial.appendInPlace)===!1)return;let u=(null==l?void 0:l.tracks)||(null==(r=this.detachedData)?void 0:r.tracks)||this.requiredTracks;if(d&&n!==this.playingAsset){if(!e.tracks)return void this.log("Waiting for track info before buffering ".concat(e));if(u&&!t0(u,e.tracks)){let t=Error("Asset ".concat(sO(n)," SourceBuffer tracks ('").concat(Object.keys(e.tracks),"') are not compatible with primary content tracks ('").concat(Object.keys(u),"')")),i={fatal:!0,type:tU.OTHER_ERROR,details:tF.INTERSTITIAL_ASSET_ITEM_ERROR,error:t},r=a.findAssetIndex(n);this.handleAssetItemError(i,a,s,r,t.message);return}}this.transferMediaTo(e,t)}handleInPlaceStall(e){let t=this.schedule,i=this.primaryMedia;if(!t||!i)return;let r=i.currentTime,a=t.findAssetIndex(e,r),n=e.assetList[a];if(n){let s=this.getAssetPlayer(n.identifier);if(s){let o=s.currentTime||r-n.timelineStart,l=s.duration-o;if(this.warn("Stalled at ".concat(o," of ").concat(o+l," in ").concat(s," ").concat(e," (media.currentTime: ").concat(r,")")),o&&(l/i.playbackRate<.5||s.bufferedInPlaceToEnd(i))&&s.hls){let i=t.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,i,a)}}}}advanceInPlace(e){let t=this.primaryMedia;t&&t.currentTime<e&&(t.currentTime=e)}handleAssetItemError(e,t,i,r,a){if(e.details===tF.BUFFER_STALLED_ERROR)return;let n=t.assetList[r]||null;if(this.warn("INTERSTITIAL_ASSET_ERROR ".concat(n?sO(n):n," ").concat(e.error)),!this.schedule)return;let s=(null==n?void 0:n.identifier)||"",o=this.getAssetPlayerQueueIndex(s),l=this.playerQueue[o]||null,d=this.schedule.items,u=tW({},e,{fatal:!1,errorAction:rd(!0),asset:n,assetListIndex:r,event:t,schedule:d,scheduleIndex:i,player:l});if(this.hls.trigger(tB.INTERSTITIAL_ASSET_ERROR,u),!e.fatal)return;let h=this.playingAsset,c=this.bufferingAsset,m=Error(a);if(n&&(this.clearAssetPlayer(s,null),n.error=m),t.assetList.some(e=>!e.error))for(let e=r;e<t.assetList.length;e++)this.resetAssetPlayer(t.assetList[e].identifier);else t.error=m;this.updateSchedule(!0),t.error?this.primaryFallback(t):h&&h.identifier===s?this.advanceAfterAssetEnded(t,i,r):c&&c.identifier===s&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,c)}primaryFallback(e){let t=e.timelineStart,i=this.effectivePlayingItem;if(i){this.log('Fallback to primary from event "'.concat(e.identifier,'" start: ').concat(t," pos: ").concat(this.timelinePos," playing: ").concat(sN(i)," error: ").concat(e.error));let r=this.timelinePos;-1===r&&(r=this.hls.startPosition);let a=this.updateItem(i,r);if(this.itemsMatch(i,a)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t)),!this.schedule)return;let n=this.schedule.findItemIndexAtTime(r);this.setSchedulePosition(n)}else this.checkStart()}onAssetListLoaded(e,t){var i,r,a;let n=t.event,s=n.identifier,o=t.assetListResponse.ASSETS;if(!(null!=(i=this.schedule)&&i.hasEvent(s)))return;let l=n.timelineStart,d=n.duration,u=0;o.forEach((e,t)=>{let i=parseFloat(e.DURATION);this.createAsset(n,t,u,l+u,i,e.URI),u+=i}),n.duration=u,this.log("Loaded asset-list with duration: ".concat(u," (was: ").concat(d,") ").concat(n));let h=this.waitingItem,c=(null==h?void 0:h.event.identifier)===s;this.updateSchedule();let m=null==(r=this.bufferingItem)?void 0:r.event;if(c){let e=this.schedule.findEventIndex(s),t=null==(a=this.schedule.items)?void 0:a[e];if(t){if(!this.playingItem&&this.timelinePos>t.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==e){n.error=Error("Interstitial no longer within playback range ".concat(this.timelinePos," ").concat(n)),this.updateSchedule(!0),this.primaryFallback(n);return}this.setBufferingItem(t)}this.setSchedulePosition(e)}else if((null==m?void 0:m.identifier)===s){let e=n.assetList[0];if(e){let t=this.getAssetPlayer(e.identifier);if(m.appendInPlace){let e=this.primaryMedia;t&&e&&this.bufferAssetPlayer(t,e)}else t&&t.loadSource()}}}onError(e,t){if(this.schedule)switch(t.details){case tF.ASSET_LIST_PARSING_ERROR:case tF.ASSET_LIST_LOAD_ERROR:case tF.ASSET_LIST_LOAD_TIMEOUT:{let e=t.interstitial;e&&(this.updateSchedule(!0),this.primaryFallback(e));break}case tF.BUFFER_STALLED_ERROR:{let e=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(e)&&e.event.appendInPlace)return void this.handleInPlaceStall(e.event);this.log("Primary player stall @".concat(this.timelinePos," bufferedPos: ").concat(this.bufferedPos)),this.onTimeupdate(),this.checkBuffer(!0)}}}constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{var e,t;let i=this.currentTime;if(void 0===i||this.playbackDisabled||!this.schedule)return;let r=i-this.timelinePos;if(Math.abs(r)<1/7056e5)return;let a=r<=-.01;this.timelinePos=i,this.bufferedPos=i;let n=this.playingItem;if(!n)return void this.checkBuffer();if(a&&this.schedule.resetErrorsInRange(i,i-r)&&this.updateSchedule(!0),this.checkBuffer(),a&&i<n.start||i>=n.end){let t=this.findItemIndex(n),r=this.schedule.findItemIndexAtTime(i);if(-1===r&&(r=t+(a?-1:1),this.log("seeked ".concat(a?"back ":"","to position not covered by schedule ").concat(i," (resolving from ").concat(t," to ").concat(r,")"))),!this.isInterstitial(n)&&null!=(e=this.media)&&e.paused&&(this.shouldPlay=!1),!a&&r>t){let e=this.schedule.findJumpRestrictedIndex(t+1,r);if(e>t)return void this.setSchedulePosition(e)}this.setSchedulePosition(r);return}let s=this.playingAsset;if(!s){if(this.playingLastItem&&this.isInterstitial(n)){let e=n.event.assetList[0];e&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(i,e))}return}let o=s.timelineStart,l=s.duration||0;(a&&i<o||i>=o+l)&&(null!=(t=n.event)&&t.appendInPlace&&(this.clearInterstitial(n.event,n),this.flushFrontBuffer(i)),this.setScheduleToAssetAtTime(i,s))},this.onTimeupdate=()=>{let e=this.currentTime;if(void 0===e||this.playbackDisabled||!(e>this.timelinePos))return;this.timelinePos=e,e>this.bufferedPos&&this.checkBuffer();let t=this.playingItem;if(!t||this.playingLastItem)return;if(e>=t.end){this.timelinePos=t.end;let e=this.findItemIndex(t);this.setSchedulePosition(e+1)}let i=this.playingAsset;i&&e>=i.timelineStart+(i.duration||0)&&this.setScheduleToAssetAtTime(e,i)},this.onScheduleUpdate=(e,t)=>{let i=this.schedule;if(!i)return;let r=this.playingItem,a=i.events||[],n=i.items||[],s=i.durations,o=e.map(e=>e.identifier),l=!!(a.length||o.length);(l||t)&&this.log("INTERSTITIALS_UPDATED (".concat(a.length,"): ").concat(a,"\nSchedule: ").concat(n.map(e=>sN(e))," pos: ").concat(this.timelinePos)),o.length&&this.log("Removed events ".concat(o));let d=null,u=null;r&&(d=this.updateItem(r,this.timelinePos),this.itemsMatch(r,d)?this.playingItem=d:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);let h=this.bufferingItem;if(h&&(u=this.updateItem(h,this.bufferedPos),this.itemsMatch(h,u)?this.bufferingItem=u:h.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(h.event,null))),e.forEach(e=>{e.assetList.forEach(e=>{this.clearAssetPlayer(e.identifier,null)})}),this.playerQueue.forEach(e=>{if(e.interstitial.appendInPlace){let t=e.assetItem.timelineStart,i=e.timelineOffset-t;if(i)try{e.timelineOffset=t}catch(r){Math.abs(i)>.025&&this.warn("".concat(r,' ("').concat(e.assetId,'" ').concat(e.timelineOffset,"->").concat(t,")"))}}}),l||t){if(this.hls.trigger(tB.INTERSTITIALS_UPDATED,{events:a.slice(0),schedule:n.slice(0),durations:s,removedIds:o}),this.isInterstitial(r)&&o.includes(r.event.identifier)){this.warn('Interstitial "'.concat(r.event.identifier,'" removed while playing')),this.primaryFallback(r.event);return}r&&this.trimInPlace(d,r),h&&u!==d&&this.trimInPlace(u,h),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new sU(e),this.schedule=new sx(this.onScheduleUpdate,e.logger),this.registerListeners()}}});class oD extends rS{registerListeners(){let{hls:e}=this;e&&(e.on(tB.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(tB.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(tB.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){let{hls:e}=this;e&&(e.off(tB.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(tB.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(tB.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(100),this.mediaSource=t.mediaSource;let i=this.media=t.media;aT(i,"playing",this.onMediaPlaying),aT(i,"waiting",this.onMediaWaiting),aT(i,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();let{media:i}=this;i&&(a_(i,"playing",this.onMediaPlaying),a_(i,"waiting",this.onMediaWaiting),a_(i,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!(null!=(e=this.media)&&e.readyState)||!this.hasBuffered)return;let t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var i,r,a;let n=null==(i=this.hls)?void 0:i.config;if(!n)return;let s=this.media;if(!s)return;let{seeking:o}=s,l=this.seeking&&!o,d=!this.seeking&&o,u=s.paused&&!o||s.ended||0===s.playbackRate;if(this.seeking=o,e!==t){t&&(this.ended=0),this.moved=!0,!o&&(this.nudgeRetry=0,n.nudgeOnVideoHole&&!u&&e>t&&this.nudgeOnVideoHole(e,t)),0===this.waiting&&this.stallResolved(e);return}if(d||l){l&&this.stallResolved(e);return}if(u){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&s.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(tB.MEDIA_ENDED,{stalled:!1}));return}if(!rL.getBuffered(s).length){this.nudgeRetry=0;return}let h=rL.bufferInfo(s,e,0),c=h.nextStart||0,m=this.fragmentTracker;if(o&&m&&this.hls){let t=ow(this.hls.inFlightFragments,e),i=h.len>2,r=!c||t||c-e>2&&!m.getPartialFragment(e);if(i||r)return;this.moved=!1}let f=null==(r=this.hls)?void 0:r.latestLevelDetails;if(!this.moved&&null!==this.stalled&&m){if(!(h.len>0)&&!c)return;let t=Math.max(c,h.start||0)-e,i=null!=f&&f.live?2*f.targetduration:2,r=oM(e,m);if(t>0&&(t<=i||r)){s.paused||this._trySkipBufferHole(r);return}}let p=n.detectStallWithCurrentTimeMs,g=self.performance.now(),E=this.waiting,y=this.stalled;if(null===y)if(E>0&&g-E<p)y=this.stalled=E;else{this.stalled=g;return}let b=g-y;if(!o&&(b>=p||E)&&this.hls){if((null==(a=this.mediaSource)?void 0:a.readyState)==="ended"&&!(null!=f&&f.live)&&1>Math.abs(e-((null==f?void 0:f.edge)||0))){if(this.ended)return;this.ended=e||1,this.hls.trigger(tB.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(h),!this.media||!this.hls)return}let T=rL.bufferInfo(s,e,n.maxBufferHole);this._tryFixBufferStall(T,b,e)}stallResolved(e){let t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){let i=self.performance.now()-t;this.log("playback not stuck anymore @".concat(e,", after ").concat(Math.round(i),"ms")),this.stallReported=!1,this.waiting=0,this.hls.trigger(tB.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var i;let r=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&null!=(i=this.buffered.audio)&&i.length&&r&&r.length>1&&e>r.end(0)){let i=rL.bufferedInfo(rL.timeRangesToArray(this.buffered.audio),e,0);if(i.len>1&&t>=i.start){let i=rL.timeRangesToArray(r),a=rL.bufferedInfo(i,t,0).bufferedIndex;if(a>-1&&a<i.length-1){let t=rL.bufferedInfo(i,e,0).bufferedIndex,r=i[a].end,n=i[a+1].start;if((-1===t||t>a)&&n-r<1&&e-r<2){let i=Error("nudging playhead to flush pipeline after video hole. currentTime: ".concat(e," hole: ").concat(r," -> ").concat(n," buffered index: ").concat(t));this.warn(i.message),this.media.currentTime+=1e-6;let a=oM(e,this.fragmentTracker);a&&"fragment"in a?a=a.fragment:a||(a=void 0);let s=rL.bufferInfo(this.media,e,0);this.hls.trigger(tB.ERROR,{type:tU.MEDIA_ERROR,details:tF.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:i,reason:i.message,frag:a,buffer:s.len,bufferInfo:s})}}}}}_tryFixBufferStall(e,t,i){var r,a;let{fragmentTracker:n,media:s}=this,o=null==(r=this.hls)?void 0:r.config;if(!s||!n||!o)return;let l=null==(a=this.hls)?void 0:a.latestLevelDetails,d=oM(i,n);if((d||null!=l&&l.live&&i<l.fragmentStart)&&(this._trySkipBufferHole(d)||!this.media))return;let u=e.buffered,h=this.adjacentTraversal(e,i);(u&&u.length>1&&e.len>o.maxBufferHole||e.nextStart&&(e.nextStart-i<o.maxBufferHole||h))&&(t>1e3*o.highBufferWatchdogPeriod||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,t){let i=this.fragmentTracker,r=e.nextStart;if(i&&r){let e=i.getFragAtPos(t,tG.MAIN),a=i.getFragAtPos(r,tG.MAIN);if(e&&a)return a.sn-e.sn<2}return!1}_reportStall(e){let{hls:t,media:i,stallReported:r,stalled:a}=this;if(!r&&null!==a&&i&&t){this.stallReported=!0;let r=Error("Playback stalling at @".concat(i.currentTime," due to low buffer (").concat(iX(e),")"));this.warn(r.message),t.trigger(tB.ERROR,{type:tU.MEDIA_ERROR,details:tF.BUFFER_STALLED_ERROR,fatal:!1,error:r,buffer:e.len,bufferInfo:e,stalled:{start:a}})}}_trySkipBufferHole(e){var t,i;let{fragmentTracker:r,media:a}=this,n=null==(t=this.hls)?void 0:t.config;if(!a||!r||!n)return 0;let s=a.currentTime,o=rL.bufferInfo(a,s,0),l=s<o.start?o.start:o.nextStart;if(l&&this.hls){let t=o.len<=n.maxBufferHole,d=o.len>0&&o.len<1&&a.readyState<3,u=l-s;if(u>0&&(t||d)){if(u>n.maxBufferHole){let t=!1;if(0===s){let e=r.getAppendedFrag(0,tG.MAIN);e&&l<e.end&&(t=!0)}if(!t&&e){if(!(null!=(i=this.hls.loadLevelObj)&&i.details)||ow(this.hls.inFlightFragments,l))return 0;let t=!1,a=e.end;for(;a<l;){let e=oM(a,r);if(e)a+=e.duration;else{t=!0;break}}if(t)return 0}}let t=Math.max(l+.05,s+.1);if(this.warn("skipping hole, adjusting currentTime from ".concat(s," to ").concat(t)),this.moved=!0,a.currentTime=t,!(null!=e&&e.gap)){let i=Error("fragment loaded with buffer holes, seeking from ".concat(s," to ").concat(t)),r={type:tU.MEDIA_ERROR,details:tF.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:i,reason:i.message,buffer:o.len,bufferInfo:o};e&&("fragment"in e?r.part=e:r.frag=e),this.hls.trigger(tB.ERROR,r)}return t}}return 0}_tryNudgeBuffer(e){let{hls:t,media:i,nudgeRetry:r}=this,a=null==t?void 0:t.config;if(!i||!a)return 0;let n=i.currentTime;if(this.nudgeRetry++,r<a.nudgeMaxRetry){let s=n+(r+1)*a.nudgeOffset,o=Error("Nudging 'currentTime' from ".concat(n," to ").concat(s));this.warn(o.message),i.currentTime=s,t.trigger(tB.ERROR,{type:tU.MEDIA_ERROR,details:tF.BUFFER_NUDGE_ON_STALL,error:o,fatal:!1,buffer:e.len,bufferInfo:e})}else{let i=Error("Playhead still not moving while enough data buffered @".concat(n," after ").concat(a.nudgeMaxRetry," nudges"));this.error(i.message),t.trigger(tB.ERROR,{type:tU.MEDIA_ERROR,details:tF.BUFFER_STALLED_ERROR,error:i,fatal:!0,buffer:e.len,bufferInfo:e})}}constructor(e,t){super("gap-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var e;null!=(e=this.media)&&e.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var e;this.ended=(null==(e=this.media)?void 0:e.currentTime)||1,this.hls.trigger(tB.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=t,this.registerListeners()}}function ow(e,t){let i=oC(e.main);if(i&&i.start<=t)return i;let r=oC(e.audio);return r&&r.start<=t?r:null}function oC(e){if(!e)return null;switch(e.state){case aS.IDLE:case aS.STOPPED:case aS.ENDED:case aS.ERROR:return null}return e.frag}function oM(e,t){return t.getAppendedFrag(e,tG.MAIN)||t.getPartialFragment(e)}function oO(){if("undefined"!=typeof self)return self.VTTCue||self.TextTrackCue}function oP(e,t,i,r,a){let n=new e(t,i,"");try{n.value=r,a&&(n.type=a)}catch(s){n=new e(t,i,iX(a?tY({type:a},r):r))}return n}let ox=(()=>{let e=oO();try{e&&new e(0,1/0,"")}catch(e){return Number.MAX_VALUE}return 1/0})();class oN{destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){let{hls:e}=this;e&&(e.on(tB.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(tB.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(tB.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(tB.MANIFEST_LOADING,this.onManifestLoading,this),e.on(tB.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(tB.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(tB.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(tB.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){let{hls:e}=this;e&&(e.off(tB.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(tB.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(tB.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(tB.MANIFEST_LOADING,this.onManifestLoading,this),e.off(tB.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(tB.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(tB.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(tB.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(e,t){var i;this.media=t.media,(null==(i=t.overrides)?void 0:i.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){var e;let t=null==(e=this.hls)?void 0:e.latestLevelDetails;t&&this.updateDateRangeCues(t)}onMediaDetaching(e,t){this.media=null,t.transferMedia||(this.id3Track&&(this.removeCues&&sS(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){let t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){let i=e[t];if("metadata"===i.kind&&"id3"===i.label)return s_(i,this.media),i}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media||!this.hls)return;let{enableEmsgMetadataCues:i,enableID3MetadataCues:r}=this.hls.config;if(!i&&!r)return;let{samples:a}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));let n=oO();if(n)for(let e=0;e<a.length;e++){let t=a[e].type;if(t===aY.emsg&&!i||!r)continue;let s=aV(a[e].data),o=a[e].pts,l=o+a[e].duration;l>ox&&(l=ox),l-o<=0&&(l=o+.25);for(let e=0;e<s.length;e++){let i=s[e];if(!aW(i)){this.updateId3CueEnds(o,t);let e=oP(n,o,l,i,t);e&&this.id3Track.addCue(e)}}}}updateId3CueEnds(e,t){var i;let r=null==(i=this.id3Track)?void 0:i.cues;if(r)for(let i=r.length;i--;){let a=r[i];a.type===t&&a.startTime<e&&a.endTime===ox&&(a.endTime=e)}}onBufferFlushing(e,t){let{startOffset:i,endOffset:r,type:a}=t,{id3Track:n,hls:s}=this;if(!s)return;let{config:{enableEmsgMetadataCues:o,enableID3MetadataCues:l}}=s;n&&(o||l)&&sI(n,i,r,"audio"===a?e=>e.type===aY.audioId3&&l:"video"===a?e=>e.type===aY.emsg&&o:e=>e.type===aY.audioId3&&l||e.type===aY.emsg&&o)}onLevelUpdated(e,t){let{details:i}=t;this.updateDateRangeCues(i,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){var i,r;if(!this.hls||!this.media)return;let{assetPlayerId:a,timelineOffset:n,enableDateRangeMetadataCues:s,interstitialsController:o}=this.hls.config;if(!s)return;let l=oO();if(a&&n&&!o){let{fragmentStart:t,fragmentEnd:i}=e,r=this.assetCue;r?(r.startTime=t,r.endTime=i):l&&(r=this.assetCue=oP(l,t,i,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"))&&(r.id=a,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(r),r.addEventListener("enter",this.onEventCueEnter))}if(!e.hasProgramDateTime)return;let{id3Track:d}=this,{dateRanges:u}=e,h=Object.keys(u),c=this.dateRangeCuesAppended;if(d&&t)if(null!=(i=d.cues)&&i.length){let e=Object.keys(c).filter(e=>!h.includes(e));for(let t=e.length;t--;){let i=e[t],a=null==(r=c[i])?void 0:r.cues;delete c[i],a&&Object.keys(a).forEach(e=>{let t=a[e];if(t){t.removeEventListener("enter",this.onEventCueEnter);try{d.removeCue(t)}catch(e){}}})}}else c=this.dateRangeCuesAppended={};let m=e.fragments[e.fragments.length-1];if(0!==h.length&&tP(null==m?void 0:m.programDateTime)){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let e=0;e<h.length;e++){let t=h[e],i=u[t],r=i.startTime,a=c[t],n=(null==a?void 0:a.cues)||{},s=(null==a?void 0:a.durationKnown)||!1,d=ox,{duration:m,endDate:f}=i;if(f&&null!==m)d=r+m,s=!0;else if(i.endOnNext&&!s){let e=h.reduce((e,t)=>{if(t!==i.id){let r=u[t];if(r.class===i.class&&r.startDate>i.startDate&&(!e||i.startDate<e.startDate))return r}return e},null);e&&(d=e.startTime,s=!0)}let p=Object.keys(i.attr);for(let e=0;e<p.length;e++){let u=p[e];if("ID"===u||"CLASS"===u||"CUE"===u||"START-DATE"===u||"DURATION"===u||"END-DATE"===u||"END-ON-NEXT"===u)continue;let h=n[u];if(h)s&&!(null!=a&&a.durationKnown)?h.endTime=d:Math.abs(h.startTime-r)>.01&&(h.startTime=r,h.endTime=d);else if(l){let e=i.attr[u];("SCTE35-OUT"===u||"SCTE35-IN"===u||"SCTE35-CMD"===u)&&(e=t3(e));let a=oP(l,r,d,{key:u,data:e},aY.dateRange);a&&(a.id=t,this.id3Track.addCue(a),n[u]=a,o&&("X-ASSET-LIST"===u||"X-ASSET-URL"===u)&&a.addEventListener("enter",this.onEventCueEnter))}}c[t]={cues:n,dateRange:i,durationKnown:s}}}}constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(tB.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}}class oU{get levelDetails(){var e;return(null==(e=this.hls)?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){let{config:e}=this;if(void 0!==e.liveMaxLatencyDuration)return e.liveMaxLatencyDuration;let t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){let e=this.levelDetails;if(null===e||null===this.hls)return null;let{holdBack:t,partHoldBack:i,targetduration:r}=e,{liveSyncDuration:a,liveSyncDurationCount:n,lowLatencyMode:s}=this.config,o=this.hls.userConfig,l=s&&i||t;return(this._targetLatencyUpdated||o.liveSyncDuration||o.liveSyncDurationCount||0===l)&&(l=void 0!==a?a:n*r),l+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,r)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){let e=this.estimateLiveEdge(),t=this.targetLatency;if(null===e||null===t)return null;let i=this.levelDetails;if(null===i)return null;let r=i.edge,a=e-t-this.edgeStalled;return Math.min(Math.max(r-i.totalduration,a),r-(this.config.lowLatencyMode&&i.partTarget||i.targetduration))}get drift(){let e=this.levelDetails;return null===e?1:e.drift}get edgeStalled(){let e=this.levelDetails;if(null===e)return 0;let t=3*(this.config.lowLatencyMode&&e.partTarget||e.targetduration);return Math.max(e.age-t,0)}get forwardBufferLength(){let{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;let i=e.buffered.length;return(i?e.buffered.end(i-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){let{hls:e}=this;e&&(e.on(tB.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(tB.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(tB.MANIFEST_LOADING,this.onManifestLoading,this),e.on(tB.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(tB.ERROR,this.onError,this))}unregisterListeners(){let{hls:e}=this;e&&(e.off(tB.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(tB.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(tB.MANIFEST_LOADING,this.onManifestLoading,this),e.off(tB.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(tB.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,t){let{details:i}=t;i.advanced&&this.onTimeupdate(),!i.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var i;t.details===tF.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&null!=(i=this.levelDetails)&&i.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var i,r;e.playbackRate!==t&&(null==(i=this.hls)||i.logger.debug("[latency-controller]: latency=".concat(this.latency.toFixed(3),", targetLatency=").concat(null==(r=this.targetLatency)?void 0:r.toFixed(3),", forwardBufferLength=").concat(this.forwardBufferLength.toFixed(3),": adjusting playback rate from ").concat(e.playbackRate," to ").concat(t)),e.playbackRate=t)}estimateLiveEdge(){let e=this.levelDetails;return null===e?null:e.edge+e.age}computeLatency(){let e=this.estimateLiveEdge();return null===e?null:e-this.currentTime}constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{let{media:e}=this,t=this.levelDetails;if(!e||!t)return;this.currentTime=e.currentTime;let i=this.computeLatency();if(null===i)return;this._latency=i;let{lowLatencyMode:r,maxLiveSyncPlaybackRate:a}=this.config;if(!r||1===a||!t.live)return;let n=this.targetLatency;if(null===n)return;let s=i-n;if(s<Math.min(this.maxLatency,n+t.targetduration)&&s>.05&&this.forwardBufferLength>1){let t=Math.min(Math.min(2,Math.max(1,a)),Math.max(1,Math.round(2/(1+Math.exp(-.75*s-this.edgeStalled))*20)/20));this.changeMediaPlaybackRate(e,t)}else 1!==e.playbackRate&&0!==e.playbackRate&&this.changeMediaPlaybackRate(e,1)},this.hls=e,this.config=e.config,this.registerListeners()}}class oF extends nC{_registerListeners(){let{hls:e}=this;e.on(tB.MANIFEST_LOADING,this.onManifestLoading,this),e.on(tB.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(tB.LEVEL_LOADED,this.onLevelLoaded,this),e.on(tB.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(tB.FRAG_BUFFERED,this.onFragBuffered,this),e.on(tB.ERROR,this.onError,this)}_unregisterListeners(){let{hls:e}=this;e.off(tB.MANIFEST_LOADING,this.onManifestLoading,this),e.off(tB.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(tB.LEVEL_LOADED,this.onLevelLoaded,this),e.off(tB.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(tB.FRAG_BUFFERED,this.onFragBuffered,this),e.off(tB.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(e=>{e.loadError=0,e.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){let i=this.hls.config.preferManagedMediaSource,r=[],a={},n={},s=!1,o=!1,l=!1;t.levels.forEach(e=>{let t=e.attrs,{audioCodec:d,videoCodec:u}=e;d&&(e.audioCodec=d=iO(d,i)||void 0),u&&(u=e.videoCodec=function(e){let t=e.split(",");for(let e=0;e<t.length;e++){let i=t[e].split(".");i.length>2&&"avc1"===i[0]&&(t[e]="avc1.".concat(parseInt(i[1]).toString(16)).concat(("000"+parseInt(i[2]).toString(16)).slice(-4)))}return t.join(",")}(u));let{width:h,height:c,unknownCodecs:m}=e,f=(null==m?void 0:m.length)||0;if(s||(s=!!(h&&c)),o||(o=!!u),l||(l=!!d),f||d&&!this.isAudioSupported(d)||u&&!this.isVideoSupported(u))return void this.log('Some or all CODECS not supported "'.concat(t.CODECS,'"'));let{CODECS:p,"FRAME-RATE":g,"HDCP-LEVEL":E,"PATHWAY-ID":y,RESOLUTION:b,"VIDEO-RANGE":T}=t,_="".concat("".concat(y||".","-")).concat(e.bitrate,"-").concat(b,"-").concat(g,"-").concat(p,"-").concat(T,"-").concat(E);if(a[_])if(a[_].uri===e.url||e.attrs["PATHWAY-ID"])a[_].addGroupId("audio",t.AUDIO),a[_].addGroupId("text",t.SUBTITLES);else{let t=n[_]+=1;e.attrs["PATHWAY-ID"]=Array(t+1).join(".");let i=this.createLevel(e);a[_]=i,r.push(i)}else{let t=this.createLevel(e);a[_]=t,n[_]=1,r.push(t)}}),this.filterAndSortMediaOptions(r,t,s,o,l)}createLevel(e){let t=new iQ(e),i=e.supplemental;if(null!=i&&i.videoCodec&&!this.isVideoSupported(i.videoCodec)){let e=Error('SUPPLEMENTAL-CODECS not supported "'.concat(i.videoCodec,'"'));this.log(e.message),t.supportedResult=iH(e,[])}return t}isAudioSupported(e){return iR(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return iR(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,i,r,a){var n,s;let o=[],l=[],d=e,u=(null==(n=t.stats)?void 0:n.parsing)||{};if((i||r)&&a&&(d=d.filter(e=>{var t;let{videoCodec:i,videoRange:r,width:a,height:n}=e;return(!!i||!!(a&&n))&&!!(t=r)&&iW.indexOf(t)>-1})),0===d.length){Promise.resolve().then(()=>{if(this.hls){let e="no level with compatible codecs found in manifest",i=e;t.levels.length&&(i="one or more CODECS in variant not supported: ".concat(iX(t.levels.map(e=>e.attrs.CODECS).filter((e,t,i)=>i.indexOf(e)===t))),this.warn(i),e+=" (".concat(i,")"));let r=Error(e);this.hls.trigger(tB.ERROR,{type:tU.MEDIA_ERROR,details:tF.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:r,reason:i})}}),u.end=performance.now();return}t.audioTracks&&oB(o=t.audioTracks.filter(e=>!e.audioCodec||this.isAudioSupported(e.audioCodec))),t.subtitles&&oB(l=t.subtitles);let h=d.slice(0);d.sort((e,t)=>{if(e.attrs["HDCP-LEVEL"]!==t.attrs["HDCP-LEVEL"])return(e.attrs["HDCP-LEVEL"]||"")>(t.attrs["HDCP-LEVEL"]||"")?1:-1;if(i&&e.height!==t.height)return e.height-t.height;if(e.frameRate!==t.frameRate)return e.frameRate-t.frameRate;if(e.videoRange!==t.videoRange)return iW.indexOf(e.videoRange)-iW.indexOf(t.videoRange);if(e.videoCodec!==t.videoCodec){let i=iD(e.videoCodec),r=iD(t.videoCodec);if(i!==r)return r-i}if(e.uri===t.uri&&e.codecSet!==t.codecSet){let i=iw(e.codecSet),r=iw(t.codecSet);if(i!==r)return r-i}return e.averageBitrate!==t.averageBitrate?e.averageBitrate-t.averageBitrate:0});let c=h[0];if(this.steering&&(d=this.steering.filterParsedLevels(d)).length!==h.length){for(let e=0;e<h.length;e++)if(h[e].pathwayId===d[0].pathwayId){c=h[e];break}}this._levels=d;for(let e=0;e<d.length;e++)if(d[e]===c){this._firstLevel=e;let t=c.bitrate,i=this.hls.bandwidthEstimate;if(this.log("manifest loaded, ".concat(d.length," level(s) found, first bitrate: ").concat(t)),(null==(s=this.hls.userConfig)?void 0:s.abrEwmaDefaultEstimate)===void 0){let e=Math.min(t,this.hls.config.abrEwmaDefaultEstimateMax);e>i&&i===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=e)}break}let m=a&&!r,f=this.hls.config,p=!!(f.audioStreamController&&f.audioTrackController),g={levels:d,audioTracks:o,subtitleTracks:l,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:a,video:r,altAudio:p&&!m&&o.some(e=>!!e.url)};u.end=performance.now(),this.hls.trigger(tB.MANIFEST_PARSED,g)}get levels(){return 0===this._levels.length?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){let t=this._levels;if(0===t.length)return;if(e<0||e>=t.length){let i=Error("invalid level idx"),r=e<0;if(this.hls.trigger(tB.ERROR,{type:tU.OTHER_ERROR,details:tF.LEVEL_SWITCH_ERROR,level:e,fatal:r,error:i,reason:i.message}),r)return;e=Math.min(e,t.length-1)}let i=this.currentLevelIndex,r=this.currentLevel,a=r?r.attrs["PATHWAY-ID"]:void 0,n=t[e],s=n.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=n,i===e&&r&&a===s)return;this.log("Switching to level ".concat(e," (").concat(n.height?n.height+"p ":"").concat(n.videoRange?n.videoRange+" ":"").concat(n.codecSet?n.codecSet+" ":"","@").concat(n.bitrate,")").concat(s?" with Pathway "+s:""," from level ").concat(i).concat(a?" with Pathway "+a:""));let o={level:e,attrs:n.attrs,details:n.details,bitrate:n.bitrate,averageBitrate:n.averageBitrate,maxBitrate:n.maxBitrate,realBitrate:n.realBitrate,width:n.width,height:n.height,codecSet:n.codecSet,audioCodec:n.audioCodec,videoCodec:n.videoCodec,audioGroups:n.audioGroups,subtitleGroups:n.subtitleGroups,loaded:n.loaded,loadError:n.loadError,fragmentError:n.fragmentError,name:n.name,id:n.id,uri:n.uri,url:n.url,urlId:0,audioGroupIds:n.audioGroupIds,textGroupIds:n.textGroupIds};this.hls.trigger(tB.LEVEL_SWITCHING,o);let l=n.details;if(!l||l.live){let e=this.switchParams(n.uri,null==r?void 0:r.details,l);this.loadPlaylist(e)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(void 0===this._startLevel){let e=this.hls.config.startLevel;return void 0!==e?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){let t=this.steering.pathways(),i=e.filter(e=>-1!==t.indexOf(e));if(e.length<1)return void this.warn("pathwayPriority ".concat(e," should contain at least one pathway from list: ").concat(t));this.steering.pathwayPriority=i}}onError(e,t){!t.fatal&&t.context&&t.context.type===tH.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,t){let{frag:i}=t;if(void 0!==i&&i.type===tG.MAIN){let e=i.elementaryStreams;if(!Object.keys(e).some(t=>!!e[t]))return;let t=this._levels[i.level];null!=t&&t.loadError&&(this.log("Resetting level error count of ".concat(t.loadError," on frag buffered")),t.loadError=0)}}onLevelLoaded(e,t){var i,r;let{level:a,details:n}=t,s=t.levelInfo;if(!s){this.warn("Invalid level index ".concat(a)),null!=(r=t.deliveryDirectives)&&r.skip&&(n.deltaUpdateFailed=!0);return}if(s===this.currentLevel||t.withoutMultiVariant){0===s.fragmentError&&(s.loadError=0);let e=s.details;e===t.details&&e.advanced&&(e=void 0),this.playlistLoaded(a,t,e)}else null!=(i=t.deliveryDirectives)&&i.skip&&(n.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);let i=this.getUrlWithDirectives(e.uri,t),r=this.currentLevelIndex,a=e.attrs["PATHWAY-ID"],n=e.details,s=null==n?void 0:n.age;this.log("Loading level index ".concat(r).concat((null==t?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:"").concat(a?" Pathway "+a:"").concat(s&&n.live?" age "+s.toFixed(1)+(n.type?" "+n.type:""):""," ").concat(i)),this.hls.trigger(tB.LEVEL_LOADING,{url:i,level:r,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return -1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(1===this._levels.length)return;let i=this._levels.filter((t,i)=>i!==e||(this.steering&&this.steering.removeLevel(t),t===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,t.details&&t.details.fragments.forEach(e=>e.level=-1)),!1));af(i),this._levels=i,this.currentLevelIndex>-1&&null!=(t=this.currentLevel)&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);let r=i.length-1;this._firstLevel=Math.min(this._firstLevel,r),this._startLevel&&(this._startLevel=Math.min(this._startLevel,r)),this.hls.trigger(tB.LEVELS_UPDATED,{levels:i})}onLevelsUpdated(e,t){let{levels:i}=t;this._levels=i}checkMaxAutoUpdated(){let{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:i}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(tB.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:i}))}constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}}function oB(e){let t={};e.forEach(e=>{let i=e.groupId||"";e.id=t[i]=t[i]||0,t[i]++})}function oH(){return self.SourceBuffer||self.WebKitSourceBuffer}function oG(){if(!t$())return!1;let e=oH();return!e||e.prototype&&"function"==typeof e.prototype.appendBuffer&&"function"==typeof e.prototype.remove}class oK extends aI{registerListeners(){super.registerListeners();let{hls:e}=this;e.on(tB.MANIFEST_PARSED,this.onManifestParsed,this),e.on(tB.LEVEL_LOADING,this.onLevelLoading,this),e.on(tB.LEVEL_LOADED,this.onLevelLoaded,this),e.on(tB.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(tB.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(tB.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(tB.BUFFER_CREATED,this.onBufferCreated,this),e.on(tB.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(tB.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(tB.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();let{hls:e}=this;e.off(tB.MANIFEST_PARSED,this.onManifestParsed,this),e.off(tB.LEVEL_LOADED,this.onLevelLoaded,this),e.off(tB.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(tB.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(tB.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(tB.BUFFER_CREATED,this.onBufferCreated,this),e.off(tB.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(tB.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(tB.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){let{lastCurrentTime:i,hls:r}=this;if(this.stopLoad(),this.setInterval(100),this.level=-1,!this.startFragRequested){let e=r.startLevel;-1===e&&(r.config.testBandwidth&&this.levels.length>1?(e=0,this.bitrateTest=!0):e=r.firstAutoLevel),r.nextLoadLevel=e,this.level=r.loadLevel,this._hasEnoughToStart=!!t}i>0&&-1===e&&!t&&(this.log("Override startPosition with lastCurrentTime @".concat(i.toFixed(3))),e=i),this.state=aS.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=aS.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case aS.WAITING_LEVEL:{let{levels:e,level:t}=this,i=null==e?void 0:e[t],r=null==i?void 0:i.details;if(!r||r.live&&(this.levelLastLoaded!==i||this.waitForLive(i)))this.hls.nextLoadLevel!==this.level&&(this.state=aS.IDLE);else{if(this.waitForCdnTuneIn(r))break;this.state=aS.IDLE}break}case aS.FRAG_LOADING_WAITING_RETRY:this.checkRetryDate()}this.state===aS.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),null!=(e=this.media)&&e.readyState&&!1===this.media.seeking&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){let{hls:e,levelLastLoaded:t,levels:i,media:r}=this;if(null===t||!r&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;let a=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(null!=i&&i[a]))return;let n=i[a],s=this.getMainFwdBufferInfo();if(null===s)return;let o=this.getLevelDetails();if(o&&this._streamEnded(s,o)){let e={};2===this.altAudio&&(e.type="video"),this.hls.trigger(tB.BUFFER_EOS,e),this.state=aS.ENDED;return}if(!this.buffering)return;e.loadLevel!==a&&-1===e.manualLevel&&this.log("Adapting to level ".concat(a," from level ").concat(this.level)),this.level=e.nextLoadLevel=a;let l=n.details;if(!l||this.state===aS.WAITING_LEVEL||this.waitForLive(n)){this.level=a,this.state=aS.WAITING_LEVEL,this.startFragRequested=!1;return}let d=s.len,u=this.getMaxBufferLength(n.maxBitrate);if(d>=u)return;this.backtrackFragment&&this.backtrackFragment.start>s.end&&(this.backtrackFragment=null);let h=this.backtrackFragment?this.backtrackFragment.start:s.end,c=this.getNextFragment(h,l);if(this.couldBacktrack&&!this.fragPrevious&&c&&t7(c)&&this.fragmentTracker.getState(c)!==ru.OK){var m;let e=(null!=(m=this.backtrackFragment)?m:c).sn-l.startSN,t=l.fragments[e-1];t&&c.cc===t.cc&&(c=t,this.fragmentTracker.removeFragment(t))}else this.backtrackFragment&&s.len&&(this.backtrackFragment=null);if(c&&this.isLoopLoading(c,h)){if(!c.gap){let e=this.audioOnly&&!this.altAudio?t9.AUDIO:t9.VIDEO,t=(e===t9.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;t&&this.afterBufferFlushed(t,e,tG.MAIN)}c=this.getNextFragmentLoopLoading(c,l,s,tG.MAIN,u)}c&&(!c.initSegment||c.initSegment.data||this.bitrateTest||(c=c.initSegment),this.loadFragment(c,n,h))}loadFragment(e,t,i){let r=this.fragmentTracker.getState(e);r===ru.NOT_LOADED||r===ru.PARTIAL?t7(e)?this.bitrateTest?(this.log("Fragment ".concat(e.sn," of level ").concat(e.level," is being downloaded to test bitrate and will not be buffered")),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,i):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,tG.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,1/0)}nextLevelSwitch(){let{levels:e,media:t}=this;if(null!=t&&t.readyState){let i,r=this.getAppendedFrag(t.currentTime);r&&r.start>1&&this.flushMainBuffer(0,r.start-1);let a=this.getLevelDetails();if(null!=a&&a.live){let e=this.getMainFwdBufferInfo();if(!e||e.len<2*a.targetduration)return}if(!t.paused&&e){let t=e[this.hls.nextLoadLevel],r=this.fragLastKbps;i=r&&this.fragCurrent?this.fragCurrent.duration*t.maxBitrate/(1e3*r)+1:0}else i=0;let n=this.getBufferedFrag(t.currentTime+i);if(n){let e=this.followingBufferedFrag(n);if(e){this.abortCurrentFrag();let t=e.maxStartPTS?e.maxStartPTS:e.start,i=e.duration,r=Math.max(n.end,t+Math.min(Math.max(i-this.config.maxFragLookUpTolerance,i*(this.couldBacktrack?.5:.125)),i*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(r,1/0)}}}}abortCurrentFrag(){let e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case aS.KEY_LOADING:case aS.FRAG_LOADING:case aS.FRAG_LOADING_WAITING_RETRY:case aS.PARSING:case aS.PARSED:this.state=aS.IDLE}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,2===this.altAudio?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);let i=t.media;aT(i,"playing",this.onMediaPlaying),aT(i,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){let{media:i}=this;i&&(a_(i,"playing",this.onMediaPlaying),a_(i,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t),t.transferMedia||(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(tB.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let i=!1,r=!1;for(let e=0;e<t.levels.length;e++){let a=t.levels[e].audioCodec;a&&(i=i||-1!==a.indexOf("mp4a.40.2"),r=r||-1!==a.indexOf("mp4a.40.5"))}this.audioCodecSwitch=i&&r&&!function(){var e;let t=oH();return"function"==typeof(null==t||null==(e=t.prototype)?void 0:e.changeType)}(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){let{levels:i}=this;if(!i||this.state!==aS.IDLE)return;let r=t.levelInfo;(!r.details||r.details.live&&(this.levelLastLoaded!==r||r.details.expired)||this.waitForCdnTuneIn(r.details))&&(this.state=aS.WAITING_LEVEL)}onLevelLoaded(e,t){var i,r;let{levels:a,startFragRequested:n}=this,s=t.level,o=t.details,l=o.totalduration;if(!a)return void this.warn("Levels were reset while loading level ".concat(s));this.log("Level ".concat(s," loaded [").concat(o.startSN,",").concat(o.endSN,"]").concat(o.lastPartSn?"[part-".concat(o.lastPartSn,"-").concat(o.lastPartIndex,"]"):"",", cc [").concat(o.startCC,", ").concat(o.endCC,"] duration:").concat(l));let d=t.levelInfo,u=this.fragCurrent;u&&(this.state===aS.FRAG_LOADING||this.state===aS.FRAG_LOADING_WAITING_RETRY)&&u.level!==t.level&&u.loader&&this.abortCurrentFrag();let h=0;if(o.live||null!=(i=d.details)&&i.live){if(this.checkLiveUpdate(o),o.deltaUpdateFailed)return;h=this.alignPlaylists(o,d.details,null==(r=this.levelLastLoaded)?void 0:r.details)}if(d.details=o,this.levelLastLoaded=d,n||this.setStartPosition(o,h),this.hls.trigger(tB.LEVEL_UPDATED,{details:o,level:s}),this.state===aS.WAITING_LEVEL){if(this.waitForCdnTuneIn(o))return;this.state=aS.IDLE}n&&o.live&&this.synchronizeToLiveEdge(o),this.tick()}synchronizeToLiveEdge(e){let{config:t,media:i}=this;if(!i)return;let r=this.hls.liveSyncPosition,a=this.getLoadPosition(),n=e.fragmentStart,s=e.edge,o=a>=n-t.maxFragLookUpTolerance&&a<=s;if(null!==r&&i.duration>r&&(a<r||!o)){let n=void 0!==t.liveMaxLatencyDuration?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!o&&i.readyState<4||a<s-n)&&(this._hasEnoughToStart||(this.nextLoadPosition=r),i.readyState))if(this.warn("Playback: ".concat(a.toFixed(3)," is located too far from the end of live sliding playlist: ").concat(s,", reset currentTime to : ").concat(r.toFixed(3))),"buffered"===this.config.liveSyncMode){var l;let e=rL.bufferInfo(i,r,0);if(!(null!=(l=e.buffered)&&l.length)||e.start<=a){i.currentTime=r;return}let{nextStart:t}=rL.bufferedInfo(e.buffered,a,0);t&&(i.currentTime=t)}else i.currentTime=r}}_handleFragmentLoadProgress(e){var t;let i=e.frag,{part:r,payload:a}=e,{levels:n}=this;if(!n)return void this.warn("Levels were reset while fragment load was in progress. Fragment ".concat(i.sn," of level ").concat(i.level," will not be buffered"));let s=n[i.level];if(!s)return void this.warn("Level ".concat(i.level," not found on progress"));let o=s.details;if(!o){this.warn("Dropping fragment ".concat(i.sn," of level ").concat(i.level," after level details were reset")),this.fragmentTracker.removeFragment(i);return}let l=s.videoCodec,d=o.PTSKnown||!o.live,u=null==(t=i.initSegment)?void 0:t.data,h=this._getAudioCodec(s),c=this.transmuxer=this.transmuxer||new nw(this.hls,tG.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),m=r?r.index:-1,f=new rI(i.level,i.sn,i.stats.chunkCount,a.byteLength,m,-1!==m),p=this.initPTS[i.cc];c.push(a,u,h,l,i,r,o.totalduration,d,f,p)}onAudioTrackSwitching(e,t){let i=this.hls,r=2===this.altAudio;if(i4(t.url,i))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;let e=this.fragCurrent;e&&(this.log("Switching to main audio track, cancel main fragment load"),e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(r){this.fragmentTracker.removeAllFragments(),i.once(tB.BUFFER_FLUSHED,()=>{this.hls&&this.hls.trigger(tB.AUDIO_TRACK_SWITCHED,t)}),i.trigger(tB.BUFFER_FLUSHING,{startOffset:0,endOffset:1/0,type:null});return}i.trigger(tB.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){let i=i4(t.url,this.hls);if(i){let e=this.videoBuffer;e&&this.mediaBuffer!==e&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=e)}this.altAudio=2*!!i,this.tick()}onBufferCreated(e,t){let i,r,a=t.tracks,n=!1;for(let e in a){let t=a[e];if("main"===t.id){if(r=e,i=t,"video"===e){let t=a[e];t&&(this.videoBuffer=t.buffer)}}else n=!0}n&&i?(this.log("Alternate track found, use ".concat(r,".buffered to schedule main fragment loading")),this.mediaBuffer=i.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){let{frag:i,part:r}=t,a=i.type===tG.MAIN;if(a){if(this.fragContextChanged(i)){this.warn("Fragment ".concat(i.sn).concat(r?" p: "+r.index:""," of level ").concat(i.level," finished buffering, but was aborted. state: ").concat(this.state)),this.state===aS.PARSED&&(this.state=aS.IDLE);return}let e=r?r.stats:i.stats;this.fragLastKbps=Math.round(8*e.total/(e.buffering.end-e.loading.first)),t7(i)&&(this.fragPrevious=i),this.fragBufferedComplete(i,r)}let n=this.media;n&&(!this._hasEnoughToStart&&rL.getBuffered(n).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),a&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var i;if(t.fatal){this.state=aS.ERROR;return}switch(t.details){case tF.FRAG_GAP:case tF.FRAG_PARSING_ERROR:case tF.FRAG_DECRYPT_ERROR:case tF.FRAG_LOAD_ERROR:case tF.FRAG_LOAD_TIMEOUT:case tF.KEY_LOAD_ERROR:case tF.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(tG.MAIN,t);break;case tF.LEVEL_LOAD_ERROR:case tF.LEVEL_LOAD_TIMEOUT:case tF.LEVEL_PARSING_ERROR:t.levelRetry||this.state!==aS.WAITING_LEVEL||(null==(i=t.context)?void 0:i.type)!==tH.LEVEL||(this.state=aS.IDLE);break;case tF.BUFFER_ADD_CODEC_ERROR:case tF.BUFFER_APPEND_ERROR:if("main"!==t.parent)return;this.reduceLengthAndFlushBuffer(t)&&this.resetLoadingState();break;case tF.BUFFER_FULL_ERROR:if("main"!==t.parent)return;this.reduceLengthAndFlushBuffer(t)&&(!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,1/0));break;case tF.INTERNAL_EXCEPTION:this.recoverWorkerError(t)}}onFragLoadEmergencyAborted(){this.state=aS.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,t){let{type:i}=t;if(i!==t9.AUDIO||!this.altAudio){let e=(i===t9.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;e&&(this.afterBufferFlushed(e,i,tG.MAIN),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,-1===this.level&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){let{media:e}=this;if(!e)return;let t=e.currentTime,i=this.startPosition;if(i>=0&&t<i){if(e.seeking)return void this.log("could not seek to ".concat(i,", already seeking at ").concat(t));let r=this.timelineOffset;r&&i&&(i+=r);let a=this.getLevelDetails(),n=rL.getBuffered(e),s=n.length?n.start(0):0,o=s-i,l=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||o>0&&(o<l||this.loadingParts&&o<2*((null==a?void 0:a.partTarget)||0)))&&(this.log("adjusting start position by ".concat(o," to match buffer start")),i+=o,this.startPosition=i),t<i&&(this.log("seek to target start position ".concat(i," from current time ").concat(t," buffer start ").concat(s)),e.currentTime=i)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t=-1!==t.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(e=>{let{hls:i}=this,r=null==e?void 0:e.frag;if(!r||this.fragContextChanged(r))return;t.fragmentError=0,this.state=aS.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;let a=r.stats;a.parsing.start=a.parsing.end=a.buffering.start=a.buffering.end=self.performance.now(),i.trigger(tB.FRAG_LOADED,e),r.bitrateTest=!1}).catch(t=>{this.state!==aS.STOPPED&&this.state!==aS.ERROR&&(this.warn(t),this.resetFragmentLoading(e))})}_handleTransmuxComplete(e){let t=this.playlistType,{hls:i}=this,{remuxResult:r,chunkMeta:a}=e,n=this.getCurrentContext(a);if(!n)return void this.resetWhenMissingContext(a);let{frag:s,part:o,level:l}=n,{video:d,text:u,id3:h,initSegment:c}=r,{details:m}=l,f=this.altAudio?void 0:r.audio;if(this.fragContextChanged(s))return void this.fragmentTracker.removeFragment(s);if(this.state=aS.PARSING,c){let e=c.tracks;if(e){let r=s.initSegment||s;if(this.unhandledEncryptionError(c,s))return;this._bufferInitSegment(l,e,r,a),i.trigger(tB.FRAG_PARSING_INIT_SEGMENT,{frag:r,id:t,tracks:e})}let r=c.initPTS,n=c.timescale,o=this.initPTS[s.cc];if(tP(r)&&(!o||o.baseTime!==r||o.timescale!==n)){let e=c.trackId;this.initPTS[s.cc]={baseTime:r,timescale:n,trackId:e},i.trigger(tB.INIT_PTS_FOUND,{frag:s,id:t,initPTS:r,timescale:n,trackId:e})}}if(d&&m){f&&"audiovideo"===d.type&&this.logMuxedErr(s);let e=m.fragments[s.sn-1-m.startSN],t=s.sn===m.startSN,i=!e||s.cc>e.cc;if(!1!==r.independent){let{startPTS:e,endPTS:r,startDTS:n,endDTS:l}=d;if(o)o.elementaryStreams[d.type]={startPTS:e,endPTS:r,startDTS:n,endDTS:l};else if(d.firstKeyFrame&&d.independent&&1===a.id&&!i&&(this.couldBacktrack=!0),d.dropped&&d.independent){let a=this.getMainFwdBufferInfo(),n=(a?a.end:this.getLoadPosition())+this.config.maxBufferHole,o=d.firstKeyFramePTS?d.firstKeyFramePTS:e;if(!t&&n<o-this.config.maxBufferHole&&!i)return void this.backtrack(s);i&&(s.gap=!0),s.setElementaryStreamInfo(d.type,s.start,r,s.start,l,!0)}else t&&e-(m.appliedTimelineOffset||0)>2&&(s.gap=!0);s.setElementaryStreamInfo(d.type,e,r,n,l),this.backtrackFragment&&(this.backtrackFragment=s),this.bufferFragmentData(d,s,o,a,t||i)}else{if(!t&&!i)return void this.backtrack(s);s.gap=!0}}if(f){let{startPTS:e,endPTS:t,startDTS:i,endDTS:r}=f;o&&(o.elementaryStreams[t9.AUDIO]={startPTS:e,endPTS:t,startDTS:i,endDTS:r}),s.setElementaryStreamInfo(t9.AUDIO,e,t,i,r),this.bufferFragmentData(f,s,o,a)}if(m&&null!=h&&h.samples.length){let e={id:t,frag:s,details:m,samples:h.samples};i.trigger(tB.FRAG_PARSING_METADATA,e)}if(m&&u){let e={id:t,frag:s,details:m,samples:u.samples};i.trigger(tB.FRAG_PARSING_USERDATA,e)}}logMuxedErr(e){this.warn("".concat(t7(e)?"Media":"Init"," segment with muxed audiovideo where only video expected: ").concat(e.url))}_bufferInitSegment(e,t,i,r){if(this.state!==aS.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(i));let{audio:a,video:n,audiovideo:s}=t;if(a){let i=e.audioCodec,r=iP(a.codec,i);"mp4a"===r&&(r="mp4a.40.5");let n=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){r&&(r=-1!==r.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5");let e=a.metadata;e&&"channelCount"in e&&1!==(e.channelCount||1)&&-1===n.indexOf("firefox")&&(r="mp4a.40.5")}r&&-1!==r.indexOf("mp4a.40.5")&&-1!==n.indexOf("android")&&"audio/mpeg"!==a.container&&(r="mp4a.40.2",this.log("Android: force audio codec to ".concat(r))),i&&i!==r&&this.log('Swapping manifest audio codec "'.concat(i,'" for "').concat(r,'"')),a.levelCodec=r,a.id=tG.MAIN,this.log("Init audio buffer, container:".concat(a.container,", codecs[selected/level/parsed]=[").concat(r||"","/").concat(i||"","/").concat(a.codec,"]")),delete t.audiovideo}if(n){n.levelCodec=e.videoCodec,n.id=tG.MAIN;let i=n.codec;if((null==i?void 0:i.length)===4)switch(i){case"hvc1":case"hev1":n.codec="hvc1.1.6.L120.90";break;case"av01":n.codec="av01.0.04M.08";break;case"avc1":n.codec="avc1.42e01e"}this.log("Init video buffer, container:".concat(n.container,", codecs[level/parsed]=[").concat(e.videoCodec||"","/").concat(i,"]").concat(n.codec!==i?" parsed-corrected="+n.codec:"").concat(n.supplemental?" supplemental="+n.supplemental:"")),delete t.audiovideo}s&&(this.log("Init audiovideo buffer, container:".concat(s.container,", codecs[level/parsed]=[").concat(e.codecs,"/").concat(s.codec,"]")),delete t.video,delete t.audio);let o=Object.keys(t);if(o.length){if(this.hls.trigger(tB.BUFFER_CODECS,t),!this.hls)return;o.forEach(e=>{let a=t[e].initSegment;null!=a&&a.byteLength&&this.hls.trigger(tB.BUFFER_APPENDING,{type:e,data:a,frag:i,part:null,chunkMeta:r,parent:i.type})})}this.tickImmediate()}getMainFwdBufferInfo(){let e=this.mediaBuffer&&2===this.altAudio?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,tG.MAIN)}get maxBufferLength(){let{levels:e,level:t}=this,i=null==e?void 0:e[t];return i?this.getMaxBufferLength(i.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=aS.IDLE}checkFragmentChanged(){let e=this.media,t=null;if(e&&e.readyState>1&&!1===e.seeking){let i=e.currentTime;if(rL.isBuffered(e,i)?t=this.getAppendedFrag(i):rL.isBuffered(e,i+.1)&&(t=this.getAppendedFrag(i+.1)),t){this.backtrackFragment=null;let e=this.fragPlaying,i=t.level;(!e||t.sn!==e.sn||e.level!==i)&&(this.fragPlaying=t,this.hls.trigger(tB.FRAG_CHANGED,{frag:t}),e&&e.level===i||this.hls.trigger(tB.LEVEL_SWITCHED,{level:i}))}}}get nextLevel(){let e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;let t=(null==(e=this.media)?void 0:e.currentTime)||this.lastCurrentTime;return tP(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;let t=(null==(e=this.media)?void 0:e.currentTime)||this.lastCurrentTime;if(tP(t)){let e=this.getLevelDetails(),i=this.currentFrag||(e?i8(null,e.fragments,t):null);if(i){let e=i.programDateTime;if(null!==e)return new Date(e+(t-i.start)*1e3)}}return null}get currentLevel(){let e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){let e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}constructor(e,t,i){super(e,t,i,"stream-controller",tG.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{let e=this.media,t=e?e.currentTime:null;if(null===t||!tP(t)||(this.log("Media seeked to ".concat(t.toFixed(3))),!this.getBufferedFrag(t)))return;let i=this.getFwdBufferInfoAtPos(e,t,tG.MAIN,0);if(null===i||0===i.len)return void this.warn("Main forward buffer length at ".concat(t,' on "seeked" event ').concat(i?i.len:"empty",")"));this.tick()},this.registerListeners()}}class oV extends tj{abort(e){for(let i in this.keyIdToKeyInfo){let r=this.keyIdToKeyInfo[i].loader;if(r){var t;if(e&&e!==(null==(t=r.context)?void 0:t.frag.type))return;r.abort()}}}detach(){for(let e in this.keyIdToKeyInfo){let t=this.keyIdToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[e]}}destroy(){for(let e in this.detach(),this.keyIdToKeyInfo){let t=this.keyIdToKeyInfo[e].loader;t&&t.destroy()}this.keyIdToKeyInfo={}}createKeyLoadError(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:tF.KEY_LOAD_ERROR,i=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;return new rA({type:tU.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:a,error:i,networkDetails:r})}loadClear(e,t,i){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length)for(let r=0,a=t.length;r<a;r++){let n=t[r];if(e.cc<=n.cc&&(!t7(e)||!t7(n)||e.sn<n.sn)||!i&&r==a-1)return this.emeController.selectKeySystemFormat(n).then(e=>{if(!this.emeController)return;n.setKeyFormat(e);let t=rj(e);if(t)return this.emeController.getKeySystemAccess([t])})}if(this.config.requireKeySystemAccessOnStart){let e=rz(this.config);if(e.length)return this.emeController.getKeySystemAccess(e)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var i,r;t&&e.setKeyFormat(t);let a=e.decryptdata;if(!a){let i=Error(t?"Expected frag.decryptdata to be defined after setting format ".concat(t):"Missing decryption data on fragment in onKeyLoading (emeEnabled with controller: ".concat(this.emeController&&this.config.emeEnabled,")"));return Promise.reject(this.createKeyLoadError(e,tF.KEY_LOAD_ERROR,i))}let n=a.uri;if(!n)return Promise.reject(this.createKeyLoadError(e,tF.KEY_LOAD_ERROR,Error('Invalid key URI: "'.concat(n,'"'))));let s=oW(a),o=this.keyIdToKeyInfo[s];if(null!=(i=o)&&i.decryptdata.key)return a.key=o.decryptdata.key,Promise.resolve({frag:e,keyInfo:o});if(this.emeController&&null!=(r=o)&&r.keyLoadPromise)switch(this.emeController.getKeyStatus(o.decryptdata)){case"usable":case"usable-in-future":return o.keyLoadPromise.then(t=>{let{keyInfo:i}=t;return a.key=i.decryptdata.key,{frag:e,keyInfo:i}})}switch(this.log("".concat(this.keyIdToKeyInfo[s]?"Rel":"L","oading").concat(a.keyId?" keyId: "+t2(a.keyId):""," URI: ").concat(a.uri," from ").concat(e.type," ").concat(e.level)),o=this.keyIdToKeyInfo[s]={decryptdata:a,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},a.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":if("identity"===a.keyFormat)return this.loadKeyHTTP(o,e);return this.loadKeyEME(o,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(o,e);default:return Promise.reject(this.createKeyLoadError(e,tF.KEY_LOAD_ERROR,Error('Key supplied with unsupported METHOD: "'.concat(a.method,'"'))))}}loadKeyEME(e,t){let i={frag:t,keyInfo:e};return this.emeController&&this.config.emeEnabled?(e.keyLoadPromise=this.emeController.loadKey(i).then(t=>(e.mediaKeySessionContext=t,i))).catch(i=>{throw e.keyLoadPromise=null,"data"in i&&(i.data.frag=t),i}):Promise.resolve(i)}loadKeyHTTP(e,t){let i=this.config,r=new i.loader(i);return t.keyLoader=e.loader=r,e.keyLoadPromise=new Promise((a,n)=>{let s={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},o=i.keyLoadPolicy.default,l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0};r.load(s,l,{onSuccess:(e,t,i,r)=>{let{frag:s,keyInfo:o}=i,l=oW(o.decryptdata);if(!s.decryptdata||o!==this.keyIdToKeyInfo[l])return n(this.createKeyLoadError(s,tF.KEY_LOAD_ERROR,Error("after key load, decryptdata unset or changed"),r));o.decryptdata.key=s.decryptdata.key=new Uint8Array(e.data),s.keyLoader=null,o.loader=null,a({frag:s,keyInfo:o})},onError:(e,i,r,a)=>{this.resetLoader(i),n(this.createKeyLoadError(t,tF.KEY_LOAD_ERROR,Error("HTTP Error ".concat(e.code," loading key ").concat(e.text)),r,tY({url:s.url,data:void 0},e)))},onTimeout:(e,i,r)=>{this.resetLoader(i),n(this.createKeyLoadError(t,tF.KEY_LOAD_TIMEOUT,Error("key loading timed out"),r))},onAbort:(e,i,r)=>{this.resetLoader(i),n(this.createKeyLoadError(t,tF.INTERNAL_ABORTED,Error("key loading aborted"),r))}})})}resetLoader(e){let{frag:t,keyInfo:i,url:r}=e,a=i.loader;t.keyLoader===a&&(t.keyLoader=null,i.loader=null);let n=oW(i.decryptdata)||r;delete this.keyIdToKeyInfo[n],a&&a.destroy()}constructor(e,t){super("key-loader",t),this.config=void 0,this.keyIdToKeyInfo={},this.emeController=null,this.config=e}}function oW(e){if(e.keyFormat!==rY.FAIRPLAY){let t=e.keyId;if(t)return t2(t)}return e.uri}function oq(e){let{type:t}=e;switch(t){case tH.AUDIO_TRACK:return tG.AUDIO;case tH.SUBTITLE_TRACK:return tG.SUBTITLE;default:return tG.MAIN}}function oY(e,t){let i=e.url;return(void 0===i||0===i.indexOf("data:"))&&(i=t.url),i}class oj{startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){let{hls:e}=this;e.on(tB.MANIFEST_LOADING,this.onManifestLoading,this),e.on(tB.LEVEL_LOADING,this.onLevelLoading,this),e.on(tB.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(tB.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(tB.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){let{hls:e}=this;e.off(tB.MANIFEST_LOADING,this.onManifestLoading,this),e.off(tB.LEVEL_LOADING,this.onLevelLoading,this),e.off(tB.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(tB.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(tB.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){let t=this.hls.config,i=t.pLoader,r=t.loader,a=new(i||r)(t);return this.loaders[e.type]=a,a}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(let e in this.loaders){let t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){let{url:i}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:tH.MANIFEST,url:i,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){let{id:i,level:r,pathwayId:a,url:n,deliveryDirectives:s,levelInfo:o}=t;this.load({id:i,level:r,pathwayId:a,responseType:"text",type:tH.LEVEL,url:n,deliveryDirectives:s,levelOrTrack:o})}onAudioTrackLoading(e,t){let{id:i,groupId:r,url:a,deliveryDirectives:n,track:s}=t;this.load({id:i,groupId:r,level:null,responseType:"text",type:tH.AUDIO_TRACK,url:a,deliveryDirectives:n,levelOrTrack:s})}onSubtitleTrackLoading(e,t){let{id:i,groupId:r,url:a,deliveryDirectives:n,track:s}=t;this.load({id:i,groupId:r,level:null,responseType:"text",type:tH.SUBTITLE_TRACK,url:a,deliveryDirectives:n,levelOrTrack:s})}onLevelsUpdated(e,t){let i=this.loaders[tH.LEVEL];if(i){let e=i.context;e&&!t.levels.some(t=>t===e.levelOrTrack)&&(i.abort(),delete this.loaders[tH.LEVEL])}}load(e){var t;let i,r=this.hls.config,a=this.getInternalLoader(e);if(a){let t=this.hls.logger,i=a.context;if(i&&i.levelOrTrack===e.levelOrTrack&&(i.url===e.url||i.deliveryDirectives&&!e.deliveryDirectives))return void(i.url===e.url?t.log("[playlist-loader]: ignore ".concat(e.url," ongoing request")):t.log("[playlist-loader]: ignore ".concat(e.url," in favor of ").concat(i.url)));t.log("[playlist-loader]: aborting previous loader for type: ".concat(e.type)),a.abort()}if(i=e.type===tH.MANIFEST?r.manifestLoadPolicy.default:tW({},r.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),a=this.createInternalLoader(e),tP(null==(t=e.deliveryDirectives)?void 0:t.part)){let t;if(e.type===tH.LEVEL&&null!==e.level?t=this.hls.levels[e.level].details:e.type===tH.AUDIO_TRACK&&null!==e.id?t=this.hls.audioTracks[e.id].details:e.type===tH.SUBTITLE_TRACK&&null!==e.id&&(t=this.hls.subtitleTracks[e.id].details),t){let e=t.partTarget,r=t.targetduration;if(e&&r){let t=1e3*Math.max(3*e,.8*r);i=tW({},i,{maxTimeToFirstByteMs:Math.min(t,i.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(t,i.maxTimeToFirstByteMs)})}}}let n=i.errorRetry||i.timeoutRetry||{},s={loadPolicy:i,timeout:i.maxLoadTimeMs,maxRetry:n.maxNumRetry||0,retryDelay:n.retryDelayMs||0,maxRetryDelay:n.maxRetryDelayMs||0};a.load(e,s,{onSuccess:(e,t,i,r)=>{let a=this.getInternalLoader(i);this.resetInternalLoader(i.type);let n=e.data;t.parsing.start=performance.now(),r4.isMediaPlaylist(n)||i.type!==tH.MANIFEST?this.handleTrackOrLevelPlaylist(e,t,i,r||null,a):this.handleMasterPlaylist(e,t,i,r)},onError:(e,t,i,r)=>{this.handleNetworkError(t,i,!1,e,r)},onTimeout:(e,t,i)=>{this.handleNetworkError(t,i,!0,void 0,e)}})}checkAutostartLoad(){if(!this.hls)return;let{config:{autoStartLoad:e,startPosition:t},forceStartLoad:i}=this.hls;(e||i)&&(this.hls.logger.log("".concat(e?"auto":"force"," startLoad with configured startPosition ").concat(t)),this.hls.startLoad(t))}handleMasterPlaylist(e,t,i,r){let a=this.hls,n=e.data,s=oY(e,i),o=r4.parseMasterPlaylist(n,s);if(o.playlistParsingError){t.parsing.end=performance.now(),this.handleManifestParsingError(e,i,o.playlistParsingError,r,t);return}let{contentSteering:l,levels:d,sessionData:u,sessionKeys:h,startTimeOffset:c,variableList:m}=o;this.variableList=m,d.forEach(e=>{let{unknownCodecs:t}=e;if(t){let{preferManagedMediaSource:i}=this.hls.config,{audioCodec:r,videoCodec:a}=e;for(let n=t.length;n--;){let s=t[n];iR(s,"audio",i)?(e.audioCodec=r=r?"".concat(r,",").concat(s):s,iS.audio[r.substring(0,4)]=2,t.splice(n,1)):iR(s,"video",i)&&(e.videoCodec=a=a?"".concat(a,",").concat(s):s,iS.video[a.substring(0,4)]=2,t.splice(n,1))}}});let{AUDIO:f=[],SUBTITLES:p,"CLOSED-CAPTIONS":g}=r4.parseMasterPlaylistMedia(n,s,o);f.length&&(f.some(e=>!e.url)||!d[0].audioCodec||d[0].attrs.AUDIO||(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),f.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new rP({}),bitrate:0,url:""}))),a.trigger(tB.MANIFEST_LOADED,{levels:d,audioTracks:f,subtitles:p,captions:g,contentSteering:l,url:s,stats:t,networkDetails:r,sessionData:u,sessionKeys:h,startTimeOffset:c,variableList:m})}handleTrackOrLevelPlaylist(e,t,i,r,a){let n=this.hls,{id:s,level:o,type:l}=i,d=oY(e,i),u=tP(o)?o:tP(s)?s:0,h=oq(i),c=r4.parseLevelPlaylist(e.data,d,u,h,0,this.variableList);if(l===tH.MANIFEST){let e={attrs:new rP({}),bitrate:0,details:c,name:"",url:d};c.requestScheduled=t.loading.start+au(c,0),n.trigger(tB.MANIFEST_LOADED,{levels:[e],audioTracks:[],url:d,stats:t,networkDetails:r,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),i.levelDetails=c,this.handlePlaylistLoaded(c,e,t,i,r,a)}handleManifestParsingError(e,t,i,r,a){this.hls.trigger(tB.ERROR,{type:tU.NETWORK_ERROR,details:tF.MANIFEST_PARSING_ERROR,fatal:t.type===tH.MANIFEST,url:e.url,err:i,error:i,reason:i.message,response:e,context:t,networkDetails:r,stats:a})}handleNetworkError(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0,n="A network ".concat(i?"timeout":"error"+(r?" (status "+r.code+")":"")," occurred while loading ").concat(e.type);e.type===tH.LEVEL?n+=": ".concat(e.level," id: ").concat(e.id):(e.type===tH.AUDIO_TRACK||e.type===tH.SUBTITLE_TRACK)&&(n+=" id: ".concat(e.id,' group-id: "').concat(e.groupId,'"'));let s=Error(n);this.hls.logger.warn("[playlist-loader]: ".concat(n));let o=tF.UNKNOWN,l=!1,d=this.getInternalLoader(e);switch(e.type){case tH.MANIFEST:o=i?tF.MANIFEST_LOAD_TIMEOUT:tF.MANIFEST_LOAD_ERROR,l=!0;break;case tH.LEVEL:o=i?tF.LEVEL_LOAD_TIMEOUT:tF.LEVEL_LOAD_ERROR,l=!1;break;case tH.AUDIO_TRACK:o=i?tF.AUDIO_TRACK_LOAD_TIMEOUT:tF.AUDIO_TRACK_LOAD_ERROR,l=!1;break;case tH.SUBTITLE_TRACK:o=i?tF.SUBTITLE_TRACK_LOAD_TIMEOUT:tF.SUBTITLE_LOAD_ERROR,l=!1}d&&this.resetInternalLoader(e.type);let u={type:tU.NETWORK_ERROR,details:o,fatal:l,url:e.url,loader:d,context:e,error:s,networkDetails:t,stats:a};r&&(u.response=tY({url:(null==t?void 0:t.url)||e.url,data:void 0},r)),this.hls.trigger(tB.ERROR,u)}handlePlaylistLoaded(e,t,i,r,a,n){let s=this.hls,{type:o,level:l,levelOrTrack:d,id:u,groupId:h,deliveryDirectives:c}=r,m=oY(t,r),f=oq(r),p="number"==typeof r.level&&f===tG.MAIN?l:void 0,g=e.playlistParsingError;if(g){if(this.hls.logger.warn("".concat(g," ").concat(e.url)),!s.config.ignorePlaylistParsingErrors)return void s.trigger(tB.ERROR,{type:tU.NETWORK_ERROR,details:tF.LEVEL_PARSING_ERROR,fatal:!1,url:m,error:g,reason:g.message,response:t,context:r,level:p,parent:f,networkDetails:a,stats:i});e.playlistParsingError=null}if(!e.fragments.length){let n=e.playlistParsingError=Error("No Segments found in Playlist");s.trigger(tB.ERROR,{type:tU.NETWORK_ERROR,details:tF.LEVEL_EMPTY_ERROR,fatal:!1,url:m,error:n,reason:n.message,response:t,context:r,level:p,parent:f,networkDetails:a,stats:i});return}switch(e.live&&n&&(n.getCacheAge&&(e.ageHeader=n.getCacheAge()||0),(!n.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),o){case tH.MANIFEST:case tH.LEVEL:if(p)if(d){if(d!==s.levels[p]){let e=s.levels.indexOf(d);e>-1&&(p=e)}}else p=0;s.trigger(tB.LEVEL_LOADED,{details:e,levelInfo:d||s.levels[0],level:p||0,id:u||0,stats:i,networkDetails:a,deliveryDirectives:c,withoutMultiVariant:o===tH.MANIFEST});break;case tH.AUDIO_TRACK:s.trigger(tB.AUDIO_TRACK_LOADED,{details:e,track:d,id:u||0,groupId:h||"",stats:i,networkDetails:a,deliveryDirectives:c});break;case tH.SUBTITLE_TRACK:s.trigger(tB.SUBTITLE_TRACK_LOADED,{details:e,track:d,id:u||0,groupId:h||"",stats:i,networkDetails:a,deliveryDirectives:c})}}constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}}class oQ{static get version(){return aw}static isMSESupported(){return oG()}static isSupported(){if(!oG())return!1;let e=t$();return"function"==typeof(null==e?void 0:e.isTypeSupported)&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(t=>e.isTypeSupported(iL(t,"video")))||["mp4a.40.2","fLaC"].some(t=>e.isTypeSupported(iL(t,"audio"))))}static getMediaSource(){return t$()}static get Events(){return tB}static get MetadataSchema(){return aY}static get ErrorTypes(){return tU}static get ErrorDetails(){return tF}static get DefaultConfig(){return oQ.defaultConfig?oQ.defaultConfig:oL}static set DefaultConfig(e){oQ.defaultConfig=e}createController(e,t){if(e){let i=new e(this);return t&&t.push(i),i}return null}on(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;this._emitter.on(e,t,i)}once(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;this._emitter.once(e,t,i)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,r=arguments.length>3?arguments[3]:void 0;this._emitter.off(e,t,i,r)}listeners(e){return this._emitter.listeners(e)}emit(e,t,i){return this._emitter.emit(e,t,i)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(t){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+t.message+'". Here is a stacktrace:',t),!this.triggeringException){this.triggeringException=!0;let i=e===tB.ERROR;this.trigger(tB.ERROR,{type:tU.OTHER_ERROR,details:tF.INTERNAL_EXCEPTION,fatal:i,event:e,error:t}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(tB.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(e=>e.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(e=>e.destroy()),this.coreComponents.length=0;let e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){let t=Error("attachMedia failed: invalid argument (".concat(e,")"));this.trigger(tB.ERROR,{type:tU.OTHER_ERROR,details:tF.ATTACH_MEDIA_ERROR,fatal:!0,error:t});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());let t="media"in e,i=t?e.media:e,r=t?e:{media:i};this._media=i,this.trigger(tB.MEDIA_ATTACHING,r)}detachMedia(){this.logger.log("detachMedia"),this.trigger(tB.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;let e=this.bufferController.transferMedia();return this.trigger(tB.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();let t=this.media,i=this._url,r=this._url=t5.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log("loadSource:".concat(r)),t&&i&&(i!==r||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(tB.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,t=arguments.length>1?arguments[1]:void 0;this.logger.log("startLoad(".concat(e+(t?", <skip seek to start>":""),")")),this.started=!0,this.resumeBuffering();for(let i=0;i<this.networkControllers.length&&(this.networkControllers[i].startLoad(e,t),this.started&&this.networkControllers);i++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!this.started&&this.networkControllers);e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){let e={[tG.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[tG.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[tG.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");let e=this._media,t=null==e?void 0:e.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=function(){try{return crypto.randomUUID()}catch(e){try{let e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch(t){let e=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{let i=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?i:3&i|8).toString(16)})}}}()),e}get levels(){return this.levelController.levels||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log("set currentLevel:".concat(e)),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log("set nextLevel:".concat(e)),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log("set loadLevel:".concat(e)),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log("set firstLevel:".concat(e)),this.levelController.firstLevel=e}get startLevel(){let e=this.levelController.startLevel;return -1===e&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log("set startLevel:".concat(e)),-1!==e&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){let t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){let{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){let{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){let{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log("set autoLevelCapping:".concat(e)),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){iV.indexOf(e)>-1&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return -1===this.levelController.manualLevel}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){let{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;let i=e.length;for(let r=0;r<i;r++)if(e[r].maxBitrate>=t)return r;return 0}get maxAutoLevel(){let e,{levels:t,autoLevelCapping:i,maxHdcpLevel:r}=this;if(e=-1===i&&null!=t&&t.length?t.length-1:i,r)for(let i=e;i--;){let e=t[i].attrs["HDCP-LEVEL"];if(e&&e<=r)return i}return e}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return(null==(t=this.audioTrackController)?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return(null==(t=this.subtitleTrackController)?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){let e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){let e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){let e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){let t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){let e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){let e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){let e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){let t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){let e=this.subtitleTrackController;return!!e&&e.subtitleDisplay}set subtitleDisplay(e){let t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!!(null!=(e=this.bufferController)&&e.bufferedToEnd)}get interstitialsManager(){var e;return(null==(e=this.interstitialsController)?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.allAudioTracks;return iG(e,iJ(t),navigator.mediaCapabilities)}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new aD,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;let t=this.logger=function(e,t,i){let r=tX();if("object"==typeof console&&!0===e||"object"==typeof e){let a=["debug","log","info","warn","error"];a.forEach(t=>{r[t]=tZ(t,e,i)});try{r.log('Debug logs enabled for "'.concat(t,'" in hls.js version ',"1.6.12"))}catch(e){return tX()}a.forEach(t=>{tJ[t]=tZ(t,e)})}else tW(tJ,r);return r}(e.debug||!1,"Hls instance",e.assetPlayerId),i=this.config=function(e,t,i){if((t.liveSyncDurationCount||t.liveMaxLatencyDurationCount)&&(t.liveSyncDuration||t.liveMaxLatencyDuration))throw Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==t.liveMaxLatencyDurationCount&&(void 0===t.liveSyncDurationCount||t.liveMaxLatencyDurationCount<=t.liveSyncDurationCount))throw Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==t.liveMaxLatencyDuration&&(void 0===t.liveSyncDuration||t.liveMaxLatencyDuration<=t.liveSyncDuration))throw Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');let r=function e(t){return t&&"object"==typeof t?Array.isArray(t)?t.map(e):Object.keys(t).reduce((i,r)=>(i[r]=e(t[r]),i),{}):t}(e),a=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return["manifest","level","frag"].forEach(e=>{let n="".concat("level"===e?"playlist":e,"LoadPolicy"),s=void 0===t[n],o=[];a.forEach(i=>{let a="".concat(e,"Loading").concat(i),l=t[a];if(void 0!==l&&s){o.push(a);let e=r[n].default;switch(t[n]={default:e},i){case"TimeOut":e.maxLoadTimeMs=l,e.maxTimeToFirstByteMs=l;break;case"MaxRetry":e.errorRetry.maxNumRetry=l,e.timeoutRetry.maxNumRetry=l;break;case"RetryDelay":e.errorRetry.retryDelayMs=l,e.timeoutRetry.retryDelayMs=l;break;case"MaxRetryTimeout":e.errorRetry.maxRetryDelayMs=l,e.timeoutRetry.maxRetryDelayMs=l}}}),o.length&&i.warn('hls.js config: "'.concat(o.join('", "'),'" setting(s) are deprecated, use "').concat(n,'": ').concat(iX(t[n])))}),tY(tY({},r),t)}(oQ.DefaultConfig,e,t);this.userConfig=e,i.progressive&&function(e,t){let i=e.loader;i!==oA&&i!==ok?(t.log("[config]: Custom loader detected, cannot enable progressive streaming"),e.progressive=!1):function(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(e){}return!1}()&&(e.loader=oA,e.progressive=!0,e.enableSoftwareAES=!0,t.log("[config]: Progressive streaming enabled, using FetchLoader"))}(i,t);let{abrController:r,bufferController:a,capLevelController:n,errorController:s,fpsController:o}=i,l=new s(this),d=this.abrController=new r(this),u=new rh(this),h=i.interstitialsController,c=h?this.interstitialsController=new h(this,oQ):null,m=this.bufferController=new a(this,u),f=this.capLevelController=new n(this),p=new o(this),g=new oj(this),E=i.contentSteeringController,y=E?new E(this):null,b=this.levelController=new oF(this,y),T=new oN(this),_=new oV(this.config,this.logger),A=this.streamController=new oK(this,u,_),S=this.gapController=new oD(this,u);f.setStreamController(A),p.setStreamController(A);let I=[g,b,A];c&&I.splice(1,0,c),y&&I.splice(1,0,y),this.networkControllers=I;let R=[d,m,S,f,p,T,u];this.audioTrackController=this.createController(i.audioTrackController,I);let k=i.audioStreamController;k&&I.push(this.audioStreamController=new k(this,u,_)),this.subtitleTrackController=this.createController(i.subtitleTrackController,I);let L=i.subtitleStreamController;L&&I.push(this.subtititleStreamController=new L(this,u,_)),this.createController(i.timelineController,R),_.emeController=this.emeController=this.createController(i.emeController,R),this.cmcdController=this.createController(i.cmcdController,R),this.latencyController=this.createController(oU,R),this.coreComponents=R,I.push(l);let D=l.onErrorOut;"function"==typeof D&&this.on(tB.ERROR,D,l),this.on(tB.MANIFEST_LOADED,g.onManifestLoaded,g)}}oQ.defaultConfig=void 0;var oz={VIDEO:"video",DRM:"drm"},oX={NETWORK_OFFLINE:2000002,NETWORK_UNKNOWN_ERROR:2e6,NETWORK_INVALID_URL:24e5,NETWORK_NOT_FOUND:2404e3,NETWORK_NOT_READY:2412e3,NETWORK_TOKEN_MISSING:2403201,NETWORK_TOKEN_MALFORMED:2412202,NETWORK_TOKEN_EXPIRED:2403210,NETWORK_TOKEN_AUD_MISSING:2403221,NETWORK_TOKEN_AUD_MISMATCH:2403222,NETWORK_TOKEN_SUB_MISMATCH:2403232,ENCRYPTED_ERROR:5e6,ENCRYPTED_UNSUPPORTED_KEY_SYSTEM:5000001,ENCRYPTED_GENERATE_REQUEST_FAILED:5000002,ENCRYPTED_UPDATE_LICENSE_FAILED:5000003,ENCRYPTED_UPDATE_SERVER_CERT_FAILED:5000004,ENCRYPTED_CDM_ERROR:5000005,ENCRYPTED_OUTPUT_RESTRICTED:5000006,ENCRYPTED_MISSING_TOKEN:5000002},oZ=e=>e===oz.VIDEO?"playback":e,oJ=class e extends Error{constructor(t,i=e.MEDIA_ERR_CUSTOM,r,a){var n;super(t),this.name="MediaError",this.code=i,this.context=a,this.fatal=null!=r?r:i>=e.MEDIA_ERR_NETWORK&&i<=e.MEDIA_ERR_ENCRYPTED,this.message||(this.message=null!=(n=e.defaultMessages[this.code])?n:"")}};oJ.MEDIA_ERR_ABORTED=1,oJ.MEDIA_ERR_NETWORK=2,oJ.MEDIA_ERR_DECODE=3,oJ.MEDIA_ERR_SRC_NOT_SUPPORTED=4,oJ.MEDIA_ERR_ENCRYPTED=5,oJ.MEDIA_ERR_CUSTOM=100,oJ.defaultMessages={1:"You aborted the media playback",2:"A network error caused the media download to fail.",3:"A media error caused playback to be aborted. The media could be corrupt or your browser does not support this format.",4:"An unsupported error occurred. The server or network failed, or your browser does not support this format.",5:"The media is encrypted and there are no keys to decrypt it."};var o$=(e,t)=>null!=t&&e in t,o0={ANY:"any",MUTED:"muted"},o1={ON_DEMAND:"on-demand",LIVE:"live",UNKNOWN:"unknown"},o2={MSE:"mse",NATIVE:"native"},o3={HEADER:"header",QUERY:"query",NONE:"none"},o4=Object.values(o3),o5={M3U8:"application/vnd.apple.mpegurl",MP4:"video/mp4"},o8={HLS:o5.M3U8};Object.keys(o8),[...Object.values(o5)];var o9={code:"en"},o6=function(e,t,i,r){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:e;a.addEventListener(t,i,r),e.addEventListener("teardown",()=>{a.removeEventListener(t,i)},{once:!0})},o7=e=>{let t=e.indexOf("?");return t<0?[e]:[e.slice(0,t),e.slice(t)]},le=e=>{let{type:t}=e;if(t){let e=t.toUpperCase();return o$(e,o8)?o8[e]:t}return lr(e)},lt=e=>"VOD"===e?o1.ON_DEMAND:o1.LIVE,li=e=>"EVENT"===e?1/0:"VOD"===e?NaN:0,lr=e=>{let{src:t}=e;if(!t)return"";let i="";try{i=new URL(t).pathname}catch(e){console.error("invalid url")}let r=i.lastIndexOf(".");if(r<0)return la(e)?o5.M3U8:"";let a=i.slice(r+1).toUpperCase();return o$(a,o5)?o5[a]:""},la=e=>{let t,{src:i,customDomain:r="mux.com"}=e;try{t=new URL("".concat(i))}catch(e){return!1}let a="https:"===t.protocol,n=t.hostname==="stream.".concat(r).toLowerCase(),s=t.pathname.split("/"),o=2===s.length,l=!(null!=s&&s[1].includes("."));return a&&n&&o&&l},ln=e=>{let t=(null!=e?e:"").split(".")[1];if(t)try{let e=t.replace(/-/g,"+").replace(/_/g,"/"),i=decodeURIComponent(atob(e).split("").map(function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(i)}catch(e){return}},ls=function(e){let{exp:t}=e,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now();return!t||1e3*t<i};function lo(e){var t;let i=!(arguments.length>1)||void 0===arguments[1]||arguments[1];return new ll(i&&null!=(t=null==o9?void 0:o9[e])?t:e,i?o9.code:"en")}var ll=class{format(e){return this.message.replace(/\{(\w+)\}/g,(t,i)=>{var r;return null!=(r=e[i])?r:""})}toString(){return this.message}constructor(e,t=(e=>null!=(e=o9)?e:"en")()){this.message=e,this.locale=t}},ld=Object.values(o0),lu=e=>"boolean"==typeof e||"string"==typeof e&&ld.includes(e),lh=(e,t)=>{if(!t)return;let i=e.muted,r=()=>e.muted=i;switch(t){case o0.ANY:e.play().catch(()=>{e.muted=!0,e.play().catch(r)});break;case o0.MUTED:e.muted=!0,e.play().catch(r);break;default:e.play().catch(()=>{})}},lc=e=>"time"in e?e.time:e.startTime;function lm(e,t,i,r,a,n){let s=document.createElement("track");return s.kind=t,s.label=i,r&&(s.srclang=r),a&&(s.id=a),n&&(s.default=!0),s.track.mode=["subtitles","captions"].includes(t)?"disabled":"hidden",s.setAttribute("data-removeondestroy",""),e.append(s),s.track}function lf(e,t,i){var r;return null==(r=Array.from(e.querySelectorAll("track")).find(e=>e.track.label===t&&e.track.kind===i))?void 0:r.track}async function lp(e,t,i,r){let a=lf(e,i,r);return a||((a=lm(e,r,i)).mode="hidden",await new Promise(e=>setTimeout(()=>e(void 0),0))),"hidden"!==a.mode&&(a.mode="hidden"),[...t].sort((e,t)=>lc(t)-lc(e)).forEach(t=>{var i,n;let s=t.value,o=lc(t);if("endTime"in t&&null!=t.endTime)null==a||a.addCue(new VTTCue(o,t.endTime,"chapters"===r?s:JSON.stringify(null!=s?s:null)));else{let t=Array.prototype.findIndex.call(null==a?void 0:a.cues,e=>e.startTime>=o),l=null==(i=null==a?void 0:a.cues)?void 0:i[t],d=l?l.startTime:Number.isFinite(e.duration)?e.duration:Number.MAX_SAFE_INTEGER,u=null==(n=null==a?void 0:a.cues)?void 0:n[t-1];u&&(u.endTime=o),null==a||a.addCue(new VTTCue(o,d,"chapters"===r?s:JSON.stringify(null!=s?s:null)))}}),e.textTracks.dispatchEvent(new Event("change",{bubbles:!0,composed:!0})),a}var lg="cuepoints",lv=Object.freeze({label:lg});async function lE(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:lv;return lp(e,t,i.label,"metadata")}var ly=e=>({time:e.startTime,value:JSON.parse(e.text)});function lb(e){var t,i;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{label:lg},a=lf(e,r.label,"metadata");if(!(null!=(t=null==a?void 0:a.activeCues)&&t.length))return;if(1===a.activeCues.length)return ly(a.activeCues[0]);let{currentTime:n}=e;return ly(Array.prototype.find.call(null!=(i=a.activeCues)?i:[],e=>{let{startTime:t,endTime:i}=e;return t<=n&&i>n})||a.activeCues[0])}async function lT(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:lv;return new Promise(i=>{o6(e,"loadstart",async()=>{let r=await lE(e,[],t);o6(e,"cuechange",()=>{let t=lb(e);if(t){let i=new CustomEvent("cuepointchange",{composed:!0,bubbles:!0,detail:t});e.dispatchEvent(i)}},{},r),i(r)})})}var l_="chapters",lA=Object.freeze({label:l_}),lS=e=>({startTime:e.startTime,endTime:e.endTime,value:e.text});async function lI(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:lA;return lp(e,t,i.label,"chapters")}function lR(e){var t,i;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{label:l_},a=lf(e,r.label,"chapters");if(!(null!=(t=null==a?void 0:a.activeCues)&&t.length))return;if(1===a.activeCues.length)return lS(a.activeCues[0]);let{currentTime:n}=e;return lS(Array.prototype.find.call(null!=(i=a.activeCues)?i:[],e=>{let{startTime:t,endTime:i}=e;return t<=n&&i>n})||a.activeCues[0])}async function lk(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:lA;return new Promise(i=>{o6(e,"loadstart",async()=>{let r=await lI(e,[],t);o6(e,"cuechange",()=>{let t=lR(e);if(t){let i=new CustomEvent("chapterchange",{composed:!0,bubbles:!0,detail:t});e.dispatchEvent(i)}},{},r),i(r)})})}var lL={VIDEO:"v",THUMBNAIL:"t",STORYBOARD:"s",DRM:"d"},lD=function(e,t,i,r){var a,n,s,o;let l,d,u,h=arguments.length>4&&void 0!==arguments[4]&&arguments[4],c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:!(null==(l=globalThis.navigator)?void 0:l.onLine);if(c){let i=lo("Your device appears to be offline",h),r=oJ.MEDIA_ERR_NETWORK,a=new oJ(i,r,!1,void 0);return a.errorCategory=t,a.muxCode=oX.NETWORK_OFFLINE,a.data=e,a}let m="status"in e?e.status:e.code,f=Date.now(),p=oJ.MEDIA_ERR_NETWORK;if(200===m)return;let g=oZ(t),E=(d=oZ(t),u="".concat(d,"Token"),null!=(s=i.tokens)&&s[d]?null==(o=i.tokens)?void 0:o[d]:o$(u,i)?i[u]:void 0),y=t===oz.VIDEO?lL.VIDEO:t===oz.DRM?lL.DRM:void 0,[b]=o7(null!=(a=i.playbackId)?a:"");if(!m||!b)return;let T=ln(E);if(E&&!T){let i=new oJ(lo("The {tokenNamePrefix}-token provided is invalid or malformed.",h).format({tokenNamePrefix:g}),p,!0,lo("Compact JWT string: {token}",h).format({token:E}));return i.errorCategory=t,i.muxCode=oX.NETWORK_TOKEN_MALFORMED,i.data=e,i}if(m>=500){let e=new oJ("",p,null==r||r);return e.errorCategory=t,e.muxCode=oX.NETWORK_UNKNOWN_ERROR,e}if(403===m)if(T){if(ls(T,f)){let i={timeStyle:"medium",dateStyle:"medium"},r=new oJ(lo("The video’s secured {tokenNamePrefix}-token has expired.",h).format({tokenNamePrefix:g}),p,!0,lo("Expired at: {expiredDate}. Current time: {currentDate}.",h).format({expiredDate:new Intl.DateTimeFormat("en",i).format(null!=(n=T.exp)?n:0),currentDate:new Intl.DateTimeFormat("en",i).format(f)}));return r.errorCategory=t,r.muxCode=oX.NETWORK_TOKEN_EXPIRED,r.data=e,r}if(((e,t)=>{let{sub:i}=e;return i!==t})(T,b)){let i=new oJ(lo("The video’s playback ID does not match the one encoded in the {tokenNamePrefix}-token.",h).format({tokenNamePrefix:g}),p,!0,lo("Specified playback ID: {playbackId} and the playback ID encoded in the {tokenNamePrefix}-token: {tokenPlaybackId}",h).format({tokenNamePrefix:g,playbackId:b,tokenPlaybackId:T.sub}));return i.errorCategory=t,i.muxCode=oX.NETWORK_TOKEN_SUB_MISMATCH,i.data=e,i}if(((e,t)=>{let{aud:i}=e;return!i})(T,0)){let i=new oJ(lo("The {tokenNamePrefix}-token is formatted with incorrect information.",h).format({tokenNamePrefix:g}),p,!0,lo("The {tokenNamePrefix}-token has no aud value. aud value should be {expectedAud}.",h).format({tokenNamePrefix:g,expectedAud:y}));return i.errorCategory=t,i.muxCode=oX.NETWORK_TOKEN_AUD_MISSING,i.data=e,i}if(((e,t)=>{let{aud:i}=e;return i!==t})(T,y)){let i=new oJ(lo("The {tokenNamePrefix}-token is formatted with incorrect information.",h).format({tokenNamePrefix:g}),p,!0,lo("The {tokenNamePrefix}-token has an incorrect aud value: {aud}. aud value should be {expectedAud}.",h).format({tokenNamePrefix:g,expectedAud:y,aud:T.aud}));return i.errorCategory=t,i.muxCode=oX.NETWORK_TOKEN_AUD_MISMATCH,i.data=e,i}}else{let i=new oJ(lo("Authorization error trying to access this {category} URL. If this is a signed URL, you might need to provide a {tokenNamePrefix}-token.",h).format({tokenNamePrefix:g,category:t}),p,null==r||r,lo("Specified playback ID: {playbackId}",h).format({playbackId:b}));return i.errorCategory=t,i.muxCode=oX.NETWORK_TOKEN_MISSING,i.data=e,i}if(412===m){let a=new oJ(lo("This playback-id may belong to a live stream that is not currently active or an asset that is not ready.",h),p,null==r||r,lo("Specified playback ID: {playbackId}",h).format({playbackId:b}));return a.errorCategory=t,a.muxCode=oX.NETWORK_NOT_READY,a.streamType=i.streamType===o1.LIVE?"live":i.streamType===o1.ON_DEMAND?"on-demand":"unknown",a.data=e,a}if(404===m){let i=new oJ(lo("This URL or playback-id does not exist. You may have used an Asset ID or an ID from a different resource.",h),p,null==r||r,lo("Specified playback ID: {playbackId}",h).format({playbackId:b}));return i.errorCategory=t,i.muxCode=oX.NETWORK_NOT_FOUND,i.data=e,i}if(400===m){let i=new oJ(lo("The URL or playback-id was invalid. You may have used an invalid value as a playback-id."),p,null==r||r,lo("Specified playback ID: {playbackId}",h).format({playbackId:b}));return i.errorCategory=t,i.muxCode=oX.NETWORK_INVALID_URL,i.data=e,i}let _=new oJ("",p,null==r||r);return _.errorCategory=t,_.muxCode=oX.NETWORK_UNKNOWN_ERROR,_.data=e,_},lw=oQ.DefaultConfig.capLevelController,lC=class e extends lw{get levels(){var e;return null!=(e=this.hls.levels)?e:[]}getValidLevels(e){return this.levels.filter((t,i)=>this.isLevelAllowed(t)&&i<=e)}getMaxLevel(t){let i=super.getMaxLevel(t),r=this.getValidLevels(t);if(!r[i])return i;let a=Math.min(r[i].width,r[i].height),n=e.minMaxResolution;return a>=n?i:lw.getMaxLevelByMediaSize(r,16/9*n,n)}constructor(e){super(e)}};lC.minMaxResolution=720;var lM,lO,lP,lx,lN,lU,lF,lB,lH={FAIRPLAY:"fairplay",PLAYREADY:"playready",WIDEVINE:"widevine"},lG=/([A-Z0-9-]+)="?(.*?)"?(?:,|$)/g,lK=async(e,t)=>{if(t===o5.MP4)return{streamType:o1.ON_DEMAND,targetLiveWindow:NaN,liveEdgeStartOffset:void 0,sessionData:void 0};if(t===o5.M3U8){let t=await fetch(e);if(!t.ok)return Promise.reject(t);let i=await t.text(),r=await fetch(i.split("\n").find((e,t,i)=>t&&i[t-1].startsWith("#EXT-X-STREAM-INF"))).then(e=>200!==e.status?Promise.reject(e):e.text());return{...(e=>{let t=e.split("\n").filter(e=>e.startsWith("#EXT-X-SESSION-DATA"));if(!t.length)return{};let i={};for(let e of t){let t=Object.fromEntries([...e.matchAll(lG)].map(e=>{let[,t,i]=e;return[t,i]})),r=t["DATA-ID"];r&&(i[r]={...t})}return{sessionData:i}})(i),...(e=>{var t,i,r;let a=e.split("\n"),n=null==(i=(null!=(t=a.find(e=>e.startsWith("#EXT-X-PLAYLIST-TYPE")))?t:"").split(":")[1])?void 0:i.trim(),s=lt(n),o=li(n),l;if(s===o1.LIVE){let e=a.find(e=>e.startsWith("#EXT-X-PART-INF"));if(e)l=2*e.split(":")[1].split("=")[1];else{let e=a.find(e=>e.startsWith("#EXT-X-TARGETDURATION")),t=null==(r=null==e?void 0:e.split(":"))?void 0:r[1];l=(null!=t?t:6)*3}}return{streamType:s,targetLiveWindow:o,liveEdgeStartOffset:l}})(r)}}return console.error("Media type ".concat(t," is an unrecognized or unsupported type for src ").concat(e,".")),{streamType:void 0,targetLiveWindow:void 0,liveEdgeStartOffset:void 0,sessionData:void 0}},lV=async function(e,t){var i,r,a,n;let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:le({src:e}),{streamType:o,targetLiveWindow:l,liveEdgeStartOffset:d,sessionData:u}=await lK(e,s),h=null==u?void 0:u["com.apple.hls.chapters"];(null!=h&&h.URI||null!=h&&h.VALUE.toLocaleLowerCase().startsWith("http"))&&lW(null!=(i=h.URI)?i:h.VALUE,t),(null!=(r=lQ.get(t))?r:{}).liveEdgeStartOffset=d,(null!=(a=lQ.get(t))?a:{}).targetLiveWindow=l,t.dispatchEvent(new CustomEvent("targetlivewindowchange",{composed:!0,bubbles:!0})),(null!=(n=lQ.get(t))?n:{}).streamType=o,t.dispatchEvent(new CustomEvent("streamtypechange",{composed:!0,bubbles:!0}))},lW=async(e,t)=>{var i,r;try{let a=await fetch(e);if(!a.ok)throw Error("Failed to fetch Mux metadata: ".concat(a.status," ").concat(a.statusText));let n=await a.json(),s={};if(!(null!=(i=null==n?void 0:n[0])&&i.metadata))return;for(let e of n[0].metadata)e.key&&e.value&&(s[e.key]=e.value);(null!=(r=lQ.get(t))?r:{}).metadata=s;let o=new CustomEvent("muxmetadata");t.dispatchEvent(o)}catch(e){console.error(e)}},lq=null!=(lx=null==(lP=null==globalThis?void 0:globalThis.navigator)?void 0:lP.userAgent)?lx:"",lY=null!=(lF=null==(lU=null==(lN=null==globalThis?void 0:globalThis.navigator)?void 0:lN.userAgentData)?void 0:lU.platform)?lF:"",lj=lq.toLowerCase().includes("android")||["x11","android"].some(e=>lY.toLowerCase().includes(e)),lQ=new WeakMap,lz="mux.com",lX=null==(lB=oQ.isSupported)?void 0:lB.call(oQ),lZ=()=>tM.utils.now(),lJ=tM.utils.generateUUID,l$=function(){let{playbackId:e,customDomain:t=lz,maxResolution:i,minResolution:r,renditionOrder:a,programStartTime:n,programEndTime:s,assetStartTime:o,assetEndTime:l,playbackToken:d,tokens:{playback:u=d}={},extraSourceParams:h={}}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!e)return;let[c,m=""]=o7(e),f=new URL("https://stream.".concat(t,"/").concat(c,".m3u8").concat(m));return u||f.searchParams.has("token")?(f.searchParams.forEach((e,t)=>{"token"!=t&&f.searchParams.delete(t)}),u&&f.searchParams.set("token",u)):(i&&f.searchParams.set("max_resolution",i),r&&(f.searchParams.set("min_resolution",r),i&&+i.slice(0,-1)<+r.slice(0,-1)&&console.error("minResolution must be <= maxResolution","minResolution",r,"maxResolution",i)),a&&f.searchParams.set("rendition_order",a),n&&f.searchParams.set("program_start_time","".concat(n)),s&&f.searchParams.set("program_end_time","".concat(s)),o&&f.searchParams.set("asset_start_time","".concat(o)),l&&f.searchParams.set("asset_end_time","".concat(l)),Object.entries(h).forEach(e=>{let[t,i]=e;null!=i&&f.searchParams.set(t,i)})),f.toString()},l0=e=>{if(!e)return;let[t]=e.split("?");return t||void 0},l1=e=>{if(!e||!e.startsWith("https://stream."))return;let[t]=new URL(e).pathname.slice(1).split(/\.m3u8|\//);return t||void 0},l2=e=>{var t;return null==(t=lQ.get(e))?void 0:t.error},l3=e=>{var t,i;return null!=(i=null==(t=lQ.get(e))?void 0:t.streamType)?i:o1.UNKNOWN},l4=e=>{var t,i;return null!=(i=null==(t=lQ.get(e))?void 0:t.seekable)?i:e.seekable},l5=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.034;return Math.abs(e-t)<=i},l8=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.034;return e>t||l5(e,t,i)},l9=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.034;return e.paused&&l8(e.currentTime,e.duration,t)},l6=(e,t)=>{var i,r,a;if(!t||!e.buffered.length)return;if(e.readyState>2)return!1;let n=t.currentLevel>=0?null==(r=null==(i=t.levels)?void 0:i[t.currentLevel])?void 0:r.details:null==(a=t.levels.find(e=>!!e.details))?void 0:a.details;if(!n||n.live)return;let{fragments:s}=n;if(!(null!=s&&s.length))return;if(e.currentTime<e.duration-(n.targetduration+.5))return!1;let o=s[s.length-1];if(e.currentTime<=o.start)return!1;let l=o.start+o.duration/2,d=e.buffered.start(e.buffered.length-1),u=e.buffered.end(e.buffered.length-1);return l>d&&l<u},l7=(e,t)=>e.ended||e.loop?e.ended:!!(t&&l6(e,t))||l9(e),de=(e,t,i)=>{let r=null==t?void 0:t.engine;null!=e&&e.mux&&!e.mux.deleted&&(null!=i&&i.muxDataKeepSession?r&&e.mux.removeHLSJS():(e.mux.destroy(),delete e.mux)),r&&(r.detachMedia(),r.destroy()),e&&(e.hasAttribute("src")&&(e.removeAttribute("src"),e.load()),e.removeEventListener("error",dh),e.removeEventListener("error",dm),e.removeEventListener("durationchange",du),lQ.delete(e),e.dispatchEvent(new Event("teardown")))};function dt(e,t){var i;let r=le(e);if(r!==o5.M3U8)return!0;let a=!r||null==(i=t.canPlayType(r))||i,{preferPlayback:n}=e,s=n===o2.MSE,o=n===o2.NATIVE;return a&&(o||!(lX&&(s||lj)))}var di=e=>e===o1.LIVE?{backBufferLength:8}:{},dr=e=>{let{tokens:{drm:t}={},playbackId:i,drmTypeCb:r}=e,a=l0(i);return t&&a?{emeEnabled:!0,drmSystems:{"com.apple.fps":{licenseUrl:ds(e,"fairplay"),serverCertificateUrl:dl(e,"fairplay")},"com.widevine.alpha":{licenseUrl:ds(e,"widevine")},"com.microsoft.playready":{licenseUrl:ds(e,"playready")}},requestMediaKeySystemAccessFunc:(e,t)=>("com.widevine.alpha"===e&&(t=[...t.map(e=>{var t;let i=null==(t=e.videoCapabilities)?void 0:t.map(e=>({...e,robustness:"HW_SECURE_ALL"}));return{...e,videoCapabilities:i}}),...t]),navigator.requestMediaKeySystemAccess(e,t).then(t=>{let i=(e=>e.includes("fps")?lH.FAIRPLAY:e.includes("playready")?lH.PLAYREADY:e.includes("widevine")?lH.WIDEVINE:void 0)(e);return null==r||r(i),t}))}:{}},da=async e=>{let t=await fetch(e);return 200!==t.status?Promise.reject(t):await t.arrayBuffer()},dn=async(e,t)=>{let i=await fetch(t,{method:"POST",headers:{"Content-type":"application/octet-stream"},body:e});return 200!==i.status?Promise.reject(i):new Uint8Array(await i.arrayBuffer())},ds=(e,t)=>{let{playbackId:i,tokens:{drm:r}={},customDomain:a=lz}=e,n=l0(i);return"https://license.".concat(a.toLocaleLowerCase().endsWith(lz)?a:lz,"/license/").concat(t,"/").concat(n,"?token=").concat(r)},dl=(e,t)=>{let{playbackId:i,tokens:{drm:r}={},customDomain:a=lz}=e,n=l0(i);return"https://license.".concat(a.toLocaleLowerCase().endsWith(lz)?a:lz,"/appcert/").concat(t,"/").concat(n,"?token=").concat(r)},dd=e=>{let{playbackId:t,src:i,customDomain:r}=e;if(t)return!0;if("string"!=typeof i)return!1;let a=new URL(i,null==window?void 0:window.location.href).hostname.toLocaleLowerCase();return a.includes(lz)||!!r&&a.includes(r.toLocaleLowerCase())};function du(e){var t;let i=e.target,r=null==(t=lQ.get(i))?void 0:t.startTime;if(r&&function(e,t,i){t&&i>t&&(i=t);for(let t=0;t<e.length;t++)if(e.start(t)<=i&&e.end(t)>=i)return!0;return!1}(i.seekable,i.duration,r)){let e="auto"===i.preload;e&&(i.preload="none"),i.currentTime=r,e&&(i.preload="auto")}}async function dh(e){if(!e.isTrusted)return;e.stopImmediatePropagation();let t=e.target;if(!(null!=t&&t.error))return;let{message:i,code:r}=t.error,a=new oJ(i,r);if(t.src&&r===oJ.MEDIA_ERR_SRC_NOT_SUPPORTED&&t.readyState===HTMLMediaElement.HAVE_NOTHING)return void setTimeout(()=>{var e;let i=null!=(e=l2(t))?e:t.error;(null==i?void 0:i.code)===oJ.MEDIA_ERR_SRC_NOT_SUPPORTED&&dc(t,a)},500);if(t.src&&(r!==oJ.MEDIA_ERR_DECODE||void 0!==r))try{let{status:e}=await fetch(t.src);a.data={response:{code:e}}}catch(e){}dc(t,a)}function dc(e,t){var i;t.fatal&&((null!=(i=lQ.get(e))?i:{}).error=t,e.dispatchEvent(new CustomEvent("error",{detail:t})))}function dm(e){var t,i;if(!(e instanceof CustomEvent)||!(e.detail instanceof oJ))return;let r=e.target,a=e.detail;a&&a.fatal&&((null!=(t=lQ.get(r))?t:{}).error=a,null==(i=r.mux)||i.emit("error",{player_error_code:a.code,player_error_message:a.message,player_error_context:a.context}))}var df=(e,t)=>{var i,r,a;console.error("getErrorFromHlsErrorData()",e);let n={[oQ.ErrorTypes.NETWORK_ERROR]:oJ.MEDIA_ERR_NETWORK,[oQ.ErrorTypes.MEDIA_ERROR]:oJ.MEDIA_ERR_DECODE,[oQ.ErrorTypes.KEY_SYSTEM_ERROR]:oJ.MEDIA_ERR_ENCRYPTED},s,o=(e=>[oQ.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,oQ.ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED].includes(e.details)?oJ.MEDIA_ERR_NETWORK:n[e.type])(e);if(o===oJ.MEDIA_ERR_NETWORK&&e.response){let a=null!=(i=(e=>e.type===oQ.ErrorTypes.KEY_SYSTEM_ERROR?oz.DRM:e.type===oQ.ErrorTypes.NETWORK_ERROR?oz.VIDEO:void 0)(e))?i:oz.VIDEO;s=null!=(r=lD(e.response,a,t,e.fatal))?r:new oJ("",o,e.fatal)}else o===oJ.MEDIA_ERR_ENCRYPTED?e.details===oQ.ErrorDetails.KEY_SYSTEM_NO_CONFIGURED_LICENSE?((s=new oJ(lo("Attempting to play DRM-protected content without providing a DRM token."),oJ.MEDIA_ERR_ENCRYPTED,e.fatal)).errorCategory=oz.DRM,s.muxCode=oX.ENCRYPTED_MISSING_TOKEN):e.details===oQ.ErrorDetails.KEY_SYSTEM_NO_ACCESS?((s=new oJ(lo("Cannot play DRM-protected content with current security configuration on this browser. Try playing in another browser."),oJ.MEDIA_ERR_ENCRYPTED,e.fatal)).errorCategory=oz.DRM,s.muxCode=oX.ENCRYPTED_UNSUPPORTED_KEY_SYSTEM):e.details===oQ.ErrorDetails.KEY_SYSTEM_NO_SESSION?((s=new oJ(lo("Failed to generate a DRM license request. This may be an issue with the player or your protected content."),oJ.MEDIA_ERR_ENCRYPTED,!0)).errorCategory=oz.DRM,s.muxCode=oX.ENCRYPTED_GENERATE_REQUEST_FAILED):e.details===oQ.ErrorDetails.KEY_SYSTEM_SESSION_UPDATE_FAILED?((s=new oJ(lo("Failed to update DRM license. This may be an issue with the player or your protected content."),oJ.MEDIA_ERR_ENCRYPTED,e.fatal)).errorCategory=oz.DRM,s.muxCode=oX.ENCRYPTED_UPDATE_LICENSE_FAILED):e.details===oQ.ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED?((s=new oJ(lo("Your server certificate failed when attempting to set it. This may be an issue with a no longer valid certificate."),oJ.MEDIA_ERR_ENCRYPTED,e.fatal)).errorCategory=oz.DRM,s.muxCode=oX.ENCRYPTED_UPDATE_SERVER_CERT_FAILED):e.details===oQ.ErrorDetails.KEY_SYSTEM_STATUS_INTERNAL_ERROR?((s=new oJ(lo("The DRM Content Decryption Module system had an internal failure. Try reloading the page, upading your browser, or playing in another browser."),oJ.MEDIA_ERR_ENCRYPTED,e.fatal)).errorCategory=oz.DRM,s.muxCode=oX.ENCRYPTED_CDM_ERROR):e.details===oQ.ErrorDetails.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED?((s=new oJ(lo("DRM playback is being attempted in an environment that is not sufficiently secure. User may see black screen."),oJ.MEDIA_ERR_ENCRYPTED,!1)).errorCategory=oz.DRM,s.muxCode=oX.ENCRYPTED_OUTPUT_RESTRICTED):((s=new oJ(e.error.message,oJ.MEDIA_ERR_ENCRYPTED,e.fatal)).errorCategory=oz.DRM,s.muxCode=oX.ENCRYPTED_ERROR):s=new oJ("",o,e.fatal);return s.context||(s.context="".concat(e.url?"url: ".concat(e.url,"\n"):"").concat(e.response&&(e.response.code||e.response.text)?"response: ".concat(e.response.code,", ").concat(e.response.text,"\n"):"").concat(e.reason?"failure reason: ".concat(e.reason,"\n"):"").concat(e.level?"level: ".concat(e.level,"\n"):"").concat(e.parent?"parent stream controller: ".concat(e.parent,"\n"):"").concat(e.buffer?"buffer length: ".concat(e.buffer,"\n"):"").concat(e.error?"error: ".concat(e.error,"\n"):"").concat(e.event?"event: ".concat(e.event,"\n"):"").concat(e.err?"error message: ".concat(null==(a=e.err)?void 0:a.message,"\n"):"")),s.data=e,s},dp=e.i(739946),dg=e.i(470292),dv=e.i(62351),dE=e.i(337696),dy=e.i(788245),db=e.i(773542);function dT(e,t){if(e!==t)throw TypeError("Private static access of wrong provenance")}function d_(e,t){if(void 0===e)throw TypeError("attempted to "+t+" private static field before its declaration")}var dA=e.i(824573),dS=e.i(299749);let dI=["abort","canplay","canplaythrough","durationchange","emptied","encrypted","ended","error","loadeddata","loadedmetadata","loadstart","pause","play","playing","progress","ratechange","seeked","seeking","stalled","suspend","timeupdate","volumechange","waiting","waitingforkey","resize","enterpictureinpicture","leavepictureinpicture","webkitbeginfullscreen","webkitendfullscreen","webkitpresentationmodechanged"],dR=["autopictureinpicture","disablepictureinpicture","disableremoteplayback","autoplay","controls","controlslist","crossorigin","loop","muted","playsinline","poster","preload","src"];function dk(e){return'\n    <style>\n      :host {\n        display: inline-flex;\n        line-height: 0;\n        flex-direction: column;\n        justify-content: end;\n      }\n\n      audio {\n        width: 100%;\n      }\n    </style>\n    <slot name="media">\n      <audio'.concat(dw(e),"></audio>\n    </slot>\n    <slot></slot>\n  ")}function dL(e){return'\n    <style>\n      :host {\n        display: inline-block;\n        line-height: 0;\n      }\n\n      video {\n        max-width: 100%;\n        max-height: 100%;\n        min-width: 100%;\n        min-height: 100%;\n        object-fit: var(--media-object-fit, contain);\n        object-position: var(--media-object-position, 50% 50%);\n      }\n\n      video::-webkit-media-text-track-container {\n        transform: var(--media-webkit-text-track-transform);\n        transition: var(--media-webkit-text-track-transition);\n      }\n    </style>\n    <slot name="media">\n      <video'.concat(dw(e),"></video>\n    </slot>\n    <slot></slot>\n  ")}function dD(e,t){var i,r,a,n,s,o,l,d,u,h,c,m,f,p;let{tag:g,is:E}=t,y=null==(r=globalThis.document)||null==(i=r.createElement)?void 0:i.call(r,g,{is:E}),b=y?function(e){let t=[];for(let i=Object.getPrototypeOf(e);i&&i!==HTMLElement.prototype;i=Object.getPrototypeOf(i)){let e=Object.getOwnPropertyNames(i);t.push(...e)}return t}(y):[];return a=new WeakMap,n=new WeakMap,s=new WeakMap,o=new WeakMap,l=new WeakSet,d=new WeakSet,u=new WeakSet,h=new WeakSet,c=new WeakSet,m=new WeakSet,f=class t extends e{static get observedAttributes(){var e,i;return(dT(t,f),T).call(f),[...null!=(i=null==y||null==(e=y.constructor)?void 0:e.observedAttributes)?i:[],...dR]}get nativeEl(){var e,t,i,r,a;return(0,dE._)(this,l,_).call(this),null!=(a=null!=(r=null!=(i=null!=(t=(0,dp._)(this,n))?t:this.querySelector(":scope > [slot=media]"))?i:this.querySelector(g))?r:null==(e=this.shadowRoot)?void 0:e.querySelector(g))?a:null}set nativeEl(e){(0,dv._)(this,n,e)}get defaultMuted(){return this.hasAttribute("muted")}set defaultMuted(e){this.toggleAttribute("muted",e)}get src(){return this.getAttribute("src")}set src(e){this.setAttribute("src","".concat(e))}get preload(){var e,t;return null!=(t=this.getAttribute("preload"))?t:null==(e=this.nativeEl)?void 0:e.preload}set preload(e){this.setAttribute("preload","".concat(e))}init(){if(!this.shadowRoot){this.attachShadow({mode:"open"});let e=function(e){let t={};for(let i of e)t[i.name]=i.value;return t}(this.attributes);E&&(e.is=E),g&&(e.part=g),this.shadowRoot.innerHTML=this.constructor.getTemplateHTML(e)}for(let e of(this.nativeEl.muted=this.hasAttribute("muted"),b))(0,dE._)(this,c,R).call(this,e);for(let e of((0,dv._)(this,o,new MutationObserver((0,dE._)(this,u,S).bind(this))),this.shadowRoot.addEventListener("slotchange",()=>(0,dE._)(this,d,A).call(this)),(0,dE._)(this,d,A).call(this),this.constructor.Events))this.shadowRoot.addEventListener(e,this,!0)}handleEvent(e){e.target===this.nativeEl&&this.dispatchEvent(new CustomEvent(e.type,{detail:e.detail}))}attributeChangedCallback(e,t,i){(0,dE._)(this,l,_).call(this),(0,dE._)(this,m,k).call(this,e,t,i)}connectedCallback(){(0,dE._)(this,l,_).call(this)}constructor(...e){super(...e),(0,dy._)(this,l),(0,dy._)(this,d),(0,dy._)(this,u),(0,dy._)(this,h),(0,dy._)(this,c),(0,dy._)(this,m),(0,dg._)(this,a,{writable:!0,value:!1}),(0,dg._)(this,n,{writable:!0,value:null}),(0,dg._)(this,s,{writable:!0,value:new Map}),(0,dg._)(this,o,{writable:!0,value:void 0}),(0,dS._)(this,"get",void 0),(0,dS._)(this,"set",void 0),(0,dS._)(this,"call",void 0)}},(0,dS._)(f,"getTemplateHTML",g.endsWith("audio")?dk:dL),(0,dS._)(f,"shadowRootOptions",{mode:"open"}),(0,dS._)(f,"Events",dI),p={writable:!0,value:!1},f;function T(){if(dT(this,f),d_(p,"get"),(0,db._)(this,p))return;dT(this,f),d_(p,"set"),(0,dA._)(this,p,!0);let e=new Set(this.observedAttributes);for(let t of(e.delete("muted"),b))if(!(t in this.prototype))if("function"==typeof y[t])this.prototype[t]=function(){for(var e=arguments.length,i=Array(e),r=0;r<e;r++)i[r]=arguments[r];return(0,dE._)(this,l,_).call(this),(()=>{var e;if(this.call)return this.call(t,...i);let r=null==(e=this.nativeEl)?void 0:e[t];return null==r?void 0:r.apply(this.nativeEl,i)})()};else{let i={get(){var i,r,a;(0,dE._)(this,l,_).call(this);let n=t.toLowerCase();if(e.has(n)){let e=this.getAttribute(n);return null!==e&&(""===e||e)}return null!=(a=null==(i=this.get)?void 0:i.call(this,t))?a:null==(r=this.nativeEl)?void 0:r[t]}};t!==t.toUpperCase()&&(i.set=function(i){(0,dE._)(this,l,_).call(this);let r=t.toLowerCase();return e.has(r)?void(!0===i||!1===i||null==i?this.toggleAttribute(r,!!i):this.setAttribute(r,i)):this.set?void this.set(t,i):void(this.nativeEl&&(this.nativeEl[t]=i))}),Object.defineProperty(this.prototype,t,i)}}function _(){(0,dp._)(this,a)||((0,dv._)(this,a,!0),this.init())}function A(){var e;let t=new Map((0,dp._)(this,s)),i=null==(e=this.shadowRoot)?void 0:e.querySelector("slot:not([name])");(null==i?void 0:i.assignedElements({flatten:!0}).filter(e=>["track","source"].includes(e.localName))).forEach(e=>{var i,r;t.delete(e);let a=(0,dp._)(this,s).get(e);a||(a=e.cloneNode(),(0,dp._)(this,s).set(e,a),null==(r=(0,dp._)(this,o))||r.observe(e,{attributes:!0})),null==(i=this.nativeEl)||i.append(a),(0,dE._)(this,h,I).call(this,a)}),t.forEach((e,t)=>{e.remove(),(0,dp._)(this,s).delete(t)})}function S(e){for(let i of e)if("attributes"===i.type){let{target:e,attributeName:r}=i,a=(0,dp._)(this,s).get(e);if(a&&r){var t;a.setAttribute(r,null!=(t=e.getAttribute(r))?t:""),(0,dE._)(this,h,I).call(this,a)}}}function I(e){e&&"track"===e.localName&&e.default&&("chapters"===e.kind||"metadata"===e.kind)&&"disabled"===e.track.mode&&(e.track.mode="hidden")}function R(e){if(Object.prototype.hasOwnProperty.call(this,e)){let t=this[e];delete this[e],this[e]=t}}function k(e,t,i){var r,a,n;!["id","class"].includes(e)&&(!f.observedAttributes.includes(e)&&this.constructor.observedAttributes.includes(e)||(null===i?null==(a=this.nativeEl)||a.removeAttribute(e):(null==(r=this.nativeEl)?void 0:r.getAttribute(e))!==i&&(null==(n=this.nativeEl)||n.setAttribute(e,i))))}}function dw(e){let t="";for(let i in e){if(!dR.includes(i))continue;let r=e[i];""===r?t+=" ".concat(i):t+=" ".concat(i,'="').concat(r,'"')}return t}let dC=dD(null!=(dM=globalThis.HTMLElement)?dM:class{},{tag:"video"});dD(null!=(dO=globalThis.HTMLElement)?dO:class{},{tag:"audio"});var dM,dO,dP,dx,dN,dU,dF,dB,dH,dG,dK,dV,dW,dq,dY=e=>{throw TypeError(e)},dj=(e,t,i)=>t.has(e)||dY("Cannot "+i),dQ=(e,t,i)=>(dj(e,t,"read from private field"),i?i.call(e):t.get(e)),dz=(e,t,i)=>t.has(e)?dY("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,i),dX=(e,t,i,r)=>(dj(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i),dZ=(e,t,i)=>(dj(e,t,"access private method"),i),dJ=(()=>{try{return"0.27.0"}catch(e){}return"UNKNOWN"})(),d$={BEACON_COLLECTION_DOMAIN:"beacon-collection-domain",CUSTOM_DOMAIN:"custom-domain",DEBUG:"debug",DISABLE_TRACKING:"disable-tracking",DISABLE_COOKIES:"disable-cookies",DISABLE_PSEUDO_ENDED:"disable-pseudo-ended",DRM_TOKEN:"drm-token",PLAYBACK_TOKEN:"playback-token",ENV_KEY:"env-key",MAX_RESOLUTION:"max-resolution",MIN_RESOLUTION:"min-resolution",RENDITION_ORDER:"rendition-order",PROGRAM_START_TIME:"program-start-time",PROGRAM_END_TIME:"program-end-time",ASSET_START_TIME:"asset-start-time",ASSET_END_TIME:"asset-end-time",METADATA_URL:"metadata-url",PLAYBACK_ID:"playback-id",PLAYER_SOFTWARE_NAME:"player-software-name",PLAYER_SOFTWARE_VERSION:"player-software-version",PLAYER_INIT_TIME:"player-init-time",PREFER_CMCD:"prefer-cmcd",PREFER_PLAYBACK:"prefer-playback",START_TIME:"start-time",STREAM_TYPE:"stream-type",TARGET_LIVE_WINDOW:"target-live-window",LIVE_EDGE_OFFSET:"live-edge-offset",TYPE:"type",LOGO:"logo"},d0=Object.values(d$),d1="mux-video",d2=class extends dC{static get NAME(){return d1}static get VERSION(){return dJ}static get observedAttributes(){var e;return[...d0,...null!=(e=dC.observedAttributes)?e:[]]}static getLogoHTML(e){return e&&"false"!==e?"default"===e?'\n<svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" part="logo" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2" viewBox="0 0 1600 500"><g fill="#fff"><path d="M994.287 93.486c-17.121 0-31-13.879-31-31 0-17.121 13.879-31 31-31 17.121 0 31 13.879 31 31 0 17.121-13.879 31-31 31m0-93.486c-34.509 0-62.484 27.976-62.484 62.486v187.511c0 68.943-56.09 125.033-125.032 125.033s-125.03-56.09-125.03-125.033V62.486C681.741 27.976 653.765 0 619.256 0s-62.484 27.976-62.484 62.486v187.511C556.772 387.85 668.921 500 806.771 500c137.851 0 250.001-112.15 250.001-250.003V62.486c0-34.51-27.976-62.486-62.485-62.486M1537.51 468.511c-17.121 0-31-13.879-31-31 0-17.121 13.879-31 31-31 17.121 0 31 13.879 31 31 0 17.121-13.879 31-31 31m-275.883-218.509-143.33 143.329c-24.402 24.402-24.402 63.966 0 88.368 24.402 24.402 63.967 24.402 88.369 0l143.33-143.329 143.328 143.329c24.402 24.4 63.967 24.402 88.369 0 24.403-24.402 24.403-63.966.001-88.368l-143.33-143.329.001-.004 143.329-143.329c24.402-24.402 24.402-63.965 0-88.367s-63.967-24.402-88.369 0L1349.996 161.63 1206.667 18.302c-24.402-24.401-63.967-24.402-88.369 0s-24.402 63.965 0 88.367l143.329 143.329v.004ZM437.511 468.521c-17.121 0-31-13.879-31-31 0-17.121 13.879-31 31-31 17.121 0 31 13.879 31 31 0 17.121-13.879 31-31 31M461.426 4.759C438.078-4.913 411.2.432 393.33 18.303L249.999 161.632 106.669 18.303C88.798.432 61.922-4.913 38.573 4.759 15.224 14.43-.001 37.214-.001 62.488v375.026c0 34.51 27.977 62.486 62.487 62.486 34.51 0 62.486-27.976 62.486-62.486V213.341l80.843 80.844c24.404 24.402 63.965 24.402 88.369 0l80.843-80.844v224.173c0 34.51 27.976 62.486 62.486 62.486s62.486-27.976 62.486-62.486V62.488c0-25.274-15.224-48.058-38.573-57.729" style="fill-rule:nonzero"/></g></svg>':'<img part="logo" src="'.concat(e,'" />'):""}static getTemplateHTML(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return"\n      ".concat(dC.getTemplateHTML(t),'\n      <style>\n        :host {\n          position: relative;\n        }\n        slot[name="logo"] {\n          display: flex;\n          justify-content: end;\n          position: absolute;\n          top: 1rem;\n          right: 1rem;\n          opacity: 0;\n          transition: opacity 0.25s ease-in-out;\n          z-index: 1;\n        }\n        slot[name="logo"]:has([part="logo"]) {\n          opacity: 1;\n        }\n        slot[name="logo"] [part="logo"] {\n          width: 5rem;\n          pointer-events: none;\n          user-select: none;\n        }\n      </style>\n      <slot name="logo">\n        ').concat(this.getLogoHTML(null!=(e=t[d$.LOGO])?e:""),"\n      </slot>\n    ")}get preferCmcd(){var e;return null!=(e=this.getAttribute(d$.PREFER_CMCD))?e:void 0}set preferCmcd(e){e!==this.preferCmcd&&(e?o4.includes(e)?this.setAttribute(d$.PREFER_CMCD,e):console.warn("Invalid value for preferCmcd. Must be one of ".concat(o4.join())):this.removeAttribute(d$.PREFER_CMCD))}get playerInitTime(){return this.hasAttribute(d$.PLAYER_INIT_TIME)?+this.getAttribute(d$.PLAYER_INIT_TIME):dQ(this,dN)}set playerInitTime(e){e!=this.playerInitTime&&(null==e?this.removeAttribute(d$.PLAYER_INIT_TIME):this.setAttribute(d$.PLAYER_INIT_TIME,"".concat(+e)))}get playerSoftwareName(){var e;return null!=(e=dQ(this,dG))?e:d1}set playerSoftwareName(e){dX(this,dG,e)}get playerSoftwareVersion(){var e;return null!=(e=dQ(this,dH))?e:dJ}set playerSoftwareVersion(e){dX(this,dH,e)}get _hls(){var e;return null==(e=dQ(this,dP))?void 0:e.engine}get mux(){var e;return null==(e=this.nativeEl)?void 0:e.mux}get error(){var e;return null!=(e=l2(this.nativeEl))?e:null}get errorTranslator(){return dQ(this,dK)}set errorTranslator(e){dX(this,dK,e)}get src(){return this.getAttribute("src")}set src(e){e!==this.src&&(null==e?this.removeAttribute("src"):this.setAttribute("src",e))}get type(){var e;return null!=(e=this.getAttribute(d$.TYPE))?e:void 0}set type(e){e!==this.type&&(e?this.setAttribute(d$.TYPE,e):this.removeAttribute(d$.TYPE))}get preload(){let e=this.getAttribute("preload");return""===e?"auto":["none","metadata","auto"].includes(e)?e:super.preload}set preload(e){e!=this.getAttribute("preload")&&(["","none","metadata","auto"].includes(e)?this.setAttribute("preload",e):this.removeAttribute("preload"))}get debug(){return null!=this.getAttribute(d$.DEBUG)}set debug(e){e!==this.debug&&(e?this.setAttribute(d$.DEBUG,""):this.removeAttribute(d$.DEBUG))}get disableTracking(){return this.hasAttribute(d$.DISABLE_TRACKING)}set disableTracking(e){e!==this.disableTracking&&this.toggleAttribute(d$.DISABLE_TRACKING,!!e)}get disableCookies(){return this.hasAttribute(d$.DISABLE_COOKIES)}set disableCookies(e){e!==this.disableCookies&&(e?this.setAttribute(d$.DISABLE_COOKIES,""):this.removeAttribute(d$.DISABLE_COOKIES))}get disablePseudoEnded(){return this.hasAttribute(d$.DISABLE_PSEUDO_ENDED)}set disablePseudoEnded(e){e!==this.disablePseudoEnded&&(e?this.setAttribute(d$.DISABLE_PSEUDO_ENDED,""):this.removeAttribute(d$.DISABLE_PSEUDO_ENDED))}get startTime(){let e=this.getAttribute(d$.START_TIME);if(null==e)return;let t=+e;return Number.isNaN(t)?void 0:t}set startTime(e){e!==this.startTime&&(null==e?this.removeAttribute(d$.START_TIME):this.setAttribute(d$.START_TIME,"".concat(e)))}get playbackId(){var e;return this.hasAttribute(d$.PLAYBACK_ID)?this.getAttribute(d$.PLAYBACK_ID):null!=(e=l1(this.src))?e:void 0}set playbackId(e){e!==this.playbackId&&(e?this.setAttribute(d$.PLAYBACK_ID,e):this.removeAttribute(d$.PLAYBACK_ID))}get maxResolution(){var e;return null!=(e=this.getAttribute(d$.MAX_RESOLUTION))?e:void 0}set maxResolution(e){e!==this.maxResolution&&(e?this.setAttribute(d$.MAX_RESOLUTION,e):this.removeAttribute(d$.MAX_RESOLUTION))}get minResolution(){var e;return null!=(e=this.getAttribute(d$.MIN_RESOLUTION))?e:void 0}set minResolution(e){e!==this.minResolution&&(e?this.setAttribute(d$.MIN_RESOLUTION,e):this.removeAttribute(d$.MIN_RESOLUTION))}get renditionOrder(){var e;return null!=(e=this.getAttribute(d$.RENDITION_ORDER))?e:void 0}set renditionOrder(e){e!==this.renditionOrder&&(e?this.setAttribute(d$.RENDITION_ORDER,e):this.removeAttribute(d$.RENDITION_ORDER))}get programStartTime(){let e=this.getAttribute(d$.PROGRAM_START_TIME);if(null==e)return;let t=+e;return Number.isNaN(t)?void 0:t}set programStartTime(e){null==e?this.removeAttribute(d$.PROGRAM_START_TIME):this.setAttribute(d$.PROGRAM_START_TIME,"".concat(e))}get programEndTime(){let e=this.getAttribute(d$.PROGRAM_END_TIME);if(null==e)return;let t=+e;return Number.isNaN(t)?void 0:t}set programEndTime(e){null==e?this.removeAttribute(d$.PROGRAM_END_TIME):this.setAttribute(d$.PROGRAM_END_TIME,"".concat(e))}get assetStartTime(){let e=this.getAttribute(d$.ASSET_START_TIME);if(null==e)return;let t=+e;return Number.isNaN(t)?void 0:t}set assetStartTime(e){null==e?this.removeAttribute(d$.ASSET_START_TIME):this.setAttribute(d$.ASSET_START_TIME,"".concat(e))}get assetEndTime(){let e=this.getAttribute(d$.ASSET_END_TIME);if(null==e)return;let t=+e;return Number.isNaN(t)?void 0:t}set assetEndTime(e){null==e?this.removeAttribute(d$.ASSET_END_TIME):this.setAttribute(d$.ASSET_END_TIME,"".concat(e))}get customDomain(){var e;return null!=(e=this.getAttribute(d$.CUSTOM_DOMAIN))?e:void 0}set customDomain(e){e!==this.customDomain&&(e?this.setAttribute(d$.CUSTOM_DOMAIN,e):this.removeAttribute(d$.CUSTOM_DOMAIN))}get drmToken(){var e;return null!=(e=this.getAttribute(d$.DRM_TOKEN))?e:void 0}set drmToken(e){e!==this.drmToken&&(e?this.setAttribute(d$.DRM_TOKEN,e):this.removeAttribute(d$.DRM_TOKEN))}get playbackToken(){var e,t,i,r;if(this.hasAttribute(d$.PLAYBACK_TOKEN))return null!=(e=this.getAttribute(d$.PLAYBACK_TOKEN))?e:void 0;if(this.hasAttribute(d$.PLAYBACK_ID)){let[,e]=o7(null!=(t=this.playbackId)?t:"");return null!=(i=new URLSearchParams(e).get("token"))?i:void 0}if(this.src)return null!=(r=new URLSearchParams(this.src).get("token"))?r:void 0}set playbackToken(e){e!==this.playbackToken&&(e?this.setAttribute(d$.PLAYBACK_TOKEN,e):this.removeAttribute(d$.PLAYBACK_TOKEN))}get tokens(){let e=this.getAttribute(d$.PLAYBACK_TOKEN),t=this.getAttribute(d$.DRM_TOKEN);return{...dQ(this,dF),...null!=e?{playback:e}:{},...null!=t?{drm:t}:{}}}set tokens(e){dX(this,dF,null!=e?e:{})}get ended(){return l7(this.nativeEl,this._hls)}get envKey(){var e;return null!=(e=this.getAttribute(d$.ENV_KEY))?e:void 0}set envKey(e){e!==this.envKey&&(e?this.setAttribute(d$.ENV_KEY,e):this.removeAttribute(d$.ENV_KEY))}get beaconCollectionDomain(){var e;return null!=(e=this.getAttribute(d$.BEACON_COLLECTION_DOMAIN))?e:void 0}set beaconCollectionDomain(e){e!==this.beaconCollectionDomain&&(e?this.setAttribute(d$.BEACON_COLLECTION_DOMAIN,e):this.removeAttribute(d$.BEACON_COLLECTION_DOMAIN))}get streamType(){var e;return null!=(e=this.getAttribute(d$.STREAM_TYPE))?e:l3(this.nativeEl)}set streamType(e){e!==this.streamType&&(e?this.setAttribute(d$.STREAM_TYPE,e):this.removeAttribute(d$.STREAM_TYPE))}get targetLiveWindow(){var e,t,i;return this.hasAttribute(d$.TARGET_LIVE_WINDOW)?+this.getAttribute(d$.TARGET_LIVE_WINDOW):(e=this.nativeEl,null!=(i=null==(t=lQ.get(e))?void 0:t.targetLiveWindow)?i:NaN)}set targetLiveWindow(e){e!=this.targetLiveWindow&&(null==e?this.removeAttribute(d$.TARGET_LIVE_WINDOW):this.setAttribute(d$.TARGET_LIVE_WINDOW,"".concat(+e)))}get liveEdgeStart(){var e,t;if(this.hasAttribute(d$.LIVE_EDGE_OFFSET)){let{liveEdgeOffset:i}=this,r=null!=(e=this.nativeEl.seekable.end(0))?e:0;return Math.max(null!=(t=this.nativeEl.seekable.start(0))?t:0,r-i)}return(e=>{var t;let i=null==(t=lQ.get(e))?void 0:t.liveEdgeStartOffset;if("number"!=typeof i)return NaN;let r=l4(e);return r.length?r.end(r.length-1)-i:NaN})(this.nativeEl)}get liveEdgeOffset(){if(this.hasAttribute(d$.LIVE_EDGE_OFFSET))return+this.getAttribute(d$.LIVE_EDGE_OFFSET)}set liveEdgeOffset(e){e!=this.liveEdgeOffset&&(null==e?this.removeAttribute(d$.LIVE_EDGE_OFFSET):this.setAttribute(d$.LIVE_EDGE_OFFSET,"".concat(+e)))}get seekable(){return l4(this.nativeEl)}async addCuePoints(e){return lE(this.nativeEl,e)}get activeCuePoint(){return lb(this.nativeEl)}get cuePoints(){return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{label:lg},i=lf(e,t.label,"metadata");return null!=i&&i.cues?Array.from(i.cues,e=>ly(e)):[]}(this.nativeEl)}async addChapters(e){return lI(this.nativeEl,e)}get activeChapter(){return lR(this.nativeEl)}get chapters(){return function(e){var t;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{label:l_},r=lf(e,i.label,"chapters");return null!=(t=null==r?void 0:r.cues)&&t.length?Array.from(r.cues,e=>lS(e)):[]}(this.nativeEl)}getStartDate(){return function(e,t){if(t){let i=t.playingDate;if(null!=i)return new Date(i.getTime()-1e3*e.currentTime)}return"function"==typeof e.getStartDate?e.getStartDate():new Date(NaN)}(this.nativeEl,this._hls)}get currentPdt(){var e,t;return e=this.nativeEl,(t=this._hls)&&t.playingDate?t.playingDate:new Date("function"==typeof e.getStartDate?e.getStartDate().getTime()+1e3*e.currentTime:NaN)}get preferPlayback(){let e=this.getAttribute(d$.PREFER_PLAYBACK);if(e===o2.MSE||e===o2.NATIVE)return e}set preferPlayback(e){e!==this.preferPlayback&&(e===o2.MSE||e===o2.NATIVE?this.setAttribute(d$.PREFER_PLAYBACK,e):this.removeAttribute(d$.PREFER_PLAYBACK))}get metadata(){return{...this.getAttributeNames().filter(e=>e.startsWith("metadata-")&&![d$.METADATA_URL].includes(e)).reduce((e,t)=>{let i=this.getAttribute(t);return null!=i&&(e[t.replace(/^metadata-/,"").replace(/-/g,"_")]=i),e},{}),...dQ(this,dU)}}set metadata(e){dX(this,dU,null!=e?e:{}),this.mux&&this.mux.emit("hb",dQ(this,dU))}get _hlsConfig(){return dQ(this,dB)}set _hlsConfig(e){dX(this,dB,e)}get logo(){var e;return null!=(e=this.getAttribute(d$.LOGO))?e:dQ(this,dV)}set logo(e){e?this.setAttribute(d$.LOGO,e):this.removeAttribute(d$.LOGO)}load(){dX(this,dP,((e,t,i)=>{var r,a,n,s;de(t,i,e);let{metadata:o={}}=e,{view_session_id:l=lJ()}=o,d=null!=(a=null==(r=e)?void 0:r.metadata)&&a.video_id?r.metadata.video_id:dd(r)&&null!=(s=null!=(n=l0(r.playbackId))?n:l1(r.src))?s:r.src;o.view_session_id=l,o.video_id=d,e.metadata=o,e.drmTypeCb=e=>{var i;null==(i=t.mux)||i.emit("hb",{view_drm_type:e})},lQ.set(t,{retryCount:0});let u=((e,t)=>{let{debug:i,streamType:r,startTime:a=-1,metadata:n,preferCmcd:s,_hlsConfig:o={}}=e,l=le(e)===o5.M3U8,d=dt(e,t);if(l&&!d&&lX){let l=di(r),d=dr(e),u=new oQ({debug:i,startPosition:a,cmcd:[o3.QUERY,o3.HEADER].includes(s)?{useHeaders:s===o3.HEADER,sessionId:null==n?void 0:n.view_session_id,contentId:null==n?void 0:n.video_id}:void 0,xhrSetup:(e,t)=>{var i,r;if(s&&s!==o3.QUERY)return;let a=new URL(t);if(!a.searchParams.has("CMCD"))return;let n=(null!=(r=null==(i=a.searchParams.get("CMCD"))?void 0:i.split(","))?r:[]).filter(e=>e.startsWith("sid")||e.startsWith("cid")).join(",");a.searchParams.set("CMCD",n),e.open("GET",a)},capLevelController:lC,...{backBufferLength:30,renderTextTracksNatively:!1,liveDurationInfinity:!0,capLevelToPlayerSize:!0,capLevelOnFPSDrop:!0},...l,...d,...o});return u.on(oQ.Events.MANIFEST_PARSED,async function(e,i){var r,a;let n=null==(r=i.sessionData)?void 0:r["com.apple.hls.chapters"];(null!=n&&n.URI||null!=n&&n.VALUE.toLocaleLowerCase().startsWith("http"))&&lW(null!=(a=null==n?void 0:n.URI)?a:null==n?void 0:n.VALUE,t)}),u}})(e,t),h=((e,t,i)=>{let{preload:r,src:a}=e,n=e=>{null!=e&&["","none","metadata","auto"].includes(e)?t.setAttribute("preload",e):t.removeAttribute("preload")};if(!i)return n(r),n;let s=!1,o=!1,l=i.config.maxBufferLength,d=i.config.maxBufferSize,u=e=>{n(e);let r=null!=e?e:t.preload;o||"none"===r||("metadata"===r?(i.config.maxBufferLength=1,i.config.maxBufferSize=1):(i.config.maxBufferLength=l,i.config.maxBufferSize=d),h())},h=()=>{!s&&a&&(s=!0,i.loadSource(a))};return o6(t,"play",()=>{o=!0,i.config.maxBufferLength=l,i.config.maxBufferSize=d,h()},{once:!0}),u(r),u})(e,t,u);null!=e&&e.muxDataKeepSession&&null!=t&&t.mux&&!t.mux.deleted?u&&t.mux.addHLSJS({hlsjs:u,Hls:u?oQ:void 0}):((e,t,i)=>{var r;let{envKey:a,disableTracking:n,muxDataSDK:s=tM,muxDataSDKOptions:o={}}=e,l=dd(e);if(!n&&(a||l)){let{playerInitTime:n,playerSoftwareName:l,playerSoftwareVersion:d,beaconCollectionDomain:u,debug:h,disableCookies:c}=e,m={...e.metadata,video_title:(null==(r=null==e?void 0:e.metadata)?void 0:r.video_title)||void 0};s.monitor(t,{debug:h,beaconCollectionDomain:u,hlsjs:i,Hls:i?oQ:void 0,automaticErrorTracking:!1,errorTranslator:t=>"string"!=typeof t.player_error_code&&("function"==typeof e.errorTranslator?e.errorTranslator(t):t),disableCookies:c,...o,data:{...a?{env_key:a}:{},player_software_name:l,player_software:l,player_software_version:d,player_init_time:n,...m}})}})(e,t,u),((e,t,i)=>{var r,a;let n=dt(e,t),{src:s,customDomain:o=lz}=e,l=()=>{t.ended||e.disablePseudoEnded||!l7(t,i)||(l6(t,i)?t.currentTime=t.buffered.end(t.buffered.length-1):t.dispatchEvent(new Event("ended")))},d,u,h=()=>{let e=l4(t),i,r;e.length>0&&(i=e.start(0),r=e.end(0)),(u!==r||d!==i)&&t.dispatchEvent(new CustomEvent("seekablechange",{composed:!0})),d=i,u=r};if(o6(t,"durationchange",h),t&&n){let i=le(e);if("string"==typeof s){if(s.endsWith(".mp4")&&s.includes(o)){let e=l1(s);lW(new URL("https://stream.".concat(o,"/").concat(e,"/metadata.json")).toString(),t)}let n=()=>{if(l3(t)!==o1.LIVE||Number.isFinite(t.duration))return;let e=setInterval(h,1e3);t.addEventListener("teardown",()=>{clearInterval(e)},{once:!0}),o6(t,"durationchange",()=>{Number.isFinite(t.duration)&&clearInterval(e)})},l=async()=>lV(s,t,i).then(n).catch(i=>{if(i instanceof Response){let r=lD(i,oz.VIDEO,e);if(r)return void dc(t,r)}});if("none"===t.preload){let e=()=>{l(),t.removeEventListener("loadedmetadata",i)},i=()=>{l(),t.removeEventListener("play",e)};o6(t,"play",e,{once:!0}),o6(t,"loadedmetadata",i,{once:!0})}else l();null!=(r=e.tokens)&&r.drm?((e,t)=>{o6(t,"encrypted",async i=>{try{let r=i.initDataType;if("skd"!==r)return void console.error('Received unexpected initialization data type "'.concat(r,'"'));if(!t.mediaKeys){let i=await navigator.requestMediaKeySystemAccess("com.apple.fps",[{initDataTypes:[r],videoCapabilities:[{contentType:"application/vnd.apple.mpegurl",robustness:""}],distinctiveIdentifier:"not-allowed",persistentState:"not-allowed",sessionTypes:["temporary"]}]).then(t=>{var i;return null==(i=e.drmTypeCb)||i.call(e,lH.FAIRPLAY),t}).catch(()=>{let e=lo("Cannot play DRM-protected content with current security configuration on this browser. Try playing in another browser."),i=new oJ(e,oJ.MEDIA_ERR_ENCRYPTED,!0);i.errorCategory=oz.DRM,i.muxCode=oX.ENCRYPTED_UNSUPPORTED_KEY_SYSTEM,dc(t,i)});if(!i)return;let a=await i.createMediaKeys();try{let t=await da(dl(e,"fairplay")).catch(t=>{if(t instanceof Response){let i=lD(t,oz.DRM,e);return console.error("mediaError",null==i?void 0:i.message,null==i?void 0:i.context),i?Promise.reject(i):Promise.reject(Error("Unexpected error in app cert request"))}return Promise.reject(t)});await a.setServerCertificate(t).catch(()=>{let e=lo("Your server certificate failed when attempting to set it. This may be an issue with a no longer valid certificate."),t=new oJ(e,oJ.MEDIA_ERR_ENCRYPTED,!0);return t.errorCategory=oz.DRM,t.muxCode=oX.ENCRYPTED_UPDATE_SERVER_CERT_FAILED,Promise.reject(t)})}catch(e){dc(t,e);return}await t.setMediaKeys(a)}let a=i.initData;if(null==a)return void console.error("Could not start encrypted playback due to missing initData in ".concat(i.type," event"));let n=t.mediaKeys.createSession();n.addEventListener("keystatuseschange",()=>{n.keyStatuses.forEach(e=>{let i;if("internal-error"===e){let e=lo("The DRM Content Decryption Module system had an internal failure. Try reloading the page, upading your browser, or playing in another browser.");(i=new oJ(e,oJ.MEDIA_ERR_ENCRYPTED,!0)).errorCategory=oz.DRM,i.muxCode=oX.ENCRYPTED_CDM_ERROR}else if("output-restricted"===e||"output-downscaled"===e){let e=lo("DRM playback is being attempted in an environment that is not sufficiently secure. User may see black screen.");(i=new oJ(e,oJ.MEDIA_ERR_ENCRYPTED,!1)).errorCategory=oz.DRM,i.muxCode=oX.ENCRYPTED_OUTPUT_RESTRICTED}i&&dc(t,i)})});let s=await Promise.all([n.generateRequest(r,a).catch(()=>{let e=lo("Failed to generate a DRM license request. This may be an issue with the player or your protected content."),i=new oJ(e,oJ.MEDIA_ERR_ENCRYPTED,!0);i.errorCategory=oz.DRM,i.muxCode=oX.ENCRYPTED_GENERATE_REQUEST_FAILED,dc(t,i)}),new Promise(e=>{n.addEventListener("message",t=>{e(t.message)},{once:!0})})]).then(e=>{let[,t]=e;return t}),o=await dn(s,ds(e,"fairplay")).catch(t=>{if(t instanceof Response){let i=lD(t,oz.DRM,e);return console.error("mediaError",null==i?void 0:i.message,null==i?void 0:i.context),i?Promise.reject(i):Promise.reject(Error("Unexpected error in license key request"))}return Promise.reject(t)});await n.update(o).catch(()=>{let e=lo("Failed to update DRM license. This may be an issue with the player or your protected content."),t=new oJ(e,oJ.MEDIA_ERR_ENCRYPTED,!0);return t.errorCategory=oz.DRM,t.muxCode=oX.ENCRYPTED_UPDATE_LICENSE_FAILED,Promise.reject(t)})}catch(e){dc(t,e);return}})})(e,t):o6(t,"encrypted",()=>{let e=new oJ(lo("Attempting to play DRM-protected content without providing a DRM token."),oJ.MEDIA_ERR_ENCRYPTED,!0);e.errorCategory=oz.DRM,e.muxCode=oX.ENCRYPTED_MISSING_TOKEN,dc(t,e)},{once:!0}),t.setAttribute("src",s),e.startTime&&((null!=(a=lQ.get(t))?a:{}).startTime=e.startTime,t.addEventListener("durationchange",du,{once:!0}))}else t.removeAttribute("src");t.addEventListener("error",dh),t.addEventListener("error",dm),t.addEventListener("emptied",()=>{t.querySelectorAll("track[data-removeondestroy]").forEach(e=>{e.remove()})},{once:!0}),o6(t,"pause",l),o6(t,"seeked",l),o6(t,"play",()=>{t.ended||l8(t.currentTime,t.duration)&&(t.currentTime=t.seekable.length?t.seekable.start(0):0)})}else i&&s?(i.once(oQ.Events.LEVEL_LOADED,(e,r)=>{((e,t,i)=>{var r,a,n,s,o,l,d,u;let{streamType:h,targetLiveWindow:c,liveEdgeStartOffset:m,lowLatency:f}=(e=>{var t;let i=e.type,r=lt(i),a=li(i),n,s=!!(null!=(t=e.partList)&&t.length);return r===o1.LIVE&&(n=s?2*e.partTarget:3*e.targetduration),{streamType:r,targetLiveWindow:a,liveEdgeStartOffset:n,lowLatency:s}})(e);if(h===o1.LIVE){f?(i.config.backBufferLength=null!=(r=i.userConfig.backBufferLength)?r:4,i.config.maxFragLookUpTolerance=null!=(a=i.userConfig.maxFragLookUpTolerance)?a:.001,i.config.abrBandWidthUpFactor=null!=(n=i.userConfig.abrBandWidthUpFactor)?n:i.config.abrBandWidthFactor):i.config.backBufferLength=null!=(s=i.userConfig.backBufferLength)?s:8;let e=Object.freeze({get length(){return t.seekable.length},start:e=>t.seekable.start(e),end(e){var r;return e>this.length||e<0||Number.isFinite(t.duration)?t.seekable.end(e):null!=(r=i.liveSyncPosition)?r:t.seekable.end(e)}});(null!=(o=lQ.get(t))?o:{}).seekable=e}(null!=(l=lQ.get(t))?l:{}).liveEdgeStartOffset=m,(null!=(d=lQ.get(t))?d:{}).targetLiveWindow=c,t.dispatchEvent(new CustomEvent("targetlivewindowchange",{composed:!0,bubbles:!0})),(null!=(u=lQ.get(t))?u:{}).streamType=h,t.dispatchEvent(new CustomEvent("streamtypechange",{composed:!0,bubbles:!0}))})(r.details,t,i),h(),l3(t)!==o1.LIVE||Number.isFinite(t.duration)||(i.on(oQ.Events.LEVEL_UPDATED,h),o6(t,"durationchange",()=>{Number.isFinite(t.duration)&&i.off(oQ.Events.LEVELS_UPDATED,h)}))}),i.on(oQ.Events.ERROR,(r,a)=>{var n,s;let o=df(a,e);if(o.muxCode===oX.NETWORK_NOT_READY){let e=null!=(n=lQ.get(t))?n:{},r=null!=(s=e.retryCount)?s:0;if(r<6){let n=0===r?5e3:6e4,s=new oJ("Retrying in ".concat(n/1e3," seconds..."),o.code,o.fatal);Object.assign(s,o),dc(t,s),setTimeout(()=>{e.retryCount=r+1,"manifestLoadError"===a.details&&a.url&&i.loadSource(a.url)},n);return}{e.retryCount=0;let i=new oJ('Try again later or <a href="#" onclick="window.location.reload(); return false;" style="color: #4a90e2;">click here to retry</a>',o.code,o.fatal);Object.assign(i,o),dc(t,i);return}}dc(t,o)}),i.on(oQ.Events.MANIFEST_LOADED,()=>{let e=lQ.get(t);e&&e.error&&(e.error=null,e.retryCount=0,t.dispatchEvent(new Event("emptied")),t.dispatchEvent(new Event("loadstart")))}),t.addEventListener("error",dm),o6(t,"waiting",l),function(e,t){var i;if(!("videoTracks"in e))return;let r=new WeakMap;t.on(oQ.Events.MANIFEST_PARSED,function(t,i){n();let a=e.addVideoTrack("main");for(let[e,t]of(a.selected=!0,i.levels.entries())){let i=a.addRendition(t.url[0],t.width,t.height,t.videoCodec,t.bitrate);r.set(t,"".concat(e)),i.id="".concat(e)}}),t.on(oQ.Events.AUDIO_TRACKS_UPDATED,function(t,i){for(let t of(a(),i.audioTracks)){let i=t.default?"main":"alternative",r=e.addAudioTrack(i,t.name,t.lang);r.id="".concat(t.id),t.default&&(r.enabled=!0)}}),e.audioTracks.addEventListener("change",()=>{var i;let r=+(null==(i=[...e.audioTracks].find(e=>e.enabled))?void 0:i.id),a=t.audioTracks.map(e=>e.id);r!=t.audioTrack&&a.includes(r)&&(t.audioTrack=r)}),t.on(oQ.Events.LEVELS_UPDATED,function(t,i){var a;let n=e.videoTracks[null!=(a=e.videoTracks.selectedIndex)?a:0];if(!n)return;let s=i.levels.map(e=>r.get(e));for(let t of e.videoRenditions)t.id&&!s.includes(t.id)&&n.removeRendition(t)}),null==(i=e.videoRenditions)||i.addEventListener("change",e=>{let i=e.target.selectedIndex;i!=t.nextLevel&&(t.nextLevel=i)});let a=()=>{for(let t of e.audioTracks)e.removeAudioTrack(t)},n=()=>{(()=>{for(let t of e.videoTracks)e.removeVideoTrack(t)})(),a()};t.once(oQ.Events.DESTROYING,n)}(e,i),function(e,t){t.on(oQ.Events.NON_NATIVE_TEXT_TRACKS_FOUND,(i,r)=>{let{tracks:a}=r;a.forEach(i=>{var r,a;let n=null!=(r=i.subtitleTrack)?r:i.closedCaptions,s=t.subtitleTracks.findIndex(e=>{let{lang:t,name:r,type:a}=e;return t==(null==n?void 0:n.lang)&&r===i.label&&a.toLowerCase()===i.kind}),o=(null!=(a=i._id)?a:i.default)?"default":"".concat(i.kind).concat(s);lm(e,i.kind,i.label,null==n?void 0:n.lang,o,i.default)})});let i=()=>{if(!t.subtitleTracks.length)return;let i=Array.from(e.textTracks).find(e=>e.id&&"showing"===e.mode&&["subtitles","captions"].includes(e.kind));if(!i)return;let r=t.subtitleTracks[t.subtitleTrack],a=r?r.default?"default":"".concat(t.subtitleTracks[t.subtitleTrack].type.toLowerCase()).concat(t.subtitleTrack):void 0;if(t.subtitleTrack<0||(null==i?void 0:i.id)!==a){let e=t.subtitleTracks.findIndex(e=>{let{lang:t,name:r,type:a,default:n}=e;return"default"===i.id&&n||t==i.language&&r===i.label&&a.toLowerCase()===i.kind});t.subtitleTrack=e}(null==i?void 0:i.id)===a&&i.cues&&Array.from(i.cues).forEach(e=>{i.addCue(e)})};e.textTracks.addEventListener("change",i),t.on(oQ.Events.CUES_PARSED,(t,i)=>{let{track:r,cues:a}=i,n=e.textTracks.getTrackById(r);if(!n)return;let s="disabled"===n.mode;s&&(n.mode="hidden"),a.forEach(e=>{var t;null!=(t=n.cues)&&t.getCueById(e.id)||n.addCue(e)}),s&&(n.mode="disabled")}),t.once(oQ.Events.DESTROYING,()=>{e.textTracks.removeEventListener("change",i),e.querySelectorAll("track[data-removeondestroy]").forEach(e=>{e.remove()})});let r=()=>{Array.from(e.textTracks).forEach(t=>{var i,r;if(!["subtitles","caption"].includes(t.kind)&&("thumbnails"===t.label||"chapters"===t.kind)){if(!(null!=(i=t.cues)&&i.length)){let i="track";t.kind&&(i+='[kind="'.concat(t.kind,'"]')),t.label&&(i+='[label="'.concat(t.label,'"]'));let a=e.querySelector(i),n=null!=(r=null==a?void 0:a.getAttribute("src"))?r:"";null==a||a.removeAttribute("src"),setTimeout(()=>{null==a||a.setAttribute("src",n)},0)}"hidden"!==t.mode&&(t.mode="hidden")}})};t.once(oQ.Events.MANIFEST_LOADED,r),t.once(oQ.Events.MEDIA_ATTACHED,r)}(t,i),i.attachMedia(t)):console.error("It looks like the video you're trying to play will not work on this system! If possible, try upgrading to the newest versions of your browser or software.")})(e,t,u),lT(t),lk(t);let c=((e,t,i)=>{let{autoplay:r}=e,a=!1,n=!1,s=lu(r)?r:!!r,o=()=>{a||o6(t,"playing",()=>{a=!0},{once:!0})};if(o(),o6(t,"loadstart",()=>{a=!1,o(),lh(t,s)},{once:!0}),o6(t,"loadstart",()=>{i||(n=e.streamType&&e.streamType!==o1.UNKNOWN?e.streamType===o1.LIVE:!Number.isFinite(t.duration)),lh(t,s)},{once:!0}),i&&i.once(oQ.Events.LEVEL_LOADED,(t,i)=>{var r;n=e.streamType&&e.streamType!==o1.UNKNOWN?e.streamType===o1.LIVE:null!=(r=i.details.live)&&r}),!s){let r=()=>{!n||Number.isFinite(e.startTime)||(null!=i&&i.liveSyncPosition?t.currentTime=i.liveSyncPosition:Number.isFinite(t.seekable.end(0))&&(t.currentTime=t.seekable.end(0)))};i&&o6(t,"play",()=>{"metadata"===t.preload?i.once(oQ.Events.LEVEL_UPDATED,r):r()},{once:!0})}return e=>{a||lh(t,s=lu(e)?e:!!e)}})(e,t,u);return{engine:u,setAutoplay:c,setPreload:h}})(this,this.nativeEl,dQ(this,dP)))}unload(){de(this.nativeEl,dQ(this,dP),this),dX(this,dP,void 0)}attributeChangedCallback(e,t,i){var r,a;switch(dC.observedAttributes.includes(e)&&!["src","autoplay","preload"].includes(e)&&super.attributeChangedCallback(e,t,i),e){case d$.PLAYER_SOFTWARE_NAME:this.playerSoftwareName=null!=i?i:void 0;break;case d$.PLAYER_SOFTWARE_VERSION:this.playerSoftwareVersion=null!=i?i:void 0;break;case"src":{let e=!!t,r=!!i;!e&&r?dZ(this,dW,dq).call(this):e&&!r?this.unload():e&&r&&(this.unload(),dZ(this,dW,dq).call(this));break}case"autoplay":if(i===t)break;null==(r=dQ(this,dP))||r.setAutoplay(this.autoplay);break;case"preload":if(i===t)break;null==(a=dQ(this,dP))||a.setPreload(i);break;case d$.PLAYBACK_ID:this.src=l$(this);break;case d$.DEBUG:{let e=this.debug;this.mux&&console.info("Cannot toggle debug mode of mux data after initialization. Make sure you set all metadata to override before setting the src."),this._hls&&(this._hls.config.debug=e);break}case d$.METADATA_URL:i&&fetch(i).then(e=>e.json()).then(e=>this.metadata=e).catch(()=>console.error("Unable to load or parse metadata JSON from metadata-url ".concat(i,"!")));break;case d$.STREAM_TYPE:(null==i||i!==t)&&this.dispatchEvent(new CustomEvent("streamtypechange",{composed:!0,bubbles:!0}));break;case d$.TARGET_LIVE_WINDOW:(null==i||i!==t)&&this.dispatchEvent(new CustomEvent("targetlivewindowchange",{composed:!0,bubbles:!0,detail:this.targetLiveWindow}));break;case d$.LOGO:(null==i||i!==t)&&this.updateLogo()}}updateLogo(){if(!this.shadowRoot)return;let e=this.shadowRoot.querySelector('slot[name="logo"]');e&&(e.innerHTML=this.constructor.getLogoHTML(dQ(this,dV)||this.logo))}connectedCallback(){var e;null==(e=super.connectedCallback)||e.call(this),this.nativeEl&&this.src&&!dQ(this,dP)&&dZ(this,dW,dq).call(this)}disconnectedCallback(){this.unload()}handleEvent(e){e.target===this.nativeEl&&this.dispatchEvent(new CustomEvent(e.type,{composed:!0,detail:e.detail}))}constructor(){super(),dz(this,dW),dz(this,dP),dz(this,dx),dz(this,dN),dz(this,dU,{}),dz(this,dF,{}),dz(this,dB),dz(this,dH),dz(this,dG),dz(this,dK),dz(this,dV,""),dX(this,dN,lZ()),this.nativeEl.addEventListener("muxmetadata",e=>{var t;let i=(e=>{var t;return null==(t=lQ.get(e))?void 0:t.metadata})(this.nativeEl),r=null!=(t=this.metadata)?t:{};this.metadata={...i,...r},(null==i?void 0:i["com.mux.video.branding"])==="mux-free-plan"&&(dX(this,dV,"default"),this.updateLogo())})}};function d3(e){return(d3=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d4(e,t,i){return(d4="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=d3(e)););return e}(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(i||e):a.value}})(e,t,i||e)}dP=new WeakMap,dx=new WeakMap,dN=new WeakMap,dU=new WeakMap,dF=new WeakMap,dB=new WeakMap,dH=new WeakMap,dG=new WeakMap,dK=new WeakMap,dV=new WeakMap,dW=new WeakSet,dq=async function(){dQ(this,dx)||(await dX(this,dx,Promise.resolve()),dX(this,dx,null),this.load())};let d5=new WeakMap;class d8 extends Error{}class d9 extends Error{}let d6=["application/x-mpegURL","application/vnd.apple.mpegurl","audio/mpegurl"];function d7(){var e,t;return null==(t=globalThis.cast)||null==(e=t.framework)?void 0:e.CastContext.getInstance()}function ue(){var e;return null==(e=d7())?void 0:e.getCurrentSession()}function ut(){var e;return null==(e=ue())?void 0:e.getSessionObj().media[0]}function ui(e){return d7().setOptions({...ur(),...e})}function ur(){return{receiverApplicationId:"CC1AD845",autoJoinPolicy:"origin_scoped",androidReceiverCompatible:!1,language:"en-US",resumeSavedSession:!0}}async function ua(e){try{let t=(await fetch(e,{method:"HEAD"})).headers.get("Content-Type");return d6.some(e=>t===e)}catch(e){return console.error("Error while trying to get the Content-Type of the manifest",e),!1}}async function un(e){try{let i=await (await fetch(e)).text(),r=i,a=function(e){let t=e.split("\n"),i=[];for(let e=0;e<t.length;e++)if(t[e].trim().startsWith("#EXT-X-STREAM-INF")){let r=t[e+1]?t[e+1].trim():"";r&&!r.startsWith("#")&&i.push(r)}return i}(i);if(a.length>0){let t=new URL(a[0],e).toString();r=await (await fetch(t)).text()}var t=r.split("\n").find(e=>!e.trim().startsWith("#")&&""!==e.trim());if(!t)return;let n=t.match(/\.([a-zA-Z0-9]+)(?:\?.*)?$/);return n?n[1]:null}catch(e){console.error("Error while trying to parse the manifest playlist",e);return}}let us=new(globalThis.WeakRef?class extends Set{add(e){super.add(new WeakRef(e))}forEach(e){super.forEach(t=>{let i=t.deref();i&&e(i)})}}:Set),uo=new WeakSet;!function(e){var t,i,r;(null==(i=globalThis.chrome)||null==(t=i.cast)?void 0:t.isAvailable)?(null==(r=globalThis.cast)?void 0:r.framework)?e():customElements.whenDefined("google-cast-button").then(e):globalThis.__onGCastApiAvailable=()=>{customElements.whenDefined("google-cast-button").then(e)}}(()=>{var e,t,r,a;if(!(null==(t=globalThis.chrome)||null==(e=t.cast)?void 0:e.isAvailable))return void console.debug("chrome.cast.isAvailable",null==(a=globalThis.chrome)||null==(r=a.cast)?void 0:r.isAvailable);i||(i=cast.framework,d7().addEventListener(i.CastContextEventType.CAST_STATE_CHANGED,e=>{us.forEach(t=>{var i,r;return null==(i=(r=d5.get(t)).onCastStateChanged)?void 0:i.call(r,e)})}),d7().addEventListener(i.CastContextEventType.SESSION_STATE_CHANGED,e=>{us.forEach(t=>{var i,r;return null==(i=(r=d5.get(t)).onSessionStateChanged)?void 0:i.call(r,e)})}),us.forEach(e=>{var t,i;return null==(t=(i=d5.get(e)).init)?void 0:t.call(i)}))});let ul=0;var ud=new WeakMap,uu=new WeakMap,uh=new WeakMap,uc=new WeakMap,um=new WeakMap,uf=new WeakMap,up=new WeakMap,ug=new WeakMap,uv=new WeakMap,uE=new WeakSet,uy=new WeakSet,ub=new WeakSet,uT=new WeakSet,u_=new WeakSet,uA=new WeakSet,uS=new WeakSet;class uI extends EventTarget{get state(){return(0,dp._)(this,um)}async watchAvailability(e){if((0,dp._)(this,ud).disableRemotePlayback)throw new d8("disableRemotePlayback attribute is present.");return(0,dp._)(this,ug).set(e,++ul),(0,dp._)(this,up).add(e),queueMicrotask(()=>e((0,dE._)(this,uy,uL).call(this))),ul}async cancelWatchAvailability(e){if((0,dp._)(this,ud).disableRemotePlayback)throw new d8("disableRemotePlayback attribute is present.");e?(0,dp._)(this,up).delete(e):(0,dp._)(this,up).clear()}async prompt(){var e,t,i,r;if((0,dp._)(this,ud).disableRemotePlayback)throw new d8("disableRemotePlayback attribute is present.");if(!(null==(t=globalThis.chrome)||null==(e=t.cast)?void 0:e.isAvailable))throw new d9("The RemotePlayback API is disabled on this platform.");let a=uo.has((0,dp._)(this,ud));uo.add((0,dp._)(this,ud)),ui((0,dp._)(this,ud).castOptions),Object.entries((0,dp._)(this,uc)).forEach(e=>{let[t,i]=e;(0,dp._)(this,uh).controller.addEventListener(t,i)});try{await d7().requestSession()}catch(e){if(a||uo.delete((0,dp._)(this,ud)),"cancel"===e)return;throw Error(e)}null==(r=d5.get((0,dp._)(this,ud)))||null==(i=r.loadOnPrompt)||i.call(r)}constructor(e){super(),(0,dg._)(this,uv,{get:uR,set:void 0}),(0,dy._)(this,uE),(0,dy._)(this,uy),(0,dy._)(this,ub),(0,dy._)(this,uT),(0,dy._)(this,u_),(0,dy._)(this,uA),(0,dy._)(this,uS),(0,dg._)(this,ud,{writable:!0,value:void 0}),(0,dg._)(this,uu,{writable:!0,value:void 0}),(0,dg._)(this,uh,{writable:!0,value:void 0}),(0,dg._)(this,uc,{writable:!0,value:void 0}),(0,dg._)(this,um,{writable:!0,value:"disconnected"}),(0,dg._)(this,uf,{writable:!0,value:!1}),(0,dg._)(this,up,{writable:!0,value:new Set}),(0,dg._)(this,ug,{writable:!0,value:new WeakMap}),(0,dv._)(this,ud,e),us.add(this),d5.set(this,{init:()=>(0,dE._)(this,u_,uC).call(this),onCastStateChanged:()=>(0,dE._)(this,ub,uD).call(this),onSessionStateChanged:()=>(0,dE._)(this,uT,uw).call(this),getCastPlayer:()=>(0,dp._)(this,uv)}),(0,dE._)(this,u_,uC).call(this)}}function uR(){if(uo.has((0,dp._)(this,ud)))return(0,dp._)(this,uh)}function uk(){uo.has((0,dp._)(this,ud))&&(Object.entries((0,dp._)(this,uc)).forEach(e=>{let[t,i]=e;(0,dp._)(this,uh).controller.removeEventListener(t,i)}),uo.delete((0,dp._)(this,ud)),(0,dp._)(this,ud).muted=(0,dp._)(this,uh).isMuted,(0,dp._)(this,ud).currentTime=(0,dp._)(this,uh).savedPlayerState.currentTime,!1===(0,dp._)(this,uh).savedPlayerState.isPaused&&(0,dp._)(this,ud).play())}function uL(){var e;let t=null==(e=d7())?void 0:e.getCastState();return t&&"NO_DEVICES_AVAILABLE"!==t}function uD(){let e=d7().getCastState();if(uo.has((0,dp._)(this,ud))&&"CONNECTING"===e&&((0,dv._)(this,um,"connecting"),this.dispatchEvent(new Event("connecting"))),!(0,dp._)(this,uf)&&(null==e?void 0:e.includes("CONNECT")))for(let e of((0,dv._)(this,uf,!0),(0,dp._)(this,up)))e(!0);else if((0,dp._)(this,uf)&&(!e||"NO_DEVICES_AVAILABLE"===e))for(let e of((0,dv._)(this,uf,!1),(0,dp._)(this,up)))e(!1)}async function uw(){let{SESSION_RESUMED:e}=i.SessionState;if(d7().getSessionState()===e){var t,r;if((0,dp._)(this,ud).castSrc===(null==(t=ut())?void 0:t.media.contentId)){uo.add((0,dp._)(this,ud)),Object.entries((0,dp._)(this,uc)).forEach(e=>{let[t,i]=e;(0,dp._)(this,uh).controller.addEventListener(t,i)});try{await (r=new chrome.cast.media.GetStatusRequest,new Promise((e,t)=>{ut().getStatus(r,e,t)}))}catch(e){console.error(e)}(0,dp._)(this,uc)[i.RemotePlayerEventType.IS_PAUSED_CHANGED](),(0,dp._)(this,uc)[i.RemotePlayerEventType.PLAYER_STATE_CHANGED]()}}}function uC(){!i||(0,dp._)(this,uu)||((0,dv._)(this,uu,!0),ui((0,dp._)(this,ud).castOptions),(0,dp._)(this,ud).textTracks.addEventListener("change",()=>(0,dE._)(this,uS,uO).call(this)),(0,dE._)(this,ub,uD).call(this),(0,dv._)(this,uh,new i.RemotePlayer),new i.RemotePlayerController((0,dp._)(this,uh)),(0,dv._)(this,uc,{[i.RemotePlayerEventType.IS_CONNECTED_CHANGED]:e=>{let{value:t}=e;!0===t?((0,dv._)(this,um,"connected"),this.dispatchEvent(new Event("connect"))):((0,dE._)(this,uE,uk).call(this),(0,dv._)(this,um,"disconnected"),this.dispatchEvent(new Event("disconnect")))},[i.RemotePlayerEventType.DURATION_CHANGED]:()=>{(0,dp._)(this,ud).dispatchEvent(new Event("durationchange"))},[i.RemotePlayerEventType.VOLUME_LEVEL_CHANGED]:()=>{(0,dp._)(this,ud).dispatchEvent(new Event("volumechange"))},[i.RemotePlayerEventType.IS_MUTED_CHANGED]:()=>{(0,dp._)(this,ud).dispatchEvent(new Event("volumechange"))},[i.RemotePlayerEventType.CURRENT_TIME_CHANGED]:()=>{var e;(null==(e=(0,dp._)(this,uv))?void 0:e.isMediaLoaded)&&(0,dp._)(this,ud).dispatchEvent(new Event("timeupdate"))},[i.RemotePlayerEventType.VIDEO_INFO_CHANGED]:()=>{(0,dp._)(this,ud).dispatchEvent(new Event("resize"))},[i.RemotePlayerEventType.IS_PAUSED_CHANGED]:()=>{(0,dp._)(this,ud).dispatchEvent(new Event(this.paused?"pause":"play"))},[i.RemotePlayerEventType.PLAYER_STATE_CHANGED]:()=>{var e,t;(null==(e=(0,dp._)(this,uv))?void 0:e.playerState)!==chrome.cast.media.PlayerState.PAUSED&&(0,dp._)(this,ud).dispatchEvent(new Event({[chrome.cast.media.PlayerState.PLAYING]:"playing",[chrome.cast.media.PlayerState.BUFFERING]:"waiting",[chrome.cast.media.PlayerState.IDLE]:"emptied"}[null==(t=(0,dp._)(this,uv))?void 0:t.playerState]))},[i.RemotePlayerEventType.IS_MEDIA_LOADED_CHANGED]:async()=>{var e;(null==(e=(0,dp._)(this,uv))?void 0:e.isMediaLoaded)&&(await Promise.resolve(),(0,dE._)(this,uA,uM).call(this))}}))}function uM(){(0,dE._)(this,uS,uO).call(this)}async function uO(){var e,t,i,r,a;let n;if(!(0,dp._)(this,uv))return;let s=(null!=(r=null==(e=(0,dp._)(this,uh).mediaInfo)?void 0:e.tracks)?r:[]).filter(e=>{let{type:t}=e;return t===chrome.cast.media.TrackType.TEXT}),o=[...(0,dp._)(this,ud).textTracks].filter(e=>{let{kind:t}=e;return"subtitles"===t||"captions"===t}),l=s.map(e=>{var t;let{language:i,name:r,trackId:a}=e,{mode:n}=null!=(t=o.find(e=>e.language===i&&e.label===r))?t:{};return!!n&&{mode:n,trackId:a}}).filter(Boolean),d=l.filter(e=>{let{mode:t}=e;return"showing"!==t}).map(e=>{let{trackId:t}=e;return t}),u=l.find(e=>{let{mode:t}=e;return"showing"===t}),h=null!=(a=null==(i=ue())||null==(t=i.getSessionObj().media[0])?void 0:t.activeTrackIds)?a:[],c=h;if(h.length&&(c=c.filter(e=>!d.includes(e))),(null==u?void 0:u.trackId)&&(c=[...c,u.trackId]),n=c=[...new Set(c)],!(h.length===n.length&&h.every(e=>n.includes(e))))try{let e=new chrome.cast.media.EditTracksInfoRequest(c);await new Promise((t,i)=>{ut().editTracksInfo(e,t,i)})}catch(e){console.error(e)}}let uP=e=>{var t,i=new WeakMap,r=new WeakMap,a=new WeakMap,n=new WeakMap,s=new WeakMap,o=new WeakSet;class l extends e{get remote(){return(0,dp._)(this,n)?(0,dp._)(this,n):globalThis.chrome?(this.disableRemotePlayback||function(){var e;let t="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1";if((null==(e=globalThis.chrome)?void 0:e.cast)||document.querySelector('script[src="'.concat(t,'"]')))return;let i=document.createElement("script");i.src=t,document.head.append(i)}(),d5.set(this,{loadOnPrompt:()=>(0,dE._)(this,o,u).call(this)}),(0,dv._)(this,n,new uI(this))):super.remote}attributeChangedCallback(e,t,i){if(super.attributeChangedCallback(e,t,i),"cast-receiver"===e&&i){(0,dp._)(this,r).receiverApplicationId=i;return}if((0,dp._)(this,s))switch(e){case"cast-stream-type":case"cast-src":this.load()}}async load(){var e,t;if(!(0,dp._)(this,s))return super.load();let r=new chrome.cast.media.MediaInfo(this.castSrc,this.castContentType);r.customData=this.castCustomData;let a=[...this.querySelectorAll("track")].filter(e=>{let{kind:t,src:i}=e;return i&&("subtitles"===t||"captions"===t)}),n=[],o=0;if(a.length&&(r.tracks=a.map(e=>{let t=++o;0===n.length&&"showing"===e.track.mode&&n.push(t);let i=new chrome.cast.media.Track(t,chrome.cast.media.TrackType.TEXT);return i.trackContentId=e.src,i.trackContentType="text/vtt",i.subtype="captions"===e.kind?chrome.cast.media.TextTrackType.CAPTIONS:chrome.cast.media.TextTrackType.SUBTITLES,i.name=e.label,i.language=e.srclang,i})),"live"===this.castStreamType?r.streamType=chrome.cast.media.StreamType.LIVE:r.streamType=chrome.cast.media.StreamType.BUFFERED,r.metadata=new chrome.cast.media.GenericMediaMetadata,r.metadata.title=this.title,r.metadata.images=[{url:this.poster}],ua(this.castSrc)){let e=await un(this.castSrc);((null==e?void 0:e.includes("m4s"))||(null==e?void 0:e.includes("mp4")))&&(r.hlsSegmentFormat=chrome.cast.media.HlsSegmentFormat.FMP4,r.hlsVideoSegmentFormat=chrome.cast.media.HlsVideoSegmentFormat.FMP4)}let l=new chrome.cast.media.LoadRequest(r);l.currentTime=null!=(t=super.currentTime)?t:0,l.autoplay=!(0,dp._)(this,i).paused,l.activeTrackIds=n,await (null==(e=ue())?void 0:e.loadMedia(l)),this.dispatchEvent(new Event("volumechange"))}play(){if((0,dp._)(this,s)){if((0,dp._)(this,s).isPaused){var e;null==(e=(0,dp._)(this,s).controller)||e.playOrPause()}return}return super.play()}pause(){if((0,dp._)(this,s)){if(!(0,dp._)(this,s).isPaused){var e;null==(e=(0,dp._)(this,s).controller)||e.playOrPause()}return}super.pause()}get castOptions(){return(0,dp._)(this,r)}get castReceiver(){var e;return null!=(e=this.getAttribute("cast-receiver"))?e:void 0}set castReceiver(e){this.castReceiver!=e&&this.setAttribute("cast-receiver","".concat(e))}get castSrc(){var e,t,i;return null!=(i=null!=(t=this.getAttribute("cast-src"))?t:null==(e=this.querySelector("source"))?void 0:e.src)?i:this.currentSrc}set castSrc(e){this.castSrc!=e&&this.setAttribute("cast-src","".concat(e))}get castContentType(){var e;return null!=(e=this.getAttribute("cast-content-type"))?e:void 0}set castContentType(e){this.setAttribute("cast-content-type","".concat(e))}get castStreamType(){var e,t;return null!=(t=null!=(e=this.getAttribute("cast-stream-type"))?e:this.streamType)?t:void 0}set castStreamType(e){this.setAttribute("cast-stream-type","".concat(e))}get castCustomData(){return(0,dp._)(this,a)}set castCustomData(e){let t=typeof e;if(!["object","undefined"].includes(t))return void console.error("castCustomData must be nullish or an object but value was of type ".concat(t));(0,dv._)(this,a,e)}get readyState(){if((0,dp._)(this,s))switch((0,dp._)(this,s).playerState){case chrome.cast.media.PlayerState.IDLE:return 0;case chrome.cast.media.PlayerState.BUFFERING:return 2;default:return 3}return super.readyState}get paused(){return(0,dp._)(this,s)?(0,dp._)(this,s).isPaused:super.paused}get muted(){var e;return(0,dp._)(this,s)?null==(e=(0,dp._)(this,s))?void 0:e.isMuted:super.muted}set muted(e){if((0,dp._)(this,s)){if(e&&!(0,dp._)(this,s).isMuted||!e&&(0,dp._)(this,s).isMuted){var t;null==(t=(0,dp._)(this,s).controller)||t.muteOrUnmute()}return}super.muted=e}get volume(){var e,t;return(0,dp._)(this,s)?null!=(t=null==(e=(0,dp._)(this,s))?void 0:e.volumeLevel)?t:1:super.volume}set volume(e){if((0,dp._)(this,s)){var t;(0,dp._)(this,s).volumeLevel=+e,null==(t=(0,dp._)(this,s).controller)||t.setVolumeLevel();return}super.volume=e}get duration(){var e,t,i;return(0,dp._)(this,s)&&(null==(e=(0,dp._)(this,s))?void 0:e.isMediaLoaded)?null!=(i=null==(t=(0,dp._)(this,s))?void 0:t.duration)?i:NaN:super.duration}get currentTime(){var e,t,i;return(0,dp._)(this,s)&&(null==(e=(0,dp._)(this,s))?void 0:e.isMediaLoaded)?null!=(i=null==(t=(0,dp._)(this,s))?void 0:t.currentTime)?i:0:super.currentTime}set currentTime(e){if((0,dp._)(this,s)){var t;(0,dp._)(this,s).currentTime=e,null==(t=(0,dp._)(this,s).controller)||t.seek();return}super.currentTime=e}constructor(...e){super(...e),(0,dg._)(this,s,{get:d,set:void 0}),(0,dy._)(this,o),(0,dg._)(this,i,{writable:!0,value:{paused:!1}}),(0,dg._)(this,r,{writable:!0,value:ur()}),(0,dg._)(this,a,{writable:!0,value:void 0}),(0,dg._)(this,n,{writable:!0,value:void 0})}}function d(){var e,t;return null==(t=d5.get(this.remote))||null==(e=t.getCastPlayer)?void 0:e.call(t)}async function u(){(0,dp._)(this,i).paused=d4(d3(l.prototype),"paused",this),d4(d3(l.prototype),"pause",this).call(this),this.muted=d4(d3(l.prototype),"muted",this);try{await this.load()}catch(e){console.error(e)}}return(0,dS._)(l,"observedAttributes",[...null!=(t=e.observedAttributes)?t:[],"cast-src","cast-content-type","cast-stream-type","cast-receiver"]),l};class ux extends Event{constructor(e,t){super(e),(0,dS._)(this,"track",void 0),this.track=t.track}}let uN=new WeakMap;function uU(e){var t,i,r;let a;return null!=(t=uN.get(e))?t:(i=e,r={},(a=uN.get(i))||uN.set(i,a={}),Object.assign(a,r))}function uF(e,t){let i=e.videoTracks;uU(t).media=e,uU(t).renditionSet||(uU(t).renditionSet=new Set);let r=uU(i).trackSet;r.add(t);let a=r.size-1;a in uW.prototype||Object.defineProperty(uW.prototype,a,{get(){return[...uU(this).trackSet][a]}}),queueMicrotask(()=>{i.dispatchEvent(new ux("addtrack",{track:t}))})}function uB(e){var t;let i=null==(t=uU(e).media)?void 0:t.videoTracks;i&&(uU(i).trackSet.delete(e),queueMicrotask(()=>{i.dispatchEvent(new ux("removetrack",{track:e}))}))}var uH=new WeakMap,uG=new WeakMap,uK=new WeakMap,uV=new WeakMap;class uW extends EventTarget{[Symbol.iterator](){return(0,dp._)(this,uV).values()}get length(){return(0,dp._)(this,uV).size}getTrackById(e){var t;return null!=(t=[...(0,dp._)(this,uV)].find(t=>t.id===e))?t:null}get selectedIndex(){return[...(0,dp._)(this,uV)].findIndex(e=>e.selected)}get onaddtrack(){return(0,dp._)(this,uH)}set onaddtrack(e){(0,dp._)(this,uH)&&(this.removeEventListener("addtrack",(0,dp._)(this,uH)),(0,dv._)(this,uH,void 0)),"function"==typeof e&&((0,dv._)(this,uH,e),this.addEventListener("addtrack",e))}get onremovetrack(){return(0,dp._)(this,uG)}set onremovetrack(e){(0,dp._)(this,uG)&&(this.removeEventListener("removetrack",(0,dp._)(this,uG)),(0,dv._)(this,uG,void 0)),"function"==typeof e&&((0,dv._)(this,uG,e),this.addEventListener("removetrack",e))}get onchange(){return(0,dp._)(this,uK)}set onchange(e){(0,dp._)(this,uK)&&(this.removeEventListener("change",(0,dp._)(this,uK)),(0,dv._)(this,uK,void 0)),"function"==typeof e&&((0,dv._)(this,uK,e),this.addEventListener("change",e))}constructor(){super(),(0,dg._)(this,uV,{get:uq,set:void 0}),(0,dg._)(this,uH,{writable:!0,value:void 0}),(0,dg._)(this,uG,{writable:!0,value:void 0}),(0,dg._)(this,uK,{writable:!0,value:void 0}),uU(this).trackSet=new Set}}function uq(){return uU(this).trackSet}class uY extends Event{constructor(e,t){super(e),(0,dS._)(this,"rendition",void 0),this.rendition=t.rendition}}function uj(e){return[...uU(e).media.videoTracks].filter(e=>e.selected).flatMap(e=>[...uU(e).renditionSet])}var uQ=new WeakMap,uz=new WeakMap,uX=new WeakMap;class uZ extends EventTarget{[Symbol.iterator](){return uj(this).values()}get length(){return uj(this).length}getRenditionById(e){var t;return null!=(t=uj(this).find(t=>"".concat(t.id)==="".concat(e)))?t:null}get selectedIndex(){return uj(this).findIndex(e=>e.selected)}set selectedIndex(e){for(let[t,i]of uj(this).entries())i.selected=t===e}get onaddrendition(){return(0,dp._)(this,uQ)}set onaddrendition(e){(0,dp._)(this,uQ)&&(this.removeEventListener("addrendition",(0,dp._)(this,uQ)),(0,dv._)(this,uQ,void 0)),"function"==typeof e&&((0,dv._)(this,uQ,e),this.addEventListener("addrendition",e))}get onremoverendition(){return(0,dp._)(this,uz)}set onremoverendition(e){(0,dp._)(this,uz)&&(this.removeEventListener("removerendition",(0,dp._)(this,uz)),(0,dv._)(this,uz,void 0)),"function"==typeof e&&((0,dv._)(this,uz,e),this.addEventListener("removerendition",e))}get onchange(){return(0,dp._)(this,uX)}set onchange(e){(0,dp._)(this,uX)&&(this.removeEventListener("change",(0,dp._)(this,uX)),(0,dv._)(this,uX,void 0)),"function"==typeof e&&((0,dv._)(this,uX,e),this.addEventListener("change",e))}constructor(...e){super(...e),(0,dg._)(this,uQ,{writable:!0,value:void 0}),(0,dg._)(this,uz,{writable:!0,value:void 0}),(0,dg._)(this,uX,{writable:!0,value:void 0})}}var uJ=new WeakMap;class u${get selected(){return(0,dp._)(this,uJ)}set selected(e){if((0,dp._)(this,uJ)!==e){(0,dv._)(this,uJ,e);var t=this;let i=uU(t).media.videoRenditions;i&&!uU(i).changeRequested&&(uU(i).changeRequested=!0,queueMicrotask(()=>{delete uU(i).changeRequested,uU(t).track.selected&&i.dispatchEvent(new Event("change"))}))}}constructor(){(0,dS._)(this,"src",void 0),(0,dS._)(this,"id",void 0),(0,dS._)(this,"width",void 0),(0,dS._)(this,"height",void 0),(0,dS._)(this,"bitrate",void 0),(0,dS._)(this,"frameRate",void 0),(0,dS._)(this,"codec",void 0),(0,dg._)(this,uJ,{writable:!0,value:!1})}}var u0=new WeakMap;class u1{addRendition(e,t,i,r,a,n){let s=new u$;return s.src=e,s.width=t,s.height=i,s.frameRate=n,s.bitrate=a,s.codec=r,!function(e,t){let i=uU(e).media.videoRenditions;uU(t).media=uU(e).media,uU(t).track=e;let r=uU(e).renditionSet;r.add(t);let a=r.size-1;a in uZ.prototype||Object.defineProperty(uZ.prototype,a,{get(){return uj(this)[a]}}),queueMicrotask(()=>{e.selected&&i.dispatchEvent(new uY("addrendition",{rendition:t}))})}(this,s),s}removeRendition(e){let t=uU(e).media.videoRenditions,i=uU(e).track;uU(i).renditionSet.delete(e),queueMicrotask(()=>{uU(e).track.selected&&t.dispatchEvent(new uY("removerendition",{rendition:e}))})}get selected(){return(0,dp._)(this,u0)}set selected(e){(0,dp._)(this,u0)!==e&&((0,dv._)(this,u0,e),!0===e&&function(e){var t;let i=null!=(t=uU(e).media.videoTracks)?t:[],r=!1;for(let t of i)t!==e&&(t.selected=!1,r=!0);if(r){if(uU(i).changeRequested)return;uU(i).changeRequested=!0,queueMicrotask(()=>{delete uU(i).changeRequested,i.dispatchEvent(new Event("change"))})}}(this))}constructor(){(0,dS._)(this,"id",void 0),(0,dS._)(this,"kind",void 0),(0,dS._)(this,"label",""),(0,dS._)(this,"language",""),(0,dS._)(this,"sourceBuffer",void 0),(0,dg._)(this,u0,{writable:!0,value:!1})}}function u2(e){return[...uU(e).media.audioTracks].filter(e=>e.enabled).flatMap(e=>[...uU(e).renditionSet])}var u3=new WeakMap,u4=new WeakMap,u5=new WeakMap;class u8 extends EventTarget{[Symbol.iterator](){return u2(this).values()}get length(){return u2(this).length}getRenditionById(e){var t;return null!=(t=u2(this).find(t=>"".concat(t.id)==="".concat(e)))?t:null}get selectedIndex(){return u2(this).findIndex(e=>e.selected)}set selectedIndex(e){for(let[t,i]of u2(this).entries())i.selected=t===e}get onaddrendition(){return(0,dp._)(this,u3)}set onaddrendition(e){(0,dp._)(this,u3)&&(this.removeEventListener("addrendition",(0,dp._)(this,u3)),(0,dv._)(this,u3,void 0)),"function"==typeof e&&((0,dv._)(this,u3,e),this.addEventListener("addrendition",e))}get onremoverendition(){return(0,dp._)(this,u4)}set onremoverendition(e){(0,dp._)(this,u4)&&(this.removeEventListener("removerendition",(0,dp._)(this,u4)),(0,dv._)(this,u4,void 0)),"function"==typeof e&&((0,dv._)(this,u4,e),this.addEventListener("removerendition",e))}get onchange(){return(0,dp._)(this,u5)}set onchange(e){(0,dp._)(this,u5)&&(this.removeEventListener("change",(0,dp._)(this,u5)),(0,dv._)(this,u5,void 0)),"function"==typeof e&&((0,dv._)(this,u5,e),this.addEventListener("change",e))}constructor(...e){super(...e),(0,dg._)(this,u3,{writable:!0,value:void 0}),(0,dg._)(this,u4,{writable:!0,value:void 0}),(0,dg._)(this,u5,{writable:!0,value:void 0})}}var u9=new WeakMap;class u6{get selected(){return(0,dp._)(this,u9)}set selected(e){if((0,dp._)(this,u9)!==e){(0,dv._)(this,u9,e);var t=this;let i=uU(t).media.audioRenditions;i&&!uU(i).changeRequested&&(uU(i).changeRequested=!0,queueMicrotask(()=>{delete uU(i).changeRequested,uU(t).track.enabled&&i.dispatchEvent(new Event("change"))}))}}constructor(){(0,dS._)(this,"src",void 0),(0,dS._)(this,"id",void 0),(0,dS._)(this,"bitrate",void 0),(0,dS._)(this,"codec",void 0),(0,dg._)(this,u9,{writable:!0,value:!1})}}function u7(e,t){let i=e.audioTracks;uU(t).media=e,uU(t).renditionSet||(uU(t).renditionSet=new Set);let r=uU(i).trackSet;r.add(t);let a=r.size-1;a in hn.prototype||Object.defineProperty(hn.prototype,a,{get(){return[...uU(this).trackSet][a]}}),queueMicrotask(()=>{i.dispatchEvent(new ux("addtrack",{track:t}))})}function he(e){var t;let i=null==(t=uU(e).media)?void 0:t.audioTracks;i&&(uU(i).trackSet.delete(e),queueMicrotask(()=>{i.dispatchEvent(new ux("removetrack",{track:e}))}))}var ht=new WeakMap,hi=new WeakMap,hr=new WeakMap,ha=new WeakMap;class hn extends EventTarget{[Symbol.iterator](){return(0,dp._)(this,ha).values()}get length(){return(0,dp._)(this,ha).size}getTrackById(e){var t;return null!=(t=[...(0,dp._)(this,ha)].find(t=>t.id===e))?t:null}get onaddtrack(){return(0,dp._)(this,ht)}set onaddtrack(e){(0,dp._)(this,ht)&&(this.removeEventListener("addtrack",(0,dp._)(this,ht)),(0,dv._)(this,ht,void 0)),"function"==typeof e&&((0,dv._)(this,ht,e),this.addEventListener("addtrack",e))}get onremovetrack(){return(0,dp._)(this,hi)}set onremovetrack(e){(0,dp._)(this,hi)&&(this.removeEventListener("removetrack",(0,dp._)(this,hi)),(0,dv._)(this,hi,void 0)),"function"==typeof e&&((0,dv._)(this,hi,e),this.addEventListener("removetrack",e))}get onchange(){return(0,dp._)(this,hr)}set onchange(e){(0,dp._)(this,hr)&&(this.removeEventListener("change",(0,dp._)(this,hr)),(0,dv._)(this,hr,void 0)),"function"==typeof e&&((0,dv._)(this,hr,e),this.addEventListener("change",e))}constructor(){super(),(0,dg._)(this,ha,{get:hs,set:void 0}),(0,dg._)(this,ht,{writable:!0,value:void 0}),(0,dg._)(this,hi,{writable:!0,value:void 0}),(0,dg._)(this,hr,{writable:!0,value:void 0}),uU(this).trackSet=new Set}}function hs(){return uU(this).trackSet}var ho=new WeakMap;class hl{addRendition(e,t,i){let r=new u6;return r.src=e,r.codec=t,r.bitrate=i,!function(e,t){let i=uU(e).media.audioRenditions;uU(t).media=uU(e).media,uU(t).track=e;let r=uU(e).renditionSet;r.add(t);let a=r.size-1;a in u8.prototype||Object.defineProperty(u8.prototype,a,{get(){return u2(this)[a]}}),queueMicrotask(()=>{e.enabled&&i.dispatchEvent(new uY("addrendition",{rendition:t}))})}(this,r),r}removeRendition(e){let t=uU(e).media.audioRenditions,i=uU(e).track;uU(i).renditionSet.delete(e),queueMicrotask(()=>{uU(e).track.enabled&&t.dispatchEvent(new uY("removerendition",{rendition:e}))})}get enabled(){return(0,dp._)(this,ho)}set enabled(e){if((0,dp._)(this,ho)!==e){(0,dv._)(this,ho,e);let t=uU(this).media.audioTracks;t&&!uU(t).changeRequested&&(uU(t).changeRequested=!0,queueMicrotask(()=>{delete uU(t).changeRequested,t.dispatchEvent(new Event("change"))}))}}constructor(){(0,dS._)(this,"id",void 0),(0,dS._)(this,"kind",void 0),(0,dS._)(this,"label",""),(0,dS._)(this,"language",""),(0,dS._)(this,"sourceBuffer",void 0),(0,dg._)(this,ho,{writable:!0,value:!1})}}let hd=hc(globalThis.HTMLMediaElement,"video"),hu=hc(globalThis.HTMLMediaElement,"audio");function hh(e){if(!(null==e?void 0:e.prototype))return e;let t=hc(e,"video");(!t||"".concat(t).includes("[native code]"))&&Object.defineProperty(e.prototype,"videoTracks",{get(){return function(e){let t=uU(e).videoTracks;if(!t&&(t=new uW,uU(e).videoTracks=t,hd)){var i;let r=hd.call(null!=(i=e.nativeEl)?i:e);for(let t of r)uF(e,t);r.addEventListener("change",()=>{t.dispatchEvent(new Event("change"))}),r.addEventListener("addtrack",i=>{if([...t].some(e=>e instanceof u1)){for(let e of r)uB(e);return}uF(e,i.track)}),r.addEventListener("removetrack",e=>{uB(e.track)})}return t}(this)}});let i=hc(e,"audio");(!i||"".concat(i).includes("[native code]"))&&Object.defineProperty(e.prototype,"audioTracks",{get(){return function(e){let t=uU(e).audioTracks;if(!t&&(t=new hn,uU(e).audioTracks=t,hu)){var i;let r=hu.call(null!=(i=e.nativeEl)?i:e);for(let t of r)u7(e,t);r.addEventListener("change",()=>{t.dispatchEvent(new Event("change"))}),r.addEventListener("addtrack",i=>{if([...t].some(e=>e instanceof hl)){for(let e of r)he(e);return}u7(e,i.track)}),r.addEventListener("removetrack",e=>{he(e.track)})}return t}(this)}}),"addVideoTrack"in e.prototype||(e.prototype.addVideoTrack=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=new u1;return r.kind=e,r.label=t,r.language=i,uF(this,r),r}),"removeVideoTrack"in e.prototype||(e.prototype.removeVideoTrack=uB),"addAudioTrack"in e.prototype||(e.prototype.addAudioTrack=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=new hl;return r.kind=e,r.label=t,r.language=i,u7(this,r),r}),"removeAudioTrack"in e.prototype||(e.prototype.removeAudioTrack=he),"videoRenditions"in e.prototype||Object.defineProperty(e.prototype,"videoRenditions",{get(){return r(this)}});let r=e=>{let t=uU(e).videoRenditions;return t||(uU(t=new uZ).media=e,uU(e).videoRenditions=t),t};"audioRenditions"in e.prototype||Object.defineProperty(e.prototype,"audioRenditions",{get(){return a(this)}});let a=e=>{let t=uU(e).audioRenditions;return t||(uU(t=new u8).media=e,uU(e).audioRenditions=t),t};return e}function hc(e,t){if(null==e?void 0:e.prototype){var i;return null==(i=Object.getOwnPropertyDescriptor(e.prototype,"".concat(t,"Tracks")))?void 0:i.get}}var hm=e=>{throw TypeError(e)},hf=(e,t,i)=>t.has(e)||hm("Cannot "+i),hp=(e,t,i)=>(hf(e,t,"read from private field"),i?i.call(e):t.get(e)),hg=(e,t,i)=>t.has(e)?hm("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,i),hv=(e,t,i,r)=>(hf(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i),hE=class{addEventListener(){}removeEventListener(){}dispatchEvent(e){return!0}};"undefined"==typeof DocumentFragment&&(globalThis.DocumentFragment=class extends hE{});var hy,hb=class extends hE{},hT=class{get detail(){return hp(this,hy)}initCustomEvent(){}constructor(e,t={}){hg(this,hy),hv(this,hy,null==t?void 0:t.detail)}};hy=new WeakMap;var h_={document:{createElement:function(e,t){return new hb}},DocumentFragment,customElements:{get(e){},define(e,t,i){},getName:e=>null,upgrade(e){},whenDefined:e=>Promise.resolve(hb)},CustomEvent:hT,EventTarget:hE,HTMLElement:hb,HTMLVideoElement:class extends hE{}},hA="undefined"==typeof window||void 0===globalThis.customElements,hS=hA?h_:globalThis;hA?h_.document:globalThis.document;var hI,hR=class extends uP(hh(d2)){get autoplay(){let e=this.getAttribute("autoplay");return null!==e&&(""===e||e)}set autoplay(e){e!==this.autoplay&&(e?this.setAttribute("autoplay","string"==typeof e?e:""):this.removeAttribute("autoplay"))}get muxCastCustomData(){return{mux:{playbackId:this.playbackId,minResolution:this.minResolution,maxResolution:this.maxResolution,renditionOrder:this.renditionOrder,customDomain:this.customDomain,tokens:{drm:this.drmToken},envKey:this.envKey,metadata:this.metadata,disableCookies:this.disableCookies,disableTracking:this.disableTracking,beaconCollectionDomain:this.beaconCollectionDomain,startTime:this.startTime,preferCmcd:this.preferCmcd}}}get castCustomData(){var e;return null!=(e=hp(this,hI))?e:this.muxCastCustomData}set castCustomData(e){hv(this,hI,e)}constructor(){super(...arguments),hg(this,hI)}};hI=new WeakMap,hS.customElements.get("mux-video")||(hS.customElements.define("mux-video",hR),hS.MuxVideoElement=hR),e.s(["default",()=>Tq,"getVideoAttribute",()=>TW,"playerSoftwareName",()=>TH,"playerSoftwareVersion",()=>TB],606552);var hk=e.i(892510);e.s(["AttributeToStateChangeEventMap",()=>hx,"AvailabilityStates",()=>hH,"MediaStateChangeEvents",()=>hO,"MediaStateReceiverAttributes",()=>hD,"MediaUIAttributes",()=>hM,"MediaUIEvents",()=>hL,"MediaUIProps",()=>hw,"PointerTypes",()=>hB,"ReadyStates",()=>hF,"StateChangeEventToAttributeMap",()=>hP,"StreamTypes",()=>hG,"TextTrackKinds",()=>hN,"TextTrackModes",()=>hU,"VolumeLevels",()=>hK,"WebkitPresentationModes",()=>hV],992617);let hL={MEDIA_PLAY_REQUEST:"mediaplayrequest",MEDIA_PAUSE_REQUEST:"mediapauserequest",MEDIA_MUTE_REQUEST:"mediamuterequest",MEDIA_UNMUTE_REQUEST:"mediaunmuterequest",MEDIA_VOLUME_REQUEST:"mediavolumerequest",MEDIA_SEEK_REQUEST:"mediaseekrequest",MEDIA_AIRPLAY_REQUEST:"mediaairplayrequest",MEDIA_ENTER_FULLSCREEN_REQUEST:"mediaenterfullscreenrequest",MEDIA_EXIT_FULLSCREEN_REQUEST:"mediaexitfullscreenrequest",MEDIA_PREVIEW_REQUEST:"mediapreviewrequest",MEDIA_ENTER_PIP_REQUEST:"mediaenterpiprequest",MEDIA_EXIT_PIP_REQUEST:"mediaexitpiprequest",MEDIA_ENTER_CAST_REQUEST:"mediaentercastrequest",MEDIA_EXIT_CAST_REQUEST:"mediaexitcastrequest",MEDIA_SHOW_TEXT_TRACKS_REQUEST:"mediashowtexttracksrequest",MEDIA_HIDE_TEXT_TRACKS_REQUEST:"mediahidetexttracksrequest",MEDIA_SHOW_SUBTITLES_REQUEST:"mediashowsubtitlesrequest",MEDIA_DISABLE_SUBTITLES_REQUEST:"mediadisablesubtitlesrequest",MEDIA_TOGGLE_SUBTITLES_REQUEST:"mediatogglesubtitlesrequest",MEDIA_PLAYBACK_RATE_REQUEST:"mediaplaybackraterequest",MEDIA_RENDITION_REQUEST:"mediarenditionrequest",MEDIA_AUDIO_TRACK_REQUEST:"mediaaudiotrackrequest",MEDIA_SEEK_TO_LIVE_REQUEST:"mediaseektoliverequest",REGISTER_MEDIA_STATE_RECEIVER:"registermediastatereceiver",UNREGISTER_MEDIA_STATE_RECEIVER:"unregistermediastatereceiver"},hD={MEDIA_CHROME_ATTRIBUTES:"mediachromeattributes",MEDIA_CONTROLLER:"mediacontroller"},hw={MEDIA_AIRPLAY_UNAVAILABLE:"mediaAirplayUnavailable",MEDIA_AUDIO_TRACK_ENABLED:"mediaAudioTrackEnabled",MEDIA_AUDIO_TRACK_LIST:"mediaAudioTrackList",MEDIA_AUDIO_TRACK_UNAVAILABLE:"mediaAudioTrackUnavailable",MEDIA_BUFFERED:"mediaBuffered",MEDIA_CAST_UNAVAILABLE:"mediaCastUnavailable",MEDIA_CHAPTERS_CUES:"mediaChaptersCues",MEDIA_CURRENT_TIME:"mediaCurrentTime",MEDIA_DURATION:"mediaDuration",MEDIA_ENDED:"mediaEnded",MEDIA_ERROR:"mediaError",MEDIA_ERROR_CODE:"mediaErrorCode",MEDIA_ERROR_MESSAGE:"mediaErrorMessage",MEDIA_FULLSCREEN_UNAVAILABLE:"mediaFullscreenUnavailable",MEDIA_HAS_PLAYED:"mediaHasPlayed",MEDIA_HEIGHT:"mediaHeight",MEDIA_IS_AIRPLAYING:"mediaIsAirplaying",MEDIA_IS_CASTING:"mediaIsCasting",MEDIA_IS_FULLSCREEN:"mediaIsFullscreen",MEDIA_IS_PIP:"mediaIsPip",MEDIA_LOADING:"mediaLoading",MEDIA_MUTED:"mediaMuted",MEDIA_PAUSED:"mediaPaused",MEDIA_PIP_UNAVAILABLE:"mediaPipUnavailable",MEDIA_PLAYBACK_RATE:"mediaPlaybackRate",MEDIA_PREVIEW_CHAPTER:"mediaPreviewChapter",MEDIA_PREVIEW_COORDS:"mediaPreviewCoords",MEDIA_PREVIEW_IMAGE:"mediaPreviewImage",MEDIA_PREVIEW_TIME:"mediaPreviewTime",MEDIA_RENDITION_LIST:"mediaRenditionList",MEDIA_RENDITION_SELECTED:"mediaRenditionSelected",MEDIA_RENDITION_UNAVAILABLE:"mediaRenditionUnavailable",MEDIA_SEEKABLE:"mediaSeekable",MEDIA_STREAM_TYPE:"mediaStreamType",MEDIA_SUBTITLES_LIST:"mediaSubtitlesList",MEDIA_SUBTITLES_SHOWING:"mediaSubtitlesShowing",MEDIA_TARGET_LIVE_WINDOW:"mediaTargetLiveWindow",MEDIA_TIME_IS_LIVE:"mediaTimeIsLive",MEDIA_VOLUME:"mediaVolume",MEDIA_VOLUME_LEVEL:"mediaVolumeLevel",MEDIA_VOLUME_UNAVAILABLE:"mediaVolumeUnavailable",MEDIA_LANG:"mediaLang",MEDIA_WIDTH:"mediaWidth"},hC=Object.entries(hw),hM=hC.reduce((e,t)=>{let[i,r]=t;return e[i]=r.toLowerCase(),e},{}),hO=hC.reduce((e,t)=>{let[i,r]=t;return e[i]=r.toLowerCase(),e},{USER_INACTIVE_CHANGE:"userinactivechange",BREAKPOINTS_CHANGE:"breakpointchange",BREAKPOINTS_COMPUTED:"breakpointscomputed"}),hP=Object.entries(hO).reduce((e,t)=>{let[i,r]=t,a=hM[i];return a&&(e[r]=a),e},{userinactivechange:"userinactive"}),hx=Object.entries(hM).reduce((e,t)=>{let[i,r]=t,a=hO[i];return a&&(e[r]=a),e},{userinactive:"userinactivechange"}),hN={SUBTITLES:"subtitles",CAPTIONS:"captions",DESCRIPTIONS:"descriptions",CHAPTERS:"chapters",METADATA:"metadata"},hU={DISABLED:"disabled",HIDDEN:"hidden",SHOWING:"showing"},hF={HAVE_NOTHING:0,HAVE_METADATA:1,HAVE_CURRENT_DATA:2,HAVE_FUTURE_DATA:3,HAVE_ENOUGH_DATA:4},hB={MOUSE:"mouse",PEN:"pen",TOUCH:"touch"},hH={UNAVAILABLE:"unavailable",UNSUPPORTED:"unsupported"},hG={LIVE:"live",ON_DEMAND:"on-demand",UNKNOWN:"unknown"},hK={HIGH:"high",MEDIUM:"medium",LOW:"low",OFF:"off"},hV={INLINE:"inline",FULLSCREEN:"fullscreen",PICTURE_IN_PICTURE:"picture-in-picture"};function hW(e){if(e){let{id:t,width:i,height:r}=e;return[t,i,r].filter(e=>null!=e).join(":")}}function hq(e){if(e){let[t,i,r]=e.split(":");return{id:t,width:+i,height:+r}}}function hY(e){if(e){let{id:t,kind:i,language:r,label:a}=e;return[t,i,r,a].filter(e=>null!=e).join(":")}}function hj(e){if(e){let[t,i,r,a]=e.split(":");return{id:t,kind:i,language:r,label:a}}}function hQ(e){return"number"==typeof e&&!Number.isNaN(e)&&Number.isFinite(e)}function hz(e){return"string"==typeof e&&!isNaN(e)&&!isNaN(parseFloat(e))}e.i(992617),e.s(["emptyTimeRanges",()=>h0,"formatAsTimePhrase",()=>hJ,"formatTime",()=>h$,"serializeTimeRanges",()=>h1],538333);let hX=e=>new Promise(t=>setTimeout(t,e)),hZ=[{singular:"hour",plural:"hours"},{singular:"minute",plural:"minutes"},{singular:"second",plural:"seconds"}],hJ=e=>{if(!hQ(e))return"";let t=Math.abs(e),i=t!==e,r=new Date(0,0,0,0,0,t,0),a=[r.getHours(),r.getMinutes(),r.getSeconds()].map((e,t)=>e&&((e,t)=>{let i=1===e?hZ[t].singular:hZ[t].plural;return"".concat(e," ").concat(i)})(e,t)).filter(e=>e).join(", ");return"".concat(a).concat(i?" remaining":"")};function h$(e,t){let i=!1;e<0&&(i=!0,e=0-e);let r=Math.floor((e=e<0?0:e)%60),a=Math.floor(e/60%60),n=Math.floor(e/3600),s=Math.floor(t/60%60),o=Math.floor(t/3600);return(isNaN(e)||e===1/0)&&(n=a=r="0"),a=(((n=n>0||o>0?n+":":"")||s>=10)&&a<10?"0"+a:a)+":",(i?"-":"")+n+a+(r=r<10?"0"+r:r)}let h0=Object.freeze({length:0,start(e){let t=e>>>0;if(t>=this.length)throw new DOMException("Failed to execute 'start' on 'TimeRanges': The index provided (".concat(t,") is greater than or equal to the maximum bound (").concat(this.length,")."));return 0},end(e){let t=e>>>0;if(t>=this.length)throw new DOMException("Failed to execute 'end' on 'TimeRanges': The index provided (".concat(t,") is greater than or equal to the maximum bound (").concat(this.length,")."));return 0}});function h1(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h0;return Array.from(e).map((t,i)=>[Number(e.start(i).toFixed(3)),Number(e.end(i).toFixed(3))].join(":")).join(" ")}e.i(538333);let h2={en:{"Start airplay":"Start airplay","Stop airplay":"Stop airplay",Audio:"Audio",Captions:"Captions","Enable captions":"Enable captions","Disable captions":"Disable captions","Start casting":"Start casting","Stop casting":"Stop casting","Enter fullscreen mode":"Enter fullscreen mode","Exit fullscreen mode":"Exit fullscreen mode",Mute:"Mute",Unmute:"Unmute","Enter picture in picture mode":"Enter picture in picture mode","Exit picture in picture mode":"Exit picture in picture mode",Play:"Play",Pause:"Pause","Playback rate":"Playback rate","Playback rate {playbackRate}":"Playback rate {playbackRate}",Quality:"Quality","Seek backward":"Seek backward","Seek forward":"Seek forward",Settings:"Settings",Auto:"Auto","audio player":"audio player","video player":"video player",volume:"volume",seek:"seek","closed captions":"closed captions","current playback rate":"current playback rate","playback time":"playback time","media loading":"media loading",settings:"settings","audio tracks":"audio tracks",quality:"quality",play:"play",pause:"pause",mute:"mute",unmute:"unmute","chapter: {chapterName}":"chapter: {chapterName}",live:"live",Off:"Off","start airplay":"start airplay","stop airplay":"stop airplay","start casting":"start casting","stop casting":"stop casting","enter fullscreen mode":"enter fullscreen mode","exit fullscreen mode":"exit fullscreen mode","enter picture in picture mode":"enter picture in picture mode","exit picture in picture mode":"exit picture in picture mode","seek to live":"seek to live","playing live":"playing live","seek back {seekOffset} seconds":"seek back {seekOffset} seconds","seek forward {seekOffset} seconds":"seek forward {seekOffset} seconds","Network Error":"Network Error","Decode Error":"Decode Error","Source Not Supported":"Source Not Supported","Encryption Error":"Encryption Error","A network error caused the media download to fail.":"A network error caused the media download to fail.","A media error caused playback to be aborted. The media could be corrupt or your browser does not support this format.":"A media error caused playback to be aborted. The media could be corrupt or your browser does not support this format.","An unsupported error occurred. The server or network failed, or your browser does not support this format.":"An unsupported error occurred. The server or network failed, or your browser does not support this format.","The media is encrypted and there are no keys to decrypt it.":"The media is encrypted and there are no keys to decrypt it."}},h3=(null==(gJ=globalThis.navigator)?void 0:gJ.language)||"en",h4=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(e=>{var t,i,r;let[a]=h3.split("-");return(null==(t=h2[h3])?void 0:t[e])||(null==(i=h2[a])?void 0:i[e])||(null==(r=h2.en)?void 0:r[e])||e})(e).replace(/\{(\w+)\}/g,(e,i)=>i in t?String(t[i]):"{".concat(i,"}"))};class h5{addEventListener(){}removeEventListener(){}dispatchEvent(){return!0}}class h8 extends h5{}class h9 extends h8{constructor(){super(...arguments),this.role=null}}let h6={createElement:function(){return new h7.HTMLElement},createElementNS:function(){return new h7.HTMLElement},addEventListener(){},removeEventListener(){},dispatchEvent:e=>!1},h7={ResizeObserver:class{observe(){}unobserve(){}disconnect(){}},document:h6,Node:h8,Element:h9,HTMLElement:class extends h9{get content(){return new h7.DocumentFragment}constructor(){super(...arguments),this.innerHTML=""}},DocumentFragment:class extends h5{},customElements:{get:function(){},define:function(){},whenDefined:function(){}},localStorage:{getItem:e=>null,setItem(e,t){},removeItem(e){}},CustomEvent:function(){},getComputedStyle:function(){},navigator:{languages:[],get userAgent(){return""}},matchMedia:e=>({matches:!1,media:e}),DOMParser:class{parseFromString(e,t){return{body:{textContent:e}}}}},ce="undefined"==typeof window||void 0===window.customElements,ct=Object.keys(h7).every(e=>e in globalThis),ci=ce&&!ct?h7:globalThis,cr=ce&&!ct?h6:globalThis.document,ca=new WeakMap,cn=e=>{let t=ca.get(e);return t||ca.set(e,t=new Set),t},cs=new ci.ResizeObserver(e=>{for(let t of e)for(let e of cn(t.target))e(t)});function co(e,t){cn(e).add(t),cs.observe(e)}function cl(e,t){let i=cn(e);i.delete(t),i.size||cs.unobserve(e)}function cd(e){let t={};for(let i of e)t[i.name]=i.value;return t}function cu(e){var t;return null!=(t=ch(e))?t:cp(e,"media-controller")}function ch(e){var t;let{MEDIA_CONTROLLER:i}=hD,r=e.getAttribute(i);if(r)return null==(t=cv(e))?void 0:t.getElementById(r)}let cc=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:".value",r=e.querySelector(i);r&&(r.textContent=t)},cm=(e,t)=>((e,t)=>{let i=e.shadowRoot.querySelector('slot[name="'.concat(t,'"]'));return i?i.children:[]})(e,t)[0],cf=(e,t)=>!!e&&!!t&&(null!=e&&!!e.contains(t)||cf(e,t.getRootNode().host)),cp=(e,t)=>{if(!e)return null;let i=e.closest(t);return i||cp(e.getRootNode().host,t)};function cg(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document,i=null==t?void 0:t.activeElement;return i?null!=(e=cg(i.shadowRoot))?e:i:null}function cv(e){var t;let i=null==(t=null==e?void 0:e.getRootNode)?void 0:t.call(e);return i instanceof ShadowRoot||i instanceof Document?i:null}function cE(e){let{depth:t=3,checkOpacity:i=!0,checkVisibilityCSS:r=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e.checkVisibility)return e.checkVisibility({checkOpacity:i,checkVisibilityCSS:r});let a=e;for(;a&&t>0;){let e=getComputedStyle(a);if(i&&"0"===e.opacity||r&&"hidden"===e.visibility||"none"===e.display)return!1;a=a.parentElement,t--}return!0}function cy(e,t){let i=function(e,t){var i,r;let a;for(a of null!=(i=e.querySelectorAll("style:not([media])"))?i:[]){let e;try{e=null==(r=a.sheet)?void 0:r.cssRules}catch(e){continue}for(let i of null!=e?e:[])if(t(i.selectorText))return i}}(e,e=>e===t);return i||cb(e,t)}function cb(e,t){var i,r;let a=null!=(i=e.querySelectorAll("style:not([media])"))?i:[],n=null==a?void 0:a[a.length-1];return(null==n?void 0:n.sheet)?(null==n||n.sheet.insertRule("".concat(t,"{}"),n.sheet.cssRules.length),null==(r=n.sheet.cssRules)?void 0:r[n.sheet.cssRules.length-1]):(console.warn("Media Chrome: No style sheet found on style tag of",e),{style:{setProperty:()=>{},removeProperty:()=>"",getPropertyValue:()=>""}})}function cT(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:NaN,r=e.getAttribute(t);return null!=r?+r:i}function c_(e,t,i){let r=+i;if(null==i||Number.isNaN(r)){e.hasAttribute(t)&&e.removeAttribute(t);return}cT(e,t,void 0)!==r&&e.setAttribute(t,"".concat(r))}function cA(e,t){return e.hasAttribute(t)}function cS(e,t,i){if(null==i){e.hasAttribute(t)&&e.removeAttribute(t);return}cA(e,t)!=i&&e.toggleAttribute(t,i)}function cI(e,t){var i;let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return null!=(i=e.getAttribute(t))?i:r}function cR(e,t,i){if(null==i){e.hasAttribute(t)&&e.removeAttribute(t);return}let r="".concat(i);cI(e,t,void 0)!==r&&e.setAttribute(t,r)}var ck=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},cL=(e,t,i)=>(ck(e,t,"read from private field"),i?i.call(e):t.get(e)),cD=(e,t,i,r)=>(ck(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i);class cw extends ci.HTMLElement{static get observedAttributes(){return[hD.MEDIA_CONTROLLER,hM.MEDIA_PAUSED]}attributeChangedCallback(e,t,i){var r,a,n,s,o;e===hD.MEDIA_CONTROLLER&&(t&&(null==(a=null==(r=cL(this,g$))?void 0:r.unassociateElement)||a.call(r,this),cD(this,g$,null)),i&&this.isConnected&&(cD(this,g$,null==(n=this.getRootNode())?void 0:n.getElementById(i)),null==(o=null==(s=cL(this,g$))?void 0:s.associateElement)||o.call(s,this)))}connectedCallback(){var e,t,i,r;this.tabIndex=-1,this.setAttribute("aria-hidden","true"),cD(this,g$,function(e){var t;let i=e.getAttribute(hD.MEDIA_CONTROLLER);return i?null==(t=e.getRootNode())?void 0:t.getElementById(i):cp(e,"media-controller")}(this)),this.getAttribute(hD.MEDIA_CONTROLLER)&&(null==(t=null==(e=cL(this,g$))?void 0:e.associateElement)||t.call(e,this)),null==(i=cL(this,g$))||i.addEventListener("pointerdown",this),null==(r=cL(this,g$))||r.addEventListener("click",this)}disconnectedCallback(){var e,t,i,r;this.getAttribute(hD.MEDIA_CONTROLLER)&&(null==(t=null==(e=cL(this,g$))?void 0:e.unassociateElement)||t.call(e,this)),null==(i=cL(this,g$))||i.removeEventListener("pointerdown",this),null==(r=cL(this,g$))||r.removeEventListener("click",this),cD(this,g$,null)}handleEvent(e){var t;let i=null==(t=e.composedPath())?void 0:t[0];if(["video","media-controller"].includes(null==i?void 0:i.localName)){if("pointerdown"===e.type)this._pointerType=e.pointerType;else if("click"===e.type){let{clientX:t,clientY:i}=e,{left:r,top:a,width:n,height:s}=this.getBoundingClientRect(),o=t-r,l=i-a;if(o<0||l<0||o>n||l>s||0===n&&0===s)return;let d=this._pointerType||"mouse";if(this._pointerType=void 0,d===hB.TOUCH)return void this.handleTap(e);if(d===hB.MOUSE)return void this.handleMouseClick(e)}}}get mediaPaused(){return cA(this,hM.MEDIA_PAUSED)}set mediaPaused(e){cS(this,hM.MEDIA_PAUSED,e)}handleTap(e){}handleMouseClick(e){let t=this.mediaPaused?hL.MEDIA_PLAY_REQUEST:hL.MEDIA_PAUSE_REQUEST;this.dispatchEvent(new ci.CustomEvent(t,{composed:!0,bubbles:!0}))}constructor(){if(super(),((e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)})(this,g$,void 0),!this.shadowRoot){this.attachShadow(this.constructor.shadowRootOptions);let e=cd(this.attributes);this.shadowRoot.innerHTML=this.constructor.getTemplateHTML(e)}}}g$=new WeakMap,cw.shadowRootOptions={mode:"open"},cw.getTemplateHTML=function(e){return"\n    <style>\n      :host {\n        display: var(--media-control-display, var(--media-gesture-receiver-display, inline-block));\n        box-sizing: border-box;\n      }\n    </style>\n  "},ci.customElements.get("media-gesture-receiver")||ci.customElements.define("media-gesture-receiver",cw);var cC=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},cM=(e,t,i)=>(cC(e,t,"read from private field"),i?i.call(e):t.get(e)),cO=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},cP=(e,t,i,r)=>(cC(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i),cx=(e,t,i)=>(cC(e,t,"access private method"),i);let cN={AUDIO:"audio",AUTOHIDE:"autohide",BREAKPOINTS:"breakpoints",GESTURES_DISABLED:"gesturesdisabled",KEYBOARD_CONTROL:"keyboardcontrol",NO_AUTOHIDE:"noautohide",USER_INACTIVE:"userinactive",AUTOHIDE_OVER_CONTROLS:"autohideovercontrols"},cU=Object.values(hM);function cF(e,t){var i,r,a;if(!e.isConnected)return;let n=Object.fromEntries((null!=(i=e.getAttribute(cN.BREAKPOINTS))?i:"sm:384 md:576 lg:768 xl:960").split(/\s+/).map(e=>e.split(":"))),s=(r=n,a=t,Object.keys(r).filter(e=>a>=parseInt(r[e]))),o=!1;if(Object.keys(n).forEach(t=>{if(s.includes(t)){e.hasAttribute("breakpoint".concat(t))||(e.setAttribute("breakpoint".concat(t),""),o=!0);return}e.hasAttribute("breakpoint".concat(t))&&(e.removeAttribute("breakpoint".concat(t)),o=!0)}),o){let t=new CustomEvent(hO.BREAKPOINTS_CHANGE,{detail:s});e.dispatchEvent(t)}e.breakpointsComputed||(e.breakpointsComputed=!0,e.dispatchEvent(new CustomEvent(hO.BREAKPOINTS_COMPUTED,{bubbles:!0,composed:!0})))}class cB extends ci.HTMLElement{static get observedAttributes(){return[cN.AUTOHIDE,cN.GESTURES_DISABLED].concat(cU).filter(e=>![hM.MEDIA_RENDITION_LIST,hM.MEDIA_AUDIO_TRACK_LIST,hM.MEDIA_CHAPTERS_CUES,hM.MEDIA_WIDTH,hM.MEDIA_HEIGHT,hM.MEDIA_ERROR,hM.MEDIA_ERROR_MESSAGE].includes(e))}attributeChangedCallback(e,t,i){e.toLowerCase()==cN.AUTOHIDE&&(this.autohide=i)}get media(){let e=this.querySelector(":scope > [slot=media]");return(null==e?void 0:e.nodeName)=="SLOT"&&(e=e.assignedElements({flatten:!0})[0]),e}async handleMediaUpdated(e){e&&(cP(this,g1,e),e.localName.includes("-")&&await ci.customElements.whenDefined(e.localName),this.mediaSetCallback(e))}connectedCallback(){var e;cM(this,g4).observe(this,{childList:!0,subtree:!0}),co(this,cM(this,g6));let t=null!=this.getAttribute(cN.AUDIO)?h4("audio player"):h4("video player");this.setAttribute("role","region"),this.setAttribute("aria-label",t),this.handleMediaUpdated(this.media),this.setAttribute(cN.USER_INACTIVE,""),cF(this,this.getBoundingClientRect().width),this.addEventListener("pointerdown",this),this.addEventListener("pointermove",this),this.addEventListener("pointerup",this),this.addEventListener("mouseleave",this),this.addEventListener("keyup",this),null==(e=ci.window)||e.addEventListener("mouseup",this)}disconnectedCallback(){var e;cM(this,g4).disconnect(),cl(this,cM(this,g6)),this.media&&this.mediaUnsetCallback(this.media),null==(e=ci.window)||e.removeEventListener("mouseup",this)}mediaSetCallback(e){}mediaUnsetCallback(e){cP(this,g1,null)}handleEvent(e){switch(e.type){case"pointerdown":cP(this,g0,e.timeStamp);break;case"pointermove":cx(this,g7,ve).call(this,e);break;case"pointerup":cx(this,vt,vi).call(this,e);break;case"mouseleave":cx(this,vr,va).call(this);break;case"mouseup":this.removeAttribute(cN.KEYBOARD_CONTROL);break;case"keyup":cx(this,vo,vl).call(this),this.setAttribute(cN.KEYBOARD_CONTROL,"")}}set autohide(e){let t=Number(e);cP(this,g3,isNaN(t)?0:t)}get autohide(){return(void 0===cM(this,g3)?2:cM(this,g3)).toString()}get breakpoints(){return cI(this,cN.BREAKPOINTS)}set breakpoints(e){cR(this,cN.BREAKPOINTS,e)}get audio(){return cA(this,cN.AUDIO)}set audio(e){cS(this,cN.AUDIO,e)}get gesturesDisabled(){return cA(this,cN.GESTURES_DISABLED)}set gesturesDisabled(e){cS(this,cN.GESTURES_DISABLED,e)}get keyboardControl(){return cA(this,cN.KEYBOARD_CONTROL)}set keyboardControl(e){cS(this,cN.KEYBOARD_CONTROL,e)}get noAutohide(){return cA(this,cN.NO_AUTOHIDE)}set noAutohide(e){cS(this,cN.NO_AUTOHIDE,e)}get autohideOverControls(){return cA(this,cN.AUTOHIDE_OVER_CONTROLS)}set autohideOverControls(e){cS(this,cN.AUTOHIDE_OVER_CONTROLS,e)}get userInteractive(){return cA(this,cN.USER_INACTIVE)}set userInteractive(e){cS(this,cN.USER_INACTIVE,e)}constructor(){if(super(),cO(this,g5),cO(this,g7),cO(this,vt),cO(this,vr),cO(this,vn),cO(this,vo),cO(this,g0,0),cO(this,g1,null),cO(this,g2,null),cO(this,g3,void 0),this.breakpointsComputed=!1,cO(this,g4,new MutationObserver(cx(this,g5,g8).bind(this))),cO(this,g9,!1),cO(this,g6,e=>{cM(this,g9)||(setTimeout(()=>{!function(e){cF(e.target,e.contentRect.width)}(e),cP(this,g9,!1)},0),cP(this,g9,!0))}),!this.shadowRoot){this.attachShadow(this.constructor.shadowRootOptions);let e=cd(this.attributes),t=this.constructor.getTemplateHTML(e);this.shadowRoot.setHTMLUnsafe?this.shadowRoot.setHTMLUnsafe(t):this.shadowRoot.innerHTML=t}let e=this.querySelector(":scope > slot[slot=media]");e&&e.addEventListener("slotchange",()=>{if(!e.assignedElements({flatten:!0}).length){cM(this,g1)&&this.mediaUnsetCallback(cM(this,g1));return}this.handleMediaUpdated(this.media)})}}g0=new WeakMap,g1=new WeakMap,g2=new WeakMap,g3=new WeakMap,g4=new WeakMap,g5=new WeakSet,g8=function(e){let t=this.media;for(let i of e)if("childList"===i.type){for(let e of i.removedNodes){if("media"!=e.slot||i.target!=this)continue;let r=i.previousSibling&&i.previousSibling.previousElementSibling;if(r&&t){let t="media"!==r.slot;for(;null!==(r=r.previousSibling);)"media"==r.slot&&(t=!1);t&&this.mediaUnsetCallback(e)}else this.mediaUnsetCallback(e)}if(t)for(let e of i.addedNodes)e===t&&this.handleMediaUpdated(t)}},g9=new WeakMap,g6=new WeakMap,g7=new WeakSet,ve=function(e){if("mouse"!==e.pointerType&&e.timeStamp-cM(this,g0)<250)return;cx(this,vn,vs).call(this),clearTimeout(cM(this,g2));let t=this.hasAttribute(cN.AUTOHIDE_OVER_CONTROLS);([this,this.media].includes(e.target)||t)&&cx(this,vo,vl).call(this)},vt=new WeakSet,vi=function(e){if("touch"===e.pointerType){let t=!this.hasAttribute(cN.USER_INACTIVE);[this,this.media].includes(e.target)&&t?cx(this,vr,va).call(this):cx(this,vo,vl).call(this)}else e.composedPath().some(e=>["media-play-button","media-fullscreen-button"].includes(null==e?void 0:e.localName))&&cx(this,vo,vl).call(this)},vr=new WeakSet,va=function(){if(0>cM(this,g3)||this.hasAttribute(cN.USER_INACTIVE))return;this.setAttribute(cN.USER_INACTIVE,"");let e=new ci.CustomEvent(hO.USER_INACTIVE_CHANGE,{composed:!0,bubbles:!0,detail:!0});this.dispatchEvent(e)},vn=new WeakSet,vs=function(){if(!this.hasAttribute(cN.USER_INACTIVE))return;this.removeAttribute(cN.USER_INACTIVE);let e=new ci.CustomEvent(hO.USER_INACTIVE_CHANGE,{composed:!0,bubbles:!0,detail:!1});this.dispatchEvent(e)},vo=new WeakSet,vl=function(){cx(this,vn,vs).call(this),clearTimeout(cM(this,g2));let e=parseInt(this.autohide);e<0||cP(this,g2,setTimeout(()=>{cx(this,vr,va).call(this)},1e3*e))},cB.shadowRootOptions={mode:"open"},cB.getTemplateHTML=function(e){return"\n    <style>\n      \n      :host([".concat(hM.MEDIA_IS_FULLSCREEN,"]) ::slotted([slot=media]) {\n        outline: none;\n      }\n\n      :host {\n        box-sizing: border-box;\n        position: relative;\n        display: inline-block;\n        line-height: 0;\n        background-color: var(--media-background-color, #000);\n      }\n\n      :host(:not([").concat(cN.AUDIO,"])) [part~=layer]:not([part~=media-layer]) {\n        position: absolute;\n        top: 0;\n        left: 0;\n        bottom: 0;\n        right: 0;\n        display: flex;\n        flex-flow: column nowrap;\n        align-items: start;\n        pointer-events: none;\n        background: none;\n      }\n\n      slot[name=media] {\n        display: var(--media-slot-display, contents);\n      }\n\n      ","\n      :host([").concat(cN.AUDIO,"]) slot[name=media] {\n        display: var(--media-slot-display, none);\n      }\n\n      ","\n      :host([").concat(cN.AUDIO,"]) [part~=layer][part~=gesture-layer] {\n        height: 0;\n        display: block;\n      }\n\n      ","\n      :host(:not([").concat(cN.AUDIO,"])[").concat(cN.GESTURES_DISABLED,"]) ::slotted([slot=gestures-chrome]),\n          :host(:not([").concat(cN.AUDIO,"])[").concat(cN.GESTURES_DISABLED,"]) media-gesture-receiver[slot=gestures-chrome] {\n        display: none;\n      }\n\n      ","\n      ::slotted(:not([slot=media]):not([slot=poster]):not(media-loading-indicator):not([role=dialog]):not([hidden])) {\n        pointer-events: auto;\n      }\n\n      :host(:not([").concat(cN.AUDIO,"])) *[part~=layer][part~=centered-layer] {\n        align-items: center;\n        justify-content: center;\n      }\n\n      :host(:not([").concat(cN.AUDIO,"])) ::slotted(media-gesture-receiver[slot=gestures-chrome]),\n      :host(:not([").concat(cN.AUDIO,"])) media-gesture-receiver[slot=gestures-chrome] {\n        align-self: stretch;\n        flex-grow: 1;\n      }\n\n      slot[name=middle-chrome] {\n        display: inline;\n        flex-grow: 1;\n        pointer-events: none;\n        background: none;\n      }\n\n      ","\n      ::slotted([slot=media]),\n      ::slotted([slot=poster]) {\n        width: 100%;\n        height: 100%;\n      }\n\n      ","\n      :host(:not([").concat(cN.AUDIO,"])) .spacer {\n        flex-grow: 1;\n      }\n\n      ","\n      :host(:-webkit-full-screen) {\n        ","\n        width: 100% !important;\n        height: 100% !important;\n      }\n\n      ","\n      ::slotted(:not([slot=media]):not([slot=poster]):not([").concat(cN.NO_AUTOHIDE,"]):not([hidden]):not([role=dialog])) {\n        opacity: 1;\n        transition: var(--media-control-transition-in, opacity 0.25s);\n      }\n\n      ","\n      :host([").concat(cN.USER_INACTIVE,"]:not([").concat(hM.MEDIA_PAUSED,"]):not([").concat(hM.MEDIA_IS_AIRPLAYING,"]):not([").concat(hM.MEDIA_IS_CASTING,"]):not([").concat(cN.AUDIO,"])) ::slotted(:not([slot=media]):not([slot=poster]):not([").concat(cN.NO_AUTOHIDE,"]):not([role=dialog])) {\n        opacity: 0;\n        transition: var(--media-control-transition-out, opacity 1s);\n      }\n\n      :host([").concat(cN.USER_INACTIVE,"]:not([").concat(cN.NO_AUTOHIDE,"]):not([").concat(hM.MEDIA_PAUSED,"]):not([").concat(hM.MEDIA_IS_CASTING,"]):not([").concat(cN.AUDIO,"])) ::slotted([slot=media]) {\n        cursor: none;\n      }\n\n      :host([").concat(cN.USER_INACTIVE,"][").concat(cN.AUTOHIDE_OVER_CONTROLS,"]:not([").concat(cN.NO_AUTOHIDE,"]):not([").concat(hM.MEDIA_PAUSED,"]):not([").concat(hM.MEDIA_IS_CASTING,"]):not([").concat(cN.AUDIO,"])) * {\n        --media-cursor: none;\n        cursor: none;\n      }\n\n\n      ::slotted(media-control-bar)  {\n        align-self: stretch;\n      }\n\n      ","\n      :host(:not([").concat(cN.AUDIO,"])[").concat(hM.MEDIA_HAS_PLAYED,']) slot[name=poster] {\n        display: none;\n      }\n\n      ::slotted([role=dialog]) {\n        width: 100%;\n        height: 100%;\n        align-self: center;\n      }\n\n      ::slotted([role=menu]) {\n        align-self: end;\n      }\n    </style>\n\n    <slot name="media" part="layer media-layer"></slot>\n    <slot name="poster" part="layer poster-layer"></slot>\n    <slot name="gestures-chrome" part="layer gesture-layer">\n      <media-gesture-receiver slot="gestures-chrome">\n        <template shadowrootmode="').concat(cw.shadowRootOptions.mode,'">\n          ').concat(cw.getTemplateHTML({}),'\n        </template>\n      </media-gesture-receiver>\n    </slot>\n    <span part="layer vertical-layer">\n      <slot name="top-chrome" part="top chrome"></slot>\n      <slot name="middle-chrome" part="middle chrome"></slot>\n      <slot name="centered-chrome" part="layer centered-layer center centered chrome"></slot>\n      ','\n      <slot part="bottom chrome"></slot>\n    </span>\n    <slot name="dialog" part="layer dialog-layer"></slot>\n  ')},ci.customElements.get("media-container")||ci.customElements.define("media-container",cB);var cH=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},cG=(e,t,i)=>(cH(e,t,"read from private field"),i?i.call(e):t.get(e)),cK=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},cV=(e,t,i,r)=>(cH(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i);class cW{[Symbol.iterator](){return cG(this,vm,vf).values()}get length(){return cG(this,vm,vf).size}get value(){var e;return null!=(e=[...cG(this,vm,vf)].join(" "))?e:""}set value(e){var t;e!==this.value&&(cV(this,vc,new Set),this.add(...null!=(t=null==e?void 0:e.split(" "))?t:[]))}toString(){return this.value}item(e){return[...cG(this,vm,vf)][e]}values(){return cG(this,vm,vf).values()}forEach(e,t){cG(this,vm,vf).forEach(e,t)}add(){for(var e,t,i=arguments.length,r=Array(i),a=0;a<i;a++)r[a]=arguments[a];r.forEach(e=>cG(this,vc).add(e)),(""!==this.value||(null==(e=cG(this,vd))?void 0:e.hasAttribute("".concat(cG(this,vu)))))&&(null==(t=cG(this,vd))||t.setAttribute("".concat(cG(this,vu)),"".concat(this.value)))}remove(){for(var e,t=arguments.length,i=Array(t),r=0;r<t;r++)i[r]=arguments[r];i.forEach(e=>cG(this,vc).delete(e)),null==(e=cG(this,vd))||e.setAttribute("".concat(cG(this,vu)),"".concat(this.value))}contains(e){return cG(this,vm,vf).has(e)}toggle(e,t){if(void 0!==t)if(t)return this.add(e),!0;else return this.remove(e),!1;return this.contains(e)?(this.remove(e),!1):(this.add(e),!0)}replace(e,t){return this.remove(e),this.add(t),e===t}constructor(e,t,{defaultValue:i}={defaultValue:void 0}){cK(this,vm),cK(this,vd,void 0),cK(this,vu,void 0),cK(this,vh,void 0),cK(this,vc,new Set),cV(this,vd,e),cV(this,vu,t),cV(this,vh,new Set(i))}}vd=new WeakMap,vu=new WeakMap,vh=new WeakMap,vc=new WeakMap,vm=new WeakSet,vf=function(){return cG(this,vc).size?cG(this,vc):cG(this,vh)};let cq=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.split(/\s+/)},cY=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",[t,i,r]=e.split(":"),a=r?decodeURIComponent(r):void 0;return{kind:"cc"===t?hN.CAPTIONS:hN.SUBTITLES,language:i,label:a}},cj=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return cq(e).map(e=>{let i=cY(e);return{...t,...i}})},cQ=e=>e?Array.isArray(e)?e.map(e=>"string"==typeof e?cY(e):e):"string"==typeof e?cj(e):[e]:[],cz=function(){let{kind:e,label:t,language:i}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{kind:"subtitles"};return t?"".concat("captions"===e?"cc":"sb",":").concat(i,":").concat(encodeURIComponent(t)):i},cX=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return Array.prototype.map.call(e,cz).join(" ")},cZ=e=>{let t=Object.entries(e).map(e=>{let[t,i]=e;return e=>e[t]===i});return e=>t.every(t=>t(e))},cJ=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=cQ(i).map(cZ);Array.from(t).filter(e=>r.some(t=>t(e))).forEach(t=>{t.mode=e})},c$=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>!0;if(!(null==e?void 0:e.textTracks))return[];let i="function"==typeof t?t:cZ(t);return Array.from(e.textTracks).filter(i)},c0=e=>{var t;return!!(null==(t=e.mediaSubtitlesShowing)?void 0:t.length)||e.hasAttribute(hM.MEDIA_SUBTITLES_SHOWING)},c1="exitFullscreen"in cr?"exitFullscreen":"webkitExitFullscreen"in cr?"webkitExitFullscreen":"webkitCancelFullScreen"in cr?"webkitCancelFullScreen":void 0,c2="fullscreenElement"in cr?"fullscreenElement":"webkitFullscreenElement"in cr?"webkitFullscreenElement":void 0,c3="fullscreenEnabled"in cr?"fullscreenEnabled":"webkitFullscreenEnabled"in cr?"webkitFullscreenEnabled":void 0,c4=()=>{var e;return r||(r=null==(e=null==cr?void 0:cr.createElement)?void 0:e.call(cr,"video"))},c5=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c4();if(!e)return!1;let t=e.volume;e.volume=t/2+.1;let i=new AbortController,r=await Promise.race([c8(e,i.signal),c9(e,t)]);return i.abort(),r},c8=(e,t)=>new Promise(i=>{e.addEventListener("volumechange",()=>i(!0),{signal:t})}),c9=async(e,t)=>{for(let i=0;i<10;i++){if(e.volume===t)return!1;await hX(10)}return e.volume!==t},c6=/.*Version\/.*Safari\/.*/.test(ci.navigator.userAgent),c7=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c4();return(!ci.matchMedia("(display-mode: standalone)").matches||!c6)&&"function"==typeof(null==e?void 0:e.requestPictureInPicture)},me=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c4(),{documentElement:t,media:i}={documentElement:cr,media:e};return!!(null==t?void 0:t[c3])||i&&"webkitSupportsFullscreen"in i},mt=me(),mi=c7(),mr=!!ci.WebKitPlaybackTargetAvailabilityEvent,ma=!!ci.chrome,mn=e=>c$(e.media,e=>[hN.SUBTITLES,hN.CAPTIONS].includes(e.kind)).sort((e,t)=>e.kind>=t.kind?1:-1),ms=e=>c$(e.media,e=>e.mode===hU.SHOWING&&[hN.SUBTITLES,hN.CAPTIONS].includes(e.kind)),mo=(e,t)=>{let i=mn(e),r=ms(e),a=!!r.length;if(i.length){if(!1===t||a&&!0!==t)cJ(hU.DISABLED,i,r);else if(!0===t||!a&&!1!==t){let t=i[0],{options:a}=e;if(!(null==a?void 0:a.noSubtitlesLangPref)){let e=globalThis.localStorage.getItem("media-chrome-pref-subtitles-lang"),r=e?[e,...globalThis.navigator.languages]:globalThis.navigator.languages,a=i.filter(e=>r.some(t=>e.language.toLowerCase().startsWith(t.split("-")[0]))).sort((e,t)=>r.findIndex(t=>e.language.toLowerCase().startsWith(t.split("-")[0]))-r.findIndex(e=>t.language.toLowerCase().startsWith(e.split("-")[0])));a[0]&&(t=a[0])}let{language:n,label:s,kind:o}=t;cJ(hU.DISABLED,i,r),cJ(hU.SHOWING,i,[{language:n,label:s,kind:o}])}}},ml=(e,t)=>e===t||null!=e&&null!=t&&typeof e==typeof t&&(!!("number"==typeof e&&Number.isNaN(e)&&Number.isNaN(t))||"object"==typeof e&&(Array.isArray(e)?md(e,t):Object.entries(e).every(e=>{let[i,r]=e;return i in t&&ml(r,t[i])}))),md=(e,t)=>{let i=Array.isArray(e),r=Array.isArray(t);return i===r&&(!i&&!r||e.length===t.length&&e.every((e,i)=>ml(e,t[i])))},mu=Object.values(hG),mh=c5().then(e=>a=e),mc=async function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];await Promise.all(t.filter(e=>e).map(async e=>{if(!("localName"in e&&e instanceof ci.HTMLElement))return;let t=e.localName;if(!t.includes("-"))return;let i=ci.customElements.get(t);i&&e instanceof i||(await ci.customElements.whenDefined(t),ci.customElements.upgrade(e))}))},mm=new ci.DOMParser,mf={mediaError:{get(e,t){let{media:i}=e;if((null==t?void 0:t.type)!=="playing")return null==i?void 0:i.error},mediaEvents:["emptied","error","playing"]},mediaErrorCode:{get(e,t){var i;let{media:r}=e;if((null==t?void 0:t.type)!=="playing")return null==(i=null==r?void 0:r.error)?void 0:i.code},mediaEvents:["emptied","error","playing"]},mediaErrorMessage:{get(e,t){var i,r;let{media:a}=e;if((null==t?void 0:t.type)!=="playing")return null!=(r=null==(i=null==a?void 0:a.error)?void 0:i.message)?r:""},mediaEvents:["emptied","error","playing"]},mediaWidth:{get(e){var t;let{media:i}=e;return null!=(t=null==i?void 0:i.videoWidth)?t:0},mediaEvents:["resize"]},mediaHeight:{get(e){var t;let{media:i}=e;return null!=(t=null==i?void 0:i.videoHeight)?t:0},mediaEvents:["resize"]},mediaPaused:{get(e){var t;let{media:i}=e;return null==(t=null==i?void 0:i.paused)||t},set(e,t){var i;let{media:r}=t;r&&(e?r.pause():null==(i=r.play())||i.catch(()=>{}))},mediaEvents:["play","playing","pause","emptied"]},mediaHasPlayed:{get(e,t){let{media:i}=e;return!!i&&(t?"playing"===t.type:!i.paused)},mediaEvents:["playing","emptied"]},mediaEnded:{get(e){var t;let{media:i}=e;return null!=(t=null==i?void 0:i.ended)&&t},mediaEvents:["seeked","ended","emptied"]},mediaPlaybackRate:{get(e){var t;let{media:i}=e;return null!=(t=null==i?void 0:i.playbackRate)?t:1},set(e,t){let{media:i}=t;i&&Number.isFinite(+e)&&(i.playbackRate=+e)},mediaEvents:["ratechange","loadstart"]},mediaMuted:{get(e){var t;let{media:i}=e;return null!=(t=null==i?void 0:i.muted)&&t},set(e,t){let{media:i}=t;if(i){try{ci.localStorage.setItem("media-chrome-pref-muted",e?"true":"false")}catch(e){console.debug("Error setting muted pref",e)}i.muted=e}},mediaEvents:["volumechange"],stateOwnersUpdateHandlers:[(e,t)=>{let{options:{noMutedPref:i}}=t,{media:r}=t;if(r&&!r.muted&&!i)try{let i="true"===ci.localStorage.getItem("media-chrome-pref-muted");mf.mediaMuted.set(i,t),e(i)}catch(e){console.debug("Error getting muted pref",e)}}]},mediaVolume:{get(e){var t;let{media:i}=e;return null!=(t=null==i?void 0:i.volume)?t:1},set(e,t){let{media:i}=t;if(i){try{null==e?ci.localStorage.removeItem("media-chrome-pref-volume"):ci.localStorage.setItem("media-chrome-pref-volume",e.toString())}catch(e){console.debug("Error setting volume pref",e)}Number.isFinite(+e)&&(i.volume=+e)}},mediaEvents:["volumechange"],stateOwnersUpdateHandlers:[(e,t)=>{let{options:{noVolumePref:i}}=t;if(!i)try{let{media:i}=t;if(!i)return;let r=ci.localStorage.getItem("media-chrome-pref-volume");if(null==r)return;mf.mediaVolume.set(+r,t),e(+r)}catch(e){console.debug("Error getting volume pref",e)}}]},mediaVolumeLevel:{get(e){let{media:t}=e;return void 0===(null==t?void 0:t.volume)?"high":t.muted||0===t.volume?"off":t.volume<.5?"low":t.volume<.75?"medium":"high"},mediaEvents:["volumechange"]},mediaCurrentTime:{get(e){var t;let{media:i}=e;return null!=(t=null==i?void 0:i.currentTime)?t:0},set(e,t){let{media:i}=t;i&&hQ(e)&&(i.currentTime=e)},mediaEvents:["timeupdate","loadedmetadata"]},mediaDuration:{get(e){let{media:t,options:{defaultDuration:i}={}}=e;return i&&(!t||!t.duration||Number.isNaN(t.duration)||!Number.isFinite(t.duration))?i:Number.isFinite(null==t?void 0:t.duration)?t.duration:NaN},mediaEvents:["durationchange","loadedmetadata","emptied"]},mediaLoading:{get(e){let{media:t}=e;return(null==t?void 0:t.readyState)<3},mediaEvents:["waiting","playing","emptied"]},mediaSeekable:{get(e){var t;let{media:i}=e;if(!(null==(t=null==i?void 0:i.seekable)?void 0:t.length))return;let r=i.seekable.start(0),a=i.seekable.end(i.seekable.length-1);if(r||a)return[Number(r.toFixed(3)),Number(a.toFixed(3))]},mediaEvents:["loadedmetadata","emptied","progress","seekablechange"]},mediaBuffered:{get(e){var t;let{media:i}=e,r=null!=(t=null==i?void 0:i.buffered)?t:[];return Array.from(r).map((e,t)=>[Number(r.start(t).toFixed(3)),Number(r.end(t).toFixed(3))])},mediaEvents:["progress","emptied"]},mediaStreamType:{get(e){let{media:t,options:{defaultStreamType:i}={}}=e,r=[hG.LIVE,hG.ON_DEMAND].includes(i)?i:void 0;if(!t)return r;let{streamType:a}=t;if(mu.includes(a))return a===hG.UNKNOWN?r:a;let n=t.duration;return n===1/0?hG.LIVE:Number.isFinite(n)?hG.ON_DEMAND:r},mediaEvents:["emptied","durationchange","loadedmetadata","streamtypechange"]},mediaTargetLiveWindow:{get(e){let{media:t}=e;if(!t)return NaN;let{targetLiveWindow:i}=t,r=mf.mediaStreamType.get(e);return(null==i||Number.isNaN(i))&&r===hG.LIVE?0:i},mediaEvents:["emptied","durationchange","loadedmetadata","streamtypechange","targetlivewindowchange"]},mediaTimeIsLive:{get(e){let{media:t,options:{liveEdgeOffset:i=10}={}}=e;if(!t)return!1;if("number"==typeof t.liveEdgeStart)return!Number.isNaN(t.liveEdgeStart)&&t.currentTime>=t.liveEdgeStart;if(mf.mediaStreamType.get(e)!==hG.LIVE)return!1;let r=t.seekable;if(!r)return!0;if(!r.length)return!1;let a=r.end(r.length-1)-i;return t.currentTime>=a},mediaEvents:["playing","timeupdate","progress","waiting","emptied"]},mediaSubtitlesList:{get:e=>mn(e).map(e=>{let{kind:t,label:i,language:r}=e;return{kind:t,label:i,language:r}}),mediaEvents:["loadstart"],textTracksEvents:["addtrack","removetrack"]},mediaSubtitlesShowing:{get:e=>ms(e).map(e=>{let{kind:t,label:i,language:r}=e;return{kind:t,label:i,language:r}}),mediaEvents:["loadstart"],textTracksEvents:["addtrack","removetrack","change"],stateOwnersUpdateHandlers:[(e,t)=>{var i,r;let{media:a,options:n}=t;if(!a)return;let s=e=>{var i;n.defaultSubtitles&&(e&&![hN.CAPTIONS,hN.SUBTITLES].includes(null==(i=null==e?void 0:e.track)?void 0:i.kind)||mo(t,!0))};return a.addEventListener("loadstart",s),null==(i=a.textTracks)||i.addEventListener("addtrack",s),null==(r=a.textTracks)||r.addEventListener("removetrack",s),()=>{var e,t;a.removeEventListener("loadstart",s),null==(e=a.textTracks)||e.removeEventListener("addtrack",s),null==(t=a.textTracks)||t.removeEventListener("removetrack",s)}}]},mediaChaptersCues:{get(e){var t;let{media:i}=e;if(!i)return[];let[r]=c$(i,{kind:hN.CHAPTERS});return Array.from(null!=(t=null==r?void 0:r.cues)?t:[]).map(e=>{let{text:t,startTime:i,endTime:r}=e;return{text:t&&mm.parseFromString(t,"text/html").body.textContent||t,startTime:i,endTime:r}})},mediaEvents:["loadstart","loadedmetadata"],textTracksEvents:["addtrack","removetrack","change"],stateOwnersUpdateHandlers:[(e,t)=>{var i;let{media:r}=t;if(!r)return;let a=r.querySelector('track[kind="chapters"][default][src]'),n=null==(i=r.shadowRoot)?void 0:i.querySelector(':is(video,audio) > track[kind="chapters"][default][src]');return null==a||a.addEventListener("load",e),null==n||n.addEventListener("load",e),()=>{null==a||a.removeEventListener("load",e),null==n||n.removeEventListener("load",e)}}]},mediaIsPip:{get(e){var t,i;let{media:r,documentElement:a}=e;if(!r||!a||!a.pictureInPictureElement)return!1;if(a.pictureInPictureElement===r)return!0;if(a.pictureInPictureElement instanceof HTMLMediaElement)return!!(null==(t=r.localName)?void 0:t.includes("-"))&&cf(r,a.pictureInPictureElement);if(a.pictureInPictureElement.localName.includes("-")){let e=a.pictureInPictureElement.shadowRoot;for(;null==e?void 0:e.pictureInPictureElement;){if(e.pictureInPictureElement===r)return!0;e=null==(i=e.pictureInPictureElement)?void 0:i.shadowRoot}}return!1},set(e,t){let{media:i}=t;if(i)if(e){if(!cr.pictureInPictureEnabled)return void console.warn("MediaChrome: Picture-in-picture is not enabled");if(!i.requestPictureInPicture)return void console.warn("MediaChrome: The current media does not support picture-in-picture");let e=()=>{console.warn("MediaChrome: The media is not ready for picture-in-picture. It must have a readyState > 0.")};i.requestPictureInPicture().catch(t=>{if(11===t.code){if(!i.src)return void console.warn("MediaChrome: The media is not ready for picture-in-picture. It must have a src set.");if(0===i.readyState&&"none"===i.preload){let t=()=>{i.removeEventListener("loadedmetadata",r),i.preload="none"},r=()=>{i.requestPictureInPicture().catch(e),t()};i.addEventListener("loadedmetadata",r),i.preload="metadata",setTimeout(()=>{0===i.readyState&&e(),t()},1e3)}else throw t}else throw t})}else cr.pictureInPictureElement&&cr.exitPictureInPicture()},mediaEvents:["enterpictureinpicture","leavepictureinpicture"]},mediaRenditionList:{get(e){var t;let{media:i}=e;return[...null!=(t=null==i?void 0:i.videoRenditions)?t:[]].map(e=>({...e}))},mediaEvents:["emptied","loadstart"],videoRenditionsEvents:["addrendition","removerendition"]},mediaRenditionSelected:{get(e){var t,i,r;let{media:a}=e;return null==(r=null==(i=null==a?void 0:a.videoRenditions)?void 0:i[null==(t=a.videoRenditions)?void 0:t.selectedIndex])?void 0:r.id},set(e,t){let{media:i}=t;if(!(null==i?void 0:i.videoRenditions))return void console.warn("MediaController: Rendition selection not supported by this media.");let r=Array.prototype.findIndex.call(i.videoRenditions,t=>t.id==e);i.videoRenditions.selectedIndex!=r&&(i.videoRenditions.selectedIndex=r)},mediaEvents:["emptied"],videoRenditionsEvents:["addrendition","removerendition","change"]},mediaAudioTrackList:{get(e){var t;let{media:i}=e;return[...null!=(t=null==i?void 0:i.audioTracks)?t:[]]},mediaEvents:["emptied","loadstart"],audioTracksEvents:["addtrack","removetrack"]},mediaAudioTrackEnabled:{get(e){var t,i;let{media:r}=e;return null==(i=[...null!=(t=null==r?void 0:r.audioTracks)?t:[]].find(e=>e.enabled))?void 0:i.id},set(e,t){let{media:i}=t;if(!(null==i?void 0:i.audioTracks))return void console.warn("MediaChrome: Audio track selection not supported by this media.");for(let t of i.audioTracks)t.enabled=e==t.id},mediaEvents:["emptied"],audioTracksEvents:["addtrack","removetrack","change"]},mediaIsFullscreen:{get:e=>(e=>{var t;let{media:i,documentElement:r,fullscreenElement:a=i}=e;if(!i||!r)return!1;let n=(e=>{let{documentElement:t,media:i}=e,r=null==t?void 0:t[c2];return!r&&"webkitDisplayingFullscreen"in i&&"webkitPresentationMode"in i&&i.webkitDisplayingFullscreen&&i.webkitPresentationMode===hV.FULLSCREEN?i:r})(e);if(!n)return!1;if(n===a||n===i)return!0;if(n.localName.includes("-")){let e=n.shadowRoot;if(!(c2 in e))return cf(n,a);for(;null==e?void 0:e[c2];){if(e[c2]===a)return!0;e=null==(t=e[c2])?void 0:t.shadowRoot}}return!1})(e),set(e,t){e?(e=>{var t;let{media:i,fullscreenElement:r}=e;try{let e=r&&"requestFullscreen"in r?"requestFullscreen":r&&"webkitRequestFullScreen"in r?"webkitRequestFullScreen":void 0;if(e){let i=null==(t=r[e])?void 0:t.call(r);if(i instanceof Promise)return i.catch(()=>{})}else(null==i?void 0:i.webkitEnterFullscreen)?i.webkitEnterFullscreen():(null==i?void 0:i.requestFullscreen)&&i.requestFullscreen()}catch(e){console.error(e)}})(t):(e=>{var t;let{documentElement:i}=e;if(c1){let e=null==(t=null==i?void 0:i[c1])?void 0:t.call(i);if(e instanceof Promise)return e.catch(()=>{})}})(t)},rootEvents:["fullscreenchange","webkitfullscreenchange"],mediaEvents:["webkitbeginfullscreen","webkitendfullscreen","webkitpresentationmodechanged"]},mediaIsCasting:{get(e){var t;let{media:i}=e;return!!(null==i?void 0:i.remote)&&(null==(t=i.remote)?void 0:t.state)!=="disconnected"&&!!i.remote.state},set(e,t){var i,r;let{media:a}=t;if(a&&(!e||(null==(i=a.remote)?void 0:i.state)==="disconnected")&&(e||(null==(r=a.remote)?void 0:r.state)==="connected")){if("function"!=typeof a.remote.prompt)return void console.warn("MediaChrome: Casting is not supported in this environment");a.remote.prompt().catch(()=>{})}},remoteEvents:["connect","connecting","disconnect"]},mediaIsAirplaying:{get:()=>!1,set(e,t){let{media:i}=t;if(i){if(!(i.webkitShowPlaybackTargetPicker&&ci.WebKitPlaybackTargetAvailabilityEvent))return void console.error("MediaChrome: received a request to select AirPlay but AirPlay is not supported in this environment");i.webkitShowPlaybackTargetPicker()}},mediaEvents:["webkitcurrentplaybacktargetiswirelesschanged"]},mediaFullscreenUnavailable:{get(e){let{media:t}=e;if(!mt||!me(t))return hH.UNSUPPORTED}},mediaPipUnavailable:{get(e){let{media:t}=e;return mi&&c7(t)?(null==t?void 0:t.disablePictureInPicture)?hH.UNAVAILABLE:void 0:hH.UNSUPPORTED}},mediaVolumeUnavailable:{get(e){let{media:t}=e;if(!1===a||(null==t?void 0:t.volume)==void 0)return hH.UNSUPPORTED},stateOwnersUpdateHandlers:[e=>{null==a&&mh.then(t=>e(t?void 0:hH.UNSUPPORTED))}]},mediaCastUnavailable:{get(e){var t;let{availability:i="not-available"}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{media:r}=e;return ma&&(null==(t=null==r?void 0:r.remote)?void 0:t.state)?null!=i&&"available"!==i?hH.UNAVAILABLE:void 0:hH.UNSUPPORTED},stateOwnersUpdateHandlers:[(e,t)=>{var i;let{media:r}=t;if(r)return r.disableRemotePlayback||r.hasAttribute("disableremoteplayback")||null==(i=null==r?void 0:r.remote)||i.watchAvailability(t=>{e({availability:t?"available":"not-available"})}).catch(t=>{"NotSupportedError"===t.name?e({availability:null}):e({availability:"not-available"})}),()=>{var e;null==(e=null==r?void 0:r.remote)||e.cancelWatchAvailability().catch(()=>{})}}]},mediaAirplayUnavailable:{get:(e,t)=>mr?(null==t?void 0:t.availability)==="not-available"?hH.UNAVAILABLE:void 0:hH.UNSUPPORTED,mediaEvents:["webkitplaybacktargetavailabilitychanged"],stateOwnersUpdateHandlers:[(e,t)=>{var i;let{media:r}=t;if(r)return r.disableRemotePlayback||r.hasAttribute("disableremoteplayback")||null==(i=null==r?void 0:r.remote)||i.watchAvailability(t=>{e({availability:t?"available":"not-available"})}).catch(t=>{"NotSupportedError"===t.name?e({availability:null}):e({availability:"not-available"})}),()=>{var e;null==(e=null==r?void 0:r.remote)||e.cancelWatchAvailability().catch(()=>{})}}]},mediaRenditionUnavailable:{get(e){var t;let{media:i}=e;return(null==i?void 0:i.videoRenditions)?(null==(t=i.videoRenditions)?void 0:t.length)?void 0:hH.UNAVAILABLE:hH.UNSUPPORTED},mediaEvents:["emptied","loadstart"],videoRenditionsEvents:["addrendition","removerendition"]},mediaAudioTrackUnavailable:{get(e){var t,i;let{media:r}=e;return(null==r?void 0:r.audioTracks)?(null!=(i=null==(t=r.audioTracks)?void 0:t.length)?i:0)<=1?hH.UNAVAILABLE:void 0:hH.UNSUPPORTED},mediaEvents:["emptied","loadstart"],audioTracksEvents:["addtrack","removetrack"]},mediaLang:{get(e){let{options:{mediaLang:t}={}}=e;return null!=t?t:"en"}}},mp={[hL.MEDIA_PREVIEW_REQUEST](e,t,i){var r,a,n;let s,o,{detail:l}=i,{media:d}=t,u=null!=l?l:void 0;if(d&&null!=u){let[e]=c$(d,{kind:hN.METADATA,label:"thumbnails"}),t=Array.prototype.find.call(null!=(r=null==e?void 0:e.cues)?r:[],(e,t,i)=>0===t?e.endTime>u:t===i.length-1?e.startTime<=u:e.startTime<=u&&e.endTime>u);if(t){let e=/'^(?:[a-z]+:)?\/\//i.test(t.text)||null==(a=null==d?void 0:d.querySelector('track[label="thumbnails"]'))?void 0:a.src,i=new URL(t.text,e);o=new URLSearchParams(i.hash).get("#xywh").split(",").map(e=>+e),s=i.href}}let h=e.mediaDuration.get(t),c=null==(n=e.mediaChaptersCues.get(t).find((e,t,i)=>t===i.length-1&&h===e.endTime?e.startTime<=u&&e.endTime>=u:e.startTime<=u&&e.endTime>u))?void 0:n.text;return null!=l&&null==c&&(c=""),{mediaPreviewTime:u,mediaPreviewImage:s,mediaPreviewCoords:o,mediaPreviewChapter:c}},[hL.MEDIA_PAUSE_REQUEST](e,t){e.mediaPaused.set(!0,t)},[hL.MEDIA_PLAY_REQUEST](e,t){var i,r,a,n;let s=e.mediaStreamType.get(t)===hG.LIVE,o=!(null==(i=t.options)?void 0:i.noAutoSeekToLive),l=e.mediaTargetLiveWindow.get(t)>0;if(s&&o&&!l){let i=null==(r=e.mediaSeekable.get(t))?void 0:r[1];if(i){let r=null!=(n=null==(a=t.options)?void 0:a.seekToLiveOffset)?n:0;e.mediaCurrentTime.set(i-r,t)}}e.mediaPaused.set(!1,t)},[hL.MEDIA_PLAYBACK_RATE_REQUEST](e,t,i){let{detail:r}=i;e.mediaPlaybackRate.set(r,t)},[hL.MEDIA_MUTE_REQUEST](e,t){e.mediaMuted.set(!0,t)},[hL.MEDIA_UNMUTE_REQUEST](e,t){e.mediaVolume.get(t)||e.mediaVolume.set(.25,t),e.mediaMuted.set(!1,t)},[hL.MEDIA_VOLUME_REQUEST](e,t,i){let{detail:r}=i;r&&e.mediaMuted.get(t)&&e.mediaMuted.set(!1,t),e.mediaVolume.set(r,t)},[hL.MEDIA_SEEK_REQUEST](e,t,i){let{detail:r}=i;e.mediaCurrentTime.set(r,t)},[hL.MEDIA_SEEK_TO_LIVE_REQUEST](e,t){var i,r,a;let n=null==(i=e.mediaSeekable.get(t))?void 0:i[1];if(Number.isNaN(Number(n)))return;let s=null!=(a=null==(r=t.options)?void 0:r.seekToLiveOffset)?a:0;e.mediaCurrentTime.set(n-s,t)},[hL.MEDIA_SHOW_SUBTITLES_REQUEST](e,t,i){var r;let{detail:a}=i,{options:n}=t,s=mn(t),o=cQ(a),l=null==(r=o[0])?void 0:r.language;l&&!n.noSubtitlesLangPref&&ci.localStorage.setItem("media-chrome-pref-subtitles-lang",l),cJ(hU.SHOWING,s,o)},[hL.MEDIA_DISABLE_SUBTITLES_REQUEST](e,t,i){let{detail:r}=i,a=mn(t);cJ(hU.DISABLED,a,null!=r?r:[])},[hL.MEDIA_TOGGLE_SUBTITLES_REQUEST](e,t,i){let{detail:r}=i;mo(t,r)},[hL.MEDIA_RENDITION_REQUEST](e,t,i){let{detail:r}=i;e.mediaRenditionSelected.set(r,t)},[hL.MEDIA_AUDIO_TRACK_REQUEST](e,t,i){let{detail:r}=i;e.mediaAudioTrackEnabled.set(r,t)},[hL.MEDIA_ENTER_PIP_REQUEST](e,t){e.mediaIsFullscreen.get(t)&&e.mediaIsFullscreen.set(!1,t),e.mediaIsPip.set(!0,t)},[hL.MEDIA_EXIT_PIP_REQUEST](e,t){e.mediaIsPip.set(!1,t)},[hL.MEDIA_ENTER_FULLSCREEN_REQUEST](e,t){e.mediaIsPip.get(t)&&e.mediaIsPip.set(!1,t),e.mediaIsFullscreen.set(!0,t)},[hL.MEDIA_EXIT_FULLSCREEN_REQUEST](e,t){e.mediaIsFullscreen.set(!1,t)},[hL.MEDIA_ENTER_CAST_REQUEST](e,t){e.mediaIsFullscreen.get(t)&&e.mediaIsFullscreen.set(!1,t),e.mediaIsCasting.set(!0,t)},[hL.MEDIA_EXIT_CAST_REQUEST](e,t){e.mediaIsCasting.set(!1,t)},[hL.MEDIA_AIRPLAY_REQUEST](e,t){e.mediaIsAirplaying.set(!0,t)}};var mg=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},mv=(e,t,i)=>(mg(e,t,"read from private field"),i?i.call(e):t.get(e)),mE=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},my=(e,t,i,r)=>(mg(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i),mb=(e,t,i)=>(mg(e,t,"access private method"),i);let mT=["ArrowLeft","ArrowRight","Enter"," ","f","m","k","c"],m_={DEFAULT_SUBTITLES:"defaultsubtitles",DEFAULT_STREAM_TYPE:"defaultstreamtype",DEFAULT_DURATION:"defaultduration",FULLSCREEN_ELEMENT:"fullscreenelement",HOTKEYS:"hotkeys",KEYS_USED:"keysused",LIVE_EDGE_OFFSET:"liveedgeoffset",SEEK_TO_LIVE_OFFSET:"seektoliveoffset",NO_AUTO_SEEK_TO_LIVE:"noautoseektolive",NO_HOTKEYS:"nohotkeys",NO_VOLUME_PREF:"novolumepref",NO_SUBTITLES_LANG_PREF:"nosubtitleslangpref",NO_DEFAULT_STORE:"nodefaultstore",KEYBOARD_FORWARD_SEEK_OFFSET:"keyboardforwardseekoffset",KEYBOARD_BACKWARD_SEEK_OFFSET:"keyboardbackwardseekoffset",LANG:"lang"};class mA extends cB{static get observedAttributes(){return super.observedAttributes.concat(m_.NO_HOTKEYS,m_.HOTKEYS,m_.DEFAULT_STREAM_TYPE,m_.DEFAULT_SUBTITLES,m_.DEFAULT_DURATION,m_.LANG)}get mediaStore(){return mv(this,vv)}set mediaStore(e){var t,i;if(mv(this,vv)&&(null==(t=mv(this,vy))||t.call(this),my(this,vy,void 0)),my(this,vv,e),!mv(this,vv)&&!this.hasAttribute(m_.NO_DEFAULT_STORE))return void mb(this,vT,v_).call(this);my(this,vy,null==(i=mv(this,vv))?void 0:i.subscribe(mv(this,vE)))}get fullscreenElement(){var e;return null!=(e=mv(this,vg))?e:this}set fullscreenElement(e){var t;this.hasAttribute(m_.FULLSCREEN_ELEMENT)&&this.removeAttribute(m_.FULLSCREEN_ELEMENT),my(this,vg,e),null==(t=mv(this,vv))||t.dispatch({type:"fullscreenelementchangerequest",detail:this.fullscreenElement})}get defaultSubtitles(){return cA(this,m_.DEFAULT_SUBTITLES)}set defaultSubtitles(e){cS(this,m_.DEFAULT_SUBTITLES,e)}get defaultStreamType(){return cI(this,m_.DEFAULT_STREAM_TYPE)}set defaultStreamType(e){cR(this,m_.DEFAULT_STREAM_TYPE,e)}get defaultDuration(){return cT(this,m_.DEFAULT_DURATION)}set defaultDuration(e){c_(this,m_.DEFAULT_DURATION,e)}get noHotkeys(){return cA(this,m_.NO_HOTKEYS)}set noHotkeys(e){cS(this,m_.NO_HOTKEYS,e)}get keysUsed(){return cI(this,m_.KEYS_USED)}set keysUsed(e){cR(this,m_.KEYS_USED,e)}get liveEdgeOffset(){return cT(this,m_.LIVE_EDGE_OFFSET)}set liveEdgeOffset(e){c_(this,m_.LIVE_EDGE_OFFSET,e)}get noAutoSeekToLive(){return cA(this,m_.NO_AUTO_SEEK_TO_LIVE)}set noAutoSeekToLive(e){cS(this,m_.NO_AUTO_SEEK_TO_LIVE,e)}get noVolumePref(){return cA(this,m_.NO_VOLUME_PREF)}set noVolumePref(e){cS(this,m_.NO_VOLUME_PREF,e)}get noSubtitlesLangPref(){return cA(this,m_.NO_SUBTITLES_LANG_PREF)}set noSubtitlesLangPref(e){cS(this,m_.NO_SUBTITLES_LANG_PREF,e)}get noDefaultStore(){return cA(this,m_.NO_DEFAULT_STORE)}set noDefaultStore(e){cS(this,m_.NO_DEFAULT_STORE,e)}attributeChangedCallback(e,t,i){var r,a,n,s,o,l,d,u,h;if(super.attributeChangedCallback(e,t,i),e===m_.NO_HOTKEYS)i!==t&&""===i?(this.hasAttribute(m_.HOTKEYS)&&console.warn("Media Chrome: Both `hotkeys` and `nohotkeys` have been set. All hotkeys will be disabled."),this.disableHotkeys()):i!==t&&null===i&&this.enableHotkeys();else if(e===m_.HOTKEYS)mv(this,vp).value=i;else if(e===m_.DEFAULT_SUBTITLES&&i!==t)null==(r=mv(this,vv))||r.dispatch({type:"optionschangerequest",detail:{defaultSubtitles:this.hasAttribute(m_.DEFAULT_SUBTITLES)}});else if(e===m_.DEFAULT_STREAM_TYPE)null==(n=mv(this,vv))||n.dispatch({type:"optionschangerequest",detail:{defaultStreamType:null!=(a=this.getAttribute(m_.DEFAULT_STREAM_TYPE))?a:void 0}});else if(e===m_.LIVE_EDGE_OFFSET)null==(s=mv(this,vv))||s.dispatch({type:"optionschangerequest",detail:{liveEdgeOffset:this.hasAttribute(m_.LIVE_EDGE_OFFSET)?+this.getAttribute(m_.LIVE_EDGE_OFFSET):void 0,seekToLiveOffset:this.hasAttribute(m_.SEEK_TO_LIVE_OFFSET)?void 0:+this.getAttribute(m_.LIVE_EDGE_OFFSET)}});else if(e===m_.SEEK_TO_LIVE_OFFSET)null==(o=mv(this,vv))||o.dispatch({type:"optionschangerequest",detail:{seekToLiveOffset:this.hasAttribute(m_.SEEK_TO_LIVE_OFFSET)?+this.getAttribute(m_.SEEK_TO_LIVE_OFFSET):void 0}});else if(e===m_.NO_AUTO_SEEK_TO_LIVE)null==(l=mv(this,vv))||l.dispatch({type:"optionschangerequest",detail:{noAutoSeekToLive:this.hasAttribute(m_.NO_AUTO_SEEK_TO_LIVE)}});else if(e===m_.FULLSCREEN_ELEMENT){let e=i?null==(d=this.getRootNode())?void 0:d.getElementById(i):void 0;my(this,vg,e),null==(u=mv(this,vv))||u.dispatch({type:"fullscreenelementchangerequest",detail:this.fullscreenElement})}else e===m_.LANG&&i!==t&&(h3=i,null==(h=mv(this,vv))||h.dispatch({type:"optionschangerequest",detail:{mediaLang:i}}))}connectedCallback(){var e,t;mv(this,vv)||this.hasAttribute(m_.NO_DEFAULT_STORE)||mb(this,vT,v_).call(this),null==(e=mv(this,vv))||e.dispatch({type:"documentelementchangerequest",detail:cr}),super.connectedCallback(),mv(this,vv)&&!mv(this,vy)&&my(this,vy,null==(t=mv(this,vv))?void 0:t.subscribe(mv(this,vE))),this.enableHotkeys()}disconnectedCallback(){var e,t,i,r;null==(e=super.disconnectedCallback)||e.call(this),mv(this,vv)&&(null==(t=mv(this,vv))||t.dispatch({type:"documentelementchangerequest",detail:void 0}),null==(i=mv(this,vv))||i.dispatch({type:hL.MEDIA_TOGGLE_SUBTITLES_REQUEST,detail:!1})),mv(this,vy)&&(null==(r=mv(this,vy))||r.call(this),my(this,vy,void 0))}mediaSetCallback(e){var t;super.mediaSetCallback(e),null==(t=mv(this,vv))||t.dispatch({type:"mediaelementchangerequest",detail:e}),e.hasAttribute("tabindex")||(e.tabIndex=-1)}mediaUnsetCallback(e){var t;super.mediaUnsetCallback(e),null==(t=mv(this,vv))||t.dispatch({type:"mediaelementchangerequest",detail:void 0})}propagateMediaState(e,t){mM(this.mediaStateReceivers,e,t)}associateElement(e){if(!e)return;let{associatedElementSubscriptions:t}=this;if(t.has(e))return;let i=mO(e,this.registerMediaStateReceiver.bind(this),this.unregisterMediaStateReceiver.bind(this));Object.values(hL).forEach(t=>{e.addEventListener(t,mv(this,vb))}),t.set(e,i)}unassociateElement(e){if(!e)return;let{associatedElementSubscriptions:t}=this;t.has(e)&&(t.get(e)(),t.delete(e),Object.values(hL).forEach(t=>{e.removeEventListener(t,mv(this,vb))}))}registerMediaStateReceiver(e){if(!e)return;let t=this.mediaStateReceivers;!(t.indexOf(e)>-1)&&(t.push(e),mv(this,vv)&&Object.entries(mv(this,vv).getState()).forEach(t=>{let[i,r]=t;mM([e],i,r)}))}unregisterMediaStateReceiver(e){let t=this.mediaStateReceivers,i=t.indexOf(e);i<0||t.splice(i,1)}enableHotkeys(){this.addEventListener("keydown",mb(this,vI,vR))}disableHotkeys(){this.removeEventListener("keydown",mb(this,vI,vR)),this.removeEventListener("keyup",mb(this,vA,vS))}get hotkeys(){return cI(this,m_.HOTKEYS)}set hotkeys(e){cR(this,m_.HOTKEYS,e)}keyboardShortcutHandler(e){var t,i,r,a,n;let s,o,l,d=e.target;if(!((null!=(r=null!=(i=null==(t=d.getAttribute(m_.KEYS_USED))?void 0:t.split(" "))?i:null==d?void 0:d.keysUsed)?r:[]).map(e=>"Space"===e?" ":e).filter(Boolean).includes(e.key)||mv(this,vp).contains("no".concat(e.key.toLowerCase())))&&!(" "===e.key&&mv(this,vp).contains("nospace")))switch(e.key){case" ":case"k":s=mv(this,vv).getState().mediaPaused?hL.MEDIA_PLAY_REQUEST:hL.MEDIA_PAUSE_REQUEST,this.dispatchEvent(new ci.CustomEvent(s,{composed:!0,bubbles:!0}));break;case"m":s="off"===this.mediaStore.getState().mediaVolumeLevel?hL.MEDIA_UNMUTE_REQUEST:hL.MEDIA_MUTE_REQUEST,this.dispatchEvent(new ci.CustomEvent(s,{composed:!0,bubbles:!0}));break;case"f":s=this.mediaStore.getState().mediaIsFullscreen?hL.MEDIA_EXIT_FULLSCREEN_REQUEST:hL.MEDIA_ENTER_FULLSCREEN_REQUEST,this.dispatchEvent(new ci.CustomEvent(s,{composed:!0,bubbles:!0}));break;case"c":this.dispatchEvent(new ci.CustomEvent(hL.MEDIA_TOGGLE_SUBTITLES_REQUEST,{composed:!0,bubbles:!0}));break;case"ArrowLeft":{let e=this.hasAttribute(m_.KEYBOARD_BACKWARD_SEEK_OFFSET)?+this.getAttribute(m_.KEYBOARD_BACKWARD_SEEK_OFFSET):10;o=Math.max((null!=(a=this.mediaStore.getState().mediaCurrentTime)?a:0)-e,0),l=new ci.CustomEvent(hL.MEDIA_SEEK_REQUEST,{composed:!0,bubbles:!0,detail:o}),this.dispatchEvent(l);break}case"ArrowRight":{let e=this.hasAttribute(m_.KEYBOARD_FORWARD_SEEK_OFFSET)?+this.getAttribute(m_.KEYBOARD_FORWARD_SEEK_OFFSET):10;o=Math.max((null!=(n=this.mediaStore.getState().mediaCurrentTime)?n:0)+e,0),l=new ci.CustomEvent(hL.MEDIA_SEEK_REQUEST,{composed:!0,bubbles:!0,detail:o}),this.dispatchEvent(l)}}}constructor(){super(),mE(this,vT),mE(this,vA),mE(this,vI),this.mediaStateReceivers=[],this.associatedElementSubscriptions=new Map,mE(this,vp,new cW(this,m_.HOTKEYS)),mE(this,vg,void 0),mE(this,vv,void 0),mE(this,vE,void 0),mE(this,vy,void 0),mE(this,vb,e=>{var t;null==(t=mv(this,vv))||t.dispatch(e)}),this.associateElement(this);let e={};my(this,vE,t=>{Object.entries(t).forEach(t=>{let[i,r]=t;if(i in e&&e[i]===r)return;this.propagateMediaState(i,r);let a=i.toLowerCase(),n=new ci.CustomEvent(hx[a],{composed:!0,detail:r});this.dispatchEvent(n)}),e=t}),this.enableHotkeys()}}vp=new WeakMap,vg=new WeakMap,vv=new WeakMap,vE=new WeakMap,vy=new WeakMap,vb=new WeakMap,vT=new WeakSet,v_=function(){var e;this.mediaStore=(e=>{let t,{media:i,fullscreenElement:r,documentElement:a,stateMediator:n=mf,requestMap:s=mp,options:o={},monitorStateOwnersOnlyWithSubscriptions:l=!0}=e,d=[],u={options:{...o}},h=Object.freeze({mediaPreviewTime:void 0,mediaPreviewImage:void 0,mediaPreviewCoords:void 0,mediaPreviewChapter:void 0}),c=e=>{void 0!=e&&(ml(e,h)||(h=Object.freeze({...h,...e}),d.forEach(e=>e(h))))},m=()=>{c(Object.entries(n).reduce((e,t)=>{let[i,{get:r}]=t;return e[i]=r(u),e},{}))},f={},p=async(e,i)=>{var r,a,s,o,h,p,g,E,y,b,T,_,A,S,I,R;let k=!!t;if(t={...u,...null!=t?t:{},...e},k)return;await mc(...Object.values(e));let L=d.length>0&&0===i&&l,D=u.media!==t.media,w=(null==(r=u.media)?void 0:r.textTracks)!==(null==(a=t.media)?void 0:a.textTracks),C=(null==(s=u.media)?void 0:s.videoRenditions)!==(null==(o=t.media)?void 0:o.videoRenditions),M=(null==(h=u.media)?void 0:h.audioTracks)!==(null==(p=t.media)?void 0:p.audioTracks),O=(null==(g=u.media)?void 0:g.remote)!==(null==(E=t.media)?void 0:E.remote),P=u.documentElement!==t.documentElement,x=!!u.media&&(D||L),N=!!(null==(y=u.media)?void 0:y.textTracks)&&(w||L),U=!!(null==(b=u.media)?void 0:b.videoRenditions)&&(C||L),F=!!(null==(T=u.media)?void 0:T.audioTracks)&&(M||L),B=!!(null==(_=u.media)?void 0:_.remote)&&(O||L),H=!!u.documentElement&&(P||L),G=x||N||U||F||B||H,K=0===d.length&&1===i&&l,V=!!t.media&&(D||K),W=!!(null==(A=t.media)?void 0:A.textTracks)&&(w||K),q=!!(null==(S=t.media)?void 0:S.videoRenditions)&&(C||K),Y=!!(null==(I=t.media)?void 0:I.audioTracks)&&(M||K),j=!!(null==(R=t.media)?void 0:R.remote)&&(O||K),Q=!!t.documentElement&&(P||K),z=V||W||q||Y||j||Q;if(!(G||z)){Object.entries(t).forEach(e=>{let[t,i]=e;u[t]=i}),m(),t=void 0;return}Object.entries(n).forEach(e=>{let i,[r,{get:a,mediaEvents:n=[],textTracksEvents:s=[],videoRenditionsEvents:o=[],audioTracksEvents:l=[],remoteEvents:d=[],rootEvents:h=[],stateOwnersUpdateHandlers:m=[]}]=e;f[r]||(f[r]={});let p=e=>{c({[r]:a(u,e)})};i=f[r].mediaEvents,n.forEach(e=>{i&&x&&(u.media.removeEventListener(e,i),f[r].mediaEvents=void 0),V&&(t.media.addEventListener(e,p),f[r].mediaEvents=p)}),i=f[r].textTracksEvents,s.forEach(e=>{var a,n;i&&N&&(null==(a=u.media.textTracks)||a.removeEventListener(e,i),f[r].textTracksEvents=void 0),W&&(null==(n=t.media.textTracks)||n.addEventListener(e,p),f[r].textTracksEvents=p)}),i=f[r].videoRenditionsEvents,o.forEach(e=>{var a,n;i&&U&&(null==(a=u.media.videoRenditions)||a.removeEventListener(e,i),f[r].videoRenditionsEvents=void 0),q&&(null==(n=t.media.videoRenditions)||n.addEventListener(e,p),f[r].videoRenditionsEvents=p)}),i=f[r].audioTracksEvents,l.forEach(e=>{var a,n;i&&F&&(null==(a=u.media.audioTracks)||a.removeEventListener(e,i),f[r].audioTracksEvents=void 0),Y&&(null==(n=t.media.audioTracks)||n.addEventListener(e,p),f[r].audioTracksEvents=p)}),i=f[r].remoteEvents,d.forEach(e=>{var a,n;i&&B&&(null==(a=u.media.remote)||a.removeEventListener(e,i),f[r].remoteEvents=void 0),j&&(null==(n=t.media.remote)||n.addEventListener(e,p),f[r].remoteEvents=p)}),i=f[r].rootEvents,h.forEach(e=>{i&&H&&(u.documentElement.removeEventListener(e,i),f[r].rootEvents=void 0),Q&&(t.documentElement.addEventListener(e,p),f[r].rootEvents=p)});let g=f[r].stateOwnersUpdateHandlers;m.forEach(e=>{g&&G&&g(),z&&(f[r].stateOwnersUpdateHandlers=e(p,t))})}),Object.entries(t).forEach(e=>{let[t,i]=e;u[t]=i}),m(),t=void 0};return p({media:i,fullscreenElement:r,documentElement:a,options:o}),{dispatch(e){let{type:t,detail:i}=e;if(s[t]&&null==h.mediaErrorCode)return void c(s[t](n,u,e));"mediaelementchangerequest"===t?p({media:i}):"fullscreenelementchangerequest"===t?p({fullscreenElement:i}):"documentelementchangerequest"===t?p({documentElement:i}):"optionschangerequest"===t&&(Object.entries(null!=i?i:{}).forEach(e=>{let[t,i]=e;u.options[t]=i}),m())},getState:()=>h,subscribe:e=>(p({},d.length+1),d.push(e),e(h),()=>{let t=d.indexOf(e);t>=0&&(p({},d.length-1),d.splice(t,1))})}})({media:this.media,fullscreenElement:this.fullscreenElement,options:{defaultSubtitles:this.hasAttribute(m_.DEFAULT_SUBTITLES),defaultDuration:this.hasAttribute(m_.DEFAULT_DURATION)?+this.getAttribute(m_.DEFAULT_DURATION):void 0,defaultStreamType:null!=(e=this.getAttribute(m_.DEFAULT_STREAM_TYPE))?e:void 0,liveEdgeOffset:this.hasAttribute(m_.LIVE_EDGE_OFFSET)?+this.getAttribute(m_.LIVE_EDGE_OFFSET):void 0,seekToLiveOffset:this.hasAttribute(m_.SEEK_TO_LIVE_OFFSET)?+this.getAttribute(m_.SEEK_TO_LIVE_OFFSET):this.hasAttribute(m_.LIVE_EDGE_OFFSET)?+this.getAttribute(m_.LIVE_EDGE_OFFSET):void 0,noAutoSeekToLive:this.hasAttribute(m_.NO_AUTO_SEEK_TO_LIVE),noVolumePref:this.hasAttribute(m_.NO_VOLUME_PREF),noSubtitlesLangPref:this.hasAttribute(m_.NO_SUBTITLES_LANG_PREF)}})},vA=new WeakSet,vS=function(e){let{key:t}=e;if(!mT.includes(t))return void this.removeEventListener("keyup",mb(this,vA,vS));this.keyboardShortcutHandler(e)},vI=new WeakSet,vR=function(e){let{metaKey:t,altKey:i,key:r}=e;if(t||i||!mT.includes(r))return void this.removeEventListener("keyup",mb(this,vA,vS));[" ","ArrowLeft","ArrowRight"].includes(r)&&!(mv(this,vp).contains("no".concat(r.toLowerCase()))||" "===r&&mv(this,vp).contains("nospace"))&&e.preventDefault(),this.addEventListener("keyup",mb(this,vA,vS),{once:!0})};let mS=Object.values(hM),mI=Object.values(hw),mR=e=>{var t,i,r,a;let{observedAttributes:n}=e.constructor;!n&&(null==(t=e.nodeName)?void 0:t.includes("-"))&&(ci.customElements.upgrade(e),{observedAttributes:n}=e.constructor);let s=null==(a=null==(r=null==(i=null==e?void 0:e.getAttribute)?void 0:i.call(e,hD.MEDIA_CHROME_ATTRIBUTES))?void 0:r.split)?void 0:a.call(r,/\s+/);return Array.isArray(n||s)?(n||s).filter(e=>mS.includes(e)):[]},mk=e=>(e=>{var t,i;return(null==(t=e.nodeName)?void 0:t.includes("-"))&&ci.customElements.get(null==(i=e.nodeName)?void 0:i.toLowerCase())&&!(e instanceof ci.customElements.get(e.nodeName.toLowerCase()))&&ci.customElements.upgrade(e),mI.some(t=>t in e)})(e)||!!mR(e).length,mL=e=>{var t;return null==(t=null==e?void 0:e.join)?void 0:t.call(e,":")},mD={[hM.MEDIA_SUBTITLES_LIST]:cX,[hM.MEDIA_SUBTITLES_SHOWING]:cX,[hM.MEDIA_SEEKABLE]:mL,[hM.MEDIA_BUFFERED]:e=>null==e?void 0:e.map(mL).join(" "),[hM.MEDIA_PREVIEW_COORDS]:e=>null==e?void 0:e.join(" "),[hM.MEDIA_RENDITION_LIST]:function(e){return null==e?void 0:e.map(hW).join(" ")},[hM.MEDIA_AUDIO_TRACK_LIST]:function(e){return null==e?void 0:e.map(hY).join(" ")}},mw=async(e,t,i)=>{var r,a;if(e.isConnected||await hX(0),"boolean"==typeof i||null==i)return cS(e,t,i);if("number"==typeof i)return c_(e,t,i);if("string"==typeof i)return cR(e,t,i);if(Array.isArray(i)&&!i.length)return e.removeAttribute(t);let n=null!=(a=null==(r=mD[t])?void 0:r.call(mD,i))?a:i;return e.setAttribute(t,n)},mC=(e,t)=>{if((e=>{var t;return!!(null==(t=e.closest)?void 0:t.call(e,'*[slot="media"]'))})(e))return;let i=(e,t)=>{var i,r;mk(e)&&t(e);let{children:a=[]}=null!=e?e:{};[...a,...null!=(r=null==(i=null==e?void 0:e.shadowRoot)?void 0:i.children)?r:[]].forEach(e=>mC(e,t))},r=null==e?void 0:e.nodeName.toLowerCase();if(r.includes("-")&&!mk(e))return void ci.customElements.whenDefined(r).then(()=>{i(e,t)});i(e,t)},mM=(e,t,i)=>{e.forEach(e=>{if(t in e){e[t]=i;return}let r=mR(e),a=t.toLowerCase();r.includes(a)&&mw(e,a,i)})},mO=(e,t,i)=>{mC(e,t);let r=e=>{var i;t(null!=(i=null==e?void 0:e.composedPath()[0])?i:e.target)},a=e=>{var t;i(null!=(t=null==e?void 0:e.composedPath()[0])?t:e.target)};e.addEventListener(hL.REGISTER_MEDIA_STATE_RECEIVER,r),e.addEventListener(hL.UNREGISTER_MEDIA_STATE_RECEIVER,a);let n=[],s=e=>{let r=e.target;"media"!==r.name&&(n.forEach(e=>mC(e,i)),(n=[...r.assignedElements({flatten:!0})]).forEach(e=>mC(e,t)))};e.addEventListener("slotchange",s);let o=new MutationObserver(e=>{e.forEach(e=>{let{addedNodes:r=[],removedNodes:a=[],type:n,target:s,attributeName:o}=e;"childList"===n?(Array.prototype.forEach.call(r,e=>mC(e,t)),Array.prototype.forEach.call(a,e=>mC(e,i))):"attributes"===n&&o===hD.MEDIA_CHROME_ATTRIBUTES&&(mk(s)?t(s):i(s))})});return o.observe(e,{childList:!0,attributes:!0,subtree:!0}),()=>{mC(e,i),e.removeEventListener("slotchange",s),o.disconnect(),e.removeEventListener(hL.REGISTER_MEDIA_STATE_RECEIVER,r),e.removeEventListener(hL.UNREGISTER_MEDIA_STATE_RECEIVER,a)}};ci.customElements.get("media-controller")||ci.customElements.define("media-controller",mA);let mP={PLACEMENT:"placement",BOUNDS:"bounds"};class mx extends ci.HTMLElement{static get observedAttributes(){return[mP.PLACEMENT,mP.BOUNDS]}get placement(){return cI(this,mP.PLACEMENT)}set placement(e){cR(this,mP.PLACEMENT,e)}get bounds(){return cI(this,mP.BOUNDS)}set bounds(e){cR(this,mP.BOUNDS,e)}constructor(){if(super(),this.updateXOffset=()=>{var e;if(!cE(this,{checkOpacity:!1,checkVisibilityCSS:!1}))return;let t=this.placement;if("left"===t||"right"===t)return void this.style.removeProperty("--media-tooltip-offset-x");let i=getComputedStyle(this),r=null!=(e=cp(this,"#"+this.bounds))?e:cu(this);if(!r)return;let{x:a,width:n}=r.getBoundingClientRect(),{x:s,width:o}=this.getBoundingClientRect(),l=i.getPropertyValue("--media-tooltip-offset-x"),d=l?parseFloat(l.replace("px","")):0,u=i.getPropertyValue("--media-tooltip-container-margin"),h=u?parseFloat(u.replace("px","")):0,c=s-a+d-h,m=s+o-(a+n)+d+h;return c<0?void this.style.setProperty("--media-tooltip-offset-x","".concat(c,"px")):m>0?void this.style.setProperty("--media-tooltip-offset-x","".concat(m,"px")):void this.style.removeProperty("--media-tooltip-offset-x")},!this.shadowRoot){this.attachShadow(this.constructor.shadowRootOptions);let e=cd(this.attributes);this.shadowRoot.innerHTML=this.constructor.getTemplateHTML(e)}if(this.arrowEl=this.shadowRoot.querySelector("#arrow"),Object.prototype.hasOwnProperty.call(this,"placement")){let e=this.placement;delete this.placement,this.placement=e}}}mx.shadowRootOptions={mode:"open"},mx.getTemplateHTML=function(e){return'\n    <style>\n      :host {\n        --_tooltip-background-color: var(--media-tooltip-background-color, var(--media-secondary-color, rgba(20, 20, 30, .7)));\n        --_tooltip-background: var(--media-tooltip-background, var(--_tooltip-background-color));\n        --_tooltip-arrow-half-width: calc(var(--media-tooltip-arrow-width, 12px) / 2);\n        --_tooltip-arrow-height: var(--media-tooltip-arrow-height, 5px);\n        --_tooltip-arrow-background: var(--media-tooltip-arrow-color, var(--_tooltip-background-color));\n        position: relative;\n        pointer-events: none;\n        display: var(--media-tooltip-display, inline-flex);\n        justify-content: center;\n        align-items: center;\n        box-sizing: border-box;\n        z-index: var(--media-tooltip-z-index, 1);\n        background: var(--_tooltip-background);\n        color: var(--media-text-color, var(--media-primary-color, rgb(238 238 238)));\n        font: var(--media-font,\n          var(--media-font-weight, 400)\n          var(--media-font-size, 13px) /\n          var(--media-text-content-height, var(--media-control-height, 18px))\n          var(--media-font-family, helvetica neue, segoe ui, roboto, arial, sans-serif));\n        padding: var(--media-tooltip-padding, .35em .7em);\n        border: var(--media-tooltip-border, none);\n        border-radius: var(--media-tooltip-border-radius, 5px);\n        filter: var(--media-tooltip-filter, drop-shadow(0 0 4px rgba(0, 0, 0, .2)));\n        white-space: var(--media-tooltip-white-space, nowrap);\n      }\n\n      :host([hidden]) {\n        display: none;\n      }\n\n      img, svg {\n        display: inline-block;\n      }\n\n      #arrow {\n        position: absolute;\n        width: 0px;\n        height: 0px;\n        border-style: solid;\n        display: var(--media-tooltip-arrow-display, block);\n      }\n\n      :host(:not([placement])),\n      :host([placement="top"]) {\n        position: absolute;\n        bottom: calc(100% + var(--media-tooltip-distance, 12px));\n        left: 50%;\n        transform: translate(calc(-50% - var(--media-tooltip-offset-x, 0px)), 0);\n      }\n      :host(:not([placement])) #arrow,\n      :host([placement="top"]) #arrow {\n        top: 100%;\n        left: 50%;\n        border-width: var(--_tooltip-arrow-height) var(--_tooltip-arrow-half-width) 0 var(--_tooltip-arrow-half-width);\n        border-color: var(--_tooltip-arrow-background) transparent transparent transparent;\n        transform: translate(calc(-50% + var(--media-tooltip-offset-x, 0px)), 0);\n      }\n\n      :host([placement="right"]) {\n        position: absolute;\n        left: calc(100% + var(--media-tooltip-distance, 12px));\n        top: 50%;\n        transform: translate(0, -50%);\n      }\n      :host([placement="right"]) #arrow {\n        top: 50%;\n        right: 100%;\n        border-width: var(--_tooltip-arrow-half-width) var(--_tooltip-arrow-height) var(--_tooltip-arrow-half-width) 0;\n        border-color: transparent var(--_tooltip-arrow-background) transparent transparent;\n        transform: translate(0, -50%);\n      }\n\n      :host([placement="bottom"]) {\n        position: absolute;\n        top: calc(100% + var(--media-tooltip-distance, 12px));\n        left: 50%;\n        transform: translate(calc(-50% - var(--media-tooltip-offset-x, 0px)), 0);\n      }\n      :host([placement="bottom"]) #arrow {\n        bottom: 100%;\n        left: 50%;\n        border-width: 0 var(--_tooltip-arrow-half-width) var(--_tooltip-arrow-height) var(--_tooltip-arrow-half-width);\n        border-color: transparent transparent var(--_tooltip-arrow-background) transparent;\n        transform: translate(calc(-50% + var(--media-tooltip-offset-x, 0px)), 0);\n      }\n\n      :host([placement="left"]) {\n        position: absolute;\n        right: calc(100% + var(--media-tooltip-distance, 12px));\n        top: 50%;\n        transform: translate(0, -50%);\n      }\n      :host([placement="left"]) #arrow {\n        top: 50%;\n        left: 100%;\n        border-width: var(--_tooltip-arrow-half-width) 0 var(--_tooltip-arrow-half-width) var(--_tooltip-arrow-height);\n        border-color: transparent transparent transparent var(--_tooltip-arrow-background);\n        transform: translate(0, -50%);\n      }\n      \n      :host([placement="none"]) #arrow {\n        display: none;\n      }\n    </style>\n    <slot></slot>\n    <div id="arrow"></div>\n  '},ci.customElements.get("media-tooltip")||ci.customElements.define("media-tooltip",mx);var mN=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},mU=(e,t,i)=>(mN(e,t,"read from private field"),i?i.call(e):t.get(e)),mF=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},mB=(e,t,i,r)=>(mN(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i);let mH={TOOLTIP_PLACEMENT:"tooltipplacement",DISABLED:"disabled",NO_TOOLTIP:"notooltip"};class mG extends ci.HTMLElement{static get observedAttributes(){return["disabled",mH.TOOLTIP_PLACEMENT,hD.MEDIA_CONTROLLER,hM.MEDIA_LANG]}enable(){this.addEventListener("click",mU(this,vL)),this.addEventListener("keydown",mU(this,vC)),this.tabIndex=0}disable(){this.removeEventListener("click",mU(this,vL)),this.removeEventListener("keydown",mU(this,vC)),this.removeEventListener("keyup",mU(this,vw)),this.tabIndex=-1}attributeChangedCallback(e,t,i){var r,a,n,s,o;e===hD.MEDIA_CONTROLLER?(t&&(null==(a=null==(r=mU(this,vk))?void 0:r.unassociateElement)||a.call(r,this),mB(this,vk,null)),i&&this.isConnected&&(mB(this,vk,null==(n=this.getRootNode())?void 0:n.getElementById(i)),null==(o=null==(s=mU(this,vk))?void 0:s.associateElement)||o.call(s,this))):"disabled"===e&&i!==t?null==i?this.enable():this.disable():e===mH.TOOLTIP_PLACEMENT&&this.tooltipEl&&i!==t?this.tooltipEl.placement=i:e===hM.MEDIA_LANG&&(this.shadowRoot.querySelector('slot[name="tooltip-content"]').innerHTML=this.constructor.getTooltipContentHTML()),mU(this,vD).call(this)}connectedCallback(){var e,t,i;let{style:r}=cy(this.shadowRoot,":host");r.setProperty("display","var(--media-control-display, var(--".concat(this.localName,"-display, inline-flex))")),this.hasAttribute("disabled")?this.disable():this.enable(),this.setAttribute("role","button");let a=this.getAttribute(hD.MEDIA_CONTROLLER);a&&(mB(this,vk,null==(e=this.getRootNode())?void 0:e.getElementById(a)),null==(i=null==(t=mU(this,vk))?void 0:t.associateElement)||i.call(t,this)),ci.customElements.whenDefined("media-tooltip").then(()=>{var e,t;return(e=vM,t=vO,mN(this,e,"access private method"),t).call(this)})}disconnectedCallback(){var e,t;this.disable(),null==(t=null==(e=mU(this,vk))?void 0:e.unassociateElement)||t.call(e,this),mB(this,vk,null),this.removeEventListener("mouseenter",mU(this,vD)),this.removeEventListener("focus",mU(this,vD)),this.removeEventListener("click",mU(this,vL))}get keysUsed(){return["Enter"," "]}get tooltipPlacement(){return cI(this,mH.TOOLTIP_PLACEMENT)}set tooltipPlacement(e){cR(this,mH.TOOLTIP_PLACEMENT,e)}get mediaController(){return cI(this,hD.MEDIA_CONTROLLER)}set mediaController(e){cR(this,hD.MEDIA_CONTROLLER,e)}get disabled(){return cA(this,mH.DISABLED)}set disabled(e){cS(this,mH.DISABLED,e)}get noTooltip(){return cA(this,mH.NO_TOOLTIP)}set noTooltip(e){cS(this,mH.NO_TOOLTIP,e)}handleClick(e){}constructor(){if(super(),mF(this,vM),mF(this,vk,void 0),this.preventClick=!1,this.tooltipEl=null,mF(this,vL,e=>{this.preventClick||this.handleClick(e),setTimeout(mU(this,vD),0)}),mF(this,vD,()=>{var e,t;null==(t=null==(e=this.tooltipEl)?void 0:e.updateXOffset)||t.call(e)}),mF(this,vw,e=>{let{key:t}=e;if(!this.keysUsed.includes(t))return void this.removeEventListener("keyup",mU(this,vw));this.preventClick||this.handleClick(e)}),mF(this,vC,e=>{let{metaKey:t,altKey:i,key:r}=e;if(t||i||!this.keysUsed.includes(r))return void this.removeEventListener("keyup",mU(this,vw));this.addEventListener("keyup",mU(this,vw),{once:!0})}),!this.shadowRoot){this.attachShadow(this.constructor.shadowRootOptions);let e=cd(this.attributes),t=this.constructor.getTemplateHTML(e);this.shadowRoot.setHTMLUnsafe?this.shadowRoot.setHTMLUnsafe(t):this.shadowRoot.innerHTML=t}this.tooltipEl=this.shadowRoot.querySelector("media-tooltip")}}vk=new WeakMap,vL=new WeakMap,vD=new WeakMap,vw=new WeakMap,vC=new WeakMap,vM=new WeakSet,vO=function(){this.addEventListener("mouseenter",mU(this,vD)),this.addEventListener("focus",mU(this,vD)),this.addEventListener("click",mU(this,vL));let e=this.tooltipPlacement;e&&this.tooltipEl&&(this.tooltipEl.placement=e)},mG.shadowRootOptions={mode:"open"},mG.getTemplateHTML=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return'\n    <style>\n      :host {\n        position: relative;\n        font: var(--media-font,\n          var(--media-font-weight, bold)\n          var(--media-font-size, 14px) /\n          var(--media-text-content-height, var(--media-control-height, 24px))\n          var(--media-font-family, helvetica neue, segoe ui, roboto, arial, sans-serif));\n        color: var(--media-text-color, var(--media-primary-color, rgb(238 238 238)));\n        background: var(--media-control-background, var(--media-secondary-color, rgb(20 20 30 / .7)));\n        padding: var(--media-button-padding, var(--media-control-padding, 10px));\n        justify-content: var(--media-button-justify-content, center);\n        display: inline-flex;\n        align-items: center;\n        vertical-align: middle;\n        box-sizing: border-box;\n        transition: background .15s linear;\n        pointer-events: auto;\n        cursor: var(--media-cursor, pointer);\n        -webkit-tap-highlight-color: transparent;\n      }\n\n      \n      :host(:focus-visible) {\n        box-shadow: inset 0 0 0 2px rgb(27 127 204 / .9);\n        outline: 0;\n      }\n      \n      :host(:where(:focus)) {\n        box-shadow: none;\n        outline: 0;\n      }\n\n      :host(:hover) {\n        background: var(--media-control-hover-background, rgba(50 50 70 / .7));\n      }\n\n      svg, img, ::slotted(svg), ::slotted(img) {\n        width: var(--media-button-icon-width);\n        height: var(--media-button-icon-height, var(--media-control-height, 24px));\n        transform: var(--media-button-icon-transform);\n        transition: var(--media-button-icon-transition);\n        fill: var(--media-icon-color, var(--media-primary-color, rgb(238 238 238)));\n        vertical-align: middle;\n        max-width: 100%;\n        max-height: 100%;\n        min-width: 100%;\n      }\n\n      media-tooltip {\n        \n        max-width: 0;\n        overflow-x: clip;\n        opacity: 0;\n        transition: opacity .3s, max-width 0s 9s;\n      }\n\n      :host(:hover) media-tooltip,\n      :host(:focus-visible) media-tooltip {\n        max-width: 100vw;\n        opacity: 1;\n        transition: opacity .3s;\n      }\n\n      :host([notooltip]) slot[name="tooltip"] {\n        display: none;\n      }\n    </style>\n\n    '.concat(this.getSlotTemplateHTML(e,t),'\n\n    <slot name="tooltip">\n      <media-tooltip part="tooltip" aria-hidden="true">\n        <template shadowrootmode="').concat(mx.shadowRootOptions.mode,'">\n          ').concat(mx.getTemplateHTML({}),'\n        </template>\n        <slot name="tooltip-content">\n          ').concat(this.getTooltipContentHTML(e),"\n        </slot>\n      </media-tooltip>\n    </slot>\n  ")},mG.getSlotTemplateHTML=function(e,t){return"\n    <slot></slot>\n  "},mG.getTooltipContentHTML=function(){return""},ci.customElements.get("media-chrome-button")||ci.customElements.define("media-chrome-button",mG);let mK='<svg aria-hidden="true" viewBox="0 0 26 24">\n  <path d="M22.13 3H3.87a.87.87 0 0 0-.87.87v13.26a.87.87 0 0 0 .87.87h3.4L9 16H5V5h16v11h-4l1.72 2h3.4a.87.87 0 0 0 .87-.87V3.87a.87.87 0 0 0-.86-.87Zm-8.75 11.44a.5.5 0 0 0-.76 0l-4.91 5.73a.5.5 0 0 0 .38.83h9.82a.501.501 0 0 0 .38-.83l-4.91-5.73Z"/>\n</svg>\n',mV=e=>{let t=e.mediaIsAirplaying?h4("stop airplay"):h4("start airplay");e.setAttribute("aria-label",t)};class mW extends mG{static get observedAttributes(){return[...super.observedAttributes,hM.MEDIA_IS_AIRPLAYING,hM.MEDIA_AIRPLAY_UNAVAILABLE]}connectedCallback(){super.connectedCallback(),mV(this)}attributeChangedCallback(e,t,i){super.attributeChangedCallback(e,t,i),e===hM.MEDIA_IS_AIRPLAYING&&mV(this)}get mediaIsAirplaying(){return cA(this,hM.MEDIA_IS_AIRPLAYING)}set mediaIsAirplaying(e){cS(this,hM.MEDIA_IS_AIRPLAYING,e)}get mediaAirplayUnavailable(){return cI(this,hM.MEDIA_AIRPLAY_UNAVAILABLE)}set mediaAirplayUnavailable(e){cR(this,hM.MEDIA_AIRPLAY_UNAVAILABLE,e)}handleClick(){let e=new ci.CustomEvent(hL.MEDIA_AIRPLAY_REQUEST,{composed:!0,bubbles:!0});this.dispatchEvent(e)}}mW.getSlotTemplateHTML=function(e){return"\n    <style>\n      :host([".concat(hM.MEDIA_IS_AIRPLAYING,"]) slot[name=icon] slot:not([name=exit]) {\n        display: none !important;\n      }\n\n      ","\n      :host(:not([").concat(hM.MEDIA_IS_AIRPLAYING,"])) slot[name=icon] slot:not([name=enter]) {\n        display: none !important;\n      }\n\n      :host([").concat(hM.MEDIA_IS_AIRPLAYING,"]) slot[name=tooltip-enter],\n      :host(:not([").concat(hM.MEDIA_IS_AIRPLAYING,'])) slot[name=tooltip-exit] {\n        display: none;\n      }\n    </style>\n\n    <slot name="icon">\n      <slot name="enter">').concat(mK,'</slot>\n      <slot name="exit">').concat(mK,"</slot>\n    </slot>\n  ")},mW.getTooltipContentHTML=function(){return'\n    <slot name="tooltip-enter">'.concat(h4("start airplay"),'</slot>\n    <slot name="tooltip-exit">').concat(h4("stop airplay"),"</slot>\n  ")},ci.customElements.get("media-airplay-button")||ci.customElements.define("media-airplay-button",mW);let mq=e=>{e.setAttribute("aria-checked",c0(e).toString())};class mY extends mG{static get observedAttributes(){return[...super.observedAttributes,hM.MEDIA_SUBTITLES_LIST,hM.MEDIA_SUBTITLES_SHOWING]}connectedCallback(){super.connectedCallback(),this.setAttribute("role","switch"),this.setAttribute("aria-label",h4("closed captions")),mq(this)}attributeChangedCallback(e,t,i){super.attributeChangedCallback(e,t,i),e===hM.MEDIA_SUBTITLES_SHOWING&&mq(this)}get mediaSubtitlesList(){return mj(this,hM.MEDIA_SUBTITLES_LIST)}set mediaSubtitlesList(e){mQ(this,hM.MEDIA_SUBTITLES_LIST,e)}get mediaSubtitlesShowing(){return mj(this,hM.MEDIA_SUBTITLES_SHOWING)}set mediaSubtitlesShowing(e){mQ(this,hM.MEDIA_SUBTITLES_SHOWING,e)}handleClick(){this.dispatchEvent(new ci.CustomEvent(hL.MEDIA_TOGGLE_SUBTITLES_REQUEST,{composed:!0,bubbles:!0}))}}mY.getSlotTemplateHTML=function(e){return'\n    <style>\n      :host([aria-checked="true"]) slot[name=off] {\n        display: none !important;\n      }\n\n      \n      :host(:not([aria-checked="true"])) slot[name=on] {\n        display: none !important;\n      }\n\n      :host([aria-checked="true"]) slot[name=tooltip-enable],\n      :host(:not([aria-checked="true"])) slot[name=tooltip-disable] {\n        display: none;\n      }\n    </style>\n\n    <slot name="icon">\n      <slot name="on">'.concat('<svg aria-hidden="true" viewBox="0 0 26 24">\n  <path d="M22.83 5.68a2.58 2.58 0 0 0-2.3-2.5c-3.62-.24-11.44-.24-15.06 0a2.58 2.58 0 0 0-2.3 2.5c-.23 4.21-.23 8.43 0 12.64a2.58 2.58 0 0 0 2.3 2.5c3.62.24 11.44.24 15.06 0a2.58 2.58 0 0 0 2.3-2.5c.23-4.21.23-8.43 0-12.64Zm-11.39 9.45a3.07 3.07 0 0 1-1.91.57 3.06 3.06 0 0 1-2.34-1 3.75 3.75 0 0 1-.92-2.67 3.92 3.92 0 0 1 .92-2.77 3.18 3.18 0 0 1 2.43-1 2.94 2.94 0 0 1 2.13.78c.364.359.62.813.74 1.31l-1.43.35a1.49 1.49 0 0 0-1.51-1.17 1.61 1.61 0 0 0-1.29.58 2.79 2.79 0 0 0-.5 1.89 3 3 0 0 0 .49 1.93 1.61 1.61 0 0 0 1.27.58 1.48 1.48 0 0 0 1-.37 2.1 2.1 0 0 0 .59-1.14l1.4.44a3.23 3.23 0 0 1-1.07 1.69Zm7.22 0a3.07 3.07 0 0 1-1.91.57 3.06 3.06 0 0 1-2.34-1 3.75 3.75 0 0 1-.92-2.67 3.88 3.88 0 0 1 .93-2.77 3.14 3.14 0 0 1 2.42-1 3 3 0 0 1 2.16.82 2.8 2.8 0 0 1 .73 1.31l-1.43.35a1.49 1.49 0 0 0-1.51-1.21 1.61 1.61 0 0 0-1.29.58A2.79 2.79 0 0 0 15 12a3 3 0 0 0 .49 1.93 1.61 1.61 0 0 0 1.27.58 1.44 1.44 0 0 0 1-.37 2.1 2.1 0 0 0 .6-1.15l1.4.44a3.17 3.17 0 0 1-1.1 1.7Z"/>\n</svg>','</slot>\n      <slot name="off">').concat('<svg aria-hidden="true" viewBox="0 0 26 24">\n  <path d="M17.73 14.09a1.4 1.4 0 0 1-1 .37 1.579 1.579 0 0 1-1.27-.58A3 3 0 0 1 15 12a2.8 2.8 0 0 1 .5-1.85 1.63 1.63 0 0 1 1.29-.57 1.47 1.47 0 0 1 1.51 1.2l1.43-.34A2.89 2.89 0 0 0 19 9.07a3 3 0 0 0-2.14-.78 3.14 3.14 0 0 0-2.42 1 3.91 3.91 0 0 0-.93 2.78 3.74 3.74 0 0 0 .92 2.66 3.07 3.07 0 0 0 2.34 1 3.07 3.07 0 0 0 1.91-.57 3.17 3.17 0 0 0 1.07-1.74l-1.4-.45c-.083.43-.3.822-.62 1.12Zm-7.22 0a1.43 1.43 0 0 1-1 .37 1.58 1.58 0 0 1-1.27-.58A3 3 0 0 1 7.76 12a2.8 2.8 0 0 1 .5-1.85 1.63 1.63 0 0 1 1.29-.57 1.47 1.47 0 0 1 1.51 1.2l1.43-.34a2.81 2.81 0 0 0-.74-1.32 2.94 2.94 0 0 0-2.13-.78 3.18 3.18 0 0 0-2.43 1 4 4 0 0 0-.92 2.78 3.74 3.74 0 0 0 .92 2.66 3.07 3.07 0 0 0 2.34 1 3.07 3.07 0 0 0 1.91-.57 3.23 3.23 0 0 0 1.07-1.74l-1.4-.45a2.06 2.06 0 0 1-.6 1.07Zm12.32-8.41a2.59 2.59 0 0 0-2.3-2.51C18.72 3.05 15.86 3 13 3c-2.86 0-5.72.05-7.53.17a2.59 2.59 0 0 0-2.3 2.51c-.23 4.207-.23 8.423 0 12.63a2.57 2.57 0 0 0 2.3 2.5c1.81.13 4.67.19 7.53.19 2.86 0 5.72-.06 7.53-.19a2.57 2.57 0 0 0 2.3-2.5c.23-4.207.23-8.423 0-12.63Zm-1.49 12.53a1.11 1.11 0 0 1-.91 1.11c-1.67.11-4.45.18-7.43.18-2.98 0-5.76-.07-7.43-.18a1.11 1.11 0 0 1-.91-1.11c-.21-4.14-.21-8.29 0-12.43a1.11 1.11 0 0 1 .91-1.11C7.24 4.56 10 4.49 13 4.49s5.76.07 7.43.18a1.11 1.11 0 0 1 .91 1.11c.21 4.14.21 8.29 0 12.43Z"/>\n</svg>',"</slot>\n    </slot>\n  ")},mY.getTooltipContentHTML=function(){return'\n    <slot name="tooltip-enable">'.concat(h4("Enable captions"),'</slot>\n    <slot name="tooltip-disable">').concat(h4("Disable captions"),"</slot>\n  ")};let mj=(e,t)=>{let i=e.getAttribute(t);return i?cj(i):[]},mQ=(e,t,i)=>{if(!(null==i?void 0:i.length))return void e.removeAttribute(t);let r=cX(i);e.getAttribute(t)!==r&&e.setAttribute(t,r)};ci.customElements.get("media-captions-button")||ci.customElements.define("media-captions-button",mY);let mz=e=>{let t=e.mediaIsCasting?h4("stop casting"):h4("start casting");e.setAttribute("aria-label",t)};class mX extends mG{static get observedAttributes(){return[...super.observedAttributes,hM.MEDIA_IS_CASTING,hM.MEDIA_CAST_UNAVAILABLE]}connectedCallback(){super.connectedCallback(),mz(this)}attributeChangedCallback(e,t,i){super.attributeChangedCallback(e,t,i),e===hM.MEDIA_IS_CASTING&&mz(this)}get mediaIsCasting(){return cA(this,hM.MEDIA_IS_CASTING)}set mediaIsCasting(e){cS(this,hM.MEDIA_IS_CASTING,e)}get mediaCastUnavailable(){return cI(this,hM.MEDIA_CAST_UNAVAILABLE)}set mediaCastUnavailable(e){cR(this,hM.MEDIA_CAST_UNAVAILABLE,e)}handleClick(){let e=this.mediaIsCasting?hL.MEDIA_EXIT_CAST_REQUEST:hL.MEDIA_ENTER_CAST_REQUEST;this.dispatchEvent(new ci.CustomEvent(e,{composed:!0,bubbles:!0}))}}mX.getSlotTemplateHTML=function(e){return"\n    <style>\n      :host([".concat(hM.MEDIA_IS_CASTING,"]) slot[name=icon] slot:not([name=exit]) {\n        display: none !important;\n      }\n\n      ","\n      :host(:not([").concat(hM.MEDIA_IS_CASTING,"])) slot[name=icon] slot:not([name=enter]) {\n        display: none !important;\n      }\n\n      :host([").concat(hM.MEDIA_IS_CASTING,"]) slot[name=tooltip-enter],\n      :host(:not([").concat(hM.MEDIA_IS_CASTING,'])) slot[name=tooltip-exit] {\n        display: none;\n      }\n    </style>\n\n    <slot name="icon">\n      <slot name="enter">').concat('<svg aria-hidden="true" viewBox="0 0 24 24"><g><path class="cast_caf_icon_arch0" d="M1,18 L1,21 L4,21 C4,19.3 2.66,18 1,18 L1,18 Z"/><path class="cast_caf_icon_arch1" d="M1,14 L1,16 C3.76,16 6,18.2 6,21 L8,21 C8,17.13 4.87,14 1,14 L1,14 Z"/><path class="cast_caf_icon_arch2" d="M1,10 L1,12 C5.97,12 10,16.0 10,21 L12,21 C12,14.92 7.07,10 1,10 L1,10 Z"/><path class="cast_caf_icon_box" d="M21,3 L3,3 C1.9,3 1,3.9 1,5 L1,8 L3,8 L3,5 L21,5 L21,19 L14,19 L14,21 L21,21 C22.1,21 23,20.1 23,19 L23,5 C23,3.9 22.1,3 21,3 L21,3 Z"/></g></svg>','</slot>\n      <slot name="exit">').concat('<svg aria-hidden="true" viewBox="0 0 24 24"><g><path class="cast_caf_icon_arch0" d="M1,18 L1,21 L4,21 C4,19.3 2.66,18 1,18 L1,18 Z"/><path class="cast_caf_icon_arch1" d="M1,14 L1,16 C3.76,16 6,18.2 6,21 L8,21 C8,17.13 4.87,14 1,14 L1,14 Z"/><path class="cast_caf_icon_arch2" d="M1,10 L1,12 C5.97,12 10,16.0 10,21 L12,21 C12,14.92 7.07,10 1,10 L1,10 Z"/><path class="cast_caf_icon_box" d="M21,3 L3,3 C1.9,3 1,3.9 1,5 L1,8 L3,8 L3,5 L21,5 L21,19 L14,19 L14,21 L21,21 C22.1,21 23,20.1 23,19 L23,5 C23,3.9 22.1,3 21,3 L21,3 Z"/><path class="cast_caf_icon_boxfill" d="M5,7 L5,8.63 C8,8.6 13.37,14 13.37,17 L19,17 L19,7 Z"/></g></svg>',"</slot>\n    </slot>\n  ")},mX.getTooltipContentHTML=function(){return'\n    <slot name="tooltip-enter">'.concat(h4("Start casting"),'</slot>\n    <slot name="tooltip-exit">').concat(h4("Stop casting"),"</slot>\n  ")},ci.customElements.get("media-cast-button")||ci.customElements.define("media-cast-button",mX);var mZ=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},mJ=(e,t,i)=>(mZ(e,t,"read from private field"),i?i.call(e):t.get(e)),m$=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},m0=(e,t,i,r)=>(mZ(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i),m1=(e,t,i)=>(mZ(e,t,"access private method"),i);let m2={OPEN:"open",ANCHOR:"anchor"};class m3 extends ci.HTMLElement{static get observedAttributes(){return[m2.OPEN,m2.ANCHOR]}get open(){return cA(this,m2.OPEN)}set open(e){cS(this,m2.OPEN,e)}handleEvent(e){switch(e.type){case"invoke":m1(this,vV,vW).call(this,e);break;case"focusout":m1(this,vq,vY).call(this,e);break;case"keydown":m1(this,vj,vQ).call(this,e)}}connectedCallback(){m1(this,vU,vF).call(this),this.role||(this.role="dialog")}attributeChangedCallback(e,t,i){m1(this,vU,vF).call(this),e===m2.OPEN&&i!==t&&(this.open?m1(this,vB,vH).call(this):m1(this,vG,vK).call(this))}focus(){m0(this,vx,cg());let e=!this.dispatchEvent(new Event("focus",{composed:!0,cancelable:!0})),t=!this.dispatchEvent(new Event("focusin",{composed:!0,bubbles:!0,cancelable:!0}));if(e||t)return;let i=this.querySelector('[autofocus], [tabindex]:not([tabindex="-1"]), [role="menu"]');null==i||i.focus()}get keysUsed(){return["Escape","Tab"]}constructor(){super(),m$(this,vU),m$(this,vB),m$(this,vG),m$(this,vV),m$(this,vq),m$(this,vj),m$(this,vP,!1),m$(this,vx,null),m$(this,vN,null),this.addEventListener("invoke",this),this.addEventListener("focusout",this),this.addEventListener("keydown",this)}}vP=new WeakMap,vx=new WeakMap,vN=new WeakMap,vU=new WeakSet,vF=function(){if(!mJ(this,vP)&&(m0(this,vP,!0),!this.shadowRoot)){this.attachShadow(this.constructor.shadowRootOptions);let e=cd(this.attributes);this.shadowRoot.innerHTML=this.constructor.getTemplateHTML(e),queueMicrotask(()=>{let{style:e}=cy(this.shadowRoot,":host");e.setProperty("transition","display .15s, visibility .15s, opacity .15s ease-in, transform .15s ease-in")})}},vB=new WeakSet,vH=function(){var e;null==(e=mJ(this,vN))||e.setAttribute("aria-expanded","true"),this.dispatchEvent(new Event("open",{composed:!0,bubbles:!0})),this.addEventListener("transitionend",()=>this.focus(),{once:!0})},vG=new WeakSet,vK=function(){var e;null==(e=mJ(this,vN))||e.setAttribute("aria-expanded","false"),this.dispatchEvent(new Event("close",{composed:!0,bubbles:!0}))},vV=new WeakSet,vW=function(e){m0(this,vN,e.relatedTarget),cf(this,e.relatedTarget)||(this.open=!this.open)},vq=new WeakSet,vY=function(e){var t;!cf(this,e.relatedTarget)&&(null==(t=mJ(this,vx))||t.focus(),mJ(this,vN)&&mJ(this,vN)!==e.relatedTarget&&this.open&&(this.open=!1))},vj=new WeakSet,vQ=function(e){var t,i,r,a,n;let{key:s,ctrlKey:o,altKey:l,metaKey:d}=e;o||l||d||this.keysUsed.includes(s)&&(e.preventDefault(),e.stopPropagation(),"Tab"===s?(e.shiftKey?null==(i=null==(t=this.previousElementSibling)?void 0:t.focus)||i.call(t):null==(a=null==(r=this.nextElementSibling)?void 0:r.focus)||a.call(r),this.blur()):"Escape"===s&&(null==(n=mJ(this,vx))||n.focus(),this.open=!1))},m3.shadowRootOptions={mode:"open"},m3.getTemplateHTML=function(e){return"\n    <style>\n      :host {\n        font: var(--media-font,\n          var(--media-font-weight, normal)\n          var(--media-font-size, 14px) /\n          var(--media-text-content-height, var(--media-control-height, 24px))\n          var(--media-font-family, helvetica neue, segoe ui, roboto, arial, sans-serif));\n        color: var(--media-text-color, var(--media-primary-color, rgb(238 238 238)));\n        display: var(--media-dialog-display, inline-flex);\n        justify-content: center;\n        align-items: center;\n        \n        transition-behavior: allow-discrete;\n        visibility: hidden;\n        opacity: 0;\n        transform: translateY(2px) scale(.99);\n        pointer-events: none;\n      }\n\n      :host([open]) {\n        transition: display .2s, visibility 0s, opacity .2s ease-out, transform .15s ease-out;\n        visibility: visible;\n        opacity: 1;\n        transform: translateY(0) scale(1);\n        pointer-events: auto;\n      }\n\n      #content {\n        display: flex;\n        position: relative;\n        box-sizing: border-box;\n        width: min(320px, 100%);\n        word-wrap: break-word;\n        max-height: 100%;\n        overflow: auto;\n        text-align: center;\n        line-height: 1.4;\n      }\n    </style>\n    ".concat(this.getSlotTemplateHTML(e),"\n  ")},m3.getSlotTemplateHTML=function(e){return'\n    <slot id="content"></slot>\n  '},ci.customElements.get("media-chrome-dialog")||ci.customElements.define("media-chrome-dialog",m3);var m4=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},m5=(e,t,i)=>(m4(e,t,"read from private field"),i?i.call(e):t.get(e)),m8=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},m9=(e,t,i,r)=>(m4(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i),m6=(e,t,i)=>(m4(e,t,"access private method"),i);class m7 extends ci.HTMLElement{static get observedAttributes(){return["disabled","aria-disabled",hD.MEDIA_CONTROLLER]}attributeChangedCallback(e,t,i){var r,a,n,s,o;e===hD.MEDIA_CONTROLLER?(t&&(null==(a=null==(r=m5(this,vz))?void 0:r.unassociateElement)||a.call(r,this),m9(this,vz,null)),i&&this.isConnected&&(m9(this,vz,null==(n=this.getRootNode())?void 0:n.getElementById(i)),null==(o=null==(s=m5(this,vz))?void 0:s.associateElement)||o.call(s,this))):("disabled"===e||"aria-disabled"===e&&t!==i)&&(null==i?(this.range.removeAttribute(e),m6(this,v8,v9).call(this)):(this.range.setAttribute(e,i),m6(this,v6,v7).call(this)))}connectedCallback(){var e,t,i;let{style:r}=cy(this.shadowRoot,":host");r.setProperty("display","var(--media-control-display, var(--".concat(this.localName,"-display, inline-flex))")),m5(this,v$).pointer=cy(this.shadowRoot,"#pointer"),m5(this,v$).progress=cy(this.shadowRoot,"#progress"),m5(this,v$).thumb=cy(this.shadowRoot,'#thumb, ::slotted([slot="thumb"])'),m5(this,v$).activeSegment=cy(this.shadowRoot,"#segments-clipping rect:nth-child(0)");let a=this.getAttribute(hD.MEDIA_CONTROLLER);a&&(m9(this,vz,null==(e=this.getRootNode())?void 0:e.getElementById(a)),null==(i=null==(t=m5(this,vz))?void 0:t.associateElement)||i.call(t,this)),this.updateBar(),this.shadowRoot.addEventListener("focusin",m5(this,v1)),this.shadowRoot.addEventListener("focusout",m5(this,v2)),m6(this,v8,v9).call(this),co(this.container,m5(this,v3))}disconnectedCallback(){var e,t;m6(this,v6,v7).call(this),null==(t=null==(e=m5(this,vz))?void 0:e.unassociateElement)||t.call(e,this),m9(this,vz,null),this.shadowRoot.removeEventListener("focusin",m5(this,v1)),this.shadowRoot.removeEventListener("focusout",m5(this,v2)),cl(this.container,m5(this,v3))}updatePointerBar(e){var t;null==(t=m5(this,v$).pointer)||t.style.setProperty("width","".concat(100*this.getPointerRatio(e),"%"))}updateBar(){var e,t;let i=100*this.range.valueAsNumber;null==(e=m5(this,v$).progress)||e.style.setProperty("width","".concat(i,"%")),null==(t=m5(this,v$).thumb)||t.style.setProperty("left","".concat(i,"%"))}updateSegments(e){let t=this.shadowRoot.querySelector("#segments-clipping");if(t.textContent="",this.container.classList.toggle("segments",!!(null==e?void 0:e.length)),!(null==e?void 0:e.length))return;let i=[...new Set([+this.range.min,...e.flatMap(e=>[e.start,e.end]),+this.range.max])];m9(this,v0,[...i]);let r=i.pop();for(let[e,a]of i.entries()){let[n,s]=[0===e,e===i.length-1],o=n?"calc(var(--segments-gap) / -1)":"".concat(100*a,"%"),l=s?r:i[e+1],d="calc(".concat((l-a)*100,"%").concat(n||s?"":" - var(--segments-gap)",")"),u=cr.createElementNS("http://www.w3.org/2000/svg","rect"),h=cy(this.shadowRoot,"#segments-clipping rect:nth-child(".concat(e+1,")"));h.style.setProperty("x",o),h.style.setProperty("width",d),t.append(u)}}getPointerRatio(e){return function(e,t,i,r){let a=r.x-i.x,n=r.y-i.y,s=a*a+n*n;return 0===s?0:Math.max(0,Math.min(1,((e-i.x)*a+(t-i.y)*n)/s))}(e.clientX,e.clientY,m5(this,vZ).getBoundingClientRect(),m5(this,vJ).getBoundingClientRect())}get dragging(){return this.hasAttribute("dragging")}handleEvent(e){switch(e.type){case"pointermove":m6(this,El,Ed).call(this,e);break;case"input":this.updateBar();break;case"pointerenter":m6(this,Ei,Er).call(this,e);break;case"pointerdown":m6(this,Ee,Et).call(this,e);break;case"pointerup":m6(this,Ea,En).call(this);break;case"pointerleave":m6(this,Es,Eo).call(this)}}get keysUsed(){return["ArrowUp","ArrowRight","ArrowDown","ArrowLeft"]}constructor(){if(super(),m8(this,v4),m8(this,v8),m8(this,v6),m8(this,Ee),m8(this,Ei),m8(this,Ea),m8(this,Es),m8(this,El),m8(this,vz,void 0),m8(this,vX,void 0),m8(this,vZ,void 0),m8(this,vJ,void 0),m8(this,v$,{}),m8(this,v0,[]),m8(this,v1,()=>{if(this.range.matches(":focus-visible")){let{style:e}=cy(this.shadowRoot,":host");e.setProperty("--_focus-visible-box-shadow","var(--_focus-box-shadow)")}}),m8(this,v2,()=>{let{style:e}=cy(this.shadowRoot,":host");e.removeProperty("--_focus-visible-box-shadow")}),m8(this,v3,()=>{let e=this.shadowRoot.querySelector("#segments-clipping");e&&e.parentNode.append(e)}),!this.shadowRoot){this.attachShadow(this.constructor.shadowRootOptions);let e=cd(this.attributes),t=this.constructor.getTemplateHTML(e);this.shadowRoot.setHTMLUnsafe?this.shadowRoot.setHTMLUnsafe(t):this.shadowRoot.innerHTML=t}this.container=this.shadowRoot.querySelector("#container"),m9(this,vZ,this.shadowRoot.querySelector("#startpoint")),m9(this,vJ,this.shadowRoot.querySelector("#endpoint")),this.range=this.shadowRoot.querySelector("#range"),this.appearance=this.shadowRoot.querySelector("#appearance")}}vz=new WeakMap,vX=new WeakMap,vZ=new WeakMap,vJ=new WeakMap,v$=new WeakMap,v0=new WeakMap,v1=new WeakMap,v2=new WeakMap,v3=new WeakMap,v4=new WeakSet,v5=function(e){let t=m5(this,v$).activeSegment;if(!t)return;let i=this.getPointerRatio(e),r=m5(this,v0).findIndex((e,t,r)=>{let a=r[t+1];return null!=a&&i>=e&&i<=a}),a="#segments-clipping rect:nth-child(".concat(r+1,")");t.selectorText==a&&t.style.transform||(t.selectorText=a,t.style.setProperty("transform","var(--media-range-segment-hover-transform, scaleY(2))"))},v8=new WeakSet,v9=function(){this.hasAttribute("disabled")||(this.addEventListener("input",this),this.addEventListener("pointerdown",this),this.addEventListener("pointerenter",this))},v6=new WeakSet,v7=function(){var e,t;this.removeEventListener("input",this),this.removeEventListener("pointerdown",this),this.removeEventListener("pointerenter",this),null==(e=ci.window)||e.removeEventListener("pointerup",this),null==(t=ci.window)||t.removeEventListener("pointermove",this)},Ee=new WeakSet,Et=function(e){var t;m9(this,vX,e.composedPath().includes(this.range)),null==(t=ci.window)||t.addEventListener("pointerup",this)},Ei=new WeakSet,Er=function(e){var t;"mouse"!==e.pointerType&&m6(this,Ee,Et).call(this,e),this.addEventListener("pointerleave",this),null==(t=ci.window)||t.addEventListener("pointermove",this)},Ea=new WeakSet,En=function(){var e;null==(e=ci.window)||e.removeEventListener("pointerup",this),this.toggleAttribute("dragging",!1),this.range.disabled=this.hasAttribute("disabled")},Es=new WeakSet,Eo=function(){var e,t;this.removeEventListener("pointerleave",this),null==(e=ci.window)||e.removeEventListener("pointermove",this),this.toggleAttribute("dragging",!1),this.range.disabled=this.hasAttribute("disabled"),null==(t=m5(this,v$).activeSegment)||t.style.removeProperty("transform")},El=new WeakSet,Ed=function(e){this.toggleAttribute("dragging",1===e.buttons||"mouse"!==e.pointerType),this.updatePointerBar(e),m6(this,v4,v5).call(this,e),this.dragging&&("mouse"!==e.pointerType||!m5(this,vX))&&(this.range.disabled=!0,this.range.valueAsNumber=this.getPointerRatio(e),this.range.dispatchEvent(new Event("input",{bubbles:!0,composed:!0})))},m7.shadowRootOptions={mode:"open"},m7.getTemplateHTML=function(e){return'\n    <style>\n      :host {\n        --_focus-box-shadow: var(--media-focus-box-shadow, inset 0 0 0 2px rgb(27 127 204 / .9));\n        --_media-range-padding: var(--media-range-padding, var(--media-control-padding, 10px));\n\n        box-shadow: var(--_focus-visible-box-shadow, none);\n        background: var(--media-control-background, var(--media-secondary-color, rgb(20 20 30 / .7)));\n        height: calc(var(--media-control-height, 24px) + 2 * var(--_media-range-padding));\n        display: inline-flex;\n        align-items: center;\n        \n        vertical-align: middle;\n        box-sizing: border-box;\n        position: relative;\n        width: 100px;\n        transition: background .15s linear;\n        cursor: var(--media-cursor, pointer);\n        pointer-events: auto;\n        touch-action: none; \n      }\n\n      \n      input[type=range]:focus {\n        outline: 0;\n      }\n      input[type=range]:focus::-webkit-slider-runnable-track {\n        outline: 0;\n      }\n\n      :host(:hover) {\n        background: var(--media-control-hover-background, rgb(50 50 70 / .7));\n      }\n\n      #leftgap {\n        padding-left: var(--media-range-padding-left, var(--_media-range-padding));\n      }\n\n      #rightgap {\n        padding-right: var(--media-range-padding-right, var(--_media-range-padding));\n      }\n\n      #startpoint,\n      #endpoint {\n        position: absolute;\n      }\n\n      #endpoint {\n        right: 0;\n      }\n\n      #container {\n        \n        width: var(--media-range-track-width, 100%);\n        transform: translate(var(--media-range-track-translate-x, 0px), var(--media-range-track-translate-y, 0px));\n        position: relative;\n        height: 100%;\n        display: flex;\n        align-items: center;\n        min-width: 40px;\n      }\n\n      #range {\n        \n        display: var(--media-time-range-hover-display, block);\n        bottom: var(--media-time-range-hover-bottom, -7px);\n        height: var(--media-time-range-hover-height, max(100% + 7px, 25px));\n        width: 100%;\n        position: absolute;\n        cursor: var(--media-cursor, pointer);\n\n        -webkit-appearance: none; \n        -webkit-tap-highlight-color: transparent;\n        background: transparent; \n        margin: 0;\n        z-index: 1;\n      }\n\n      @media (hover: hover) {\n        #range {\n          bottom: var(--media-time-range-hover-bottom, -5px);\n          height: var(--media-time-range-hover-height, max(100% + 5px, 20px));\n        }\n      }\n\n      \n      \n      #range::-webkit-slider-thumb {\n        -webkit-appearance: none;\n        background: transparent;\n        width: .1px;\n        height: .1px;\n      }\n\n      \n      #range::-moz-range-thumb {\n        background: transparent;\n        border: transparent;\n        width: .1px;\n        height: .1px;\n      }\n\n      #appearance {\n        height: var(--media-range-track-height, 4px);\n        display: flex;\n        flex-direction: column;\n        justify-content: center;\n        width: 100%;\n        position: absolute;\n        \n        will-change: transform;\n      }\n\n      #track {\n        background: var(--media-range-track-background, rgb(255 255 255 / .2));\n        border-radius: var(--media-range-track-border-radius, 1px);\n        border: var(--media-range-track-border, none);\n        outline: var(--media-range-track-outline);\n        outline-offset: var(--media-range-track-outline-offset);\n        backdrop-filter: var(--media-range-track-backdrop-filter);\n        -webkit-backdrop-filter: var(--media-range-track-backdrop-filter);\n        box-shadow: var(--media-range-track-box-shadow, none);\n        position: absolute;\n        width: 100%;\n        height: 100%;\n        overflow: hidden;\n      }\n\n      #progress,\n      #pointer {\n        position: absolute;\n        height: 100%;\n        will-change: width;\n      }\n\n      #progress {\n        background: var(--media-range-bar-color, var(--media-primary-color, rgb(238 238 238)));\n        transition: var(--media-range-track-transition);\n      }\n\n      #pointer {\n        background: var(--media-range-track-pointer-background);\n        border-right: var(--media-range-track-pointer-border-right);\n        transition: visibility .25s, opacity .25s;\n        visibility: hidden;\n        opacity: 0;\n      }\n\n      @media (hover: hover) {\n        :host(:hover) #pointer {\n          transition: visibility .5s, opacity .5s;\n          visibility: visible;\n          opacity: 1;\n        }\n      }\n\n      #thumb,\n      ::slotted([slot=thumb]) {\n        width: var(--media-range-thumb-width, 10px);\n        height: var(--media-range-thumb-height, 10px);\n        transition: var(--media-range-thumb-transition);\n        transform: var(--media-range-thumb-transform, none);\n        opacity: var(--media-range-thumb-opacity, 1);\n        translate: -50%;\n        position: absolute;\n        left: 0;\n        cursor: var(--media-cursor, pointer);\n      }\n\n      #thumb {\n        border-radius: var(--media-range-thumb-border-radius, 10px);\n        background: var(--media-range-thumb-background, var(--media-primary-color, rgb(238 238 238)));\n        box-shadow: var(--media-range-thumb-box-shadow, 1px 1px 1px transparent);\n        border: var(--media-range-thumb-border, none);\n      }\n\n      :host([disabled]) #thumb {\n        background-color: #777;\n      }\n\n      .segments #appearance {\n        height: var(--media-range-segment-hover-height, 7px);\n      }\n\n      #track {\n        clip-path: url(#segments-clipping);\n      }\n\n      #segments {\n        --segments-gap: var(--media-range-segments-gap, 2px);\n        position: absolute;\n        width: 100%;\n        height: 100%;\n      }\n\n      #segments-clipping {\n        transform: translateX(calc(var(--segments-gap) / 2));\n      }\n\n      #segments-clipping:empty {\n        display: none;\n      }\n\n      #segments-clipping rect {\n        height: var(--media-range-track-height, 4px);\n        y: calc((var(--media-range-segment-hover-height, 7px) - var(--media-range-track-height, 4px)) / 2);\n        transition: var(--media-range-segment-transition, transform .1s ease-in-out);\n        transform: var(--media-range-segment-transform, scaleY(1));\n        transform-origin: center;\n      }\n    </style>\n    <div id="leftgap"></div>\n    <div id="container">\n      <div id="startpoint"></div>\n      <div id="endpoint"></div>\n      <div id="appearance">\n        <div id="track" part="track">\n          <div id="pointer"></div>\n          <div id="progress" part="progress"></div>\n        </div>\n        <slot name="thumb">\n          <div id="thumb" part="thumb"></div>\n        </slot>\n        <svg id="segments"><clipPath id="segments-clipping"></clipPath></svg>\n      </div>\n      <input id="range" type="range" min="0" max="1" step="any" value="0">\n    </div>\n    <div id="rightgap"></div>\n  '},ci.customElements.get("media-chrome-range")||ci.customElements.define("media-chrome-range",m7);var fe=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},ft=(e,t,i)=>(fe(e,t,"read from private field"),i?i.call(e):t.get(e)),fi=(e,t,i,r)=>(fe(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i);class fr extends ci.HTMLElement{static get observedAttributes(){return[hD.MEDIA_CONTROLLER]}attributeChangedCallback(e,t,i){var r,a,n,s,o;e===hD.MEDIA_CONTROLLER&&(t&&(null==(a=null==(r=ft(this,Eu))?void 0:r.unassociateElement)||a.call(r,this),fi(this,Eu,null)),i&&this.isConnected&&(fi(this,Eu,null==(n=this.getRootNode())?void 0:n.getElementById(i)),null==(o=null==(s=ft(this,Eu))?void 0:s.associateElement)||o.call(s,this)))}connectedCallback(){var e,t,i;let r=this.getAttribute(hD.MEDIA_CONTROLLER);r&&(fi(this,Eu,null==(e=this.getRootNode())?void 0:e.getElementById(r)),null==(i=null==(t=ft(this,Eu))?void 0:t.associateElement)||i.call(t,this))}disconnectedCallback(){var e,t;null==(t=null==(e=ft(this,Eu))?void 0:e.unassociateElement)||t.call(e,this),fi(this,Eu,null)}constructor(){if(super(),((e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)})(this,Eu,void 0),!this.shadowRoot){this.attachShadow(this.constructor.shadowRootOptions);let e=cd(this.attributes);this.shadowRoot.innerHTML=this.constructor.getTemplateHTML(e)}}}Eu=new WeakMap,fr.shadowRootOptions={mode:"open"},fr.getTemplateHTML=function(e){return'\n    <style>\n      :host {\n        \n        box-sizing: border-box;\n        display: var(--media-control-display, var(--media-control-bar-display, inline-flex));\n        color: var(--media-text-color, var(--media-primary-color, rgb(238 238 238)));\n        --media-loading-indicator-icon-height: 44px;\n      }\n\n      ::slotted(media-time-range),\n      ::slotted(media-volume-range) {\n        min-height: 100%;\n      }\n\n      ::slotted(media-time-range),\n      ::slotted(media-clip-selector) {\n        flex-grow: 1;\n      }\n\n      ::slotted([role="menu"]) {\n        position: absolute;\n      }\n    </style>\n\n    <slot></slot>\n  '},ci.customElements.get("media-control-bar")||ci.customElements.define("media-control-bar",fr);var fa=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},fn=(e,t,i)=>(fa(e,t,"read from private field"),i?i.call(e):t.get(e)),fs=(e,t,i,r)=>(fa(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i);class fo extends ci.HTMLElement{static get observedAttributes(){return[hD.MEDIA_CONTROLLER]}attributeChangedCallback(e,t,i){var r,a,n,s,o;e===hD.MEDIA_CONTROLLER&&(t&&(null==(a=null==(r=fn(this,Eh))?void 0:r.unassociateElement)||a.call(r,this),fs(this,Eh,null)),i&&this.isConnected&&(fs(this,Eh,null==(n=this.getRootNode())?void 0:n.getElementById(i)),null==(o=null==(s=fn(this,Eh))?void 0:s.associateElement)||o.call(s,this)))}connectedCallback(){var e,t,i;let{style:r}=cy(this.shadowRoot,":host");r.setProperty("display","var(--media-control-display, var(--".concat(this.localName,"-display, inline-flex))"));let a=this.getAttribute(hD.MEDIA_CONTROLLER);a&&(fs(this,Eh,null==(e=this.getRootNode())?void 0:e.getElementById(a)),null==(i=null==(t=fn(this,Eh))?void 0:t.associateElement)||i.call(t,this))}disconnectedCallback(){var e,t;null==(t=null==(e=fn(this,Eh))?void 0:e.unassociateElement)||t.call(e,this),fs(this,Eh,null)}constructor(){if(super(),((e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)})(this,Eh,void 0),!this.shadowRoot){this.attachShadow(this.constructor.shadowRootOptions);let e=cd(this.attributes);this.shadowRoot.innerHTML=this.constructor.getTemplateHTML(e)}}}Eh=new WeakMap,fo.shadowRootOptions={mode:"open"},fo.getTemplateHTML=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return"\n    <style>\n      :host {\n        font: var(--media-font,\n          var(--media-font-weight, normal)\n          var(--media-font-size, 14px) /\n          var(--media-text-content-height, var(--media-control-height, 24px))\n          var(--media-font-family, helvetica neue, segoe ui, roboto, arial, sans-serif));\n        color: var(--media-text-color, var(--media-primary-color, rgb(238 238 238)));\n        background: var(--media-text-background, var(--media-control-background, var(--media-secondary-color, rgb(20 20 30 / .7))));\n        padding: var(--media-control-padding, 10px);\n        display: inline-flex;\n        justify-content: center;\n        align-items: center;\n        vertical-align: middle;\n        box-sizing: border-box;\n        text-align: center;\n        pointer-events: auto;\n      }\n\n      \n      :host(:focus-visible) {\n        box-shadow: inset 0 0 0 2px rgb(27 127 204 / .9);\n        outline: 0;\n      }\n\n      \n      :host(:where(:focus)) {\n        box-shadow: none;\n        outline: 0;\n      }\n    </style>\n\n    ".concat(this.getSlotTemplateHTML(e,t),"\n  ")},fo.getSlotTemplateHTML=function(e,t){return"\n    <slot></slot>\n  "},ci.customElements.get("media-text-display")||ci.customElements.define("media-text-display",fo);var fl=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},fd=(e,t,i)=>(fl(e,t,"read from private field"),i?i.call(e):t.get(e));class fu extends fo{static get observedAttributes(){return[...super.observedAttributes,hM.MEDIA_DURATION]}attributeChangedCallback(e,t,i){e===hM.MEDIA_DURATION&&(fd(this,Ec).textContent=h$(+i)),super.attributeChangedCallback(e,t,i)}get mediaDuration(){return cT(this,hM.MEDIA_DURATION)}set mediaDuration(e){c_(this,hM.MEDIA_DURATION,e)}constructor(){var e;super(),((e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)})(this,Ec,void 0),((e,t,i,r)=>(fl(e,t,"write to private field"),r?r.call(e,i):t.set(e,i)))(this,Ec,this.shadowRoot.querySelector("slot")),fd(this,Ec).textContent=h$(null!=(e=this.mediaDuration)?e:0)}}Ec=new WeakMap,fu.getSlotTemplateHTML=function(e,t){return"\n    <slot>".concat(h$(t.mediaDuration),"</slot>\n  ")},ci.customElements.get("media-duration-display")||ci.customElements.define("media-duration-display",fu);let fh={2:h4("Network Error"),3:h4("Decode Error"),4:h4("Source Not Supported"),5:h4("Encryption Error")},fc={2:h4("A network error caused the media download to fail."),3:h4("A media error caused playback to be aborted. The media could be corrupt or your browser does not support this format."),4:h4("An unsupported error occurred. The server or network failed, or your browser does not support this format."),5:h4("The media is encrypted and there are no keys to decrypt it.")},fm=e=>{var t,i;return 1===e.code?null:{title:null!=(t=fh[e.code])?t:"Error ".concat(e.code),message:null!=(i=fc[e.code])?i:e.message}};var ff=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)};function fp(e){var t;let{title:i,message:r}=null!=(t=fm(e))?t:{},a="";return i&&(a+='<slot name="error-'.concat(e.code,'-title"><h3>').concat(i,"</h3></slot>")),r&&(a+='<slot name="error-'.concat(e.code,'-message"><p>').concat(r,"</p></slot>")),a}let fg=[hM.MEDIA_ERROR_CODE,hM.MEDIA_ERROR_MESSAGE];class fv extends m3{static get observedAttributes(){return[...super.observedAttributes,...fg]}formatErrorMessage(e){return this.constructor.formatErrorMessage(e)}attributeChangedCallback(e,t,i){var r;if(super.attributeChangedCallback(e,t,i),!fg.includes(e))return;let a=null!=(r=this.mediaError)?r:{code:this.mediaErrorCode,message:this.mediaErrorMessage};this.open=a.code&&null!==fm(a),this.open&&(this.shadowRoot.querySelector("slot").name="error-".concat(this.mediaErrorCode),this.shadowRoot.querySelector("#content").innerHTML=this.formatErrorMessage(a))}get mediaError(){var e,t;return ff(this,e=Em,"read from private field"),t?t.call(this):e.get(this)}set mediaError(e){var t,i;ff(this,t=Em,"write to private field"),i?i.call(this,e):t.set(this,e)}get mediaErrorCode(){return cT(this,"mediaerrorcode")}set mediaErrorCode(e){c_(this,"mediaerrorcode",e)}get mediaErrorMessage(){return cI(this,"mediaerrormessage")}set mediaErrorMessage(e){cR(this,"mediaerrormessage",e)}constructor(){super(...arguments),((e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)})(this,Em,null)}}Em=new WeakMap,fv.getSlotTemplateHTML=function(e){return'\n    <style>\n      :host {\n        background: rgb(20 20 30 / .8);\n      }\n\n      #content {\n        display: block;\n        padding: 1.2em 1.5em;\n      }\n\n      h3,\n      p {\n        margin-block: 0 .3em;\n      }\n    </style>\n    <slot name="error-'.concat(e.mediaerrorcode,'" id="content">\n      ').concat(fp({code:+e.mediaerrorcode,message:e.mediaerrormessage}),"\n    </slot>\n  ")},fv.formatErrorMessage=fp,ci.customElements.get("media-error-dialog")||ci.customElements.define("media-error-dialog",fv);let fE=e=>{let t=e.mediaIsFullscreen?h4("exit fullscreen mode"):h4("enter fullscreen mode");e.setAttribute("aria-label",t)};class fy extends mG{static get observedAttributes(){return[...super.observedAttributes,hM.MEDIA_IS_FULLSCREEN,hM.MEDIA_FULLSCREEN_UNAVAILABLE]}connectedCallback(){super.connectedCallback(),fE(this)}attributeChangedCallback(e,t,i){super.attributeChangedCallback(e,t,i),e===hM.MEDIA_IS_FULLSCREEN&&fE(this)}get mediaFullscreenUnavailable(){return cI(this,hM.MEDIA_FULLSCREEN_UNAVAILABLE)}set mediaFullscreenUnavailable(e){cR(this,hM.MEDIA_FULLSCREEN_UNAVAILABLE,e)}get mediaIsFullscreen(){return cA(this,hM.MEDIA_IS_FULLSCREEN)}set mediaIsFullscreen(e){cS(this,hM.MEDIA_IS_FULLSCREEN,e)}handleClick(){let e=this.mediaIsFullscreen?hL.MEDIA_EXIT_FULLSCREEN_REQUEST:hL.MEDIA_ENTER_FULLSCREEN_REQUEST;this.dispatchEvent(new ci.CustomEvent(e,{composed:!0,bubbles:!0}))}}fy.getSlotTemplateHTML=function(e){return"\n    <style>\n      :host([".concat(hM.MEDIA_IS_FULLSCREEN,"]) slot[name=icon] slot:not([name=exit]) {\n        display: none !important;\n      }\n\n      ","\n      :host(:not([").concat(hM.MEDIA_IS_FULLSCREEN,"])) slot[name=icon] slot:not([name=enter]) {\n        display: none !important;\n      }\n\n      :host([").concat(hM.MEDIA_IS_FULLSCREEN,"]) slot[name=tooltip-enter],\n      :host(:not([").concat(hM.MEDIA_IS_FULLSCREEN,'])) slot[name=tooltip-exit] {\n        display: none;\n      }\n    </style>\n\n    <slot name="icon">\n      <slot name="enter">').concat('<svg aria-hidden="true" viewBox="0 0 26 24">\n  <path d="M16 3v2.5h3.5V9H22V3h-6ZM4 9h2.5V5.5H10V3H4v6Zm15.5 9.5H16V21h6v-6h-2.5v3.5ZM6.5 15H4v6h6v-2.5H6.5V15Z"/>\n</svg>','</slot>\n      <slot name="exit">').concat('<svg aria-hidden="true" viewBox="0 0 26 24">\n  <path d="M18.5 6.5V3H16v6h6V6.5h-3.5ZM16 21h2.5v-3.5H22V15h-6v6ZM4 17.5h3.5V21H10v-6H4v2.5Zm3.5-11H4V9h6V3H7.5v3.5Z"/>\n</svg>',"</slot>\n    </slot>\n  ")},fy.getTooltipContentHTML=function(){return'\n    <slot name="tooltip-enter">'.concat(h4("Enter fullscreen mode"),'</slot>\n    <slot name="tooltip-exit">').concat(h4("Exit fullscreen mode"),"</slot>\n  ")},ci.customElements.get("media-fullscreen-button")||ci.customElements.define("media-fullscreen-button",fy);let{MEDIA_TIME_IS_LIVE:fb,MEDIA_PAUSED:fT}=hM,{MEDIA_SEEK_TO_LIVE_REQUEST:f_,MEDIA_PLAY_REQUEST:fA}=hL,fS=e=>{var t;let i=e.mediaPaused||!e.mediaTimeIsLive,r=i?h4("seek to live"):h4("playing live");e.setAttribute("aria-label",r);let a=null==(t=e.shadowRoot)?void 0:t.querySelector('slot[name="text"]');a&&(a.textContent=h4("live")),i?e.removeAttribute("aria-disabled"):e.setAttribute("aria-disabled","true")};class fI extends mG{static get observedAttributes(){return[...super.observedAttributes,fb,fT]}connectedCallback(){super.connectedCallback(),fS(this)}attributeChangedCallback(e,t,i){super.attributeChangedCallback(e,t,i),fS(this)}get mediaPaused(){return cA(this,hM.MEDIA_PAUSED)}set mediaPaused(e){cS(this,hM.MEDIA_PAUSED,e)}get mediaTimeIsLive(){return cA(this,hM.MEDIA_TIME_IS_LIVE)}set mediaTimeIsLive(e){cS(this,hM.MEDIA_TIME_IS_LIVE,e)}handleClick(){(this.mediaPaused||!this.mediaTimeIsLive)&&(this.dispatchEvent(new ci.CustomEvent(f_,{composed:!0,bubbles:!0})),this.hasAttribute(fT)&&this.dispatchEvent(new ci.CustomEvent(fA,{composed:!0,bubbles:!0})))}}fI.getSlotTemplateHTML=function(e){return"\n    <style>\n      :host { --media-tooltip-display: none; }\n      \n      slot[name=indicator] > *,\n      :host ::slotted([slot=indicator]) {\n        \n        min-width: auto;\n        fill: var(--media-live-button-icon-color, rgb(140, 140, 140));\n        color: var(--media-live-button-icon-color, rgb(140, 140, 140));\n      }\n\n      :host([".concat(fb,"]:not([").concat(fT,"])) slot[name=indicator] > *,\n      :host([").concat(fb,"]:not([").concat(fT,"])) ::slotted([slot=indicator]) {\n        fill: var(--media-live-button-indicator-color, rgb(255, 0, 0));\n        color: var(--media-live-button-indicator-color, rgb(255, 0, 0));\n      }\n\n      :host([").concat(fb,"]:not([").concat(fT,'])) {\n        cursor: var(--media-cursor, not-allowed);\n      }\n\n      slot[name=text]{\n        text-transform: uppercase;\n      }\n\n    </style>\n\n    <slot name="indicator">').concat('<svg viewBox="0 0 6 12"><circle cx="3" cy="6" r="2"></circle></svg>',"</slot>\n    ",'\n    <slot name="spacer">&nbsp;</slot><slot name="text">').concat(h4("live"),"</slot>\n  ")},ci.customElements.get("media-live-button")||ci.customElements.define("media-live-button",fI);var fR=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},fk=(e,t,i)=>(fR(e,t,"read from private field"),i?i.call(e):t.get(e)),fL=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},fD=(e,t,i,r)=>(fR(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i);let fw={LOADING_DELAY:"loadingdelay",NO_AUTOHIDE:"noautohide"};class fC extends ci.HTMLElement{static get observedAttributes(){return[hD.MEDIA_CONTROLLER,hM.MEDIA_PAUSED,hM.MEDIA_LOADING,fw.LOADING_DELAY]}attributeChangedCallback(e,t,i){var r,a,n,s,o;e===fw.LOADING_DELAY&&t!==i?this.loadingDelay=Number(i):e===hD.MEDIA_CONTROLLER&&(t&&(null==(a=null==(r=fk(this,Ef))?void 0:r.unassociateElement)||a.call(r,this),fD(this,Ef,null)),i&&this.isConnected&&(fD(this,Ef,null==(n=this.getRootNode())?void 0:n.getElementById(i)),null==(o=null==(s=fk(this,Ef))?void 0:s.associateElement)||o.call(s,this)))}connectedCallback(){var e,t,i;let r=this.getAttribute(hD.MEDIA_CONTROLLER);r&&(fD(this,Ef,null==(e=this.getRootNode())?void 0:e.getElementById(r)),null==(i=null==(t=fk(this,Ef))?void 0:t.associateElement)||i.call(t,this))}disconnectedCallback(){var e,t;null==(t=null==(e=fk(this,Ef))?void 0:e.unassociateElement)||t.call(e,this),fD(this,Ef,null)}get loadingDelay(){return fk(this,Ep)}set loadingDelay(e){fD(this,Ep,e);let{style:t}=cy(this.shadowRoot,":host");t.setProperty("--_loading-indicator-delay","var(--media-loading-indicator-transition-delay, ".concat(e,"ms)"))}get mediaPaused(){return cA(this,hM.MEDIA_PAUSED)}set mediaPaused(e){cS(this,hM.MEDIA_PAUSED,e)}get mediaLoading(){return cA(this,hM.MEDIA_LOADING)}set mediaLoading(e){cS(this,hM.MEDIA_LOADING,e)}get mediaController(){return cI(this,hD.MEDIA_CONTROLLER)}set mediaController(e){cR(this,hD.MEDIA_CONTROLLER,e)}get noAutohide(){return cA(this,fw.NO_AUTOHIDE)}set noAutohide(e){cS(this,fw.NO_AUTOHIDE,e)}constructor(){if(super(),fL(this,Ef,void 0),fL(this,Ep,500),!this.shadowRoot){this.attachShadow(this.constructor.shadowRootOptions);let e=cd(this.attributes);this.shadowRoot.innerHTML=this.constructor.getTemplateHTML(e)}}}Ef=new WeakMap,Ep=new WeakMap,fC.shadowRootOptions={mode:"open"},fC.getTemplateHTML=function(e){return"\n    <style>\n      :host {\n        display: var(--media-control-display, var(--media-loading-indicator-display, inline-block));\n        vertical-align: middle;\n        box-sizing: border-box;\n        --_loading-indicator-delay: var(--media-loading-indicator-transition-delay, ".concat(500,"ms);\n      }\n\n      #status {\n        color: rgba(0,0,0,0);\n        width: 0px;\n        height: 0px;\n      }\n\n      :host slot[name=icon] > *,\n      :host ::slotted([slot=icon]) {\n        opacity: var(--media-loading-indicator-opacity, 0);\n        transition: opacity 0.15s;\n      }\n\n      :host([").concat(hM.MEDIA_LOADING,"]:not([").concat(hM.MEDIA_PAUSED,"])) slot[name=icon] > *,\n      :host([").concat(hM.MEDIA_LOADING,"]:not([").concat(hM.MEDIA_PAUSED,"])) ::slotted([slot=icon]) {\n        opacity: var(--media-loading-indicator-opacity, 1);\n        transition: opacity 0.15s var(--_loading-indicator-delay);\n      }\n\n      :host #status {\n        visibility: var(--media-loading-indicator-opacity, hidden);\n        transition: visibility 0.15s;\n      }\n\n      :host([").concat(hM.MEDIA_LOADING,"]:not([").concat(hM.MEDIA_PAUSED,'])) #status {\n        visibility: var(--media-loading-indicator-opacity, visible);\n        transition: visibility 0.15s var(--_loading-indicator-delay);\n      }\n\n      svg, img, ::slotted(svg), ::slotted(img) {\n        width: var(--media-loading-indicator-icon-width);\n        height: var(--media-loading-indicator-icon-height, 100px);\n        fill: var(--media-icon-color, var(--media-primary-color, rgb(238 238 238)));\n        vertical-align: middle;\n      }\n    </style>\n\n    <slot name="icon">').concat('\n<svg aria-hidden="true" viewBox="0 0 100 100">\n  <path d="M73,50c0-12.7-10.3-23-23-23S27,37.3,27,50 M30.9,50c0-10.5,8.5-19.1,19.1-19.1S69.1,39.5,69.1,50">\n    <animateTransform\n       attributeName="transform"\n       attributeType="XML"\n       type="rotate"\n       dur="1s"\n       from="0 50 50"\n       to="360 50 50"\n       repeatCount="indefinite" />\n  </path>\n</svg>\n','</slot>\n    <div id="status" role="status" aria-live="polite">').concat(h4("media loading"),"</div>\n  ")},ci.customElements.get("media-loading-indicator")||ci.customElements.define("media-loading-indicator",fC);let fM='<svg aria-hidden="true" viewBox="0 0 24 24">\n  <path d="M3 9v6h4l5 5V4L7 9H3Zm13.5 3A4.5 4.5 0 0 0 14 8v8a4.47 4.47 0 0 0 2.5-4Z"/>\n</svg>',fO=e=>{let t="off"===e.mediaVolumeLevel?h4("unmute"):h4("mute");e.setAttribute("aria-label",t)};class fP extends mG{static get observedAttributes(){return[...super.observedAttributes,hM.MEDIA_VOLUME_LEVEL]}connectedCallback(){super.connectedCallback(),fO(this)}attributeChangedCallback(e,t,i){super.attributeChangedCallback(e,t,i),e===hM.MEDIA_VOLUME_LEVEL&&fO(this)}get mediaVolumeLevel(){return cI(this,hM.MEDIA_VOLUME_LEVEL)}set mediaVolumeLevel(e){cR(this,hM.MEDIA_VOLUME_LEVEL,e)}handleClick(){let e="off"===this.mediaVolumeLevel?hL.MEDIA_UNMUTE_REQUEST:hL.MEDIA_MUTE_REQUEST;this.dispatchEvent(new ci.CustomEvent(e,{composed:!0,bubbles:!0}))}}fP.getSlotTemplateHTML=function(e){return"\n    <style>\n      :host(:not([".concat(hM.MEDIA_VOLUME_LEVEL,"])) slot[name=icon] slot:not([name=high]),\n      :host([").concat(hM.MEDIA_VOLUME_LEVEL,"=high]) slot[name=icon] slot:not([name=high]) {\n        display: none !important;\n      }\n\n      :host([").concat(hM.MEDIA_VOLUME_LEVEL,"=off]) slot[name=icon] slot:not([name=off]) {\n        display: none !important;\n      }\n\n      :host([").concat(hM.MEDIA_VOLUME_LEVEL,"=low]) slot[name=icon] slot:not([name=low]) {\n        display: none !important;\n      }\n\n      :host([").concat(hM.MEDIA_VOLUME_LEVEL,"=medium]) slot[name=icon] slot:not([name=medium]) {\n        display: none !important;\n      }\n\n      :host(:not([").concat(hM.MEDIA_VOLUME_LEVEL,"=off])) slot[name=tooltip-unmute],\n      :host([").concat(hM.MEDIA_VOLUME_LEVEL,'=off]) slot[name=tooltip-mute] {\n        display: none;\n      }\n    </style>\n\n    <slot name="icon">\n      <slot name="off">').concat('<svg aria-hidden="true" viewBox="0 0 24 24">\n  <path d="M16.5 12A4.5 4.5 0 0 0 14 8v2.18l2.45 2.45a4.22 4.22 0 0 0 .05-.63Zm2.5 0a6.84 6.84 0 0 1-.54 2.64L20 16.15A8.8 8.8 0 0 0 21 12a9 9 0 0 0-7-8.77v2.06A7 7 0 0 1 19 12ZM4.27 3 3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25A6.92 6.92 0 0 1 14 18.7v2.06A9 9 0 0 0 17.69 19l2 2.05L21 19.73l-9-9L4.27 3ZM12 4 9.91 6.09 12 8.18V4Z"/>\n</svg>','</slot>\n      <slot name="low">').concat(fM,'</slot>\n      <slot name="medium">').concat(fM,'</slot>\n      <slot name="high">').concat('<svg aria-hidden="true" viewBox="0 0 24 24">\n  <path d="M3 9v6h4l5 5V4L7 9H3Zm13.5 3A4.5 4.5 0 0 0 14 8v8a4.47 4.47 0 0 0 2.5-4ZM14 3.23v2.06a7 7 0 0 1 0 13.42v2.06a9 9 0 0 0 0-17.54Z"/>\n</svg>',"</slot>\n    </slot>\n  ")},fP.getTooltipContentHTML=function(){return'\n    <slot name="tooltip-mute">'.concat(h4("Mute"),'</slot>\n    <slot name="tooltip-unmute">').concat(h4("Unmute"),"</slot>\n  ")},ci.customElements.get("media-mute-button")||ci.customElements.define("media-mute-button",fP);let fx='<svg aria-hidden="true" viewBox="0 0 28 24">\n  <path d="M24 3H4a1 1 0 0 0-1 1v16a1 1 0 0 0 1 1h20a1 1 0 0 0 1-1V4a1 1 0 0 0-1-1Zm-1 16H5V5h18v14Zm-3-8h-7v5h7v-5Z"/>\n</svg>',fN=e=>{let t=e.mediaIsPip?h4("exit picture in picture mode"):h4("enter picture in picture mode");e.setAttribute("aria-label",t)};class fU extends mG{static get observedAttributes(){return[...super.observedAttributes,hM.MEDIA_IS_PIP,hM.MEDIA_PIP_UNAVAILABLE]}connectedCallback(){super.connectedCallback(),fN(this)}attributeChangedCallback(e,t,i){super.attributeChangedCallback(e,t,i),e===hM.MEDIA_IS_PIP&&fN(this)}get mediaPipUnavailable(){return cI(this,hM.MEDIA_PIP_UNAVAILABLE)}set mediaPipUnavailable(e){cR(this,hM.MEDIA_PIP_UNAVAILABLE,e)}get mediaIsPip(){return cA(this,hM.MEDIA_IS_PIP)}set mediaIsPip(e){cS(this,hM.MEDIA_IS_PIP,e)}handleClick(){let e=this.mediaIsPip?hL.MEDIA_EXIT_PIP_REQUEST:hL.MEDIA_ENTER_PIP_REQUEST;this.dispatchEvent(new ci.CustomEvent(e,{composed:!0,bubbles:!0}))}}fU.getSlotTemplateHTML=function(e){return"\n    <style>\n      :host([".concat(hM.MEDIA_IS_PIP,"]) slot[name=icon] slot:not([name=exit]) {\n        display: none !important;\n      }\n\n      :host(:not([").concat(hM.MEDIA_IS_PIP,"])) slot[name=icon] slot:not([name=enter]) {\n        display: none !important;\n      }\n\n      :host([").concat(hM.MEDIA_IS_PIP,"]) slot[name=tooltip-enter],\n      :host(:not([").concat(hM.MEDIA_IS_PIP,'])) slot[name=tooltip-exit] {\n        display: none;\n      }\n    </style>\n\n    <slot name="icon">\n      <slot name="enter">').concat(fx,'</slot>\n      <slot name="exit">').concat(fx,"</slot>\n    </slot>\n  ")},fU.getTooltipContentHTML=function(){return'\n    <slot name="tooltip-enter">'.concat(h4("Enter picture in picture mode"),'</slot>\n    <slot name="tooltip-exit">').concat(h4("Exit picture in picture mode"),"</slot>\n  ")},ci.customElements.get("media-pip-button")||ci.customElements.define("media-pip-button",fU);var fF=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot read from private field");return i?i.call(e):t.get(e)};let fB={RATES:"rates"},fH=[1,1.2,1.5,1.7,2];class fG extends mG{static get observedAttributes(){return[...super.observedAttributes,hM.MEDIA_PLAYBACK_RATE,fB.RATES]}attributeChangedCallback(e,t,i){if(super.attributeChangedCallback(e,t,i),e===fB.RATES&&(fF(this,Eg).value=i),e===hM.MEDIA_PLAYBACK_RATE){let e=i?+i:NaN,t=Number.isNaN(e)?1:e;this.container.innerHTML="".concat(t,"x"),this.setAttribute("aria-label",h4("Playback rate {playbackRate}",{playbackRate:t}))}}get rates(){return fF(this,Eg)}set rates(e){e?Array.isArray(e)?fF(this,Eg).value=e.join(" "):"string"==typeof e&&(fF(this,Eg).value=e):fF(this,Eg).value=""}get mediaPlaybackRate(){return cT(this,hM.MEDIA_PLAYBACK_RATE,1)}set mediaPlaybackRate(e){c_(this,hM.MEDIA_PLAYBACK_RATE,e)}handleClick(){var e,t;let i=Array.from(fF(this,Eg).values(),e=>+e).sort((e,t)=>e-t),r=null!=(t=null!=(e=i.find(e=>e>this.mediaPlaybackRate))?e:i[0])?t:1,a=new ci.CustomEvent(hL.MEDIA_PLAYBACK_RATE_REQUEST,{composed:!0,bubbles:!0,detail:r});this.dispatchEvent(a)}constructor(){var e;super(),((e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)})(this,Eg,new cW(this,fB.RATES,{defaultValue:fH})),this.container=this.shadowRoot.querySelector('slot[name="icon"]'),this.container.innerHTML="".concat(null!=(e=this.mediaPlaybackRate)?e:1,"x")}}Eg=new WeakMap,fG.getSlotTemplateHTML=function(e){return'\n    <style>\n      :host {\n        min-width: 5ch;\n        padding: var(--media-button-padding, var(--media-control-padding, 10px 5px));\n      }\n    </style>\n    <slot name="icon">'.concat(e.mediaplaybackrate||1,"x</slot>\n  ")},fG.getTooltipContentHTML=function(){return h4("Playback rate")},ci.customElements.get("media-playback-rate-button")||ci.customElements.define("media-playback-rate-button",fG);let fK=e=>{let t=e.mediaPaused?h4("play"):h4("pause");e.setAttribute("aria-label",t)};class fV extends mG{static get observedAttributes(){return[...super.observedAttributes,hM.MEDIA_PAUSED,hM.MEDIA_ENDED]}connectedCallback(){super.connectedCallback(),fK(this)}attributeChangedCallback(e,t,i){super.attributeChangedCallback(e,t,i),(e===hM.MEDIA_PAUSED||e===hM.MEDIA_LANG)&&fK(this)}get mediaPaused(){return cA(this,hM.MEDIA_PAUSED)}set mediaPaused(e){cS(this,hM.MEDIA_PAUSED,e)}handleClick(){let e=this.mediaPaused?hL.MEDIA_PLAY_REQUEST:hL.MEDIA_PAUSE_REQUEST;this.dispatchEvent(new ci.CustomEvent(e,{composed:!0,bubbles:!0}))}}fV.getSlotTemplateHTML=function(e){return"\n    <style>\n      :host([".concat(hM.MEDIA_PAUSED,"]) slot[name=pause],\n      :host(:not([").concat(hM.MEDIA_PAUSED,"])) slot[name=play] {\n        display: none !important;\n      }\n\n      :host([").concat(hM.MEDIA_PAUSED,"]) slot[name=tooltip-pause],\n      :host(:not([").concat(hM.MEDIA_PAUSED,'])) slot[name=tooltip-play] {\n        display: none;\n      }\n    </style>\n\n    <slot name="icon">\n      <slot name="play">').concat('<svg aria-hidden="true" viewBox="0 0 24 24">\n  <path d="m6 21 15-9L6 3v18Z"/>\n</svg>','</slot>\n      <slot name="pause">').concat('<svg aria-hidden="true" viewBox="0 0 24 24">\n  <path d="M6 20h4V4H6v16Zm8-16v16h4V4h-4Z"/>\n</svg>',"</slot>\n    </slot>\n  ")},fV.getTooltipContentHTML=function(){return'\n    <slot name="tooltip-play">'.concat(h4("Play"),'</slot>\n    <slot name="tooltip-pause">').concat(h4("Pause"),"</slot>\n  ")},ci.customElements.get("media-play-button")||ci.customElements.define("media-play-button",fV);let fW={PLACEHOLDER_SRC:"placeholdersrc",SRC:"src"};class fq extends ci.HTMLElement{static get observedAttributes(){return[fW.PLACEHOLDER_SRC,fW.SRC]}attributeChangedCallback(e,t,i){if(e===fW.SRC&&(null==i?this.image.removeAttribute(fW.SRC):this.image.setAttribute(fW.SRC,i)),e===fW.PLACEHOLDER_SRC)if(null==i)this.image.style.removeProperty("background-image");else{var r;r=this.image,r.style["background-image"]="url('".concat(i,"')")}}get placeholderSrc(){return cI(this,fW.PLACEHOLDER_SRC)}set placeholderSrc(e){cR(this,fW.SRC,e)}get src(){return cI(this,fW.SRC)}set src(e){cR(this,fW.SRC,e)}constructor(){if(super(),!this.shadowRoot){this.attachShadow(this.constructor.shadowRootOptions);let e=cd(this.attributes);this.shadowRoot.innerHTML=this.constructor.getTemplateHTML(e)}this.image=this.shadowRoot.querySelector("#image")}}fq.shadowRootOptions={mode:"open"},fq.getTemplateHTML=function(e){return'\n    <style>\n      :host {\n        pointer-events: none;\n        display: var(--media-poster-image-display, inline-block);\n        box-sizing: border-box;\n      }\n\n      img {\n        max-width: 100%;\n        max-height: 100%;\n        min-width: 100%;\n        min-height: 100%;\n        background-repeat: no-repeat;\n        background-position: var(--media-poster-image-background-position, var(--media-object-position, center));\n        background-size: var(--media-poster-image-background-size, var(--media-object-fit, contain));\n        object-fit: var(--media-object-fit, contain);\n        object-position: var(--media-object-position, center);\n      }\n    </style>\n\n    <img part="poster img" aria-hidden="true" id="image"/>\n  '},ci.customElements.get("media-poster-image")||ci.customElements.define("media-poster-image",fq);var fY=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)};Ev=new WeakMap,ci.customElements.get("media-preview-chapter-display")||ci.customElements.define("media-preview-chapter-display",class extends fo{static get observedAttributes(){return[...super.observedAttributes,hM.MEDIA_PREVIEW_CHAPTER,hM.MEDIA_LANG]}attributeChangedCallback(e,t,i){if(super.attributeChangedCallback(e,t,i),(e===hM.MEDIA_PREVIEW_CHAPTER||e===hM.MEDIA_LANG)&&i!==t&&null!=i){var r;if((fY(this,Ev,"read from private field"),r?r.call(this):Ev.get(this)).textContent=i,""!==i){let e=h4("chapter: {chapterName}",{chapterName:i});this.setAttribute("aria-valuetext",e)}else this.removeAttribute("aria-valuetext")}}get mediaPreviewChapter(){return cI(this,hM.MEDIA_PREVIEW_CHAPTER)}set mediaPreviewChapter(e){cR(this,hM.MEDIA_PREVIEW_CHAPTER,e)}constructor(){super(),((e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)})(this,Ev,void 0),((e,t,i,r)=>(fY(e,t,"write to private field"),r?r.call(e,i):t.set(e,i)))(this,Ev,this.shadowRoot.querySelector("slot"))}});var fj=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},fQ=(e,t,i)=>(fj(e,t,"read from private field"),i?i.call(e):t.get(e)),fz=(e,t,i,r)=>(fj(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i);class fX extends ci.HTMLElement{static get observedAttributes(){return[hD.MEDIA_CONTROLLER,hM.MEDIA_PREVIEW_IMAGE,hM.MEDIA_PREVIEW_COORDS]}connectedCallback(){var e,t,i;let r=this.getAttribute(hD.MEDIA_CONTROLLER);r&&(fz(this,EE,null==(e=this.getRootNode())?void 0:e.getElementById(r)),null==(i=null==(t=fQ(this,EE))?void 0:t.associateElement)||i.call(t,this))}disconnectedCallback(){var e,t;null==(t=null==(e=fQ(this,EE))?void 0:e.unassociateElement)||t.call(e,this),fz(this,EE,null)}attributeChangedCallback(e,t,i){var r,a,n,s,o;[hM.MEDIA_PREVIEW_IMAGE,hM.MEDIA_PREVIEW_COORDS].includes(e)&&this.update(),e===hD.MEDIA_CONTROLLER&&(t&&(null==(a=null==(r=fQ(this,EE))?void 0:r.unassociateElement)||a.call(r,this),fz(this,EE,null)),i&&this.isConnected&&(fz(this,EE,null==(n=this.getRootNode())?void 0:n.getElementById(i)),null==(o=null==(s=fQ(this,EE))?void 0:s.associateElement)||o.call(s,this)))}get mediaPreviewImage(){return cI(this,hM.MEDIA_PREVIEW_IMAGE)}set mediaPreviewImage(e){cR(this,hM.MEDIA_PREVIEW_IMAGE,e)}get mediaPreviewCoords(){let e=this.getAttribute(hM.MEDIA_PREVIEW_COORDS);if(e)return e.split(/\s+/).map(e=>+e)}set mediaPreviewCoords(e){if(!e)return void this.removeAttribute(hM.MEDIA_PREVIEW_COORDS);this.setAttribute(hM.MEDIA_PREVIEW_COORDS,e.join(" "))}update(){let e=this.mediaPreviewCoords,t=this.mediaPreviewImage;if(!(e&&t))return;let[i,r,a,n]=e,s=t.split("#")[0],{maxWidth:o,maxHeight:l,minWidth:d,minHeight:u}=getComputedStyle(this),h=Math.min(parseInt(o)/a,parseInt(l)/n),c=Math.max(parseInt(d)/a,parseInt(u)/n),m=h<1,f=m?h:c>1?c:1,{style:p}=cy(this.shadowRoot,":host"),g=cy(this.shadowRoot,"img").style,E=this.shadowRoot.querySelector("img"),y=m?"min":"max";p.setProperty("".concat(y,"-width"),"initial","important"),p.setProperty("".concat(y,"-height"),"initial","important"),p.width="".concat(a*f,"px"),p.height="".concat(n*f,"px");let b=()=>{g.width="".concat(this.imgWidth*f,"px"),g.height="".concat(this.imgHeight*f,"px"),g.display="block"};E.src!==s&&(E.onload=()=>{this.imgWidth=E.naturalWidth,this.imgHeight=E.naturalHeight,b()},E.src=s,b()),b(),g.transform="translate(-".concat(i*f,"px, -").concat(r*f,"px)")}constructor(){if(super(),((e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)})(this,EE,void 0),!this.shadowRoot){this.attachShadow(this.constructor.shadowRootOptions);let e=cd(this.attributes);this.shadowRoot.innerHTML=this.constructor.getTemplateHTML(e)}}}EE=new WeakMap,fX.shadowRootOptions={mode:"open"},fX.getTemplateHTML=function(e){return'\n    <style>\n      :host {\n        box-sizing: border-box;\n        display: var(--media-control-display, var(--media-preview-thumbnail-display, inline-block));\n        overflow: hidden;\n      }\n\n      img {\n        display: none;\n        position: relative;\n      }\n    </style>\n    <img crossorigin loading="eager" decoding="async">\n  '},ci.customElements.get("media-preview-thumbnail")||ci.customElements.define("media-preview-thumbnail",fX);var fZ=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},fJ=(e,t,i)=>(fZ(e,t,"read from private field"),i?i.call(e):t.get(e));Ey=new WeakMap,ci.customElements.get("media-preview-time-display")||ci.customElements.define("media-preview-time-display",class extends fo{static get observedAttributes(){return[...super.observedAttributes,hM.MEDIA_PREVIEW_TIME]}attributeChangedCallback(e,t,i){super.attributeChangedCallback(e,t,i),e===hM.MEDIA_PREVIEW_TIME&&null!=i&&(fJ(this,Ey).textContent=h$(parseFloat(i)))}get mediaPreviewTime(){return cT(this,hM.MEDIA_PREVIEW_TIME)}set mediaPreviewTime(e){c_(this,hM.MEDIA_PREVIEW_TIME,e)}constructor(){super(),((e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)})(this,Ey,void 0),((e,t,i,r)=>(fZ(e,t,"write to private field"),r?r.call(e,i):t.set(e,i)))(this,Ey,this.shadowRoot.querySelector("slot")),fJ(this,Ey).textContent=h$(0)}});let f$={SEEK_OFFSET:"seekoffset"};class f0 extends mG{static get observedAttributes(){return[...super.observedAttributes,hM.MEDIA_CURRENT_TIME,f$.SEEK_OFFSET]}connectedCallback(){super.connectedCallback(),this.seekOffset=cT(this,f$.SEEK_OFFSET,30)}attributeChangedCallback(e,t,i){super.attributeChangedCallback(e,t,i),e===f$.SEEK_OFFSET&&(this.seekOffset=cT(this,f$.SEEK_OFFSET,30))}get seekOffset(){return cT(this,f$.SEEK_OFFSET,30)}set seekOffset(e){c_(this,f$.SEEK_OFFSET,e),this.setAttribute("aria-label",h4("seek back {seekOffset} seconds",{seekOffset:this.seekOffset})),cc(cm(this,"icon"),this.seekOffset)}get mediaCurrentTime(){return cT(this,hM.MEDIA_CURRENT_TIME,0)}set mediaCurrentTime(e){c_(this,hM.MEDIA_CURRENT_TIME,e)}handleClick(){let e=Math.max(this.mediaCurrentTime-this.seekOffset,0),t=new ci.CustomEvent(hL.MEDIA_SEEK_REQUEST,{composed:!0,bubbles:!0,detail:e});this.dispatchEvent(t)}}f0.getSlotTemplateHTML=function(e,t){let i;return'\n    <slot name="icon">'.concat((i=t.seekOffset,'\n  <svg aria-hidden="true" viewBox="0 0 20 24">\n    <defs>\n      <style>.text{font-size:8px;font-family:Arial-BoldMT, Arial;font-weight:700;}</style>\n    </defs>\n    <text class="text value" transform="translate(2.18 19.87)">'.concat(i,'</text>\n    <path d="M10 6V3L4.37 7 10 10.94V8a5.54 5.54 0 0 1 1.9 10.48v2.12A7.5 7.5 0 0 0 10 6Z"/>\n  </svg>')),"</slot>\n  ")},f0.getTooltipContentHTML=function(){return h4("Seek backward")},ci.customElements.get("media-seek-backward-button")||ci.customElements.define("media-seek-backward-button",f0);let f1={SEEK_OFFSET:"seekoffset"};class f2 extends mG{static get observedAttributes(){return[...super.observedAttributes,hM.MEDIA_CURRENT_TIME,f1.SEEK_OFFSET]}connectedCallback(){super.connectedCallback(),this.seekOffset=cT(this,f1.SEEK_OFFSET,30)}attributeChangedCallback(e,t,i){super.attributeChangedCallback(e,t,i),e===f1.SEEK_OFFSET&&(this.seekOffset=cT(this,f1.SEEK_OFFSET,30))}get seekOffset(){return cT(this,f1.SEEK_OFFSET,30)}set seekOffset(e){c_(this,f1.SEEK_OFFSET,e),this.setAttribute("aria-label",h4("seek forward {seekOffset} seconds",{seekOffset:this.seekOffset})),cc(cm(this,"icon"),this.seekOffset)}get mediaCurrentTime(){return cT(this,hM.MEDIA_CURRENT_TIME,0)}set mediaCurrentTime(e){c_(this,hM.MEDIA_CURRENT_TIME,e)}handleClick(){let e=this.mediaCurrentTime+this.seekOffset,t=new ci.CustomEvent(hL.MEDIA_SEEK_REQUEST,{composed:!0,bubbles:!0,detail:e});this.dispatchEvent(t)}}f2.getSlotTemplateHTML=function(e,t){let i;return'\n    <slot name="icon">'.concat((i=t.seekOffset,'\n  <svg aria-hidden="true" viewBox="0 0 20 24">\n    <defs>\n      <style>.text{font-size:8px;font-family:Arial-BoldMT, Arial;font-weight:700;}</style>\n    </defs>\n    <text class="text value" transform="translate(8.9 19.87)">'.concat(i,'</text>\n    <path d="M10 6V3l5.61 4L10 10.94V8a5.54 5.54 0 0 0-1.9 10.48v2.12A7.5 7.5 0 0 1 10 6Z"/>\n  </svg>')),"</slot>\n  ")},f2.getTooltipContentHTML=function(){return h4("Seek forward")},ci.customElements.get("media-seek-forward-button")||ci.customElements.define("media-seek-forward-button",f2);var f3=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},f4=(e,t,i)=>(f3(e,t,"read from private field"),i?i.call(e):t.get(e));let f5={REMAINING:"remaining",SHOW_DURATION:"showduration",NO_TOGGLE:"notoggle"},f8=[...Object.values(f5),hM.MEDIA_CURRENT_TIME,hM.MEDIA_DURATION,hM.MEDIA_SEEKABLE],f9=["Enter"," "],f6=function(e){var t,i;let{timesSep:r="&nbsp;/&nbsp;"}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=null!=(t=e.mediaCurrentTime)?t:0,[,n]=null!=(i=e.mediaSeekable)?i:[],s=0;Number.isFinite(e.mediaDuration)?s=e.mediaDuration:Number.isFinite(n)&&(s=n);let o=e.remaining?h$(0-(s-a)):h$(a);return e.showDuration?"".concat(o).concat(r).concat(h$(s)):o};class f7 extends fo{static get observedAttributes(){return[...super.observedAttributes,...f8,"disabled"]}connectedCallback(){let{style:e}=cy(this.shadowRoot,":host(:hover:not([notoggle]))");e.setProperty("cursor","var(--media-cursor, pointer)"),e.setProperty("background","var(--media-control-hover-background, rgba(50 50 70 / .7))"),this.hasAttribute("disabled")||this.enable(),this.setAttribute("role","progressbar"),this.setAttribute("aria-label",h4("playback time"));let t=e=>{let{key:i}=e;if(!f9.includes(i))return void this.removeEventListener("keyup",t);this.toggleTimeDisplay()};this.addEventListener("keydown",e=>{let{metaKey:i,altKey:r,key:a}=e;if(i||r||!f9.includes(a))return void this.removeEventListener("keyup",t);this.addEventListener("keyup",t)}),this.addEventListener("click",this.toggleTimeDisplay),super.connectedCallback()}toggleTimeDisplay(){this.noToggle||(this.hasAttribute("remaining")?this.removeAttribute("remaining"):this.setAttribute("remaining",""))}disconnectedCallback(){this.disable(),super.disconnectedCallback()}attributeChangedCallback(e,t,i){f8.includes(e)?this.update():"disabled"===e&&i!==t&&(null==i?this.enable():this.disable()),super.attributeChangedCallback(e,t,i)}enable(){this.tabIndex=0}disable(){this.tabIndex=-1}get remaining(){return cA(this,f5.REMAINING)}set remaining(e){cS(this,f5.REMAINING,e)}get showDuration(){return cA(this,f5.SHOW_DURATION)}set showDuration(e){cS(this,f5.SHOW_DURATION,e)}get noToggle(){return cA(this,f5.NO_TOGGLE)}set noToggle(e){cS(this,f5.NO_TOGGLE,e)}get mediaDuration(){return cT(this,hM.MEDIA_DURATION)}set mediaDuration(e){c_(this,hM.MEDIA_DURATION,e)}get mediaCurrentTime(){return cT(this,hM.MEDIA_CURRENT_TIME)}set mediaCurrentTime(e){c_(this,hM.MEDIA_CURRENT_TIME,e)}get mediaSeekable(){let e=this.getAttribute(hM.MEDIA_SEEKABLE);if(e)return e.split(":").map(e=>+e)}set mediaSeekable(e){if(null==e)return void this.removeAttribute(hM.MEDIA_SEEKABLE);this.setAttribute(hM.MEDIA_SEEKABLE,e.join(":"))}update(){let e=f6(this);(e=>{var t;let i=e.mediaCurrentTime,[,r]=null!=(t=e.mediaSeekable)?t:[],a=null;if(Number.isFinite(e.mediaDuration)?a=e.mediaDuration:Number.isFinite(r)&&(a=r),null==i||null===a)return e.setAttribute("aria-valuetext","video not loaded, unknown time.");let n=e.remaining?hJ(0-(a-i)):hJ(i);if(!e.showDuration)return e.setAttribute("aria-valuetext",n);let s=hJ(a),o="".concat(n," of ").concat(s);e.setAttribute("aria-valuetext",o)})(this),e!==f4(this,Eb).innerHTML&&(f4(this,Eb).innerHTML=e)}constructor(){super(),((e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)})(this,Eb,void 0),((e,t,i,r)=>(f3(e,t,"write to private field"),r?r.call(e,i):t.set(e,i)))(this,Eb,this.shadowRoot.querySelector("slot")),f4(this,Eb).innerHTML="".concat(f6(this))}}Eb=new WeakMap,f7.getSlotTemplateHTML=function(e,t){return"\n    <slot>".concat(f6(t),"</slot>\n  ")},ci.customElements.get("media-time-display")||ci.customElements.define("media-time-display",f7);var pe=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},pt=(e,t,i)=>(pe(e,t,"read from private field"),i?i.call(e):t.get(e)),pi=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},pr=(e,t,i,r)=>(pe(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i);class pa{start(){0===pt(this,ED)&&(pr(this,EA,performance.now()),pr(this,E_,pt(this,EA)),pr(this,EI,0),pt(this,Ew).call(this))}stop(){0!==pt(this,ED)&&(cancelAnimationFrame(pt(this,ED)),pr(this,ED,0))}update(e){let{start:t,duration:i,playbackRate:r}=e,a=t-pt(this,ET).valueAsNumber,n=Math.abs(i-this.duration);(a>0||a<-.03||n>=.5)&&this.callback(t),pr(this,Ek,t),pr(this,ER,performance.now()),this.duration=i,this.playbackRate=r}constructor(e,t,i){var r=this;pi(this,ET,void 0),pi(this,E_,void 0),pi(this,EA,void 0),pi(this,ES,void 0),pi(this,EI,void 0),pi(this,ER,void 0),pi(this,Ek,void 0),pi(this,EL,void 0),pi(this,ED,0),pi(this,Ew,function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:performance.now();pr(r,ED,requestAnimationFrame(pt(r,Ew))),pr(r,ES,performance.now()-pt(r,EA));let t=1e3/r.fps;if(pt(r,ES)>t){let i,a,n;pr(r,EA,e-pt(r,ES)%t);let s=1e3/((e-pt(r,E_))/++(i=EI,{set _(value){pr(r,i,value,a)},get _(){return pt(r,i,n)}})._),o=(e-pt(r,ER))/1e3/r.duration,l=pt(r,Ek)+o*r.playbackRate;l-pt(r,ET).valueAsNumber>0?pr(r,EL,r.playbackRate/r.duration/s):(pr(r,EL,.995*pt(r,EL)),l=pt(r,ET).valueAsNumber+pt(r,EL)),r.callback(l)}}),pr(this,ET,e),this.callback=t,this.fps=i}}ET=new WeakMap,E_=new WeakMap,EA=new WeakMap,ES=new WeakMap,EI=new WeakMap,ER=new WeakMap,Ek=new WeakMap,EL=new WeakMap,ED=new WeakMap,Ew=new WeakMap;var pn=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},ps=(e,t,i)=>(pn(e,t,"read from private field"),i?i.call(e):t.get(e)),po=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},pl=(e,t,i,r)=>(pn(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i),pd=(e,t,i)=>(pn(e,t,"access private method"),i);let pu=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.mediaCurrentTime,i=Number.isFinite(e.mediaSeekableStart)?e.mediaSeekableStart:0,r=Number.isFinite(e.mediaDuration)?e.mediaDuration:e.mediaSeekableEnd;return Number.isNaN(r)?0:Math.max(0,Math.min((t-i)/(r-i),1))},ph=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.range.valueAsNumber,i=Number.isFinite(e.mediaSeekableStart)?e.mediaSeekableStart:0,r=Number.isFinite(e.mediaDuration)?e.mediaDuration:e.mediaSeekableEnd;return Number.isNaN(r)?0:t*(r-i)+i};class pc extends m7{static get observedAttributes(){return[...super.observedAttributes,hM.MEDIA_PAUSED,hM.MEDIA_DURATION,hM.MEDIA_SEEKABLE,hM.MEDIA_CURRENT_TIME,hM.MEDIA_PREVIEW_IMAGE,hM.MEDIA_PREVIEW_TIME,hM.MEDIA_PREVIEW_CHAPTER,hM.MEDIA_BUFFERED,hM.MEDIA_PLAYBACK_RATE,hM.MEDIA_LOADING,hM.MEDIA_ENDED]}connectedCallback(){var e;super.connectedCallback(),this.range.setAttribute("aria-label",h4("seek")),pd(this,EH,EG).call(this),pl(this,EC,this.getRootNode()),null==(e=ps(this,EC))||e.addEventListener("transitionstart",this)}disconnectedCallback(){var e;super.disconnectedCallback(),pd(this,EH,EG).call(this),null==(e=ps(this,EC))||e.removeEventListener("transitionstart",this),pl(this,EC,null)}attributeChangedCallback(e,t,i){super.attributeChangedCallback(e,t,i),t!=i&&(e===hM.MEDIA_CURRENT_TIME||e===hM.MEDIA_PAUSED||e===hM.MEDIA_ENDED||e===hM.MEDIA_LOADING||e===hM.MEDIA_DURATION||e===hM.MEDIA_SEEKABLE?(ps(this,EM).update({start:pu(this),duration:this.mediaSeekableEnd-this.mediaSeekableStart,playbackRate:this.mediaPlaybackRate}),pd(this,EH,EG).call(this),(e=>{let t=e.range,i=hJ(+ph(e)),r=hJ(+e.mediaSeekableEnd),a=i&&r?"".concat(i," of ").concat(r):"video not loaded, unknown time.";t.setAttribute("aria-valuetext",a)})(this)):e===hM.MEDIA_BUFFERED&&this.updateBufferedBar(),(e===hM.MEDIA_DURATION||e===hM.MEDIA_SEEKABLE)&&(this.mediaChaptersCues=ps(this,EB),this.updateBar()))}get mediaChaptersCues(){return ps(this,EB)}set mediaChaptersCues(e){var t;pl(this,EB,e),this.updateSegments(null==(t=ps(this,EB))?void 0:t.map(e=>({start:pu(this,e.startTime),end:pu(this,e.endTime)})))}get mediaPaused(){return cA(this,hM.MEDIA_PAUSED)}set mediaPaused(e){cS(this,hM.MEDIA_PAUSED,e)}get mediaLoading(){return cA(this,hM.MEDIA_LOADING)}set mediaLoading(e){cS(this,hM.MEDIA_LOADING,e)}get mediaDuration(){return cT(this,hM.MEDIA_DURATION)}set mediaDuration(e){c_(this,hM.MEDIA_DURATION,e)}get mediaCurrentTime(){return cT(this,hM.MEDIA_CURRENT_TIME)}set mediaCurrentTime(e){c_(this,hM.MEDIA_CURRENT_TIME,e)}get mediaPlaybackRate(){return cT(this,hM.MEDIA_PLAYBACK_RATE,1)}set mediaPlaybackRate(e){c_(this,hM.MEDIA_PLAYBACK_RATE,e)}get mediaBuffered(){let e=this.getAttribute(hM.MEDIA_BUFFERED);return e?e.split(" ").map(e=>e.split(":").map(e=>+e)):[]}set mediaBuffered(e){if(!e)return void this.removeAttribute(hM.MEDIA_BUFFERED);let t=e.map(e=>e.join(":")).join(" ");this.setAttribute(hM.MEDIA_BUFFERED,t)}get mediaSeekable(){let e=this.getAttribute(hM.MEDIA_SEEKABLE);if(e)return e.split(":").map(e=>+e)}set mediaSeekable(e){if(null==e)return void this.removeAttribute(hM.MEDIA_SEEKABLE);this.setAttribute(hM.MEDIA_SEEKABLE,e.join(":"))}get mediaSeekableEnd(){var e;let[,t=this.mediaDuration]=null!=(e=this.mediaSeekable)?e:[];return t}get mediaSeekableStart(){var e;let[t=0]=null!=(e=this.mediaSeekable)?e:[];return t}get mediaPreviewImage(){return cI(this,hM.MEDIA_PREVIEW_IMAGE)}set mediaPreviewImage(e){cR(this,hM.MEDIA_PREVIEW_IMAGE,e)}get mediaPreviewTime(){return cT(this,hM.MEDIA_PREVIEW_TIME)}set mediaPreviewTime(e){c_(this,hM.MEDIA_PREVIEW_TIME,e)}get mediaEnded(){return cA(this,hM.MEDIA_ENDED)}set mediaEnded(e){cS(this,hM.MEDIA_ENDED,e)}updateBar(){super.updateBar(),this.updateBufferedBar(),this.updateCurrentBox()}updateBufferedBar(){var e;let t,i=this.mediaBuffered;if(!i.length)return;if(this.mediaEnded)t=1;else{let r=this.mediaCurrentTime,[,a=this.mediaSeekableStart]=null!=(e=i.find(e=>{let[t,i]=e;return t<=r&&r<=i}))?e:[];t=pu(this,a)}let{style:r}=cy(this.shadowRoot,"#buffered");r.setProperty("width","".concat(100*t,"%"))}updateCurrentBox(){if(!this.shadowRoot.querySelector('slot[name="current"]').assignedElements().length)return;let e=cy(this.shadowRoot,"#current-rail"),t=cy(this.shadowRoot,'[part~="current-box"]'),i=pd(this,Eq,EY).call(this,ps(this,EN)),r=pd(this,Ej,EQ).call(this,i,this.range.valueAsNumber),a=pd(this,Ez,EX).call(this,i,this.range.valueAsNumber);e.style.transform="translateX(".concat(r,")"),e.style.setProperty("--_range-width","".concat(i.range.width)),t.style.setProperty("--_box-shift","".concat(a)),t.style.setProperty("--_box-width","".concat(i.box.width,"px")),t.style.setProperty("visibility","initial")}handleEvent(e){switch(super.handleEvent(e),e.type){case"input":pd(this,E1,E2).call(this);break;case"pointermove":pd(this,EZ,EJ).call(this,e);break;case"pointerup":case"pointerleave":pd(this,E$,E0).call(this,null);break;case"transitionstart":cf(e.target,this)&&setTimeout(()=>pd(this,EH,EG).call(this),0)}}constructor(){super(),po(this,EH),po(this,EK),po(this,Eq),po(this,Ej),po(this,Ez),po(this,EZ),po(this,E$),po(this,E1),po(this,EC,void 0),po(this,EM,void 0),po(this,EO,void 0),po(this,EP,void 0),po(this,Ex,void 0),po(this,EN,void 0),po(this,EU,void 0),po(this,EF,void 0),po(this,EB,void 0),po(this,EW,e=>{this.dragging||(hQ(e)&&(this.range.valueAsNumber=e),this.updateBar())}),this.shadowRoot.querySelector("#track").insertAdjacentHTML("afterbegin",'<div id="buffered" part="buffered"></div>'),pl(this,EO,this.shadowRoot.querySelectorAll('[part~="box"]')),pl(this,Ex,this.shadowRoot.querySelector('[part~="preview-box"]')),pl(this,EN,this.shadowRoot.querySelector('[part~="current-box"]'));let e=getComputedStyle(this);pl(this,EU,parseInt(e.getPropertyValue("--media-box-padding-left"))),pl(this,EF,parseInt(e.getPropertyValue("--media-box-padding-right"))),pl(this,EM,new pa(this.range,ps(this,EW),60))}}EC=new WeakMap,EM=new WeakMap,EO=new WeakMap,EP=new WeakMap,Ex=new WeakMap,EN=new WeakMap,EU=new WeakMap,EF=new WeakMap,EB=new WeakMap,EH=new WeakSet,EG=function(){pd(this,EK,EV).call(this)?ps(this,EM).start():ps(this,EM).stop()},EK=new WeakSet,EV=function(){return this.isConnected&&!this.mediaPaused&&!this.mediaLoading&&!this.mediaEnded&&this.mediaSeekableEnd>0&&cE(this)},EW=new WeakMap,Eq=new WeakSet,EY=function(e){var t;let i=(null!=(t=this.getAttribute("bounds")?cp(this,"#".concat(this.getAttribute("bounds"))):this.parentElement)?t:this).getBoundingClientRect(),r=this.range.getBoundingClientRect(),a=e.offsetWidth,n=-(r.left-i.left-a/2),s=i.right-r.left-a/2;return{box:{width:a,min:n,max:s},bounds:i,range:r}},Ej=new WeakSet,EQ=function(e,t){let i="".concat(100*t,"%"),{width:r,min:a,max:n}=e.box;if(!r)return i;if(!Number.isNaN(a)){let e="calc(1 / var(--_range-width) * 100 * ".concat(a,"% + ").concat("var(--media-box-padding-left)",")");i="max(".concat(e,", ").concat(i,")")}if(!Number.isNaN(n)){let e="calc(1 / var(--_range-width) * 100 * ".concat(n,"% - ").concat("var(--media-box-padding-right)",")");i="min(".concat(i,", ").concat(e,")")}return i},Ez=new WeakSet,EX=function(e,t){let{width:i,min:r,max:a}=e.box,n=t*e.range.width;if(n<r+ps(this,EU)){let t=e.range.left-e.bounds.left-ps(this,EU);return"".concat(n-i/2+t,"px")}if(n>a-ps(this,EF)){let t=e.bounds.right-e.range.right-ps(this,EF);return"".concat(n+i/2-t-e.range.width,"px")}return 0},EZ=new WeakSet,EJ=function(e){let t=[...ps(this,EO)].some(t=>e.composedPath().includes(t));if(!this.dragging&&(t||!e.composedPath().includes(this)))return void pd(this,E$,E0).call(this,null);let i=this.mediaSeekableEnd;if(!i)return;let r=cy(this.shadowRoot,"#preview-rail"),a=cy(this.shadowRoot,'[part~="preview-box"]'),n=pd(this,Eq,EY).call(this,ps(this,Ex)),s=(e.clientX-n.range.left)/n.range.width;s=Math.max(0,Math.min(1,s));let o=pd(this,Ej,EQ).call(this,n,s),l=pd(this,Ez,EX).call(this,n,s);r.style.transform="translateX(".concat(o,")"),r.style.setProperty("--_range-width","".concat(n.range.width)),a.style.setProperty("--_box-shift","".concat(l)),a.style.setProperty("--_box-width","".concat(n.box.width,"px")),1>Math.abs(Math.round(ps(this,EP))-Math.round(s*i))&&s>.01&&s<.99||(pl(this,EP,s*i),pd(this,E$,E0).call(this,ps(this,EP)))},E$=new WeakSet,E0=function(e){this.dispatchEvent(new ci.CustomEvent(hL.MEDIA_PREVIEW_REQUEST,{composed:!0,bubbles:!0,detail:e}))},E1=new WeakSet,E2=function(){ps(this,EM).stop();let e=ph(this);this.dispatchEvent(new ci.CustomEvent(hL.MEDIA_SEEK_REQUEST,{composed:!0,bubbles:!0,detail:e}))},pc.shadowRootOptions={mode:"open"},pc.getTemplateHTML=function(e){return"\n    ".concat(m7.getTemplateHTML(e),"\n    <style>\n      :host {\n        --media-box-border-radius: 4px;\n        --media-box-padding-left: 10px;\n        --media-box-padding-right: 10px;\n        --media-preview-border-radius: var(--media-box-border-radius);\n        --media-box-arrow-offset: var(--media-box-border-radius);\n        --_control-background: var(--media-control-background, var(--media-secondary-color, rgb(20 20 30 / .7)));\n        --_preview-background: var(--media-preview-background, var(--_control-background));\n\n        ",'\n        contain: layout;\n      }\n\n      #buffered {\n        background: var(--media-time-range-buffered-color, rgb(255 255 255 / .4));\n        position: absolute;\n        height: 100%;\n        will-change: width;\n      }\n\n      #preview-rail,\n      #current-rail {\n        width: 100%;\n        position: absolute;\n        left: 0;\n        bottom: 100%;\n        pointer-events: none;\n        will-change: transform;\n      }\n\n      [part~="box"] {\n        width: min-content;\n        ','\n        position: absolute;\n        bottom: 100%;\n        flex-direction: column;\n        align-items: center;\n        transform: translateX(-50%);\n      }\n\n      [part~="current-box"] {\n        display: var(--media-current-box-display, var(--media-box-display, flex));\n        margin: var(--media-current-box-margin, var(--media-box-margin, 0 0 5px));\n        visibility: hidden;\n      }\n\n      [part~="preview-box"] {\n        display: var(--media-preview-box-display, var(--media-box-display, flex));\n        margin: var(--media-preview-box-margin, var(--media-box-margin, 0 0 5px));\n        transition-property: var(--media-preview-transition-property, visibility, opacity);\n        transition-duration: var(--media-preview-transition-duration-out, .25s);\n        transition-delay: var(--media-preview-transition-delay-out, 0s);\n        visibility: hidden;\n        opacity: 0;\n      }\n\n      :host(:is([').concat(hM.MEDIA_PREVIEW_IMAGE,"], [").concat(hM.MEDIA_PREVIEW_TIME,'])[dragging]) [part~="preview-box"] {\n        transition-duration: var(--media-preview-transition-duration-in, .5s);\n        transition-delay: var(--media-preview-transition-delay-in, .25s);\n        visibility: visible;\n        opacity: 1;\n      }\n\n      @media (hover: hover) {\n        :host(:is([').concat(hM.MEDIA_PREVIEW_IMAGE,"], [").concat(hM.MEDIA_PREVIEW_TIME,']):hover) [part~="preview-box"] {\n          transition-duration: var(--media-preview-transition-duration-in, .5s);\n          transition-delay: var(--media-preview-transition-delay-in, .25s);\n          visibility: visible;\n          opacity: 1;\n        }\n      }\n\n      media-preview-thumbnail,\n      ::slotted(media-preview-thumbnail) {\n        visibility: hidden;\n        ',"\n        transition: visibility 0s .25s;\n        transition-delay: calc(var(--media-preview-transition-delay-out, 0s) + var(--media-preview-transition-duration-out, .25s));\n        background: var(--media-preview-thumbnail-background, var(--_preview-background));\n        box-shadow: var(--media-preview-thumbnail-box-shadow, 0 0 4px rgb(0 0 0 / .2));\n        max-width: var(--media-preview-thumbnail-max-width, 180px);\n        max-height: var(--media-preview-thumbnail-max-height, 160px);\n        min-width: var(--media-preview-thumbnail-min-width, 120px);\n        min-height: var(--media-preview-thumbnail-min-height, 80px);\n        border: var(--media-preview-thumbnail-border);\n        border-radius: var(--media-preview-thumbnail-border-radius,\n          var(--media-preview-border-radius) var(--media-preview-border-radius) 0 0);\n      }\n\n      :host([").concat(hM.MEDIA_PREVIEW_IMAGE,"][dragging]) media-preview-thumbnail,\n      :host([").concat(hM.MEDIA_PREVIEW_IMAGE,"][dragging]) ::slotted(media-preview-thumbnail) {\n        transition-delay: var(--media-preview-transition-delay-in, .25s);\n        visibility: visible;\n      }\n\n      @media (hover: hover) {\n        :host([").concat(hM.MEDIA_PREVIEW_IMAGE,"]:hover) media-preview-thumbnail,\n        :host([").concat(hM.MEDIA_PREVIEW_IMAGE,"]:hover) ::slotted(media-preview-thumbnail) {\n          transition-delay: var(--media-preview-transition-delay-in, .25s);\n          visibility: visible;\n        }\n\n        :host([").concat(hM.MEDIA_PREVIEW_TIME,"]:hover) {\n          --media-time-range-hover-display: block;\n        }\n      }\n\n      media-preview-chapter-display,\n      ::slotted(media-preview-chapter-display) {\n        font-size: var(--media-font-size, 13px);\n        line-height: 17px;\n        min-width: 0;\n        visibility: hidden;\n        ","\n        transition: min-width 0s, border-radius 0s, margin 0s, padding 0s, visibility 0s;\n        transition-delay: calc(var(--media-preview-transition-delay-out, 0s) + var(--media-preview-transition-duration-out, .25s));\n        background: var(--media-preview-chapter-background, var(--_preview-background));\n        border-radius: var(--media-preview-chapter-border-radius,\n          var(--media-preview-border-radius) var(--media-preview-border-radius)\n          var(--media-preview-border-radius) var(--media-preview-border-radius));\n        padding: var(--media-preview-chapter-padding, 3.5px 9px);\n        margin: var(--media-preview-chapter-margin, 0 0 5px);\n        text-shadow: var(--media-preview-chapter-text-shadow, 0 0 4px rgb(0 0 0 / .75));\n      }\n\n      :host([").concat(hM.MEDIA_PREVIEW_IMAGE,"]) media-preview-chapter-display,\n      :host([").concat(hM.MEDIA_PREVIEW_IMAGE,"]) ::slotted(media-preview-chapter-display) {\n        transition-delay: var(--media-preview-transition-delay-in, .25s);\n        border-radius: var(--media-preview-chapter-border-radius, 0);\n        padding: var(--media-preview-chapter-padding, 3.5px 9px 0);\n        margin: var(--media-preview-chapter-margin, 0);\n        min-width: 100%;\n      }\n\n      media-preview-chapter-display[").concat(hM.MEDIA_PREVIEW_CHAPTER,"],\n      ::slotted(media-preview-chapter-display[").concat(hM.MEDIA_PREVIEW_CHAPTER,"]) {\n        visibility: visible;\n      }\n\n      media-preview-chapter-display:not([aria-valuetext]),\n      ::slotted(media-preview-chapter-display:not([aria-valuetext])) {\n        display: none;\n      }\n\n      media-preview-time-display,\n      ::slotted(media-preview-time-display),\n      media-time-display,\n      ::slotted(media-time-display) {\n        font-size: var(--media-font-size, 13px);\n        line-height: 17px;\n        min-width: 0;\n        ","\n        transition: min-width 0s, border-radius 0s;\n        transition-delay: calc(var(--media-preview-transition-delay-out, 0s) + var(--media-preview-transition-duration-out, .25s));\n        background: var(--media-preview-time-background, var(--_preview-background));\n        border-radius: var(--media-preview-time-border-radius,\n          var(--media-preview-border-radius) var(--media-preview-border-radius)\n          var(--media-preview-border-radius) var(--media-preview-border-radius));\n        padding: var(--media-preview-time-padding, 3.5px 9px);\n        margin: var(--media-preview-time-margin, 0);\n        text-shadow: var(--media-preview-time-text-shadow, 0 0 4px rgb(0 0 0 / .75));\n        transform: translateX(min(\n          max(calc(50% - var(--_box-width) / 2),\n          calc(var(--_box-shift, 0))),\n          calc(var(--_box-width) / 2 - 50%)\n        ));\n      }\n\n      :host([").concat(hM.MEDIA_PREVIEW_IMAGE,"]) media-preview-time-display,\n      :host([").concat(hM.MEDIA_PREVIEW_IMAGE,"]) ::slotted(media-preview-time-display) {\n        transition-delay: var(--media-preview-transition-delay-in, .25s);\n        border-radius: var(--media-preview-time-border-radius,\n          0 0 var(--media-preview-border-radius) var(--media-preview-border-radius));\n        min-width: 100%;\n      }\n\n      :host([").concat(hM.MEDIA_PREVIEW_TIME,']:hover) {\n        --media-time-range-hover-display: block;\n      }\n\n      [part~="arrow"],\n      ::slotted([part~="arrow"]) {\n        display: var(--media-box-arrow-display, inline-block);\n        transform: translateX(min(\n          max(calc(50% - var(--_box-width) / 2 + var(--media-box-arrow-offset)),\n          calc(var(--_box-shift, 0))),\n          calc(var(--_box-width) / 2 - 50% - var(--media-box-arrow-offset))\n        ));\n        ','\n        border-color: transparent;\n        border-top-color: var(--media-box-arrow-background, var(--_control-background));\n        border-width: var(--media-box-arrow-border-width,\n          var(--media-box-arrow-height, 5px) var(--media-box-arrow-width, 6px) 0);\n        border-style: solid;\n        justify-content: center;\n        height: 0;\n      }\n    </style>\n    <div id="preview-rail">\n      <slot name="preview" part="box preview-box">\n        <media-preview-thumbnail>\n          <template shadowrootmode="').concat(fX.shadowRootOptions.mode,'">\n            ').concat(fX.getTemplateHTML({}),'\n          </template>\n        </media-preview-thumbnail>\n        <media-preview-chapter-display></media-preview-chapter-display>\n        <media-preview-time-display></media-preview-time-display>\n        <slot name="preview-arrow"><div part="arrow"></div></slot>\n      </slot>\n    </div>\n    <div id="current-rail">\n      <slot name="current" part="box current-box">\n        ',"\n      </slot>\n    </div>\n  ")},ci.customElements.get("media-time-range")||ci.customElements.define("media-time-range",pc),ci.customElements.get("media-volume-range")||ci.customElements.define("media-volume-range",class extends m7{static get observedAttributes(){return[...super.observedAttributes,hM.MEDIA_VOLUME,hM.MEDIA_MUTED,hM.MEDIA_VOLUME_UNAVAILABLE]}connectedCallback(){super.connectedCallback(),this.range.setAttribute("aria-label",h4("volume"))}attributeChangedCallback(e,t,i){if(super.attributeChangedCallback(e,t,i),e===hM.MEDIA_VOLUME||e===hM.MEDIA_MUTED){let e;this.range.valueAsNumber=this.mediaMuted?0:this.mediaVolume,this.range.setAttribute("aria-valuetext",(e=this.range.valueAsNumber,"".concat(Math.round(100*e),"%"))),this.updateBar()}}get mediaVolume(){return cT(this,hM.MEDIA_VOLUME,1)}set mediaVolume(e){c_(this,hM.MEDIA_VOLUME,e)}get mediaMuted(){return cA(this,hM.MEDIA_MUTED)}set mediaMuted(e){cS(this,hM.MEDIA_MUTED,e)}get mediaVolumeUnavailable(){return cI(this,hM.MEDIA_VOLUME_UNAVAILABLE)}set mediaVolumeUnavailable(e){cR(this,hM.MEDIA_VOLUME_UNAVAILABLE,e)}constructor(){super(),this.range.addEventListener("input",()=>{let e=this.range.value,t=new ci.CustomEvent(hL.MEDIA_VOLUME_REQUEST,{composed:!0,bubbles:!0,detail:e});this.dispatchEvent(t)})}});var pm=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},pf=(e,t,i)=>(pm(e,t,"read from private field"),i?i.call(e):t.get(e)),pp=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},pg=(e,t,i,r)=>(pm(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i);let pv={processCallback(e,t,i){if(i){for(let[e,r]of t)if(e in i){let t=i[e];"boolean"==typeof t&&r instanceof pI&&"boolean"==typeof r.element[r.attributeName]?r.booleanValue=t:"function"==typeof t&&r instanceof pI?r.element[r.attributeName]=t:r.value=t}}}};class pE extends ci.DocumentFragment{update(e){pf(this,E4).processCallback(this,pf(this,E3),e)}constructor(e,t,i=pv){var r;super(),pp(this,E3,void 0),pp(this,E4,void 0),this.append(e.content.cloneNode(!0)),pg(this,E3,py(this)),pg(this,E4,i),null==(r=i.createCallback)||r.call(i,this,pf(this,E3),t),i.processCallback(this,pf(this,E3),t)}}E3=new WeakMap,E4=new WeakMap;let py=function(e){let t,i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];for(let a of e.attributes||[])if(a.value.includes("{{")){let n=new pS;for([t,i]of pT(a.value))if(t){let t=new pI(e,a.name,a.namespaceURI);n.append(t),r.push([i,t])}else n.append(i);a.value=n.toString()}for(let a of e.childNodes)if(1!==a.nodeType||a instanceof HTMLTemplateElement){let n=a.data;if(1===a.nodeType||n.includes("{{")){let s=[];if(n)for([t,i]of pT(n))if(t){let t=new pR(e);s.push(t),r.push([i,t])}else s.push(new Text(i));else if(a instanceof HTMLTemplateElement){let t=new pk(e,a);s.push(t),r.push([t.expression,t])}a.replaceWith(...s.flatMap(e=>e.replacementNodes||[e]))}}else py(a,r);return r},pb={},pT=e=>{let t="",i=0,r=pb[e],a=0,n;if(r)return r;for(r=[];n=e[a];a++)"{"===n&&"{"===e[a+1]&&"\\"!==e[a-1]&&e[a+2]&&1==++i?(t&&r.push([0,t]),t="",a++):"}"!==n||"}"!==e[a+1]||"\\"===e[a-1]||--i?t+=n||"":(r.push([1,t.trim()]),t="",a++);return t&&r.push([0,(i>0?"{{":"")+t]),pb[e]=r};class p_{get value(){return""}set value(e){}toString(){return this.value}}let pA=new WeakMap;class pS{[Symbol.iterator](){return pf(this,E5).values()}get length(){return pf(this,E5).length}item(e){return pf(this,E5)[e]}append(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];for(let e of t)e instanceof pI&&pA.set(e,this),pf(this,E5).push(e)}toString(){return pf(this,E5).join("")}constructor(){pp(this,E5,[])}}E5=new WeakMap;class pI extends p_{get attributeName(){return pf(this,E6)}get attributeNamespace(){return pf(this,E7)}get element(){return pf(this,E9)}get value(){return pf(this,E8)}set value(e){pf(this,E8)!==e&&(pg(this,E8,e),pf(this,ye,yt)&&1!==pf(this,ye,yt).length?pf(this,E9).setAttributeNS(pf(this,E7),pf(this,E6),pf(this,ye,yt).toString()):null==e?pf(this,E9).removeAttributeNS(pf(this,E7),pf(this,E6)):pf(this,E9).setAttributeNS(pf(this,E7),pf(this,E6),e))}get booleanValue(){return pf(this,E9).hasAttributeNS(pf(this,E7),pf(this,E6))}set booleanValue(e){if(pf(this,ye,yt)&&1!==pf(this,ye,yt).length)throw new DOMException("Value is not fully templatized");this.value=e?"":null}constructor(e,t,i){super(),pp(this,ye),pp(this,E8,""),pp(this,E9,void 0),pp(this,E6,void 0),pp(this,E7,void 0),pg(this,E9,e),pg(this,E6,t),pg(this,E7,i)}}E8=new WeakMap,E9=new WeakMap,E6=new WeakMap,E7=new WeakMap,ye=new WeakSet,yt=function(){return pA.get(this)};class pR extends p_{get replacementNodes(){return pf(this,yr)}get parentNode(){return pf(this,yi)}get nextSibling(){return pf(this,yr)[pf(this,yr).length-1].nextSibling}get previousSibling(){return pf(this,yr)[0].previousSibling}get value(){return pf(this,yr).map(e=>e.textContent).join("")}set value(e){this.replace(e)}replace(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];let r=t.flat().flatMap(e=>null==e?[new Text]:e.forEach?[...e]:11===e.nodeType?[...e.childNodes]:e.nodeType?[e]:[new Text(e)]);r.length||r.push(new Text),pg(this,yr,function(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=0,n,s,o,l=i.length,d=t.length;for(;a<l&&a<d&&t[a]==i[a];)a++;for(;a<l&&a<d&&i[l-1]==t[d-1];)r=i[--d,--l];if(a==d)for(;a<l;)e.insertBefore(i[a++],r);if(a==l)for(;a<d;)e.removeChild(t[a++]);else{for(n=t[a];a<l;)o=i[a++],s=n?n.nextSibling:r,n==o?n=s:a<l&&i[a]==s?(e.replaceChild(o,n),n=s):e.insertBefore(o,n);for(;n!=r;)s=n.nextSibling,e.removeChild(n),n=s}return i}(pf(this,yr)[0].parentNode,pf(this,yr),r,this.nextSibling))}constructor(e,t){super(),pp(this,yi,void 0),pp(this,yr,void 0),pg(this,yi,e),pg(this,yr,t?[...t]:[new Text])}}yi=new WeakMap,yr=new WeakMap;class pk extends pR{constructor(e,t){let i=t.getAttribute("directive")||t.getAttribute("type"),r=t.getAttribute("expression")||t.getAttribute(i)||"";r.startsWith("{{")&&(r=r.trim().slice(2,-2).trim()),super(e),this.expression=r,this.template=t,this.directive=i}}let pL={string:e=>String(e)};class pD{constructor(e){this.template=e,this.state=void 0}}let pw=new WeakMap,pC=new WeakMap,pM={partial:(e,t)=>{t[e.expression]=new pD(e.template)},if:(e,t)=>{var i;if(pN(e.expression,t))if(pw.get(e)!==e.template){pw.set(e,e.template);let i=new pE(e.template,t,pP);e.replace(i),pC.set(e,i)}else null==(i=pC.get(e))||i.update(t);else e.replace(""),pw.delete(e),pC.delete(e)}},pO=Object.keys(pM),pP={processCallback(e,t,i){var r,a;if(i)for(let[e,n]of t){if(n instanceof pk){if(!n.directive){let e=pO.find(e=>n.template.hasAttribute(e));e&&(n.directive=e,n.expression=n.template.getAttribute(e))}null==(r=pM[n.directive])||r.call(pM,n,i);continue}let t=pN(e,i);if(t instanceof pD){pw.get(n)!==t.template?(pw.set(n,t.template),n.value=t=new pE(t.template,t.state,pP),pC.set(n,t)):null==(a=pC.get(n))||a.update(t.state);continue}t?(n instanceof pI&&n.attributeName.startsWith("aria-")&&(t=String(t)),n instanceof pI?"boolean"==typeof t?n.booleanValue=t:"function"==typeof t?n.element[n.attributeName]=t:n.value=t:(n.value=t,pw.delete(n),pC.delete(n))):n instanceof pI?n.value=void 0:(n.value=void 0,pw.delete(n),pC.delete(n))}}},px={"!":e=>!e,"!!":e=>!!e,"==":(e,t)=>e==t,"!=":(e,t)=>e!=t,">":(e,t)=>e>t,">=":(e,t)=>e>=t,"<":(e,t)=>e<t,"<=":(e,t)=>e<=t,"??":(e,t)=>null!=e?e:t,"|":(e,t)=>{var i;return null==(i=pL[t])?void 0:i.call(pL,e)}};function pN(e){var t,i,r,a,n,s,o;let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},d=(function(e,t){let i,r,a,n=[];for(;e;){for(let n in a=null,i=e.length,t)(r=t[n].exec(e))&&r.index<i&&(a={token:r[0],type:n,matches:r.slice(1)},i=r.index);i&&n.push({token:e.substr(0,i),type:void 0}),a&&n.push(a),e=e.substr(i+(a?a.token.length:0))}return n})(e,{boolean:/true|false/,number:/-?\d+\.?\d*/,string:/(["'])((?:\\.|[^\\])*?)\1/,operator:/[!=><][=!]?|\?\?|\|/,ws:/\s+/,param:/[$a-z_][$\w]*/i}).filter(e=>{let{type:t}=e;return"ws"!==t});if(0===d.length||d.some(e=>{let{type:t}=e;return!t}))return pU(e);if((null==(t=d[0])?void 0:t.token)===">"){let t=l[null==(i=d[1])?void 0:i.token];if(!t)return pU(e);let s={...l};t.state=s;let o=d.slice(2);for(let e=0;e<o.length;e+=3){let t=null==(r=o[e])?void 0:r.token,i=null==(a=o[e+1])?void 0:a.token,d=null==(n=o[e+2])?void 0:n.token;t&&"="===i&&(s[t]=pB(d,l))}return t}if(1===d.length)return pF(d[0])?pB(d[0].token,l):pU(e);if(2===d.length){let t=px[null==(s=d[0])?void 0:s.token];return t&&pF(d[1])?t(pB(d[1].token,l)):pU(e)}if(3===d.length){let t=null==(o=d[1])?void 0:o.token,i=px[t];if(!i||!pF(d[0])||!pF(d[2]))return pU(e);let r=pB(d[0].token,l);return i(r,"|"===t?d[2].token:pB(d[2].token,l))}}function pU(e){return console.warn("Warning: invalid expression `".concat(e,"`")),!1}function pF(e){let{type:t}=e;return["number","boolean","string","param"].includes(t)}function pB(e,t){let i=e[0],r=e.slice(-1);return"true"===e||"false"===e?"true"===e:i===r&&["'",'"'].includes(i)?e.slice(1,-1):hz(e)?parseFloat(e):t[e]}var pH=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},pG=(e,t,i)=>(pH(e,t,"read from private field"),i?i.call(e):t.get(e)),pK=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},pV=(e,t,i,r)=>(pH(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i),pW=(e,t,i)=>(pH(e,t,"access private method"),i);let pq={mediatargetlivewindow:"targetlivewindow",mediastreamtype:"streamtype"},pY=cr.createElement("template");pY.innerHTML="\n  <style>\n    :host {\n      display: inline-block;\n      line-height: 0;\n    }\n\n    media-controller {\n      width: 100%;\n      height: 100%;\n    }\n\n    media-captions-button:not([mediasubtitleslist]),\n    media-captions-menu:not([mediasubtitleslist]),\n    media-captions-menu-button:not([mediasubtitleslist]),\n    media-audio-track-menu[mediaaudiotrackunavailable],\n    media-audio-track-menu-button[mediaaudiotrackunavailable],\n    media-rendition-menu[mediarenditionunavailable],\n    media-rendition-menu-button[mediarenditionunavailable],\n    media-volume-range[mediavolumeunavailable],\n    media-airplay-button[mediaairplayunavailable],\n    media-fullscreen-button[mediafullscreenunavailable],\n    media-cast-button[mediacastunavailable],\n    media-pip-button[mediapipunavailable] {\n      display: none;\n    }\n  </style>\n";class pj extends ci.HTMLElement{get mediaController(){return this.renderRoot.querySelector("media-controller")}get template(){var e;return null!=(e=pG(this,ya))?e:this.constructor.template}set template(e){if(null===e)return void this.removeAttribute("template");"string"==typeof e?this.setAttribute("template",e):e instanceof HTMLTemplateElement&&(pV(this,ya,e),pV(this,ys,null),this.createRenderer())}get props(){var e,t,i;let r=[...Array.from(null!=(t=null==(e=this.mediaController)?void 0:e.attributes)?t:[]).filter(e=>{let{name:t}=e;return pq[t]||t.startsWith("breakpoint")}),...Array.from(this.attributes)],a={};for(let e of r){let t=null!=(i=pq[e.name])?i:e.name.replace(/[-_]([a-z])/g,(e,t)=>t.toUpperCase()),{value:r}=e;null!=r?(hz(r)&&(r=parseFloat(r)),a[t]=""===r||r):a[t]=!1}return a}attributeChangedCallback(e,t,i){"template"===e&&t!=i&&pW(this,yd,yu).call(this)}connectedCallback(){pW(this,yd,yu).call(this)}createRenderer(){this.template instanceof HTMLTemplateElement&&this.template!==pG(this,yn)&&(pV(this,yn,this.template),this.renderer=new pE(this.template,this.props,this.constructor.processor),this.renderRoot.textContent="",this.renderRoot.append(pY.content.cloneNode(!0),this.renderer))}render(){var e;null==(e=this.renderer)||e.update(this.props)}constructor(){super(),pK(this,yo),pK(this,yd),pK(this,ya,void 0),pK(this,yn,void 0),pK(this,ys,void 0),this.shadowRoot?this.renderRoot=this.shadowRoot:(this.renderRoot=this.attachShadow({mode:"open"}),this.createRenderer());let e=new MutationObserver(e=>{var t;(!this.mediaController||(null==(t=this.mediaController)?void 0:t.breakpointsComputed))&&e.some(e=>{let t=e.target;return t===this||"media-controller"===t.localName&&!!(pq[e.attributeName]||e.attributeName.startsWith("breakpoint"))})&&this.render()});e.observe(this,{attributes:!0}),e.observe(this.renderRoot,{attributes:!0,subtree:!0}),this.addEventListener(hO.BREAKPOINTS_COMPUTED,this.render),pW(this,yo,yl).call(this,"template")}}async function pQ(e){let t=await fetch(e);if(200!==t.status)throw Error("Failed to load resource: the server responded with a status of ".concat(t.status));return t.text()}function pz(e){return e.split("-")[0]}ya=new WeakMap,yn=new WeakMap,ys=new WeakMap,yo=new WeakSet,yl=function(e){if(Object.prototype.hasOwnProperty.call(this,e)){let t=this[e];delete this[e],this[e]=t}},yd=new WeakSet,yu=function(){var e;let t=this.getAttribute("template");if(!t||t===pG(this,ys))return;let i=this.getRootNode(),r=null==(e=null==i?void 0:i.getElementById)?void 0:e.call(i,t);if(r){pV(this,ys,t),pV(this,ya,r),this.createRenderer();return}(function(e){if(!/^(\/|\.\/|https?:\/\/)/.test(e))return!1;let t=/^https?:\/\//.test(e)?void 0:location.origin;try{new URL(e,t)}catch(e){return!1}return!0})(t)&&(pV(this,ys,t),pQ(t).then(e=>{let t=cr.createElement("template");t.innerHTML=e,pV(this,ya,t),this.createRenderer()}).catch(console.error))},pj.observedAttributes=["template"],pj.processor=pP,ci.customElements.get("media-theme")||ci.customElements.define("media-theme",pj);class pX extends Event{constructor({action:e="auto",relatedTarget:t,...i}){super("invoke",i),this.action=e,this.relatedTarget=t}}class pZ extends Event{constructor({newState:e,oldState:t,...i}){super("toggle",i),this.newState=e,this.oldState=t}}var pJ=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},p$=(e,t,i)=>(pJ(e,t,"read from private field"),i?i.call(e):t.get(e)),p0=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},p1=(e,t,i,r)=>(pJ(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i),p2=(e,t,i)=>(pJ(e,t,"access private method"),i);function p3(e){let{type:t,text:i,value:r,checked:a}=e,n=cr.createElement("media-chrome-menu-item");n.type=null!=t?t:"",n.part.add("menu-item"),t&&n.part.add(t),n.value=r,n.checked=a;let s=cr.createElement("span");return s.textContent=i,n.append(s),n}function p4(e,t){let i=e.querySelector(':scope > [slot="'.concat(t,'"]'));if((null==i?void 0:i.nodeName)=="SLOT"&&(i=i.assignedElements({flatten:!0})[0]),i)return i.cloneNode(!0);let r=e.shadowRoot.querySelector('[name="'.concat(t,'"] > svg'));return r?r.cloneNode(!0):""}let p5={STYLE:"style",HIDDEN:"hidden",DISABLED:"disabled",ANCHOR:"anchor"};class p8 extends ci.HTMLElement{static get observedAttributes(){return[p5.DISABLED,p5.HIDDEN,p5.STYLE,p5.ANCHOR,hD.MEDIA_CONTROLLER]}static formatMenuItemText(e,t){return e}enable(){this.addEventListener("click",this),this.addEventListener("focusout",this),this.addEventListener("keydown",this),this.addEventListener("invoke",this),this.addEventListener("toggle",this)}disable(){this.removeEventListener("click",this),this.removeEventListener("focusout",this),this.removeEventListener("keyup",this),this.removeEventListener("invoke",this),this.removeEventListener("toggle",this)}handleEvent(e){switch(e.type){case"slotchange":p2(this,yE,yy).call(this,e);break;case"invoke":p2(this,yI,yR).call(this,e);break;case"click":p2(this,yU,yF).call(this,e);break;case"toggle":p2(this,yG,yK).call(this,e);break;case"focusout":p2(this,yq,yY).call(this,e);break;case"keydown":p2(this,yj,yQ).call(this,e)}}connectedCallback(){var e,t;p1(this,yv,cb(this.shadowRoot,":host")),p2(this,yA,yS).call(this),this.hasAttribute("disabled")||this.enable(),this.role||(this.role="menu"),p1(this,yh,ch(this)),null==(t=null==(e=p$(this,yh))?void 0:e.associateElement)||t.call(e,this),this.hidden||(co(p6(this),p$(this,yC)),co(this,p$(this,yM))),p2(this,yb,yT).call(this)}disconnectedCallback(){var e,t;cl(p6(this),p$(this,yC)),cl(this,p$(this,yM)),this.disable(),null==(t=null==(e=p$(this,yh))?void 0:e.unassociateElement)||t.call(e,this),p1(this,yh,null)}attributeChangedCallback(e,t,i){var r,a,n,s;e===p5.HIDDEN&&i!==t?(p$(this,yg)||p1(this,yg,!0),this.hidden?p2(this,yD,yw).call(this):p2(this,yk,yL).call(this),this.dispatchEvent(new pZ({oldState:this.hidden?"open":"closed",newState:this.hidden?"closed":"open",bubbles:!0}))):e===hD.MEDIA_CONTROLLER?(t&&(null==(a=null==(r=p$(this,yh))?void 0:r.unassociateElement)||a.call(r,this),p1(this,yh,null)),i&&this.isConnected&&(p1(this,yh,ch(this)),null==(s=null==(n=p$(this,yh))?void 0:n.associateElement)||s.call(n,this))):e===p5.DISABLED&&i!==t?null==i?this.enable():this.disable():e===p5.STYLE&&i!==t&&p2(this,yA,yS).call(this)}formatMenuItemText(e,t){return this.constructor.formatMenuItemText(e,t)}get anchor(){return this.getAttribute("anchor")}set anchor(e){this.setAttribute("anchor","".concat(e))}get anchorElement(){var e;return this.anchor?null==(e=cv(this))?void 0:e.querySelector("#".concat(this.anchor)):null}get items(){return this.defaultSlot.assignedElements({flatten:!0}).filter(p9)}get radioGroupItems(){return this.items.filter(e=>"menuitemradio"===e.role)}get checkedItems(){return this.items.filter(e=>e.checked)}get value(){var e,t;return null!=(t=null==(e=this.checkedItems[0])?void 0:e.value)?t:""}set value(e){let t=this.items.find(t=>t.value===e);t&&p2(this,y1,y2).call(this,t)}focus(){if(p1(this,yc,cg()),this.items.length){p2(this,y$,y0).call(this,this.items[0]),this.items[0].focus();return}let e=this.querySelector('[autofocus], [tabindex]:not([tabindex="-1"]), [role="menu"]');null==e||e.focus()}handleSelect(e){var t;let i=p2(this,yz,yX).call(this,e);i&&(p2(this,y1,y2).call(this,i,"checkbox"===i.type),p$(this,ym)&&!this.hidden&&(null==(t=p$(this,yc))||t.focus(),this.hidden=!0))}get keysUsed(){return["Enter","Escape","Tab"," ","ArrowDown","ArrowUp","Home","End"]}handleMove(e){var t,i;let{key:r}=e,a=this.items,n=null!=(i=null!=(t=p2(this,yz,yX).call(this,e))?t:p2(this,yZ,yJ).call(this))?i:a[0],s=Math.max(0,a.indexOf(n));"ArrowDown"===r?s++:"ArrowUp"===r?s--:"Home"===e.key?s=0:"End"===e.key&&(s=a.length-1),s<0&&(s=a.length-1),s>a.length-1&&(s=0),p2(this,y$,y0).call(this,a[s]),a[s].focus()}constructor(){if(super(),p0(this,yE),p0(this,yb),p0(this,yA),p0(this,yI),p0(this,yk),p0(this,yD),p0(this,yO),p0(this,yx),p0(this,yU),p0(this,yB),p0(this,yG),p0(this,yV),p0(this,yq),p0(this,yj),p0(this,yz),p0(this,yZ),p0(this,y$),p0(this,y1),p0(this,yh,null),p0(this,yc,null),p0(this,ym,null),p0(this,yf,new Set),p0(this,yp,void 0),p0(this,yg,!1),p0(this,yv,null),p0(this,y_,()=>{let e=p$(this,yf),t=new Set(this.items);for(let i of e)t.has(i)||this.dispatchEvent(new CustomEvent("removemenuitem",{detail:i}));for(let i of t)e.has(i)||this.dispatchEvent(new CustomEvent("addmenuitem",{detail:i}));p1(this,yf,t)}),p0(this,yC,()=>{p2(this,yO,yP).call(this),p2(this,yx,yN).call(this,!1)}),p0(this,yM,()=>{p2(this,yO,yP).call(this)}),!this.shadowRoot){this.attachShadow(this.constructor.shadowRootOptions);let e=cd(this.attributes);this.shadowRoot.innerHTML=this.constructor.getTemplateHTML(e)}this.container=this.shadowRoot.querySelector("#container"),this.defaultSlot=this.shadowRoot.querySelector("slot:not([name])"),this.shadowRoot.addEventListener("slotchange",this),p1(this,yp,new MutationObserver(p$(this,y_))),p$(this,yp).observe(this.defaultSlot,{childList:!0})}}function p9(e){return["menuitem","menuitemradio","menuitemcheckbox"].includes(null==e?void 0:e.role)}function p6(e){var t;return null!=(t=e.getAttribute("bounds")?cp(e,"#".concat(e.getAttribute("bounds"))):cu(e)||e.parentElement)?t:e}yh=new WeakMap,yc=new WeakMap,ym=new WeakMap,yf=new WeakMap,yp=new WeakMap,yg=new WeakMap,yv=new WeakMap,yE=new WeakSet,yy=function(e){let t=e.target;for(let e of t.assignedNodes({flatten:!0}))3===e.nodeType&&""===e.textContent.trim()&&e.remove();["header","title"].includes(t.name)&&p2(this,yb,yT).call(this),t.name||p$(this,y_).call(this)},yb=new WeakSet,yT=function(){let e=this.shadowRoot.querySelector('slot[name="header"]');e.hidden=0===this.shadowRoot.querySelector('slot[name="title"]').assignedNodes().length&&0===e.assignedNodes().length},y_=new WeakMap,yA=new WeakSet,yS=function(){var e;let t=this.shadowRoot.querySelector("#layout-row"),i=null==(e=getComputedStyle(this).getPropertyValue("--media-menu-layout"))?void 0:e.trim();t.setAttribute("media","row"===i?"":"width:0")},yI=new WeakSet,yR=function(e){p1(this,ym,e.relatedTarget),cf(this,e.relatedTarget)||(this.hidden=!this.hidden)},yk=new WeakSet,yL=function(){var e;null==(e=p$(this,ym))||e.setAttribute("aria-expanded","true"),this.addEventListener("transitionend",()=>this.focus(),{once:!0}),co(p6(this),p$(this,yC)),co(this,p$(this,yM))},yD=new WeakSet,yw=function(){var e;null==(e=p$(this,ym))||e.setAttribute("aria-expanded","false"),cl(p6(this),p$(this,yC)),cl(this,p$(this,yM))},yC=new WeakMap,yM=new WeakMap,yO=new WeakSet,yP=function(e){if(this.hasAttribute("mediacontroller")&&!this.anchor||this.hidden||!this.anchorElement)return;let{x:t,y:i}=function(e){let{anchor:t,floating:i,placement:r}=e,{x:a,y:n}=function(e,t){let i,{anchor:r,floating:a}=e,n="x"==(["top","bottom"].includes(pz(t))?"y":"x")?"y":"x",s="y"===n?"height":"width",o=pz(t),l=r.x+r.width/2-a.width/2,d=r.y+r.height/2-a.height/2,u=r[s]/2-a[s]/2;switch(o){case"top":i={x:l,y:r.y-a.height};break;case"bottom":i={x:l,y:r.y+r.height};break;case"right":i={x:r.x+r.width,y:d};break;case"left":i={x:r.x-a.width,y:d};break;default:i={x:r.x,y:r.y}}switch(t.split("-")[1]){case"start":i[n]-=u;break;case"end":i[n]+=u}return i}(function(e){let{anchor:t,floating:i}=e;return{anchor:function(e,t){var i;let r=e.getBoundingClientRect(),a=null!=(i=null==t?void 0:t.getBoundingClientRect())?i:{x:0,y:0};return{x:r.x-a.x,y:r.y-a.y,width:r.width,height:r.height}}(t,i.offsetParent),floating:{x:0,y:0,width:i.offsetWidth,height:i.offsetHeight}}}({anchor:t,floating:i}),r);return{x:a,y:n}}({anchor:this.anchorElement,floating:this,placement:"top-start"});null!=e||(e=this.offsetWidth);let r=p6(this).getBoundingClientRect(),a=r.width-t-e,n=r.height-i-this.offsetHeight,{style:s}=p$(this,yv);s.setProperty("position","absolute"),s.setProperty("right","".concat(Math.max(0,a),"px")),s.setProperty("--_menu-bottom","".concat(n,"px"));let o=getComputedStyle(this),l=s.getPropertyValue("--_menu-bottom")===o.bottom?n:parseFloat(o.bottom),d=r.height-l-parseFloat(o.marginBottom);this.style.setProperty("--_menu-max-height","".concat(d,"px"))},yx=new WeakSet,yN=function(e){let t=this.querySelector('[role="menuitem"][aria-haspopup][aria-expanded="true"]'),i=null==t?void 0:t.querySelector('[role="menu"]'),{style:r}=p$(this,yv);if(e||r.setProperty("--media-menu-transition-in","none"),i){let e=i.offsetHeight,r=Math.max(i.offsetWidth,t.offsetWidth);this.style.setProperty("min-width","".concat(r,"px")),this.style.setProperty("min-height","".concat(e,"px")),p2(this,yO,yP).call(this,r)}else this.style.removeProperty("min-width"),this.style.removeProperty("min-height"),p2(this,yO,yP).call(this);r.removeProperty("--media-menu-transition-in")},yU=new WeakSet,yF=function(e){var t;if(e.stopPropagation(),e.composedPath().includes(p$(this,yB,yH))){null==(t=p$(this,yc))||t.focus(),this.hidden=!0;return}let i=p2(this,yz,yX).call(this,e);!i||i.hasAttribute("disabled")||(p2(this,y$,y0).call(this,i),this.handleSelect(e))},yB=new WeakSet,yH=function(){var e;return null==(e=this.shadowRoot.querySelector('slot[name="header"]').assignedElements({flatten:!0}))?void 0:e.find(e=>e.matches('button[part~="back"]'))},yG=new WeakSet,yK=function(e){if(e.target===this)return;p2(this,yV,yW).call(this);let t=Array.from(this.querySelectorAll('[role="menuitem"][aria-haspopup]'));for(let i of t)i.invokeTargetElement!=e.target&&("open"!=e.newState||"true"!=i.getAttribute("aria-expanded")||i.invokeTargetElement.hidden||i.invokeTargetElement.dispatchEvent(new pX({relatedTarget:i})));for(let e of t)e.setAttribute("aria-expanded","".concat(!e.submenuElement.hidden));p2(this,yx,yN).call(this,!0)},yV=new WeakSet,yW=function(){let e=this.querySelector('[role="menuitem"] > [role="menu"]:not([hidden])');this.container.classList.toggle("has-expanded",!!e)},yq=new WeakSet,yY=function(e){var t;cf(this,e.relatedTarget)||(p$(this,yg)&&(null==(t=p$(this,yc))||t.focus()),p$(this,ym)&&p$(this,ym)!==e.relatedTarget&&!this.hidden&&(this.hidden=!0))},yj=new WeakSet,yQ=function(e){var t,i,r,a,n;let{key:s,ctrlKey:o,altKey:l,metaKey:d}=e;if(!o&&!l&&!d&&this.keysUsed.includes(s))if(e.preventDefault(),e.stopPropagation(),"Tab"===s){if(p$(this,yg)){this.hidden=!0;return}e.shiftKey?null==(i=null==(t=this.previousElementSibling)?void 0:t.focus)||i.call(t):null==(a=null==(r=this.nextElementSibling)?void 0:r.focus)||a.call(r),this.blur()}else"Escape"===s?(null==(n=p$(this,yc))||n.focus(),p$(this,yg)&&(this.hidden=!0)):"Enter"===s||" "===s?this.handleSelect(e):this.handleMove(e)},yz=new WeakSet,yX=function(e){return e.composedPath().find(e=>["menuitemradio","menuitemcheckbox"].includes(e.role))},yZ=new WeakSet,yJ=function(){return this.items.find(e=>0===e.tabIndex)},y$=new WeakSet,y0=function(e){for(let t of this.items)t.tabIndex=t===e?0:-1},y1=new WeakSet,y2=function(e,t){let i=[...this.checkedItems];"radio"===e.type&&this.radioGroupItems.forEach(e=>e.checked=!1),t?e.checked=!e.checked:e.checked=!0,this.checkedItems.some((e,t)=>e!=i[t])&&this.dispatchEvent(new Event("change",{bubbles:!0,composed:!0}))},p8.shadowRootOptions={mode:"open"},p8.getTemplateHTML=function(e){return'\n    <style>\n      :host {\n        font: var(--media-font,\n          var(--media-font-weight, normal)\n          var(--media-font-size, 14px) /\n          var(--media-text-content-height, var(--media-control-height, 24px))\n          var(--media-font-family, helvetica neue, segoe ui, roboto, arial, sans-serif));\n        color: var(--media-text-color, var(--media-primary-color, rgb(238 238 238)));\n        --_menu-bg: rgb(20 20 30 / .8);\n        background: var(--media-menu-background, var(--media-control-background, var(--media-secondary-color, var(--_menu-bg))));\n        border-radius: var(--media-menu-border-radius);\n        border: var(--media-menu-border, none);\n        display: var(--media-menu-display, inline-flex) !important;\n        \n        transition: var(--media-menu-transition-in,\n          visibility 0s,\n          opacity .2s ease-out,\n          transform .15s ease-out,\n          left .2s ease-in-out,\n          min-width .2s ease-in-out,\n          min-height .2s ease-in-out\n        ) !important;\n        \n        visibility: var(--media-menu-visibility, visible);\n        opacity: var(--media-menu-opacity, 1);\n        max-height: var(--media-menu-max-height, var(--_menu-max-height, 300px));\n        transform: var(--media-menu-transform-in, translateY(0) scale(1));\n        flex-direction: column;\n        \n        min-height: 0;\n        position: relative;\n        bottom: var(--_menu-bottom);\n        box-sizing: border-box;\n      } \n\n      @-moz-document url-prefix() {\n        :host{\n          --_menu-bg: rgb(20 20 30);\n        }\n      }\n\n      :host([hidden]) {\n        transition: var(--media-menu-transition-out,\n          visibility .15s ease-in,\n          opacity .15s ease-in,\n          transform .15s ease-in\n        ) !important;\n        visibility: var(--media-menu-hidden-visibility, hidden);\n        opacity: var(--media-menu-hidden-opacity, 0);\n        max-height: var(--media-menu-hidden-max-height,\n          var(--media-menu-max-height, var(--_menu-max-height, 300px)));\n        transform: var(--media-menu-transform-out, translateY(2px) scale(.99));\n        pointer-events: none;\n      }\n\n      :host([slot="submenu"]) {\n        background: none;\n        width: 100%;\n        min-height: 100%;\n        position: absolute;\n        bottom: 0;\n        right: -100%;\n      }\n\n      #container {\n        display: flex;\n        flex-direction: column;\n        min-height: 0;\n        transition: transform .2s ease-out;\n        transform: translate(0, 0);\n      }\n\n      #container.has-expanded {\n        transition: transform .2s ease-in;\n        transform: translate(-100%, 0);\n      }\n\n      button {\n        background: none;\n        color: inherit;\n        border: none;\n        padding: 0;\n        font: inherit;\n        outline: inherit;\n        display: inline-flex;\n        align-items: center;\n      }\n\n      slot[name="header"][hidden] {\n        display: none;\n      }\n\n      slot[name="header"] > *,\n      slot[name="header"]::slotted(*) {\n        padding: .4em .7em;\n        border-bottom: 1px solid rgb(255 255 255 / .25);\n        cursor: var(--media-cursor, default);\n      }\n\n      slot[name="header"] > button[part~="back"],\n      slot[name="header"]::slotted(button[part~="back"]) {\n        cursor: var(--media-cursor, pointer);\n      }\n\n      svg[part~="back"] {\n        height: var(--media-menu-icon-height, var(--media-control-height, 24px));\n        fill: var(--media-icon-color, var(--media-primary-color, rgb(238 238 238)));\n        display: block;\n        margin-right: .5ch;\n      }\n\n      slot:not([name]) {\n        gap: var(--media-menu-gap);\n        flex-direction: var(--media-menu-flex-direction, column);\n        overflow: var(--media-menu-overflow, hidden auto);\n        display: flex;\n        min-height: 0;\n      }\n\n      :host([role="menu"]) slot:not([name]) {\n        padding-block: .4em;\n      }\n\n      slot:not([name])::slotted([role="menu"]) {\n        background: none;\n      }\n\n      media-chrome-menu-item > span {\n        margin-right: .5ch;\n        max-width: var(--media-menu-item-max-width);\n        text-overflow: ellipsis;\n        overflow: hidden;\n      }\n    </style>\n    <style id="layout-row" media="width:0">\n\n      slot[name="header"] > *,\n      slot[name="header"]::slotted(*) {\n        padding: .4em .5em;\n      }\n\n      slot:not([name]) {\n        gap: var(--media-menu-gap, .25em);\n        flex-direction: var(--media-menu-flex-direction, row);\n        padding-inline: .5em;\n      }\n\n      media-chrome-menu-item {\n        padding: .3em .5em;\n      }\n\n      media-chrome-menu-item[aria-checked="true"] {\n        background: var(--media-menu-item-checked-background, rgb(255 255 255 / .2));\n      }\n\n      \n      media-chrome-menu-item::part(checked-indicator) {\n        display: var(--media-menu-item-checked-indicator-display, none);\n      }\n    </style>\n    <div id="container" part="container">\n      <slot name="header" hidden>\n        <button part="back button" aria-label="Back to previous menu">\n          <slot name="back-icon">\n            <svg aria-hidden="true" viewBox="0 0 20 24" part="back indicator">\n              <path d="m11.88 17.585.742-.669-4.2-4.665 4.2-4.666-.743-.669-4.803 5.335 4.803 5.334Z"/>\n            </svg>\n          </slot>\n          <slot name="title"></slot>\n        </button>\n      </slot>\n      <slot></slot>\n    </div>\n    <slot name="checked-indicator" hidden></slot>\n  '},ci.customElements.get("media-chrome-menu")||ci.customElements.define("media-chrome-menu",p8);var p7=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},ge=(e,t,i)=>(p7(e,t,"read from private field"),i?i.call(e):t.get(e)),gt=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},gi=(e,t,i,r)=>(p7(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i),gr=(e,t,i)=>(p7(e,t,"access private method"),i);let ga={TYPE:"type",VALUE:"value",CHECKED:"checked",DISABLED:"disabled"};class gn extends ci.HTMLElement{static get observedAttributes(){return[ga.TYPE,ga.DISABLED,ga.CHECKED,ga.VALUE]}enable(){this.hasAttribute("tabindex")||this.setAttribute("tabindex","-1"),gs(this)&&!this.hasAttribute("aria-checked")&&this.setAttribute("aria-checked","false"),this.addEventListener("click",this),this.addEventListener("keydown",this)}disable(){this.removeAttribute("tabindex"),this.removeEventListener("click",this),this.removeEventListener("keydown",this),this.removeEventListener("keyup",this)}handleEvent(e){switch(e.type){case"slotchange":gr(this,y5,y8).call(this,e);break;case"click":this.handleClick(e);break;case"keydown":gr(this,ba,bn).call(this,e);break;case"keyup":gr(this,bi,br).call(this,e)}}attributeChangedCallback(e,t,i){e===ga.CHECKED&&gs(this)&&!ge(this,y3)?this.setAttribute("aria-checked",null!=i?"true":"false"):e===ga.TYPE&&i!==t?this.role="menuitem"+i:e===ga.DISABLED&&i!==t&&(null==i?this.enable():this.disable())}connectedCallback(){this.hasAttribute(ga.DISABLED)||this.enable(),this.role="menuitem"+this.type,gi(this,y4,function e(t,i){if(!t)return null;let{host:r}=t.getRootNode();return!i&&r?e(t,r):(null==i?void 0:i.items)?i:e(i,null==i?void 0:i.parentNode)}(this,this.parentNode)),gr(this,bs,bo).call(this),this.submenuElement&&gr(this,y9,y6).call(this)}disconnectedCallback(){this.disable(),gr(this,bs,bo).call(this),gi(this,y4,null)}get invokeTarget(){return this.getAttribute("invoketarget")}set invokeTarget(e){this.setAttribute("invoketarget","".concat(e))}get invokeTargetElement(){var e;return this.invokeTarget?null==(e=cv(this))?void 0:e.querySelector("#".concat(this.invokeTarget)):this.submenuElement}get submenuElement(){return this.shadowRoot.querySelector('slot[name="submenu"]').assignedElements({flatten:!0})[0]}get type(){var e;return null!=(e=this.getAttribute(ga.TYPE))?e:""}set type(e){this.setAttribute(ga.TYPE,"".concat(e))}get value(){var e;return null!=(e=this.getAttribute(ga.VALUE))?e:this.text}set value(e){this.setAttribute(ga.VALUE,e)}get text(){var e;return(null!=(e=this.textContent)?e:"").trim()}get checked(){if(gs(this))return"true"===this.getAttribute("aria-checked")}set checked(e){gs(this)&&(gi(this,y3,!0),this.setAttribute("aria-checked",e?"true":"false"),e?this.part.add("checked"):this.part.remove("checked"))}handleClick(e){!gs(this)&&this.invokeTargetElement&&cf(this,e.target)&&this.invokeTargetElement.dispatchEvent(new pX({relatedTarget:this}))}get keysUsed(){return["Enter"," "]}constructor(){if(super(),gt(this,y5),gt(this,y9),gt(this,y7),gt(this,bi),gt(this,ba),gt(this,bs),gt(this,y3,!1),gt(this,y4,void 0),gt(this,bt,()=>{var e,t;this.submenuElement.items&&this.setAttribute("submenusize","".concat(this.submenuElement.items.length));let i=this.shadowRoot.querySelector('slot[name="description"]'),r=null==(e=this.submenuElement.checkedItems)?void 0:e[0],a=null!=(t=null==r?void 0:r.dataset.description)?t:null==r?void 0:r.text,n=cr.createElement("span");n.textContent=null!=a?a:"",i.replaceChildren(n)}),!this.shadowRoot){this.attachShadow(this.constructor.shadowRootOptions);let e=cd(this.attributes);this.shadowRoot.innerHTML=this.constructor.getTemplateHTML(e)}this.shadowRoot.addEventListener("slotchange",this)}}function gs(e){return"radio"===e.type||"checkbox"===e.type}y3=new WeakMap,y4=new WeakMap,y5=new WeakSet,y8=function(e){let t=e.target;if(!(null==t?void 0:t.name))for(let e of t.assignedNodes({flatten:!0}))e instanceof Text&&""===e.textContent.trim()&&e.remove();"submenu"===t.name&&(this.submenuElement?gr(this,y9,y6).call(this):gr(this,y7,be).call(this))},y9=new WeakSet,y6=async function(){this.setAttribute("aria-haspopup","menu"),this.setAttribute("aria-expanded","".concat(!this.submenuElement.hidden)),this.submenuElement.addEventListener("change",ge(this,bt)),this.submenuElement.addEventListener("addmenuitem",ge(this,bt)),this.submenuElement.addEventListener("removemenuitem",ge(this,bt)),ge(this,bt).call(this)},y7=new WeakSet,be=function(){this.removeAttribute("aria-haspopup"),this.removeAttribute("aria-expanded"),this.submenuElement.removeEventListener("change",ge(this,bt)),this.submenuElement.removeEventListener("addmenuitem",ge(this,bt)),this.submenuElement.removeEventListener("removemenuitem",ge(this,bt)),ge(this,bt).call(this)},bt=new WeakMap,bi=new WeakSet,br=function(e){let{key:t}=e;if(!this.keysUsed.includes(t))return void this.removeEventListener("keyup",gr(this,bi,br));this.handleClick(e)},ba=new WeakSet,bn=function(e){let{metaKey:t,altKey:i,key:r}=e;if(t||i||!this.keysUsed.includes(r))return void this.removeEventListener("keyup",gr(this,bi,br));this.addEventListener("keyup",gr(this,bi,br),{once:!0})},bs=new WeakSet,bo=function(){var e;let t=null==(e=ge(this,y4))?void 0:e.radioGroupItems;if(!t)return;let i=t.filter(e=>"true"===e.getAttribute("aria-checked")).pop();for(let e of(i||(i=t[0]),t))e.setAttribute("aria-checked","false");null==i||i.setAttribute("aria-checked","true")},gn.shadowRootOptions={mode:"open"},gn.getTemplateHTML=function(e){return'\n    <style>\n      :host {\n        transition: var(--media-menu-item-transition,\n          background .15s linear,\n          opacity .2s ease-in-out\n        );\n        outline: var(--media-menu-item-outline, 0);\n        outline-offset: var(--media-menu-item-outline-offset, -1px);\n        cursor: var(--media-cursor, pointer);\n        display: flex;\n        align-items: center;\n        align-self: stretch;\n        justify-self: stretch;\n        white-space: nowrap;\n        white-space-collapse: collapse;\n        text-wrap: nowrap;\n        padding: .4em .8em .4em 1em;\n      }\n\n      :host(:focus-visible) {\n        box-shadow: var(--media-menu-item-focus-shadow, inset 0 0 0 2px rgb(27 127 204 / .9));\n        outline: var(--media-menu-item-hover-outline, 0);\n        outline-offset: var(--media-menu-item-hover-outline-offset,  var(--media-menu-item-outline-offset, -1px));\n      }\n\n      :host(:hover) {\n        cursor: var(--media-cursor, pointer);\n        background: var(--media-menu-item-hover-background, rgb(92 92 102 / .5));\n        outline: var(--media-menu-item-hover-outline);\n        outline-offset: var(--media-menu-item-hover-outline-offset,  var(--media-menu-item-outline-offset, -1px));\n      }\n\n      :host([aria-checked="true"]) {\n        background: var(--media-menu-item-checked-background);\n      }\n\n      :host([hidden]) {\n        display: none;\n      }\n\n      :host([disabled]) {\n        pointer-events: none;\n        color: rgba(255, 255, 255, .3);\n      }\n\n      slot:not([name]) {\n        width: 100%;\n      }\n\n      slot:not([name="submenu"]) {\n        display: inline-flex;\n        align-items: center;\n        transition: inherit;\n        opacity: var(--media-menu-item-opacity, 1);\n      }\n\n      slot[name="description"] {\n        justify-content: end;\n      }\n\n      slot[name="description"] > span {\n        display: inline-block;\n        margin-inline: 1em .2em;\n        max-width: var(--media-menu-item-description-max-width, 100px);\n        text-overflow: ellipsis;\n        overflow: hidden;\n        font-size: .8em;\n        font-weight: 400;\n        text-align: right;\n        position: relative;\n        top: .04em;\n      }\n\n      slot[name="checked-indicator"] {\n        display: none;\n      }\n\n      :host(:is([role="menuitemradio"],[role="menuitemcheckbox"])) slot[name="checked-indicator"] {\n        display: var(--media-menu-item-checked-indicator-display, inline-block);\n      }\n\n      \n      svg, img, ::slotted(svg), ::slotted(img) {\n        height: var(--media-menu-item-icon-height, var(--media-control-height, 24px));\n        fill: var(--media-icon-color, var(--media-primary-color, rgb(238 238 238)));\n        display: block;\n      }\n\n      \n      [part~="indicator"],\n      ::slotted([part~="indicator"]) {\n        fill: var(--media-menu-item-indicator-fill,\n          var(--media-icon-color, var(--media-primary-color, rgb(238 238 238))));\n        height: var(--media-menu-item-indicator-height, 1.25em);\n        margin-right: .5ch;\n      }\n\n      [part~="checked-indicator"] {\n        visibility: hidden;\n      }\n\n      :host([aria-checked="true"]) [part~="checked-indicator"] {\n        visibility: visible;\n      }\n    </style>\n    <slot name="checked-indicator">\n      <svg aria-hidden="true" viewBox="0 1 24 24" part="checked-indicator indicator">\n        <path d="m10 15.17 9.193-9.191 1.414 1.414-10.606 10.606-6.364-6.364 1.414-1.414 4.95 4.95Z"/>\n      </svg>\n    </slot>\n    <slot name="prefix"></slot>\n    <slot></slot>\n    <slot name="description"></slot>\n    <slot name="suffix">\n      '.concat(this.getSuffixSlotInnerHTML(e),'\n    </slot>\n    <slot name="submenu"></slot>\n  ')},gn.getSuffixSlotInnerHTML=function(e){return""},ci.customElements.get("media-chrome-menu-item")||ci.customElements.define("media-chrome-menu-item",gn);class go extends p8{get anchorElement(){return"auto"!==this.anchor?super.anchorElement:cu(this).querySelector("media-settings-menu-button")}}go.getTemplateHTML=function(e){return"\n    ".concat(p8.getTemplateHTML(e),'\n    <style>\n      :host {\n        --_menu-bg: rgb(20 20 30 / .8);\n        background: var(--media-settings-menu-background,\n            var(--media-menu-background,\n              var(--media-control-background,\n                var(--media-secondary-color, var(--_menu-bg)))));\n        min-width: var(--media-settings-menu-min-width, 170px);\n        border-radius: 2px 2px 0 0;\n        overflow: hidden;\n      }\n\n      @-moz-document url-prefix() {\n        :host{\n          --_menu-bg: rgb(20 20 30);\n        }\n      }\n\n      :host([role="menu"]) {\n        ',"\n        justify-content: end;\n      }\n\n      slot:not([name]) {\n        justify-content: var(--media-settings-menu-justify-content);\n        flex-direction: var(--media-settings-menu-flex-direction, column);\n        overflow: visible;\n      }\n\n      #container.has-expanded {\n        --media-settings-menu-item-opacity: 0;\n      }\n    </style>\n  ")},ci.customElements.get("media-settings-menu")||ci.customElements.define("media-settings-menu",go);class gl extends gn{}gl.shadowRootOptions={mode:"open"},gl.getTemplateHTML=function(e){return"\n    ".concat(gn.getTemplateHTML.call(this,e),'\n    <style>\n      slot:not([name="submenu"]) {\n        opacity: var(--media-settings-menu-item-opacity, var(--media-menu-item-opacity));\n      }\n\n      :host([aria-expanded="true"]:hover) {\n        background: transparent;\n      }\n    </style>\n  ')},gl.getSuffixSlotInnerHTML=function(e){return'\n    <svg aria-hidden="true" viewBox="0 0 20 24">\n      <path d="m8.12 17.585-.742-.669 4.2-4.665-4.2-4.666.743-.669 4.803 5.335-4.803 5.334Z"/>\n    </svg>\n  '},ci.customElements.get("media-settings-menu-item")||ci.customElements.define("media-settings-menu-item",gl);class gd extends mG{connectedCallback(){super.connectedCallback(),this.invokeTargetElement&&this.setAttribute("aria-haspopup","menu")}get invokeTarget(){return this.getAttribute("invoketarget")}set invokeTarget(e){this.setAttribute("invoketarget","".concat(e))}get invokeTargetElement(){var e;return this.invokeTarget?null==(e=cv(this))?void 0:e.querySelector("#".concat(this.invokeTarget)):null}handleClick(){var e;null==(e=this.invokeTargetElement)||e.dispatchEvent(new pX({relatedTarget:this}))}}ci.customElements.get("media-chrome-menu-button")||ci.customElements.define("media-chrome-menu-button",gd);class gu extends gd{static get observedAttributes(){return[...super.observedAttributes,"target"]}connectedCallback(){super.connectedCallback(),this.setAttribute("aria-label",h4("settings"))}get invokeTargetElement(){return void 0!=this.invokeTarget?super.invokeTargetElement:cu(this).querySelector("media-settings-menu")}}gu.getSlotTemplateHTML=function(){return'\n    <style>\n      :host([aria-expanded="true"]) slot[name=tooltip] {\n        display: none;\n      }\n    </style>\n    <slot name="icon">\n      <svg aria-hidden="true" viewBox="0 0 24 24">\n        <path d="M4.5 14.5a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5Zm7.5 0a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5Zm7.5 0a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5Z"/>\n      </svg>\n    </slot>\n  '},gu.getTooltipContentHTML=function(){return h4("Settings")},ci.customElements.get("media-settings-menu-button")||ci.customElements.define("media-settings-menu-button",gu);var gh=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},gc=(e,t,i)=>(gh(e,t,"read from private field"),i?i.call(e):t.get(e)),gm=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},gf=(e,t,i,r)=>(gh(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i),gp=(e,t,i)=>(gh(e,t,"access private method"),i);bl=new WeakMap,bd=new WeakMap,bu=new WeakSet,bh=function(){if(gc(this,bd)===JSON.stringify(this.mediaAudioTrackList))return;gf(this,bd,JSON.stringify(this.mediaAudioTrackList));let e=this.mediaAudioTrackList;for(let t of(this.defaultSlot.textContent="",e)){let e=p3({type:"radio",text:this.formatMenuItemText(t.label,t),value:"".concat(t.id),checked:t.enabled});e.prepend(p4(this,"checked-indicator")),this.defaultSlot.append(e)}},bc=new WeakSet,bm=function(){if(null==this.value)return;let e=new ci.CustomEvent(hL.MEDIA_AUDIO_TRACK_REQUEST,{composed:!0,bubbles:!0,detail:this.value});this.dispatchEvent(e)},ci.customElements.get("media-audio-track-menu")||ci.customElements.define("media-audio-track-menu",class extends p8{static get observedAttributes(){return[...super.observedAttributes,hM.MEDIA_AUDIO_TRACK_LIST,hM.MEDIA_AUDIO_TRACK_ENABLED,hM.MEDIA_AUDIO_TRACK_UNAVAILABLE]}attributeChangedCallback(e,t,i){if(super.attributeChangedCallback(e,t,i),e===hM.MEDIA_AUDIO_TRACK_ENABLED&&t!==i)this.value=i;else if(e===hM.MEDIA_AUDIO_TRACK_LIST&&t!==i){var r;gf(this,bl,null==(r=null!=i?i:"")?void 0:r.split(/\s+/).map(hj)),gp(this,bu,bh).call(this)}}connectedCallback(){super.connectedCallback(),this.addEventListener("change",gp(this,bc,bm))}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener("change",gp(this,bc,bm))}get anchorElement(){var e;return"auto"!==this.anchor?super.anchorElement:null==(e=cu(this))?void 0:e.querySelector("media-audio-track-menu-button")}get mediaAudioTrackList(){return gc(this,bl)}set mediaAudioTrackList(e){gf(this,bl,e),gp(this,bu,bh).call(this)}get mediaAudioTrackEnabled(){var e;return null!=(e=cI(this,hM.MEDIA_AUDIO_TRACK_ENABLED))?e:""}set mediaAudioTrackEnabled(e){cR(this,hM.MEDIA_AUDIO_TRACK_ENABLED,e)}constructor(){super(...arguments),gm(this,bu),gm(this,bc),gm(this,bl,[]),gm(this,bd,void 0)}});let gg=e=>{let t=h4("Audio");e.setAttribute("aria-label",t)};class gv extends gd{static get observedAttributes(){return[...super.observedAttributes,hM.MEDIA_AUDIO_TRACK_ENABLED,hM.MEDIA_AUDIO_TRACK_UNAVAILABLE]}connectedCallback(){super.connectedCallback(),gg(this)}attributeChangedCallback(e,t,i){super.attributeChangedCallback(e,t,i),e===hM.MEDIA_LANG&&gg(this)}get invokeTargetElement(){var e;return void 0!=this.invokeTarget?super.invokeTargetElement:null==(e=cu(this))?void 0:e.querySelector("media-audio-track-menu")}get mediaAudioTrackEnabled(){var e;return null!=(e=cI(this,hM.MEDIA_AUDIO_TRACK_ENABLED))?e:""}set mediaAudioTrackEnabled(e){cR(this,hM.MEDIA_AUDIO_TRACK_ENABLED,e)}}gv.getSlotTemplateHTML=function(){return'\n    <style>\n      :host([aria-expanded="true"]) slot[name=tooltip] {\n        display: none;\n      }\n    </style>\n    <slot name="icon">'.concat('<svg aria-hidden="true" viewBox="0 0 24 24">\n  <path d="M11 17H9.5V7H11v10Zm-3-3H6.5v-4H8v4Zm6-5h-1.5v6H14V9Zm3 7h-1.5V8H17v8Z"/>\n  <path d="M22 12c0 5.523-4.477 10-10 10S2 17.523 2 12 6.477 2 12 2s10 4.477 10 10Zm-2 0a8 8 0 1 0-16 0 8 8 0 0 0 16 0Z"/>\n</svg>',"</slot>\n  ")},gv.getTooltipContentHTML=function(){return h4("Audio")},ci.customElements.get("media-audio-track-menu-button")||ci.customElements.define("media-audio-track-menu-button",gv);var gE=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},gy=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},gb=(e,t,i)=>(gE(e,t,"access private method"),i);class gT extends p8{static get observedAttributes(){return[...super.observedAttributes,hM.MEDIA_SUBTITLES_LIST,hM.MEDIA_SUBTITLES_SHOWING]}attributeChangedCallback(e,t,i){super.attributeChangedCallback(e,t,i),e===hM.MEDIA_SUBTITLES_LIST&&t!==i?gb(this,bp,bg).call(this):e===hM.MEDIA_SUBTITLES_SHOWING&&t!==i&&(this.value=i)}connectedCallback(){super.connectedCallback(),this.addEventListener("change",gb(this,bv,bE))}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener("change",gb(this,bv,bE))}get anchorElement(){return"auto"!==this.anchor?super.anchorElement:cu(this).querySelector("media-captions-menu-button")}get mediaSubtitlesList(){return g_(this,hM.MEDIA_SUBTITLES_LIST)}set mediaSubtitlesList(e){gA(this,hM.MEDIA_SUBTITLES_LIST,e)}get mediaSubtitlesShowing(){return g_(this,hM.MEDIA_SUBTITLES_SHOWING)}set mediaSubtitlesShowing(e){gA(this,hM.MEDIA_SUBTITLES_SHOWING,e)}constructor(){super(...arguments),gy(this,bp),gy(this,bv),gy(this,bf,void 0)}}bf=new WeakMap,bp=new WeakSet,bg=function(){var e,t,i,r,a,n;if(gE(this,t=bf,"read from private field"),(i?i.call(this):t.get(this))===JSON.stringify(this.mediaSubtitlesList))return;r=bf,a=JSON.stringify(this.mediaSubtitlesList),gE(this,r,"write to private field"),n?n.call(this,a):r.set(this,a),this.defaultSlot.textContent="";let s=!this.value,o=p3({type:"radio",text:this.formatMenuItemText(h4("Off")),value:"off",checked:s});for(let t of(o.prepend(p4(this,"checked-indicator")),this.defaultSlot.append(o),this.mediaSubtitlesList)){let i=p3({type:"radio",text:this.formatMenuItemText(t.label,t),value:cz(t),checked:this.value==cz(t)});i.prepend(p4(this,"checked-indicator")),"captions"===(null!=(e=t.kind)?e:"subs")&&i.append(p4(this,"captions-indicator")),this.defaultSlot.append(i)}},bv=new WeakSet,bE=function(){let e=this.mediaSubtitlesShowing,t=this.getAttribute(hM.MEDIA_SUBTITLES_SHOWING),i=this.value!==t;if((null==e?void 0:e.length)&&i&&this.dispatchEvent(new ci.CustomEvent(hL.MEDIA_DISABLE_SUBTITLES_REQUEST,{composed:!0,bubbles:!0,detail:e})),!this.value||!i)return;let r=new ci.CustomEvent(hL.MEDIA_SHOW_SUBTITLES_REQUEST,{composed:!0,bubbles:!0,detail:this.value});this.dispatchEvent(r)},gT.getTemplateHTML=function(e){return"\n    ".concat(p8.getTemplateHTML(e),'\n    <slot name="captions-indicator" hidden>').concat('\n  <svg aria-hidden="true" viewBox="0 0 26 24" part="captions-indicator indicator">\n    <path d="M22.83 5.68a2.58 2.58 0 0 0-2.3-2.5c-3.62-.24-11.44-.24-15.06 0a2.58 2.58 0 0 0-2.3 2.5c-.23 4.21-.23 8.43 0 12.64a2.58 2.58 0 0 0 2.3 2.5c3.62.24 11.44.24 15.06 0a2.58 2.58 0 0 0 2.3-2.5c.23-4.21.23-8.43 0-12.64Zm-11.39 9.45a3.07 3.07 0 0 1-1.91.57 3.06 3.06 0 0 1-2.34-1 3.75 3.75 0 0 1-.92-2.67 3.92 3.92 0 0 1 .92-2.77 3.18 3.18 0 0 1 2.43-1 2.94 2.94 0 0 1 2.13.78c.364.359.62.813.74 1.31l-1.43.35a1.49 1.49 0 0 0-1.51-1.17 1.61 1.61 0 0 0-1.29.58 2.79 2.79 0 0 0-.5 1.89 3 3 0 0 0 .49 1.93 1.61 1.61 0 0 0 1.27.58 1.48 1.48 0 0 0 1-.37 2.1 2.1 0 0 0 .59-1.14l1.4.44a3.23 3.23 0 0 1-1.07 1.69Zm7.22 0a3.07 3.07 0 0 1-1.91.57 3.06 3.06 0 0 1-2.34-1 3.75 3.75 0 0 1-.92-2.67 3.88 3.88 0 0 1 .93-2.77 3.14 3.14 0 0 1 2.42-1 3 3 0 0 1 2.16.82 2.8 2.8 0 0 1 .73 1.31l-1.43.35a1.49 1.49 0 0 0-1.51-1.21 1.61 1.61 0 0 0-1.29.58A2.79 2.79 0 0 0 15 12a3 3 0 0 0 .49 1.93 1.61 1.61 0 0 0 1.27.58 1.44 1.44 0 0 0 1-.37 2.1 2.1 0 0 0 .6-1.15l1.4.44a3.17 3.17 0 0 1-1.1 1.7Z"/>\n  </svg>',"</slot>\n  ")};let g_=(e,t)=>{let i=e.getAttribute(t);return i?cj(i):[]},gA=(e,t,i)=>{if(!(null==i?void 0:i.length))return void e.removeAttribute(t);let r=cX(i);e.getAttribute(t)!==r&&e.setAttribute(t,r)};ci.customElements.get("media-captions-menu")||ci.customElements.define("media-captions-menu",gT);let gS=e=>{e.setAttribute("aria-checked",c0(e).toString())},gI=e=>{e.setAttribute("aria-label",h4("closed captions"))};class gR extends gd{static get observedAttributes(){return[...super.observedAttributes,hM.MEDIA_SUBTITLES_LIST,hM.MEDIA_SUBTITLES_SHOWING,hM.MEDIA_LANG]}connectedCallback(){super.connectedCallback(),gI(this),gS(this)}attributeChangedCallback(e,t,i){super.attributeChangedCallback(e,t,i),e===hM.MEDIA_SUBTITLES_SHOWING?gS(this):e===hM.MEDIA_LANG&&gI(this)}get invokeTargetElement(){var e;return void 0!=this.invokeTarget?super.invokeTargetElement:null==(e=cu(this))?void 0:e.querySelector("media-captions-menu")}get mediaSubtitlesList(){return gk(this,hM.MEDIA_SUBTITLES_LIST)}set mediaSubtitlesList(e){gL(this,hM.MEDIA_SUBTITLES_LIST,e)}get mediaSubtitlesShowing(){return gk(this,hM.MEDIA_SUBTITLES_SHOWING)}set mediaSubtitlesShowing(e){gL(this,hM.MEDIA_SUBTITLES_SHOWING,e)}}gR.getSlotTemplateHTML=function(){return'\n    <style>\n      :host([aria-checked="true"]) slot[name=off] {\n        display: none !important;\n      }\n\n      \n      :host(:not([aria-checked="true"])) slot[name=on] {\n        display: none !important;\n      }\n\n      :host([aria-expanded="true"]) slot[name=tooltip] {\n        display: none;\n      }\n    </style>\n\n    <slot name="icon">\n      <slot name="on">'.concat('<svg aria-hidden="true" viewBox="0 0 26 24">\n  <path d="M22.83 5.68a2.58 2.58 0 0 0-2.3-2.5c-3.62-.24-11.44-.24-15.06 0a2.58 2.58 0 0 0-2.3 2.5c-.23 4.21-.23 8.43 0 12.64a2.58 2.58 0 0 0 2.3 2.5c3.62.24 11.44.24 15.06 0a2.58 2.58 0 0 0 2.3-2.5c.23-4.21.23-8.43 0-12.64Zm-11.39 9.45a3.07 3.07 0 0 1-1.91.57 3.06 3.06 0 0 1-2.34-1 3.75 3.75 0 0 1-.92-2.67 3.92 3.92 0 0 1 .92-2.77 3.18 3.18 0 0 1 2.43-1 2.94 2.94 0 0 1 2.13.78c.364.359.62.813.74 1.31l-1.43.35a1.49 1.49 0 0 0-1.51-1.17 1.61 1.61 0 0 0-1.29.58 2.79 2.79 0 0 0-.5 1.89 3 3 0 0 0 .49 1.93 1.61 1.61 0 0 0 1.27.58 1.48 1.48 0 0 0 1-.37 2.1 2.1 0 0 0 .59-1.14l1.4.44a3.23 3.23 0 0 1-1.07 1.69Zm7.22 0a3.07 3.07 0 0 1-1.91.57 3.06 3.06 0 0 1-2.34-1 3.75 3.75 0 0 1-.92-2.67 3.88 3.88 0 0 1 .93-2.77 3.14 3.14 0 0 1 2.42-1 3 3 0 0 1 2.16.82 2.8 2.8 0 0 1 .73 1.31l-1.43.35a1.49 1.49 0 0 0-1.51-1.21 1.61 1.61 0 0 0-1.29.58A2.79 2.79 0 0 0 15 12a3 3 0 0 0 .49 1.93 1.61 1.61 0 0 0 1.27.58 1.44 1.44 0 0 0 1-.37 2.1 2.1 0 0 0 .6-1.15l1.4.44a3.17 3.17 0 0 1-1.1 1.7Z"/>\n</svg>','</slot>\n      <slot name="off">').concat('<svg aria-hidden="true" viewBox="0 0 26 24">\n  <path d="M17.73 14.09a1.4 1.4 0 0 1-1 .37 1.579 1.579 0 0 1-1.27-.58A3 3 0 0 1 15 12a2.8 2.8 0 0 1 .5-1.85 1.63 1.63 0 0 1 1.29-.57 1.47 1.47 0 0 1 1.51 1.2l1.43-.34A2.89 2.89 0 0 0 19 9.07a3 3 0 0 0-2.14-.78 3.14 3.14 0 0 0-2.42 1 3.91 3.91 0 0 0-.93 2.78 3.74 3.74 0 0 0 .92 2.66 3.07 3.07 0 0 0 2.34 1 3.07 3.07 0 0 0 1.91-.57 3.17 3.17 0 0 0 1.07-1.74l-1.4-.45c-.083.43-.3.822-.62 1.12Zm-7.22 0a1.43 1.43 0 0 1-1 .37 1.58 1.58 0 0 1-1.27-.58A3 3 0 0 1 7.76 12a2.8 2.8 0 0 1 .5-1.85 1.63 1.63 0 0 1 1.29-.57 1.47 1.47 0 0 1 1.51 1.2l1.43-.34a2.81 2.81 0 0 0-.74-1.32 2.94 2.94 0 0 0-2.13-.78 3.18 3.18 0 0 0-2.43 1 4 4 0 0 0-.92 2.78 3.74 3.74 0 0 0 .92 2.66 3.07 3.07 0 0 0 2.34 1 3.07 3.07 0 0 0 1.91-.57 3.23 3.23 0 0 0 1.07-1.74l-1.4-.45a2.06 2.06 0 0 1-.6 1.07Zm12.32-8.41a2.59 2.59 0 0 0-2.3-2.51C18.72 3.05 15.86 3 13 3c-2.86 0-5.72.05-7.53.17a2.59 2.59 0 0 0-2.3 2.51c-.23 4.207-.23 8.423 0 12.63a2.57 2.57 0 0 0 2.3 2.5c1.81.13 4.67.19 7.53.19 2.86 0 5.72-.06 7.53-.19a2.57 2.57 0 0 0 2.3-2.5c.23-4.207.23-8.423 0-12.63Zm-1.49 12.53a1.11 1.11 0 0 1-.91 1.11c-1.67.11-4.45.18-7.43.18-2.98 0-5.76-.07-7.43-.18a1.11 1.11 0 0 1-.91-1.11c-.21-4.14-.21-8.29 0-12.43a1.11 1.11 0 0 1 .91-1.11C7.24 4.56 10 4.49 13 4.49s5.76.07 7.43.18a1.11 1.11 0 0 1 .91 1.11c.21 4.14.21 8.29 0 12.43Z"/>\n</svg>',"</slot>\n    </slot>\n  ")},gR.getTooltipContentHTML=function(){return h4("Captions")};let gk=(e,t)=>{let i=e.getAttribute(t);return i?cj(i):[]},gL=(e,t,i)=>{if(!(null==i?void 0:i.length))return void e.removeAttribute(t);let r=cX(i);e.getAttribute(t)!==r&&e.setAttribute(t,r)};ci.customElements.get("media-captions-menu-button")||ci.customElements.define("media-captions-menu-button",gR);var gD=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},gw=(e,t,i)=>(gD(e,t,"read from private field"),i?i.call(e):t.get(e)),gC=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},gM=(e,t,i)=>(gD(e,t,"access private method"),i);let gO={RATES:"rates"};by=new WeakMap,bb=new WeakSet,bT=function(){for(let e of(this.defaultSlot.textContent="",gw(this,by))){let t=p3({type:"radio",text:this.formatMenuItemText("".concat(e,"x"),e),value:e,checked:this.mediaPlaybackRate===Number(e)});t.prepend(p4(this,"checked-indicator")),this.defaultSlot.append(t)}},b_=new WeakSet,bA=function(){if(!this.value)return;let e=new ci.CustomEvent(hL.MEDIA_PLAYBACK_RATE_REQUEST,{composed:!0,bubbles:!0,detail:this.value});this.dispatchEvent(e)},ci.customElements.get("media-playback-rate-menu")||ci.customElements.define("media-playback-rate-menu",class extends p8{static get observedAttributes(){return[...super.observedAttributes,hM.MEDIA_PLAYBACK_RATE,gO.RATES]}attributeChangedCallback(e,t,i){super.attributeChangedCallback(e,t,i),e===hM.MEDIA_PLAYBACK_RATE&&t!=i?this.value=i:e===gO.RATES&&t!=i&&(gw(this,by).value=i,gM(this,bb,bT).call(this))}connectedCallback(){super.connectedCallback(),this.addEventListener("change",gM(this,b_,bA))}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener("change",gM(this,b_,bA))}get anchorElement(){return"auto"!==this.anchor?super.anchorElement:cu(this).querySelector("media-playback-rate-menu-button")}get rates(){return gw(this,by)}set rates(e){e?Array.isArray(e)?gw(this,by).value=e.join(" "):"string"==typeof e&&(gw(this,by).value=e):gw(this,by).value="",gM(this,bb,bT).call(this)}get mediaPlaybackRate(){return cT(this,hM.MEDIA_PLAYBACK_RATE,1)}set mediaPlaybackRate(e){c_(this,hM.MEDIA_PLAYBACK_RATE,e)}constructor(){super(),gC(this,bb),gC(this,b_),gC(this,by,new cW(this,gO.RATES,{defaultValue:fH})),gM(this,bb,bT).call(this)}});class gP extends gd{static get observedAttributes(){return[...super.observedAttributes,hM.MEDIA_PLAYBACK_RATE]}attributeChangedCallback(e,t,i){if(super.attributeChangedCallback(e,t,i),e===hM.MEDIA_PLAYBACK_RATE){let e=i?+i:NaN,t=Number.isNaN(e)?1:e;this.container.innerHTML="".concat(t,"x"),this.setAttribute("aria-label",h4("Playback rate {playbackRate}",{playbackRate:t}))}}get invokeTargetElement(){return void 0!=this.invokeTarget?super.invokeTargetElement:cu(this).querySelector("media-playback-rate-menu")}get mediaPlaybackRate(){return cT(this,hM.MEDIA_PLAYBACK_RATE,1)}set mediaPlaybackRate(e){c_(this,hM.MEDIA_PLAYBACK_RATE,e)}constructor(){var e;super(),this.container=this.shadowRoot.querySelector('slot[name="icon"]'),this.container.innerHTML="".concat(null!=(e=this.mediaPlaybackRate)?e:1,"x")}}gP.getSlotTemplateHTML=function(e){return'\n    <style>\n      :host {\n        min-width: 5ch;\n        padding: var(--media-button-padding, var(--media-control-padding, 10px 5px));\n      }\n      \n      :host([aria-expanded="true"]) slot[name=tooltip] {\n        display: none;\n      }\n    </style>\n    <slot name="icon">'.concat(e.mediaplaybackrate||1,"x</slot>\n  ")},gP.getTooltipContentHTML=function(){return h4("Playback rate")},ci.customElements.get("media-playback-rate-menu-button")||ci.customElements.define("media-playback-rate-menu-button",gP);var gx=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},gN=(e,t,i)=>(gx(e,t,"read from private field"),i?i.call(e):t.get(e)),gU=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},gF=(e,t,i,r)=>(gx(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i),gB=(e,t,i)=>(gx(e,t,"access private method"),i);bS=new WeakMap,bI=new WeakMap,bR=new WeakSet,bk=function(){if(gN(this,bI).mediaRenditionList===JSON.stringify(this.mediaRenditionList)&&gN(this,bI).mediaHeight===this.mediaHeight)return;gN(this,bI).mediaRenditionList=JSON.stringify(this.mediaRenditionList),gN(this,bI).mediaHeight=this.mediaHeight;let e=this.mediaRenditionList.sort((e,t)=>t.height-e.height);for(let t of e)t.selected=t.id===this.mediaRenditionSelected;this.defaultSlot.textContent="";let t=!this.mediaRenditionSelected;for(let i of e){let e=p3({type:"radio",text:this.formatMenuItemText("".concat(Math.min(i.width,i.height),"p"),i),value:"".concat(i.id),checked:i.selected&&!t});e.prepend(p4(this,"checked-indicator")),this.defaultSlot.append(e)}let i=p3({type:"radio",text:t?this.formatMenuItemText("".concat(h4("Auto")," (").concat(this.mediaHeight,"p)")):this.formatMenuItemText(h4("Auto")),value:"auto",checked:t}),r=this.mediaHeight>0?"".concat(h4("Auto")," (").concat(this.mediaHeight,"p)"):h4("Auto");i.dataset.description=r,i.prepend(p4(this,"checked-indicator")),this.defaultSlot.append(i)},bL=new WeakSet,bD=function(){if(null==this.value)return;let e=new ci.CustomEvent(hL.MEDIA_RENDITION_REQUEST,{composed:!0,bubbles:!0,detail:this.value});this.dispatchEvent(e)},ci.customElements.get("media-rendition-menu")||ci.customElements.define("media-rendition-menu",class extends p8{static get observedAttributes(){return[...super.observedAttributes,hM.MEDIA_RENDITION_LIST,hM.MEDIA_RENDITION_SELECTED,hM.MEDIA_RENDITION_UNAVAILABLE,hM.MEDIA_HEIGHT]}attributeChangedCallback(e,t,i){if(super.attributeChangedCallback(e,t,i),e===hM.MEDIA_RENDITION_SELECTED&&t!==i)this.value=null!=i?i:"auto",gB(this,bR,bk).call(this);else if(e===hM.MEDIA_RENDITION_LIST&&t!==i)gF(this,bS,null==i?void 0:i.split(/\s+/).map(hq)),gB(this,bR,bk).call(this);else e===hM.MEDIA_HEIGHT&&t!==i&&gB(this,bR,bk).call(this)}connectedCallback(){super.connectedCallback(),this.addEventListener("change",gB(this,bL,bD))}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener("change",gB(this,bL,bD))}get anchorElement(){return"auto"!==this.anchor?super.anchorElement:cu(this).querySelector("media-rendition-menu-button")}get mediaRenditionList(){return gN(this,bS)}set mediaRenditionList(e){gF(this,bS,e),gB(this,bR,bk).call(this)}get mediaRenditionSelected(){return cI(this,hM.MEDIA_RENDITION_SELECTED)}set mediaRenditionSelected(e){cR(this,hM.MEDIA_RENDITION_SELECTED,e)}get mediaHeight(){return cT(this,hM.MEDIA_HEIGHT)}set mediaHeight(e){c_(this,hM.MEDIA_HEIGHT,e)}constructor(){super(...arguments),gU(this,bR),gU(this,bL),gU(this,bS,[]),gU(this,bI,{})}});class gH extends gd{static get observedAttributes(){return[...super.observedAttributes,hM.MEDIA_RENDITION_SELECTED,hM.MEDIA_RENDITION_UNAVAILABLE,hM.MEDIA_HEIGHT]}connectedCallback(){super.connectedCallback(),this.setAttribute("aria-label",h4("quality"))}get invokeTargetElement(){return void 0!=this.invokeTarget?super.invokeTargetElement:cu(this).querySelector("media-rendition-menu")}get mediaRenditionSelected(){return cI(this,hM.MEDIA_RENDITION_SELECTED)}set mediaRenditionSelected(e){cR(this,hM.MEDIA_RENDITION_SELECTED,e)}get mediaHeight(){return cT(this,hM.MEDIA_HEIGHT)}set mediaHeight(e){c_(this,hM.MEDIA_HEIGHT,e)}}function gG(){let e=(0,hk._)(["\n  <style>\n    ","\n    ","\n  </style>\n  ","\n"]);return gG=function(){return e},e}function gK(){let e=(0,hk._)(['<track label="thumbnails" default kind="metadata" src="','" />']);return gK=function(){return e},e}function gV(){let e=(0,hk._)([""]);return gV=function(){return e},e}function gW(){let e=(0,hk._)(['\n  <media-theme\n    template="','"\n    defaultstreamtype="','"\n    hotkeys="','"\n    nohotkeys="','"\n    noautoseektolive="','"\n    novolumepref="','"\n    disabled="','"\n    audio="','"\n    style="','"\n    defaultsubtitles="','"\n    forwardseekoffset="','"\n    backwardseekoffset="','"\n    playbackrates="','"\n    defaultshowremainingtime="','"\n    defaultduration="','"\n    hideduration="','"\n    title="','"\n    videotitle="','"\n    proudlydisplaymuxbadge="','"\n    exportparts="','"\n    onclose="','"\n    onfocusin="','"\n  >\n    <mux-video\n      slot="media"\n      inert="','"\n      target-live-window="','"\n      stream-type="','"\n      crossorigin="','"\n      playsinline\n      autoplay="','"\n      muted="','"\n      loop="','"\n      preload="','"\n      debug="','"\n      prefer-cmcd="','"\n      disable-tracking="','"\n      disable-cookies="','"\n      prefer-playback="','"\n      start-time="','"\n      beacon-collection-domain="','"\n      player-init-time="','"\n      player-software-name="','"\n      player-software-version="','"\n      env-key="','"\n      custom-domain="','"\n      src="','"\n      cast-src="','"\n      cast-receiver="','"\n      drm-token="','"\n      exportparts="video"\n      disable-pseudo-ended="','"\n    >\n      ','\n      <slot></slot>\n    </mux-video>\n    <slot name="poster" slot="poster">\n      <media-poster-image\n        part="poster"\n        exportparts="poster, img"\n        src="','"\n        placeholdersrc="','"\n      ></media-poster-image>\n    </slot>\n  </media-theme>\n']);return gW=function(){return e},e}gH.getSlotTemplateHTML=function(){return'\n    <style>\n      :host([aria-expanded="true"]) slot[name=tooltip] {\n        display: none;\n      }\n    </style>\n    <slot name="icon">'.concat('<svg aria-hidden="true" viewBox="0 0 24 24">\n  <path d="M13.5 2.5h2v6h-2v-2h-11v-2h11v-2Zm4 2h4v2h-4v-2Zm-12 4h2v6h-2v-2h-3v-2h3v-2Zm4 2h12v2h-12v-2Zm1 4h2v6h-2v-2h-8v-2h8v-2Zm4 2h7v2h-7v-2Z" />\n</svg>',"</slot>\n  ")},gH.getTooltipContentHTML=function(){return h4("Quality")},ci.customElements.get("media-rendition-menu-button")||ci.customElements.define("media-rendition-menu-button",gH);var gq=e=>{throw TypeError(e)},gY=(e,t,i)=>t.has(e)||gq("Cannot "+i),gj=(e,t,i)=>(gY(e,t,"read from private field"),i?i.call(e):t.get(e)),gQ=(e,t,i)=>t.has(e)?gq("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,i),gz=(e,t,i,r)=>(gY(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i),gX=(e,t,i)=>(gY(e,t,"access private method"),i),gZ=class{addEventListener(){}removeEventListener(){}dispatchEvent(e){return!0}};"undefined"==typeof DocumentFragment&&(globalThis.DocumentFragment=class extends gZ{});var gJ,g$,g0,g1,g2,g3,g4,g5,g8,g9,g6,g7,ve,vt,vi,vr,va,vn,vs,vo,vl,vd,vu,vh,vc,vm,vf,vp,vg,vv,vE,vy,vb,vT,v_,vA,vS,vI,vR,vk,vL,vD,vw,vC,vM,vO,vP,vx,vN,vU,vF,vB,vH,vG,vK,vV,vW,vq,vY,vj,vQ,vz,vX,vZ,vJ,v$,v0,v1,v2,v3,v4,v5,v8,v9,v6,v7,Ee,Et,Ei,Er,Ea,En,Es,Eo,El,Ed,Eu,Eh,Ec,Em,Ef,Ep,Eg,Ev,EE,Ey,Eb,ET,E_,EA,ES,EI,ER,Ek,EL,ED,Ew,EC,EM,EO,EP,Ex,EN,EU,EF,EB,EH,EG,EK,EV,EW,Eq,EY,Ej,EQ,Ez,EX,EZ,EJ,E$,E0,E1,E2,E3,E4,E5,E8,E9,E6,E7,ye,yt,yi,yr,ya,yn,ys,yo,yl,yd,yu,yh,yc,ym,yf,yp,yg,yv,yE,yy,yb,yT,y_,yA,yS,yI,yR,yk,yL,yD,yw,yC,yM,yO,yP,yx,yN,yU,yF,yB,yH,yG,yK,yV,yW,yq,yY,yj,yQ,yz,yX,yZ,yJ,y$,y0,y1,y2,y3,y4,y5,y8,y9,y6,y7,be,bt,bi,br,ba,bn,bs,bo,bl,bd,bu,bh,bc,bm,bf,bp,bg,bv,bE,by,bb,bT,b_,bA,bS,bI,bR,bk,bL,bD,bw,bC=class extends gZ{},bM=class{get detail(){return gj(this,bw)}initCustomEvent(){}constructor(e,t={}){gQ(this,bw),gz(this,bw,null==t?void 0:t.detail)}};bw=new WeakMap;var bO={document:{createElement:function(e,t){return new bC}},DocumentFragment,customElements:{get(e){},define(e,t,i){},getName:e=>null,upgrade(e){},whenDefined:e=>Promise.resolve(bC)},CustomEvent:bM,EventTarget:gZ,HTMLElement:bC,HTMLVideoElement:class extends gZ{}},bP="undefined"==typeof window||void 0===globalThis.customElements,bx=bP?bO:globalThis,bN=bP?bO.document:globalThis.document;function bU(e){return e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function bF(e){return e.replace(/[-_]([a-z])/g,(e,t)=>t.toUpperCase())}function bB(e){if(null==e)return;let t=+e;return Number.isNaN(t)?void 0:t}function bH(e){let t=(function(e){let t={};for(let i in e)null!=e[i]&&(t[i]=e[i]);return new URLSearchParams(t)})(e).toString();return t?"?"+t:""}var bG,bK,bV,bW=(e,t)=>!!e&&!!t&&(!!e.contains(t)||bW(e,t.getRootNode().host)),bq="mux.com",bY=(()=>{try{return"3.6.0"}catch(e){}return"UNKNOWN"})(),bj=function(e){var t;let{token:i,customDomain:r=bq,thumbnailTime:a,programTime:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=null==i?a:void 0,{aud:o}=null!=(t=ln(i))?t:{};if(!(i&&"t"!==o))return"https://image.".concat(r,"/").concat(e,"/thumbnail.webp").concat(bH({token:i,time:s,program_time:n}))},bQ=function(e){var t;let{token:i,customDomain:r=bq,programStartTime:a,programEndTime:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{aud:s}=null!=(t=ln(i))?t:{};if(!(i&&"s"!==s))return"https://image.".concat(r,"/").concat(e,"/storyboard.vtt").concat(bH({token:i,format:"webp",program_start_time:a,program_end_time:n}))},bz=e=>{if(e){if([o1.LIVE,o1.ON_DEMAND].includes(e))return e;if(null!=e&&e.includes("live"))return o1.LIVE}},bX={crossorigin:"crossOrigin",playsinline:"playsInline"},bZ=class{[Symbol.iterator](){return gj(this,bV).values()}get length(){return gj(this,bV).length}get value(){var e;return null!=(e=gj(this,bV).join(" "))?e:""}set value(e){var t;e!==this.value&&(gz(this,bV,[]),this.add(...null!=(t=null==e?void 0:e.split(" "))?t:[]))}toString(){return this.value}item(e){return gj(this,bV)[e]}values(){return gj(this,bV).values()}keys(){return gj(this,bV).keys()}forEach(e){gj(this,bV).forEach(e)}add(){for(var e,t,i=arguments.length,r=Array(i),a=0;a<i;a++)r[a]=arguments[a];r.forEach(e=>{this.contains(e)||gj(this,bV).push(e)}),(""!==this.value||null!=(e=gj(this,bG))&&e.hasAttribute("".concat(gj(this,bK))))&&null!=(t=gj(this,bG))&&t.setAttribute("".concat(gj(this,bK)),"".concat(this.value))}remove(){for(var e,t=arguments.length,i=Array(t),r=0;r<t;r++)i[r]=arguments[r];i.forEach(e=>{gj(this,bV).splice(gj(this,bV).indexOf(e),1)}),null==(e=gj(this,bG))||e.setAttribute("".concat(gj(this,bK)),"".concat(this.value))}contains(e){return gj(this,bV).includes(e)}toggle(e,t){return void 0!==t?t?(this.add(e),!0):(this.remove(e),!1):this.contains(e)?(this.remove(e),!1):(this.add(e),!0)}replace(e,t){this.remove(e),this.add(t)}constructor(e,t){gQ(this,bG),gQ(this,bK),gQ(this,bV,[]),gz(this,bG,e),gz(this,bK,t)}};bG=new WeakMap,bK=new WeakMap,bV=new WeakMap;var bJ="[mux-player ".concat(bY,"]");function b$(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];console.warn(bJ,...t)}function b0(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];console.error(bJ,...t)}function b1(e){var t;let i=null!=(t=e.message)?t:"";e.context&&(i+=" ".concat(e.context)),e.file&&(i+=" ".concat(lo("Read more: "),"\nhttps://github.com/muxinc/elements/blob/main/errors/").concat(e.file)),b$(i)}var b2={AUTOPLAY:"autoplay",CROSSORIGIN:"crossorigin",LOOP:"loop",MUTED:"muted",PLAYSINLINE:"playsinline",PRELOAD:"preload"},b3={VOLUME:"volume",PLAYBACKRATE:"playbackrate",MUTED:"muted"},b4=Object.freeze({length:0,start(e){let t=e>>>0;if(t>=this.length)throw new DOMException("Failed to execute 'start' on 'TimeRanges': The index provided (".concat(t,") is greater than or equal to the maximum bound (").concat(this.length,")."));return 0},end(e){let t=e>>>0;if(t>=this.length)throw new DOMException("Failed to execute 'end' on 'TimeRanges': The index provided (".concat(t,") is greater than or equal to the maximum bound (").concat(this.length,")."));return 0}}),b5=[...Object.values(b2).filter(e=>b2.PLAYSINLINE!==e),...Object.values(b3)];function b8(e,t){return e.media?e.media.getAttribute(t):e.getAttribute(t)}var b9=class extends bx.HTMLElement{static get observedAttributes(){return b5}attributeChangedCallback(e,t,i){var r,a;switch(e){case b3.MUTED:this.media&&(this.media.muted=null!=i,this.media.defaultMuted=null!=i);return;case b3.VOLUME:{let e=null!=(r=bB(i))?r:1;this.media&&(this.media.volume=e);return}case b3.PLAYBACKRATE:{let e=null!=(a=bB(i))?a:1;this.media&&(this.media.playbackRate=e,this.media.defaultPlaybackRate=e);return}}}play(){var e,t;return null!=(t=null==(e=this.media)?void 0:e.play())?t:Promise.reject()}pause(){var e;null==(e=this.media)||e.pause()}load(){var e;null==(e=this.media)||e.load()}get media(){var e;return null==(e=this.shadowRoot)?void 0:e.querySelector("mux-video")}get audioTracks(){return this.media.audioTracks}get videoTracks(){return this.media.videoTracks}get audioRenditions(){return this.media.audioRenditions}get videoRenditions(){return this.media.videoRenditions}get paused(){var e,t;return null==(t=null==(e=this.media)?void 0:e.paused)||t}get duration(){var e,t;return null!=(t=null==(e=this.media)?void 0:e.duration)?t:NaN}get ended(){var e,t;return null!=(t=null==(e=this.media)?void 0:e.ended)&&t}get buffered(){var e,t;return null!=(t=null==(e=this.media)?void 0:e.buffered)?t:b4}get seekable(){var e,t;return null!=(t=null==(e=this.media)?void 0:e.seekable)?t:b4}get readyState(){var e,t;return null!=(t=null==(e=this.media)?void 0:e.readyState)?t:0}get videoWidth(){var e,t;return null!=(t=null==(e=this.media)?void 0:e.videoWidth)?t:0}get videoHeight(){var e,t;return null!=(t=null==(e=this.media)?void 0:e.videoHeight)?t:0}get currentSrc(){var e,t;return null!=(t=null==(e=this.media)?void 0:e.currentSrc)?t:""}get currentTime(){var e,t;return null!=(t=null==(e=this.media)?void 0:e.currentTime)?t:0}set currentTime(e){this.media&&(this.media.currentTime=Number(e))}get volume(){var e,t;return null!=(t=null==(e=this.media)?void 0:e.volume)?t:1}set volume(e){this.media&&(this.media.volume=Number(e))}get playbackRate(){var e,t;return null!=(t=null==(e=this.media)?void 0:e.playbackRate)?t:1}set playbackRate(e){this.media&&(this.media.playbackRate=Number(e))}get defaultPlaybackRate(){var e;return null!=(e=bB(this.getAttribute(b3.PLAYBACKRATE)))?e:1}set defaultPlaybackRate(e){null!=e?this.setAttribute(b3.PLAYBACKRATE,"".concat(e)):this.removeAttribute(b3.PLAYBACKRATE)}get crossOrigin(){return b8(this,b2.CROSSORIGIN)}set crossOrigin(e){this.setAttribute(b2.CROSSORIGIN,"".concat(e))}get autoplay(){return null!=b8(this,b2.AUTOPLAY)}set autoplay(e){e?this.setAttribute(b2.AUTOPLAY,"string"==typeof e?e:""):this.removeAttribute(b2.AUTOPLAY)}get loop(){return null!=b8(this,b2.LOOP)}set loop(e){e?this.setAttribute(b2.LOOP,""):this.removeAttribute(b2.LOOP)}get muted(){var e,t;return null!=(t=null==(e=this.media)?void 0:e.muted)&&t}set muted(e){this.media&&(this.media.muted=!!e)}get defaultMuted(){return null!=b8(this,b2.MUTED)}set defaultMuted(e){e?this.setAttribute(b2.MUTED,""):this.removeAttribute(b2.MUTED)}get playsInline(){return null!=b8(this,b2.PLAYSINLINE)}set playsInline(e){b0("playsInline is set to true by default and is not currently supported as a setter.")}get preload(){return this.media?this.media.preload:this.getAttribute("preload")}set preload(e){["","none","metadata","auto"].includes(e)?this.setAttribute(b2.PRELOAD,e):this.removeAttribute(b2.PRELOAD)}constructor(){super()}},b6=new WeakMap,b7=class e{set(e){if("function"==typeof e)this.handleEvent=e.bind(this.element);else if("object"==typeof e&&"function"==typeof e.handleEvent)this.handleEvent=e.handleEvent.bind(e);else{this.element.removeEventListener(this.type,this);let e=b6.get(this.element);e&&e.delete(this.type)}}static for(t){b6.has(t.element)||b6.set(t.element,new Map);let i=t.attributeName.slice(2),r=b6.get(t.element);return r&&r.has(i)?r.get(i):new e(t.element,i)}constructor(e,t){this.element=e,this.type=t,this.element.addEventListener(this.type,this);let i=b6.get(this.element);i&&i.set(this.type,this)}},Te=new Map,Tt=new WeakMap,Ti=new WeakMap,Tr=class{get template(){if(Te.has(this.stringsKey))return Te.get(this.stringsKey);{let e=bN.createElement("template"),t=this.strings.length-1;return e.innerHTML=this.strings.reduce((e,i,r)=>e+i+(r<t?"{{ ".concat(r," }}"):""),""),Te.set(this.stringsKey,e),e}}renderInto(e){var t;let i=this.template;if(Tt.get(e)!==i){Tt.set(e,i);let t=new pE(i,this.values,this.processor);Ti.set(e,t),e instanceof pR?e.replace(...t.children):e.appendChild(t);return}let r=Ti.get(e);null==(t=null==r?void 0:r.update)||t.call(r,this.values)}constructor(e,t,i){this.strings=e,this.values=t,this.processor=i,this.stringsKey=this.strings.join("\x01")}},Ta={processCallback(e,t,i){var r;if(i)for(let[e,a]of t)e in i&&function(e,t){(function(e,t){if(e instanceof pI&&t instanceof Element){let i=e.element;return i[e.attributeName]!==t&&(e.element.removeAttributeNS(e.attributeNamespace,e.attributeName),i[e.attributeName]=t),!0}return!1})(e,t)||function(e,t){if("boolean"==typeof t&&e instanceof pI){let i=e.attributeNamespace;return t!==e.element.hasAttributeNS(i,e.attributeName)&&(e.booleanValue=t),!0}return!1}(e,t)||e instanceof pI&&e.attributeName.startsWith("on")&&(b7.for(e).set(t),e.element.removeAttributeNS(e.attributeNamespace,e.attributeName),1)||!1===t&&e instanceof pR&&(e.replace(""),1)||t instanceof Tr&&e instanceof pR&&(t.renderInto(e),1)||t instanceof DocumentFragment&&e instanceof pR&&(t.childNodes.length&&e.replace(...t.childNodes),1)||function(e,t){if(e instanceof pI){let i=e.attributeNamespace,r=e.element.getAttributeNS(i,e.attributeName);return String(t)!==r&&(e.value=String(t))}e.value=String(t)}(e,t)}(a,null!=(r=i[e])?r:"")}};function Tn(e){for(var t=arguments.length,i=Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];return new Tr(e,i,Ta)}var Ts=Object.values({TOP:"top",CENTER:"center",BOTTOM:"bottom",LAYER:"layer",MEDIA_LAYER:"media-layer",POSTER_LAYER:"poster-layer",VERTICAL_LAYER:"vertical-layer",CENTERED_LAYER:"centered-layer",GESTURE_LAYER:"gesture-layer",CONTROLLER_LAYER:"controller",BUTTON:"button",RANGE:"range",DISPLAY:"display",CONTROL_BAR:"control-bar",MENU_BUTTON:"menu-button",MENU:"menu",OPTION:"option",POSTER:"poster",LIVE:"live",PLAY:"play",PRE_PLAY:"pre-play",SEEK_BACKWARD:"seek-backward",SEEK_FORWARD:"seek-forward",MUTE:"mute",CAPTIONS:"captions",AIRPLAY:"airplay",PIP:"pip",FULLSCREEN:"fullscreen",CAST:"cast",PLAYBACK_RATE:"playback-rate",VOLUME:"volume",TIME:"time",TITLE:"title",AUDIO_TRACK:"audio-track",RENDITION:"rendition"}).join(", "),To=e=>e.charAt(0).toUpperCase()+e.slice(1),Tl=function(e){var t,i;let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e.muxCode){let a=To(null!=(t=e.errorCategory)?t:"video"),n=oZ(null!=(i=e.errorCategory)?i:oz.VIDEO);if(e.muxCode===oX.NETWORK_OFFLINE)return lo("Your device appears to be offline",r);if(e.muxCode===oX.NETWORK_TOKEN_EXPIRED)return lo("{category} URL has expired",r).format({category:a});if([oX.NETWORK_TOKEN_SUB_MISMATCH,oX.NETWORK_TOKEN_AUD_MISMATCH,oX.NETWORK_TOKEN_AUD_MISSING,oX.NETWORK_TOKEN_MALFORMED].includes(e.muxCode))return lo("{category} URL is formatted incorrectly",r).format({category:a});if(e.muxCode===oX.NETWORK_TOKEN_MISSING)return lo("Invalid {categoryName} URL",r).format({categoryName:n});if(e.muxCode===oX.NETWORK_NOT_FOUND)return lo("{category} does not exist",r).format({category:a});if(e.muxCode===oX.NETWORK_NOT_READY){let t="live"===e.streamType?"Live stream":"Video";return lo("{mediaType} is not currently available",r).format({mediaType:t})}}if(e.code){if(e.code===oJ.MEDIA_ERR_NETWORK)return lo("Network Error",r);if(e.code===oJ.MEDIA_ERR_DECODE)return lo("Media Error",r);if(e.code===oJ.MEDIA_ERR_SRC_NOT_SUPPORTED)return lo("Source Not Supported",r)}return lo("Error",r)},Td=function(e){var t,i;let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e.muxCode){let a=To(null!=(t=e.errorCategory)?t:"video"),n=oZ(null!=(i=e.errorCategory)?i:oz.VIDEO);return e.muxCode===oX.NETWORK_OFFLINE?lo("Check your internet connection and try reloading this video.",r):e.muxCode===oX.NETWORK_TOKEN_EXPIRED?lo("The video’s secured {tokenNamePrefix}-token has expired.",r).format({tokenNamePrefix:n}):e.muxCode===oX.NETWORK_TOKEN_SUB_MISMATCH?lo("The video’s playback ID does not match the one encoded in the {tokenNamePrefix}-token.",r).format({tokenNamePrefix:n}):e.muxCode===oX.NETWORK_TOKEN_MALFORMED?lo("{category} URL is formatted incorrectly",r).format({category:a}):[oX.NETWORK_TOKEN_AUD_MISMATCH,oX.NETWORK_TOKEN_AUD_MISSING].includes(e.muxCode)?lo("The {tokenNamePrefix}-token is formatted with incorrect information.",r).format({tokenNamePrefix:n}):[oX.NETWORK_TOKEN_MISSING,oX.NETWORK_INVALID_URL].includes(e.muxCode)?lo("The video URL or {tokenNamePrefix}-token are formatted with incorrect or incomplete information.",r).format({tokenNamePrefix:n}):e.muxCode===oX.NETWORK_NOT_FOUND?"":e.message}return e.code&&(e.code===oJ.MEDIA_ERR_NETWORK||e.code===oJ.MEDIA_ERR_DECODE||e.code===oJ.MEDIA_ERR_SRC_NOT_SUPPORTED),e.message},Tu=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return{title:Tl(e,t).toString(),message:Td(e,t).toString()}},Th=(e,t)=>{let i=(e=>{if(e.muxCode){if(e.muxCode===oX.NETWORK_TOKEN_EXPIRED)return"403-expired-token.md";if(e.muxCode===oX.NETWORK_TOKEN_MALFORMED)return"403-malformatted-token.md";if([oX.NETWORK_TOKEN_AUD_MISMATCH,oX.NETWORK_TOKEN_AUD_MISSING].includes(e.muxCode))return"403-incorrect-aud-value.md";if(e.muxCode===oX.NETWORK_TOKEN_SUB_MISMATCH)return"403-playback-id-mismatch.md";if(e.muxCode===oX.NETWORK_TOKEN_MISSING)return"missing-signed-tokens.md";if(e.muxCode===oX.NETWORK_NOT_FOUND)return"404-not-found.md";if(e.muxCode===oX.NETWORK_NOT_READY)return"412-not-playable.md"}if(e.code){if(e.code===oJ.MEDIA_ERR_NETWORK)return"";if(e.code===oJ.MEDIA_ERR_DECODE)return"media-decode-error.md";if(e.code===oJ.MEDIA_ERR_SRC_NOT_SUPPORTED)return"media-src-not-supported.md"}return""})(e);return{message:e.message,context:e.context,file:i}},Tc=bN.createElement("template");"innerHTML"in Tc&&(Tc.innerHTML='<template id="media-theme-gerwig">\n  <style>\n    @keyframes pre-play-hide {\n      0% {\n        transform: scale(1);\n        opacity: 1;\n      }\n\n      30% {\n        transform: scale(0.7);\n      }\n\n      100% {\n        transform: scale(1.5);\n        opacity: 0;\n      }\n    }\n\n    :host {\n      --_primary-color: var(--media-primary-color, #fff);\n      --_secondary-color: var(--media-secondary-color, transparent);\n      --_accent-color: var(--media-accent-color, #fa50b5);\n      --_text-color: var(--media-text-color, #000);\n\n      --media-icon-color: var(--_primary-color);\n      --media-control-background: var(--_secondary-color);\n      --media-control-hover-background: var(--_accent-color);\n      --media-time-buffered-color: rgba(255, 255, 255, 0.4);\n      --media-preview-time-text-shadow: none;\n      --media-control-height: 14px;\n      --media-control-padding: 6px;\n      --media-tooltip-container-margin: 6px;\n      --media-tooltip-distance: 18px;\n\n      color: var(--_primary-color);\n      display: inline-block;\n      width: 100%;\n      height: 100%;\n    }\n\n    :host([audio]) {\n      --_secondary-color: var(--media-secondary-color, black);\n      --media-preview-time-text-shadow: none;\n    }\n\n    :host([audio]) ::slotted([slot=\'media\']) {\n      height: 0px;\n    }\n\n    :host([audio]) media-loading-indicator {\n      display: none;\n    }\n\n    :host([audio]) media-controller {\n      background: transparent;\n    }\n\n    :host([audio]) media-controller::part(vertical-layer) {\n      background: transparent;\n    }\n\n    :host([audio]) media-control-bar {\n      width: 100%;\n      background-color: var(--media-control-background);\n    }\n\n    /*\n     * 0.433s is the transition duration for VTT Regions.\n     * Borrowed here, so the captions don\'t move too fast.\n     */\n    media-controller {\n      --media-webkit-text-track-transform: translateY(0) scale(0.98);\n      --media-webkit-text-track-transition: transform 0.433s ease-out 0.3s;\n    }\n    media-controller:is([mediapaused], :not([userinactive])) {\n      --media-webkit-text-track-transform: translateY(-50px) scale(0.98);\n      --media-webkit-text-track-transition: transform 0.15s ease;\n    }\n\n    /*\n     * CSS specific to iOS devices.\n     * See: https://stackoverflow.com/questions/30102792/css-media-query-to-target-only-ios-devices/60220757#60220757\n     */\n    @supports (-webkit-touch-callout: none) {\n      /* Disable subtitle adjusting for iOS Safari */\n      media-controller[mediaisfullscreen] {\n        --media-webkit-text-track-transform: unset;\n        --media-webkit-text-track-transition: unset;\n      }\n    }\n\n    media-time-range {\n      --media-box-padding-left: 6px;\n      --media-box-padding-right: 6px;\n      --media-range-bar-color: var(--_accent-color);\n      --media-time-range-buffered-color: var(--_primary-color);\n      --media-range-track-color: transparent;\n      --media-range-track-background: rgba(255, 255, 255, 0.4);\n      --media-range-thumb-background: radial-gradient(\n        circle,\n        #000 0%,\n        #000 25%,\n        var(--_accent-color) 25%,\n        var(--_accent-color)\n      );\n      --media-range-thumb-width: 12px;\n      --media-range-thumb-height: 12px;\n      --media-range-thumb-transform: scale(0);\n      --media-range-thumb-transition: transform 0.3s;\n      --media-range-thumb-opacity: 1;\n      --media-preview-background: var(--_primary-color);\n      --media-box-arrow-background: var(--_primary-color);\n      --media-preview-thumbnail-border: 5px solid var(--_primary-color);\n      --media-preview-border-radius: 5px;\n      --media-text-color: var(--_text-color);\n      --media-control-hover-background: transparent;\n      --media-preview-chapter-text-shadow: none;\n      color: var(--_accent-color);\n      padding: 0 6px;\n    }\n\n    :host([audio]) media-time-range {\n      --media-preview-time-padding: 1.5px 6px;\n      --media-preview-box-margin: 0 0 -5px;\n    }\n\n    media-time-range:hover {\n      --media-range-thumb-transform: scale(1);\n    }\n\n    media-preview-thumbnail {\n      border-bottom-width: 0;\n    }\n\n    [part~=\'menu\'] {\n      border-radius: 2px;\n      border: 1px solid rgba(0, 0, 0, 0.1);\n      bottom: 50px;\n      padding: 2.5px 10px;\n    }\n\n    [part~=\'menu\']::part(indicator) {\n      fill: var(--_accent-color);\n    }\n\n    [part~=\'menu\']::part(menu-item) {\n      box-sizing: border-box;\n      display: flex;\n      align-items: center;\n      padding: 6px 10px;\n      min-height: 34px;\n    }\n\n    [part~=\'menu\']::part(checked) {\n      font-weight: 700;\n    }\n\n    media-captions-menu,\n    media-rendition-menu,\n    media-audio-track-menu,\n    media-playback-rate-menu {\n      position: absolute; /* ensure they don\'t take up space in DOM on load */\n      --media-menu-background: var(--_primary-color);\n      --media-menu-item-checked-background: transparent;\n      --media-text-color: var(--_text-color);\n      --media-menu-item-hover-background: transparent;\n      --media-menu-item-hover-outline: var(--_accent-color) solid 1px;\n    }\n\n    media-rendition-menu {\n      min-width: 140px;\n    }\n\n    /* The icon is a circle so make it 16px high instead of 14px for more balance. */\n    media-audio-track-menu-button {\n      --media-control-padding: 5px;\n      --media-control-height: 16px;\n    }\n\n    media-playback-rate-menu-button {\n      --media-control-padding: 6px 3px;\n      min-width: 4.4ch;\n    }\n\n    media-playback-rate-menu {\n      --media-menu-flex-direction: row;\n      --media-menu-item-checked-background: var(--_accent-color);\n      --media-menu-item-checked-indicator-display: none;\n      margin-right: 6px;\n      padding: 0;\n      --media-menu-gap: 0.25em;\n    }\n\n    media-playback-rate-menu[part~=\'menu\']::part(menu-item) {\n      padding: 6px 6px 6px 8px;\n    }\n\n    media-playback-rate-menu[part~=\'menu\']::part(checked) {\n      color: #fff;\n    }\n\n    :host(:not([audio])) media-time-range {\n      /* Adding px is required here for calc() */\n      --media-range-padding: 0px;\n      background: transparent;\n      z-index: 10;\n      height: 10px;\n      bottom: -3px;\n      width: 100%;\n    }\n\n    media-control-bar :is([role=\'button\'], [role=\'switch\'], button) {\n      line-height: 0;\n    }\n\n    media-control-bar :is([part*=\'button\'], [part*=\'range\'], [part*=\'display\']) {\n      border-radius: 3px;\n    }\n\n    .spacer {\n      flex-grow: 1;\n      background-color: var(--media-control-background, rgba(20, 20, 30, 0.7));\n    }\n\n    media-control-bar[slot~=\'top-chrome\'] {\n      min-height: 42px;\n      pointer-events: none;\n    }\n\n    media-control-bar {\n      --gradient-steps:\n        hsl(0 0% 0% / 0) 0%, hsl(0 0% 0% / 0.013) 8.1%, hsl(0 0% 0% / 0.049) 15.5%, hsl(0 0% 0% / 0.104) 22.5%,\n        hsl(0 0% 0% / 0.175) 29%, hsl(0 0% 0% / 0.259) 35.3%, hsl(0 0% 0% / 0.352) 41.2%, hsl(0 0% 0% / 0.45) 47.1%,\n        hsl(0 0% 0% / 0.55) 52.9%, hsl(0 0% 0% / 0.648) 58.8%, hsl(0 0% 0% / 0.741) 64.7%, hsl(0 0% 0% / 0.825) 71%,\n        hsl(0 0% 0% / 0.896) 77.5%, hsl(0 0% 0% / 0.951) 84.5%, hsl(0 0% 0% / 0.987) 91.9%, hsl(0 0% 0%) 100%;\n    }\n\n    :host([title]) media-control-bar[slot=\'top-chrome\']::before,\n    :host([videotitle]) media-control-bar[slot=\'top-chrome\']::before {\n      content: \'\';\n      position: absolute;\n      width: 100%;\n      padding-bottom: min(100px, 25%);\n      background: linear-gradient(to top, var(--gradient-steps));\n      opacity: 0.8;\n      pointer-events: none;\n    }\n\n    :host(:not([audio])) media-control-bar[part~=\'bottom\']::before {\n      content: \'\';\n      position: absolute;\n      width: 100%;\n      bottom: 0;\n      left: 0;\n      padding-bottom: min(100px, 25%);\n      background: linear-gradient(to bottom, var(--gradient-steps));\n      opacity: 0.8;\n      z-index: 1;\n      pointer-events: none;\n    }\n\n    media-control-bar[part~=\'bottom\'] > * {\n      z-index: 20;\n    }\n\n    media-control-bar[part~=\'bottom\'] {\n      padding: 6px 6px;\n    }\n\n    media-control-bar[slot~=\'top-chrome\'] > * {\n      --media-control-background: transparent;\n      --media-control-hover-background: transparent;\n      position: relative;\n    }\n\n    media-controller::part(vertical-layer) {\n      transition: background-color 1s;\n    }\n\n    media-controller:is([mediapaused], :not([userinactive]))::part(vertical-layer) {\n      background-color: var(--controls-backdrop-color, var(--controls, transparent));\n      transition: background-color 0.25s;\n    }\n\n    .center-controls {\n      --media-button-icon-width: 100%;\n      --media-button-icon-height: auto;\n      --media-tooltip-display: none;\n      pointer-events: none;\n      width: 100%;\n      display: flex;\n      flex-flow: row;\n      align-items: center;\n      justify-content: center;\n      filter: drop-shadow(0 0 2px rgb(0 0 0 / 0.25)) drop-shadow(0 0 6px rgb(0 0 0 / 0.25));\n      paint-order: stroke;\n      stroke: rgba(102, 102, 102, 1);\n      stroke-width: 0.3px;\n      text-shadow:\n        0 0 2px rgb(0 0 0 / 0.25),\n        0 0 6px rgb(0 0 0 / 0.25);\n    }\n\n    .center-controls media-play-button {\n      --media-control-background: transparent;\n      --media-control-hover-background: transparent;\n      --media-control-padding: 0;\n      width: 40px;\n    }\n\n    [breakpointsm] .center-controls media-play-button {\n      width: 90px;\n      height: 90px;\n      border-radius: 50%;\n      transition: background 0.4s;\n      padding: 24px;\n      --media-control-background: #000;\n      --media-control-hover-background: var(--_accent-color);\n    }\n\n    .center-controls media-seek-backward-button,\n    .center-controls media-seek-forward-button {\n      --media-control-background: transparent;\n      --media-control-hover-background: transparent;\n      padding: 0;\n      margin: 0 20px;\n      width: max(33px, min(8%, 40px));\n    }\n\n    [breakpointsm]:not([audio]) .center-controls.pre-playback {\n      display: grid;\n      align-items: initial;\n      justify-content: initial;\n      height: 100%;\n      overflow: hidden;\n    }\n\n    [breakpointsm]:not([audio]) .center-controls.pre-playback media-play-button {\n      place-self: var(--_pre-playback-place, center);\n      grid-area: 1 / 1;\n      margin: 16px;\n    }\n\n    /* Show and hide controls or pre-playback state */\n\n    [breakpointsm]:is([mediahasplayed], :not([mediapaused])):not([audio])\n      .center-controls.pre-playback\n      media-play-button {\n      /* Using `forwards` would lead to a laggy UI after the animation got in the end state */\n      animation: 0.3s linear pre-play-hide;\n      opacity: 0;\n      pointer-events: none;\n    }\n\n    .autoplay-unmute {\n      --media-control-hover-background: transparent;\n      width: 100%;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      filter: drop-shadow(0 0 2px rgb(0 0 0 / 0.25)) drop-shadow(0 0 6px rgb(0 0 0 / 0.25));\n    }\n\n    .autoplay-unmute-btn {\n      --media-control-height: 16px;\n      border-radius: 8px;\n      background: #000;\n      color: var(--_primary-color);\n      display: flex;\n      align-items: center;\n      padding: 8px 16px;\n      font-size: 18px;\n      font-weight: 500;\n      cursor: pointer;\n    }\n\n    .autoplay-unmute-btn:hover {\n      background: var(--_accent-color);\n    }\n\n    [breakpointsm] .autoplay-unmute-btn {\n      --media-control-height: 30px;\n      padding: 14px 24px;\n      font-size: 26px;\n    }\n\n    .autoplay-unmute-btn svg {\n      margin: 0 6px 0 0;\n    }\n\n    [breakpointsm] .autoplay-unmute-btn svg {\n      margin: 0 10px 0 0;\n    }\n\n    media-controller:not([audio]):not([mediahasplayed]) *:is(media-control-bar, media-time-range) {\n      display: none;\n    }\n\n    media-error-dialog:not([mediaerrorcode]) {\n      opacity: 0;\n    }\n\n    media-loading-indicator {\n      --media-loading-icon-width: 100%;\n      --media-button-icon-height: auto;\n      display: var(--media-control-display, var(--media-loading-indicator-display, flex));\n      pointer-events: none;\n      position: absolute;\n      width: min(15%, 150px);\n      flex-flow: row;\n      align-items: center;\n      justify-content: center;\n    }\n\n    /* Intentionally don\'t target the div for transition but the children\n     of the div. Prevents messing with media-chrome\'s autohide feature. */\n    media-loading-indicator + div * {\n      transition: opacity 0.15s;\n      opacity: 1;\n    }\n\n    media-loading-indicator[medialoading]:not([mediapaused]) ~ div > * {\n      opacity: 0;\n      transition-delay: 400ms;\n    }\n\n    media-volume-range {\n      width: min(100%, 100px);\n      --media-range-padding-left: 10px;\n      --media-range-padding-right: 10px;\n      --media-range-thumb-width: 12px;\n      --media-range-thumb-height: 12px;\n      --media-range-thumb-background: radial-gradient(\n        circle,\n        #000 0%,\n        #000 25%,\n        var(--_primary-color) 25%,\n        var(--_primary-color)\n      );\n      --media-control-hover-background: none;\n    }\n\n    media-time-display {\n      white-space: nowrap;\n    }\n\n    /* Generic style for explicitly disabled controls */\n    media-control-bar[part~=\'bottom\'] [disabled],\n    media-control-bar[part~=\'bottom\'] [aria-disabled=\'true\'] {\n      opacity: 60%;\n      cursor: not-allowed;\n    }\n\n    media-text-display {\n      --media-font-size: 16px;\n      --media-control-padding: 14px;\n      font-weight: 500;\n    }\n\n    media-play-button.animated *:is(g, path) {\n      transition: all 0.3s;\n    }\n\n    media-play-button.animated[mediapaused] .pause-icon-pt1 {\n      opacity: 0;\n    }\n\n    media-play-button.animated[mediapaused] .pause-icon-pt2 {\n      transform-origin: center center;\n      transform: scaleY(0);\n    }\n\n    media-play-button.animated[mediapaused] .play-icon {\n      clip-path: inset(0 0 0 0);\n    }\n\n    media-play-button.animated:not([mediapaused]) .play-icon {\n      clip-path: inset(0 0 0 100%);\n    }\n\n    media-seek-forward-button,\n    media-seek-backward-button {\n      --media-font-weight: 400;\n    }\n\n    .mute-icon {\n      display: inline-block;\n    }\n\n    .mute-icon :is(path, g) {\n      transition: opacity 0.5s;\n    }\n\n    .muted {\n      opacity: 0;\n    }\n\n    media-mute-button[mediavolumelevel=\'low\'] :is(.volume-medium, .volume-high),\n    media-mute-button[mediavolumelevel=\'medium\'] :is(.volume-high) {\n      opacity: 0;\n    }\n\n    media-mute-button[mediavolumelevel=\'off\'] .unmuted {\n      opacity: 0;\n    }\n\n    media-mute-button[mediavolumelevel=\'off\'] .muted {\n      opacity: 1;\n    }\n\n    /**\n     * Our defaults for these buttons are to hide them at small sizes\n     * users can override this with CSS\n     */\n    media-controller:not([breakpointsm]):not([audio]) {\n      --bottom-play-button: none;\n      --bottom-seek-backward-button: none;\n      --bottom-seek-forward-button: none;\n      --bottom-time-display: none;\n      --bottom-playback-rate-menu-button: none;\n      --bottom-pip-button: none;\n    }\n\n    [part=\'mux-badge\'] {\n      position: absolute;\n      bottom: 10px;\n      right: 10px;\n      z-index: 2;\n      opacity: 0.6;\n      transition:\n        opacity 0.2s ease-in-out,\n        bottom 0.2s ease-in-out;\n    }\n\n    [part=\'mux-badge\']:hover {\n      opacity: 1;\n    }\n\n    [part=\'mux-badge\'] a {\n      font-size: 14px;\n      font-family: var(--_font-family);\n      color: var(--_primary-color);\n      text-decoration: none;\n      display: flex;\n      align-items: center;\n      gap: 5px;\n    }\n\n    [part=\'mux-badge\'] .mux-badge-text {\n      transition: opacity 0.5s ease-in-out;\n      opacity: 0;\n    }\n\n    [part=\'mux-badge\'] .mux-badge-logo {\n      width: 40px;\n      height: auto;\n      display: inline-block;\n    }\n\n    [part=\'mux-badge\'] .mux-badge-logo svg {\n      width: 100%;\n      height: 100%;\n      fill: white;\n    }\n\n    media-controller:not([userinactive]):not([mediahasplayed]) [part=\'mux-badge\'],\n    media-controller:not([userinactive]) [part=\'mux-badge\'],\n    media-controller[mediahasplayed][mediapaused] [part=\'mux-badge\'] {\n      transition: bottom 0.1s ease-in-out;\n    }\n\n    media-controller[userinactive]:not([mediapaused]) [part=\'mux-badge\'] {\n      transition: bottom 0.2s ease-in-out 0.62s;\n    }\n\n    media-controller:not([userinactive]) [part=\'mux-badge\'] .mux-badge-text,\n    media-controller[mediahasplayed][mediapaused] [part=\'mux-badge\'] .mux-badge-text {\n      opacity: 1;\n    }\n\n    media-controller[userinactive]:not([mediapaused]) [part=\'mux-badge\'] .mux-badge-text {\n      opacity: 0;\n    }\n\n    media-controller[userinactive]:not([mediapaused]) [part=\'mux-badge\'] {\n      bottom: 10px;\n    }\n\n    media-controller:not([userinactive]):not([mediahasplayed]) [part=\'mux-badge\'] {\n      bottom: 10px;\n    }\n\n    media-controller:not([userinactive])[mediahasplayed] [part=\'mux-badge\'],\n    media-controller[mediahasplayed][mediapaused] [part=\'mux-badge\'] {\n      bottom: calc(28px + var(--media-control-height, 0px) + var(--media-control-padding, 0px) * 2);\n    }\n  </style>\n\n  <template partial="TitleDisplay">\n    <template if="videotitle">\n      <template if="videotitle != true">\n        <media-text-display part="top title display" class="title-display">{{videotitle}}</media-text-display>\n      </template>\n    </template>\n    <template if="!videotitle">\n      <template if="title">\n        <media-text-display part="top title display" class="title-display">{{title}}</media-text-display>\n      </template>\n    </template>\n  </template>\n\n  <template partial="PlayButton">\n    <media-play-button\n      part="{{section ?? \'bottom\'}} play button"\n      disabled="{{disabled}}"\n      aria-disabled="{{disabled}}"\n      class="animated"\n    >\n      <svg aria-hidden="true" viewBox="0 0 18 14" slot="icon">\n        <g class="play-icon">\n          <path\n            d="M15.5987 6.2911L3.45577 0.110898C2.83667 -0.204202 2.06287 0.189698 2.06287 0.819798V13.1802C2.06287 13.8103 2.83667 14.2042 3.45577 13.8891L15.5987 7.7089C16.2178 7.3938 16.2178 6.6061 15.5987 6.2911Z"\n          />\n        </g>\n        <g class="pause-icon">\n          <path\n            class="pause-icon-pt1"\n            d="M5.90709 0H2.96889C2.46857 0 2.06299 0.405585 2.06299 0.9059V13.0941C2.06299 13.5944 2.46857 14 2.96889 14H5.90709C6.4074 14 6.81299 13.5944 6.81299 13.0941V0.9059C6.81299 0.405585 6.4074 0 5.90709 0Z"\n          />\n          <path\n            class="pause-icon-pt2"\n            d="M15.1571 0H12.2189C11.7186 0 11.313 0.405585 11.313 0.9059V13.0941C11.313 13.5944 11.7186 14 12.2189 14H15.1571C15.6574 14 16.063 13.5944 16.063 13.0941V0.9059C16.063 0.405585 15.6574 0 15.1571 0Z"\n          />\n        </g>\n      </svg>\n    </media-play-button>\n  </template>\n\n  <template partial="PrePlayButton">\n    <media-play-button\n      part="{{section ?? \'center\'}} play button pre-play"\n      disabled="{{disabled}}"\n      aria-disabled="{{disabled}}"\n    >\n      <svg aria-hidden="true" viewBox="0 0 18 14" slot="icon" style="transform: translate(3px, 0)">\n        <path\n          d="M15.5987 6.2911L3.45577 0.110898C2.83667 -0.204202 2.06287 0.189698 2.06287 0.819798V13.1802C2.06287 13.8103 2.83667 14.2042 3.45577 13.8891L15.5987 7.7089C16.2178 7.3938 16.2178 6.6061 15.5987 6.2911Z"\n        />\n      </svg>\n    </media-play-button>\n  </template>\n\n  <template partial="SeekBackwardButton">\n    <media-seek-backward-button\n      seekoffset="{{backwardseekoffset}}"\n      part="{{section ?? \'bottom\'}} seek-backward button"\n      disabled="{{disabled}}"\n      aria-disabled="{{disabled}}"\n    >\n      <svg viewBox="0 0 22 14" aria-hidden="true" slot="icon">\n        <path\n          d="M3.65 2.07888L0.0864 6.7279C-0.0288 6.87812 -0.0288 7.12188 0.0864 7.2721L3.65 11.9211C3.7792 12.0896 4 11.9703 4 11.7321V2.26787C4 2.02968 3.7792 1.9104 3.65 2.07888Z"\n        />\n        <text transform="translate(6 12)" style="font-size: 14px; font-family: \'ArialMT\', \'Arial\'">\n          {{backwardseekoffset}}\n        </text>\n      </svg>\n    </media-seek-backward-button>\n  </template>\n\n  <template partial="SeekForwardButton">\n    <media-seek-forward-button\n      seekoffset="{{forwardseekoffset}}"\n      part="{{section ?? \'bottom\'}} seek-forward button"\n      disabled="{{disabled}}"\n      aria-disabled="{{disabled}}"\n    >\n      <svg viewBox="0 0 22 14" aria-hidden="true" slot="icon">\n        <g>\n          <text transform="translate(-1 12)" style="font-size: 14px; font-family: \'ArialMT\', \'Arial\'">\n            {{forwardseekoffset}}\n          </text>\n          <path\n            d="M18.35 11.9211L21.9136 7.2721C22.0288 7.12188 22.0288 6.87812 21.9136 6.7279L18.35 2.07888C18.2208 1.91041 18 2.02968 18 2.26787V11.7321C18 11.9703 18.2208 12.0896 18.35 11.9211Z"\n          />\n        </g>\n      </svg>\n    </media-seek-forward-button>\n  </template>\n\n  <template partial="MuteButton">\n    <media-mute-button part="bottom mute button" disabled="{{disabled}}" aria-disabled="{{disabled}}">\n      <svg viewBox="0 0 18 14" slot="icon" class="mute-icon" aria-hidden="true">\n        <g class="unmuted">\n          <path\n            d="M6.76786 1.21233L3.98606 3.98924H1.19937C0.593146 3.98924 0.101743 4.51375 0.101743 5.1607V6.96412L0 6.99998L0.101743 7.03583V8.83926C0.101743 9.48633 0.593146 10.0108 1.19937 10.0108H3.98606L6.76773 12.7877C7.23561 13.2547 8 12.9007 8 12.2171V1.78301C8 1.09925 7.23574 0.745258 6.76786 1.21233Z"\n          />\n          <path\n            class="volume-low"\n            d="M10 3.54781C10.7452 4.55141 11.1393 5.74511 11.1393 6.99991C11.1393 8.25471 10.7453 9.44791 10 10.4515L10.7988 11.0496C11.6734 9.87201 12.1356 8.47161 12.1356 6.99991C12.1356 5.52821 11.6735 4.12731 10.7988 2.94971L10 3.54781Z"\n          />\n          <path\n            class="volume-medium"\n            d="M12.3778 2.40086C13.2709 3.76756 13.7428 5.35806 13.7428 7.00026C13.7428 8.64246 13.2709 10.233 12.3778 11.5992L13.2106 12.1484C14.2107 10.6185 14.739 8.83796 14.739 7.00016C14.739 5.16236 14.2107 3.38236 13.2106 1.85156L12.3778 2.40086Z"\n          />\n          <path\n            class="volume-high"\n            d="M15.5981 0.75L14.7478 1.2719C15.7937 2.9919 16.3468 4.9723 16.3468 7C16.3468 9.0277 15.7937 11.0082 14.7478 12.7281L15.5981 13.25C16.7398 11.3722 17.343 9.211 17.343 7C17.343 4.789 16.7398 2.6268 15.5981 0.75Z"\n          />\n        </g>\n        <g class="muted">\n          <path\n            fill-rule="evenodd"\n            clip-rule="evenodd"\n            d="M4.39976 4.98924H1.19937C1.19429 4.98924 1.17777 4.98961 1.15296 5.01609C1.1271 5.04369 1.10174 5.09245 1.10174 5.1607V8.83926C1.10174 8.90761 1.12714 8.95641 1.15299 8.984C1.17779 9.01047 1.1943 9.01084 1.19937 9.01084H4.39977L7 11.6066V2.39357L4.39976 4.98924ZM7.47434 1.92006C7.4743 1.9201 7.47439 1.92002 7.47434 1.92006V1.92006ZM6.76773 12.7877L3.98606 10.0108H1.19937C0.593146 10.0108 0.101743 9.48633 0.101743 8.83926V7.03583L0 6.99998L0.101743 6.96412V5.1607C0.101743 4.51375 0.593146 3.98924 1.19937 3.98924H3.98606L6.76786 1.21233C7.23574 0.745258 8 1.09925 8 1.78301V12.2171C8 12.9007 7.23561 13.2547 6.76773 12.7877Z"\n          />\n          <path\n            fill-rule="evenodd"\n            clip-rule="evenodd"\n            d="M15.2677 9.30323C15.463 9.49849 15.7796 9.49849 15.9749 9.30323C16.1701 9.10796 16.1701 8.79138 15.9749 8.59612L14.2071 6.82841L15.9749 5.06066C16.1702 4.8654 16.1702 4.54882 15.9749 4.35355C15.7796 4.15829 15.4631 4.15829 15.2678 4.35355L13.5 6.1213L11.7322 4.35348C11.537 4.15822 11.2204 4.15822 11.0251 4.35348C10.8298 4.54874 10.8298 4.86532 11.0251 5.06058L12.7929 6.82841L11.0251 8.59619C10.8299 8.79146 10.8299 9.10804 11.0251 9.3033C11.2204 9.49856 11.537 9.49856 11.7323 9.3033L13.5 7.53552L15.2677 9.30323Z"\n          />\n        </g>\n      </svg>\n    </media-mute-button>\n  </template>\n\n  <template partial="PipButton">\n    <media-pip-button part="bottom pip button" disabled="{{disabled}}" aria-disabled="{{disabled}}">\n      <svg viewBox="0 0 18 14" aria-hidden="true" slot="icon">\n        <path\n          d="M15.9891 0H2.011C0.9004 0 0 0.9003 0 2.0109V11.989C0 13.0996 0.9004 14 2.011 14H15.9891C17.0997 14 18 13.0997 18 11.9891V2.0109C18 0.9003 17.0997 0 15.9891 0ZM17 11.9891C17 12.5465 16.5465 13 15.9891 13H2.011C1.4536 13 1.0001 12.5465 1.0001 11.9891V2.0109C1.0001 1.4535 1.4536 0.9999 2.011 0.9999H15.9891C16.5465 0.9999 17 1.4535 17 2.0109V11.9891Z"\n        />\n        <path\n          d="M15.356 5.67822H8.19523C8.03253 5.67822 7.90063 5.81012 7.90063 5.97282V11.3836C7.90063 11.5463 8.03253 11.6782 8.19523 11.6782H15.356C15.5187 11.6782 15.6506 11.5463 15.6506 11.3836V5.97282C15.6506 5.81012 15.5187 5.67822 15.356 5.67822Z"\n        />\n      </svg>\n    </media-pip-button>\n  </template>\n\n  <template partial="CaptionsMenu">\n    <media-captions-menu-button part="bottom captions button">\n      <svg aria-hidden="true" viewBox="0 0 18 14" slot="on">\n        <path\n          d="M15.989 0H2.011C0.9004 0 0 0.9003 0 2.0109V11.9891C0 13.0997 0.9004 14 2.011 14H15.989C17.0997 14 18 13.0997 18 11.9891V2.0109C18 0.9003 17.0997 0 15.989 0ZM4.2292 8.7639C4.5954 9.1902 5.0935 9.4031 5.7233 9.4031C6.1852 9.4031 6.5544 9.301 6.8302 9.0969C7.1061 8.8933 7.2863 8.614 7.3702 8.26H8.4322C8.3062 8.884 8.0093 9.3733 7.5411 9.7273C7.0733 10.0813 6.4703 10.2581 5.732 10.2581C5.108 10.2581 4.5699 10.1219 4.1168 9.8489C3.6637 9.5759 3.3141 9.1946 3.0685 8.7058C2.8224 8.2165 2.6994 7.6511 2.6994 7.009C2.6994 6.3611 2.8224 5.7927 3.0685 5.3034C3.3141 4.8146 3.6637 4.4323 4.1168 4.1559C4.5699 3.88 5.108 3.7418 5.732 3.7418C6.4703 3.7418 7.0733 3.922 7.5411 4.2818C8.0094 4.6422 8.3062 5.1461 8.4322 5.794H7.3702C7.2862 5.4283 7.106 5.1368 6.8302 4.921C6.5544 4.7052 6.1852 4.5968 5.7233 4.5968C5.0934 4.5968 4.5954 4.8116 4.2292 5.2404C3.8635 5.6696 3.6804 6.259 3.6804 7.009C3.6804 7.7531 3.8635 8.3381 4.2292 8.7639ZM11.0974 8.7639C11.4636 9.1902 11.9617 9.4031 12.5915 9.4031C13.0534 9.4031 13.4226 9.301 13.6984 9.0969C13.9743 8.8933 14.1545 8.614 14.2384 8.26H15.3004C15.1744 8.884 14.8775 9.3733 14.4093 9.7273C13.9415 10.0813 13.3385 10.2581 12.6002 10.2581C11.9762 10.2581 11.4381 10.1219 10.985 9.8489C10.5319 9.5759 10.1823 9.1946 9.9367 8.7058C9.6906 8.2165 9.5676 7.6511 9.5676 7.009C9.5676 6.3611 9.6906 5.7927 9.9367 5.3034C10.1823 4.8146 10.5319 4.4323 10.985 4.1559C11.4381 3.88 11.9762 3.7418 12.6002 3.7418C13.3385 3.7418 13.9415 3.922 14.4093 4.2818C14.8776 4.6422 15.1744 5.1461 15.3004 5.794H14.2384C14.1544 5.4283 13.9742 5.1368 13.6984 4.921C13.4226 4.7052 13.0534 4.5968 12.5915 4.5968C11.9616 4.5968 11.4636 4.8116 11.0974 5.2404C10.7317 5.6696 10.5486 6.259 10.5486 7.009C10.5486 7.7531 10.7317 8.3381 11.0974 8.7639Z"\n        />\n      </svg>\n      <svg aria-hidden="true" viewBox="0 0 18 14" slot="off">\n        <path\n          d="M5.73219 10.258C5.10819 10.258 4.57009 10.1218 4.11699 9.8488C3.66389 9.5758 3.31429 9.1945 3.06869 8.7057C2.82259 8.2164 2.69958 7.651 2.69958 7.0089C2.69958 6.361 2.82259 5.7926 3.06869 5.3033C3.31429 4.8145 3.66389 4.4322 4.11699 4.1558C4.57009 3.8799 5.10819 3.7417 5.73219 3.7417C6.47049 3.7417 7.07348 3.9219 7.54128 4.2817C8.00958 4.6421 8.30638 5.146 8.43238 5.7939H7.37039C7.28639 5.4282 7.10618 5.1367 6.83039 4.9209C6.55459 4.7051 6.18538 4.5967 5.72348 4.5967C5.09358 4.5967 4.59559 4.8115 4.22939 5.2403C3.86369 5.6695 3.68058 6.2589 3.68058 7.0089C3.68058 7.753 3.86369 8.338 4.22939 8.7638C4.59559 9.1901 5.09368 9.403 5.72348 9.403C6.18538 9.403 6.55459 9.3009 6.83039 9.0968C7.10629 8.8932 7.28649 8.6139 7.37039 8.2599H8.43238C8.30638 8.8839 8.00948 9.3732 7.54128 9.7272C7.07348 10.0812 6.47049 10.258 5.73219 10.258Z"\n        />\n        <path\n          d="M12.6003 10.258C11.9763 10.258 11.4382 10.1218 10.9851 9.8488C10.532 9.5758 10.1824 9.1945 9.93685 8.7057C9.69075 8.2164 9.56775 7.651 9.56775 7.0089C9.56775 6.361 9.69075 5.7926 9.93685 5.3033C10.1824 4.8145 10.532 4.4322 10.9851 4.1558C11.4382 3.8799 11.9763 3.7417 12.6003 3.7417C13.3386 3.7417 13.9416 3.9219 14.4094 4.2817C14.8777 4.6421 15.1745 5.146 15.3005 5.7939H14.2385C14.1545 5.4282 13.9743 5.1367 13.6985 4.9209C13.4227 4.7051 13.0535 4.5967 12.5916 4.5967C11.9617 4.5967 11.4637 4.8115 11.0975 5.2403C10.7318 5.6695 10.5487 6.2589 10.5487 7.0089C10.5487 7.753 10.7318 8.338 11.0975 8.7638C11.4637 9.1901 11.9618 9.403 12.5916 9.403C13.0535 9.403 13.4227 9.3009 13.6985 9.0968C13.9744 8.8932 14.1546 8.6139 14.2385 8.2599H15.3005C15.1745 8.8839 14.8776 9.3732 14.4094 9.7272C13.9416 10.0812 13.3386 10.258 12.6003 10.258Z"\n        />\n        <path\n          d="M15.9891 1C16.5465 1 17 1.4535 17 2.011V11.9891C17 12.5465 16.5465 13 15.9891 13H2.0109C1.4535 13 1 12.5465 1 11.9891V2.0109C1 1.4535 1.4535 0.9999 2.0109 0.9999L15.9891 1ZM15.9891 0H2.0109C0.9003 0 0 0.9003 0 2.0109V11.9891C0 13.0997 0.9003 14 2.0109 14H15.9891C17.0997 14 18 13.0997 18 11.9891V2.0109C18 0.9003 17.0997 0 15.9891 0Z"\n        />\n      </svg>\n    </media-captions-menu-button>\n    <media-captions-menu\n      hidden\n      anchor="auto"\n      part="bottom captions menu"\n      disabled="{{disabled}}"\n      aria-disabled="{{disabled}}"\n      exportparts="menu-item"\n    >\n      <div slot="checked-indicator">\n        <style>\n          .indicator {\n            position: relative;\n            top: 1px;\n            width: 0.9em;\n            height: auto;\n            fill: var(--_accent-color);\n            margin-right: 5px;\n          }\n\n          [aria-checked=\'false\'] .indicator {\n            display: none;\n          }\n        </style>\n        <svg viewBox="0 0 14 18" class="indicator">\n          <path\n            d="M12.252 3.48c-.115.033-.301.161-.425.291-.059.063-1.407 1.815-2.995 3.894s-2.897 3.79-2.908 3.802c-.013.014-.661-.616-1.672-1.624-.908-.905-1.702-1.681-1.765-1.723-.401-.27-.783-.211-1.176.183a1.285 1.285 0 0 0-.261.342.582.582 0 0 0-.082.35c0 .165.01.205.08.35.075.153.213.296 2.182 2.271 1.156 1.159 2.17 2.159 2.253 2.222.189.143.338.196.539.194.203-.003.412-.104.618-.299.205-.193 6.7-8.693 6.804-8.903a.716.716 0 0 0 .085-.345c.01-.179.005-.203-.062-.339-.124-.252-.45-.531-.746-.639a.784.784 0 0 0-.469-.027"\n            fill-rule="evenodd"\n          />\n        </svg></div\n    ></media-captions-menu>\n  </template>\n\n  <template partial="AirplayButton">\n    <media-airplay-button part="bottom airplay button" disabled="{{disabled}}" aria-disabled="{{disabled}}">\n      <svg viewBox="0 0 18 14" aria-hidden="true" slot="icon">\n        <path\n          d="M16.1383 0H1.8618C0.8335 0 0 0.8335 0 1.8617V10.1382C0 11.1664 0.8335 12 1.8618 12H3.076C3.1204 11.9433 3.1503 11.8785 3.2012 11.826L4.004 11H1.8618C1.3866 11 1 10.6134 1 10.1382V1.8617C1 1.3865 1.3866 0.9999 1.8618 0.9999H16.1383C16.6135 0.9999 17.0001 1.3865 17.0001 1.8617V10.1382C17.0001 10.6134 16.6135 11 16.1383 11H13.9961L14.7989 11.826C14.8499 11.8785 14.8798 11.9432 14.9241 12H16.1383C17.1665 12 18.0001 11.1664 18.0001 10.1382V1.8617C18 0.8335 17.1665 0 16.1383 0Z"\n        />\n        <path\n          d="M9.55061 8.21903C9.39981 8.06383 9.20001 7.98633 9.00011 7.98633C8.80021 7.98633 8.60031 8.06383 8.44951 8.21903L4.09771 12.697C3.62471 13.1838 3.96961 13.9998 4.64831 13.9998H13.3518C14.0304 13.9998 14.3754 13.1838 13.9023 12.697L9.55061 8.21903Z"\n        />\n      </svg>\n    </media-airplay-button>\n  </template>\n\n  <template partial="FullscreenButton">\n    <media-fullscreen-button part="bottom fullscreen button" disabled="{{disabled}}" aria-disabled="{{disabled}}">\n      <svg viewBox="0 0 18 14" aria-hidden="true" slot="enter">\n        <path\n          d="M1.00745 4.39539L1.01445 1.98789C1.01605 1.43049 1.47085 0.978289 2.02835 0.979989L6.39375 0.992589L6.39665 -0.007411L2.03125 -0.020011C0.920646 -0.023211 0.0176463 0.874489 0.0144463 1.98509L0.00744629 4.39539H1.00745Z"\n        />\n        <path\n          d="M17.0144 2.03431L17.0076 4.39541H18.0076L18.0144 2.03721C18.0176 0.926712 17.1199 0.0237125 16.0093 0.0205125L11.6439 0.0078125L11.641 1.00781L16.0064 1.02041C16.5638 1.02201 17.016 1.47681 17.0144 2.03431Z"\n        />\n        <path\n          d="M16.9925 9.60498L16.9855 12.0124C16.9839 12.5698 16.5291 13.022 15.9717 13.0204L11.6063 13.0078L11.6034 14.0078L15.9688 14.0204C17.0794 14.0236 17.9823 13.1259 17.9855 12.0153L17.9925 9.60498H16.9925Z"\n        />\n        <path\n          d="M0.985626 11.9661L0.992426 9.60498H-0.0074737L-0.0142737 11.9632C-0.0174737 13.0738 0.880226 13.9767 1.99083 13.98L6.35623 13.9926L6.35913 12.9926L1.99373 12.98C1.43633 12.9784 0.983926 12.5236 0.985626 11.9661Z"\n        />\n      </svg>\n      <svg viewBox="0 0 18 14" aria-hidden="true" slot="exit">\n        <path\n          d="M5.39655 -0.0200195L5.38955 2.38748C5.38795 2.94488 4.93315 3.39708 4.37565 3.39538L0.0103463 3.38278L0.00744629 4.38278L4.37285 4.39538C5.48345 4.39858 6.38635 3.50088 6.38965 2.39028L6.39665 -0.0200195H5.39655Z"\n        />\n        <path\n          d="M12.6411 2.36891L12.6479 0.0078125H11.6479L11.6411 2.36601C11.6379 3.47651 12.5356 4.37951 13.6462 4.38271L18.0116 4.39531L18.0145 3.39531L13.6491 3.38271C13.0917 3.38111 12.6395 2.92641 12.6411 2.36891Z"\n        />\n        <path\n          d="M12.6034 14.0204L12.6104 11.613C12.612 11.0556 13.0668 10.6034 13.6242 10.605L17.9896 10.6176L17.9925 9.61759L13.6271 9.60499C12.5165 9.60179 11.6136 10.4995 11.6104 11.6101L11.6034 14.0204H12.6034Z"\n        />\n        <path\n          d="M5.359 11.6315L5.3522 13.9926H6.3522L6.359 11.6344C6.3622 10.5238 5.4645 9.62088 4.3539 9.61758L-0.0115043 9.60498L-0.0144043 10.605L4.351 10.6176C4.9084 10.6192 5.3607 11.074 5.359 11.6315Z"\n        />\n      </svg>\n    </media-fullscreen-button>\n  </template>\n\n  <template partial="CastButton">\n    <media-cast-button part="bottom cast button" disabled="{{disabled}}" aria-disabled="{{disabled}}">\n      <svg viewBox="0 0 18 14" aria-hidden="true" slot="enter">\n        <path\n          d="M16.0072 0H2.0291C0.9185 0 0.0181 0.9003 0.0181 2.011V5.5009C0.357 5.5016 0.6895 5.5275 1.0181 5.5669V2.011C1.0181 1.4536 1.4716 1 2.029 1H16.0072C16.5646 1 17.0181 1.4536 17.0181 2.011V11.9891C17.0181 12.5465 16.5646 13 16.0072 13H8.4358C8.4746 13.3286 8.4999 13.6611 8.4999 13.9999H16.0071C17.1177 13.9999 18.018 13.0996 18.018 11.989V2.011C18.0181 0.9003 17.1178 0 16.0072 0ZM0 6.4999V7.4999C3.584 7.4999 6.5 10.4159 6.5 13.9999H7.5C7.5 9.8642 4.1357 6.4999 0 6.4999ZM0 8.7499V9.7499C2.3433 9.7499 4.25 11.6566 4.25 13.9999H5.25C5.25 11.1049 2.895 8.7499 0 8.7499ZM0.0181 11V14H3.0181C3.0181 12.3431 1.675 11 0.0181 11Z"\n        />\n      </svg>\n      <svg viewBox="0 0 18 14" aria-hidden="true" slot="exit">\n        <path\n          d="M15.9891 0H2.01103C0.900434 0 3.35947e-05 0.9003 3.35947e-05 2.011V5.5009C0.338934 5.5016 0.671434 5.5275 1.00003 5.5669V2.011C1.00003 1.4536 1.45353 1 2.01093 1H15.9891C16.5465 1 17 1.4536 17 2.011V11.9891C17 12.5465 16.5465 13 15.9891 13H8.41773C8.45653 13.3286 8.48183 13.6611 8.48183 13.9999H15.989C17.0996 13.9999 17.9999 13.0996 17.9999 11.989V2.011C18 0.9003 17.0997 0 15.9891 0ZM-0.0180664 6.4999V7.4999C3.56593 7.4999 6.48193 10.4159 6.48193 13.9999H7.48193C7.48193 9.8642 4.11763 6.4999 -0.0180664 6.4999ZM-0.0180664 8.7499V9.7499C2.32523 9.7499 4.23193 11.6566 4.23193 13.9999H5.23193C5.23193 11.1049 2.87693 8.7499 -0.0180664 8.7499ZM3.35947e-05 11V14H3.00003C3.00003 12.3431 1.65693 11 3.35947e-05 11Z"\n        />\n        <path d="M2.15002 5.634C5.18352 6.4207 7.57252 8.8151 8.35282 11.8499H15.8501V2.1499H2.15002V5.634Z" />\n      </svg>\n    </media-cast-button>\n  </template>\n\n  <template partial="LiveButton">\n    <media-live-button part="{{section ?? \'top\'}} live button" disabled="{{disabled}}" aria-disabled="{{disabled}}">\n      <span slot="text">Live</span>\n    </media-live-button>\n  </template>\n\n  <template partial="PlaybackRateMenu">\n    <media-playback-rate-menu-button part="bottom playback-rate button"></media-playback-rate-menu-button>\n    <media-playback-rate-menu\n      hidden\n      anchor="auto"\n      rates="{{playbackrates}}"\n      exportparts="menu-item"\n      part="bottom playback-rate menu"\n      disabled="{{disabled}}"\n      aria-disabled="{{disabled}}"\n    ></media-playback-rate-menu>\n  </template>\n\n  <template partial="VolumeRange">\n    <media-volume-range\n      part="bottom volume range"\n      disabled="{{disabled}}"\n      aria-disabled="{{disabled}}"\n    ></media-volume-range>\n  </template>\n\n  <template partial="TimeDisplay">\n    <media-time-display\n      remaining="{{defaultshowremainingtime}}"\n      showduration="{{!hideduration}}"\n      part="bottom time display"\n      disabled="{{disabled}}"\n      aria-disabled="{{disabled}}"\n    ></media-time-display>\n  </template>\n\n  <template partial="TimeRange">\n    <media-time-range part="bottom time range" disabled="{{disabled}}" aria-disabled="{{disabled}}">\n      <media-preview-thumbnail slot="preview"></media-preview-thumbnail>\n      <media-preview-chapter-display slot="preview"></media-preview-chapter-display>\n      <media-preview-time-display slot="preview"></media-preview-time-display>\n      <div slot="preview" part="arrow"></div>\n    </media-time-range>\n  </template>\n\n  <template partial="AudioTrackMenu">\n    <media-audio-track-menu-button part="bottom audio-track button">\n      <svg aria-hidden="true" slot="icon" viewBox="0 0 18 16">\n        <path d="M9 15A7 7 0 1 1 9 1a7 7 0 0 1 0 14Zm0 1A8 8 0 1 0 9 0a8 8 0 0 0 0 16Z" />\n        <path\n          d="M5.2 6.3a.5.5 0 0 1 .5.5v2.4a.5.5 0 1 1-1 0V6.8a.5.5 0 0 1 .5-.5Zm2.4-2.4a.5.5 0 0 1 .5.5v7.2a.5.5 0 0 1-1 0V4.4a.5.5 0 0 1 .5-.5ZM10 5.5a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5Zm2.4-.8a.5.5 0 0 1 .5.5v5.6a.5.5 0 0 1-1 0V5.2a.5.5 0 0 1 .5-.5Z"\n        />\n      </svg>\n    </media-audio-track-menu-button>\n    <media-audio-track-menu\n      hidden\n      anchor="auto"\n      part="bottom audio-track menu"\n      disabled="{{disabled}}"\n      aria-disabled="{{disabled}}"\n      exportparts="menu-item"\n    >\n      <div slot="checked-indicator">\n        <style>\n          .indicator {\n            position: relative;\n            top: 1px;\n            width: 0.9em;\n            height: auto;\n            fill: var(--_accent-color);\n            margin-right: 5px;\n          }\n\n          [aria-checked=\'false\'] .indicator {\n            display: none;\n          }\n        </style>\n        <svg viewBox="0 0 14 18" class="indicator">\n          <path\n            d="M12.252 3.48c-.115.033-.301.161-.425.291-.059.063-1.407 1.815-2.995 3.894s-2.897 3.79-2.908 3.802c-.013.014-.661-.616-1.672-1.624-.908-.905-1.702-1.681-1.765-1.723-.401-.27-.783-.211-1.176.183a1.285 1.285 0 0 0-.261.342.582.582 0 0 0-.082.35c0 .165.01.205.08.35.075.153.213.296 2.182 2.271 1.156 1.159 2.17 2.159 2.253 2.222.189.143.338.196.539.194.203-.003.412-.104.618-.299.205-.193 6.7-8.693 6.804-8.903a.716.716 0 0 0 .085-.345c.01-.179.005-.203-.062-.339-.124-.252-.45-.531-.746-.639a.784.784 0 0 0-.469-.027"\n            fill-rule="evenodd"\n          />\n        </svg>\n      </div>\n    </media-audio-track-menu>\n  </template>\n\n  <template partial="RenditionMenu">\n    <media-rendition-menu-button part="bottom rendition button">\n      <svg aria-hidden="true" slot="icon" viewBox="0 0 18 14">\n        <path\n          d="M2.25 9a2 2 0 1 0 0-4 2 2 0 0 0 0 4ZM9 9a2 2 0 1 0 0-4 2 2 0 0 0 0 4Zm6.75 0a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z"\n        />\n      </svg>\n    </media-rendition-menu-button>\n    <media-rendition-menu\n      hidden\n      anchor="auto"\n      part="bottom rendition menu"\n      disabled="{{disabled}}"\n      aria-disabled="{{disabled}}"\n    >\n      <div slot="checked-indicator">\n        <style>\n          .indicator {\n            position: relative;\n            top: 1px;\n            width: 0.9em;\n            height: auto;\n            fill: var(--_accent-color);\n            margin-right: 5px;\n          }\n\n          [aria-checked=\'false\'] .indicator {\n            opacity: 0;\n          }\n        </style>\n        <svg viewBox="0 0 14 18" class="indicator">\n          <path\n            d="M12.252 3.48c-.115.033-.301.161-.425.291-.059.063-1.407 1.815-2.995 3.894s-2.897 3.79-2.908 3.802c-.013.014-.661-.616-1.672-1.624-.908-.905-1.702-1.681-1.765-1.723-.401-.27-.783-.211-1.176.183a1.285 1.285 0 0 0-.261.342.582.582 0 0 0-.082.35c0 .165.01.205.08.35.075.153.213.296 2.182 2.271 1.156 1.159 2.17 2.159 2.253 2.222.189.143.338.196.539.194.203-.003.412-.104.618-.299.205-.193 6.7-8.693 6.804-8.903a.716.716 0 0 0 .085-.345c.01-.179.005-.203-.062-.339-.124-.252-.45-.531-.746-.639a.784.784 0 0 0-.469-.027"\n            fill-rule="evenodd"\n          />\n        </svg>\n      </div>\n    </media-rendition-menu>\n  </template>\n\n  <template partial="MuxBadge">\n    <div part="mux-badge">\n      <a href="https://www.mux.com/player" target="_blank">\n        <span class="mux-badge-text">Powered by</span>\n        <div class="mux-badge-logo">\n          <svg\n            viewBox="0 0 1600 500"\n            style="fill-rule: evenodd; clip-rule: evenodd; stroke-linejoin: round; stroke-miterlimit: 2"\n          >\n            <g>\n              <path\n                d="M994.287,93.486c-17.121,-0 -31,-13.879 -31,-31c0,-17.121 13.879,-31 31,-31c17.121,-0 31,13.879 31,31c0,17.121 -13.879,31 -31,31m0,-93.486c-34.509,-0 -62.484,27.976 -62.484,62.486l0,187.511c0,68.943 -56.09,125.033 -125.032,125.033c-68.942,-0 -125.03,-56.09 -125.03,-125.033l0,-187.511c0,-34.51 -27.976,-62.486 -62.485,-62.486c-34.509,-0 -62.484,27.976 -62.484,62.486l0,187.511c0,137.853 112.149,250.003 249.999,250.003c137.851,-0 250.001,-112.15 250.001,-250.003l0,-187.511c0,-34.51 -27.976,-62.486 -62.485,-62.486"\n                style="fill-rule: nonzero"\n              ></path>\n              <path\n                d="M1537.51,468.511c-17.121,-0 -31,-13.879 -31,-31c0,-17.121 13.879,-31 31,-31c17.121,-0 31,13.879 31,31c0,17.121 -13.879,31 -31,31m-275.883,-218.509l-143.33,143.329c-24.402,24.402 -24.402,63.966 0,88.368c24.402,24.402 63.967,24.402 88.369,-0l143.33,-143.329l143.328,143.329c24.402,24.4 63.967,24.402 88.369,-0c24.403,-24.402 24.403,-63.966 0.001,-88.368l-143.33,-143.329l0.001,-0.004l143.329,-143.329c24.402,-24.402 24.402,-63.965 0,-88.367c-24.402,-24.402 -63.967,-24.402 -88.369,-0l-143.329,143.328l-143.329,-143.328c-24.402,-24.401 -63.967,-24.402 -88.369,-0c-24.402,24.402 -24.402,63.965 0,88.367l143.329,143.329l0,0.004Z"\n                style="fill-rule: nonzero"\n              ></path>\n              <path\n                d="M437.511,468.521c-17.121,-0 -31,-13.879 -31,-31c0,-17.121 13.879,-31 31,-31c17.121,-0 31,13.879 31,31c0,17.121 -13.879,31 -31,31m23.915,-463.762c-23.348,-9.672 -50.226,-4.327 -68.096,13.544l-143.331,143.329l-143.33,-143.329c-17.871,-17.871 -44.747,-23.216 -68.096,-13.544c-23.349,9.671 -38.574,32.455 -38.574,57.729l0,375.026c0,34.51 27.977,62.486 62.487,62.486c34.51,-0 62.486,-27.976 62.486,-62.486l0,-224.173l80.843,80.844c24.404,24.402 63.965,24.402 88.369,-0l80.843,-80.844l0,224.173c0,34.51 27.976,62.486 62.486,62.486c34.51,-0 62.486,-27.976 62.486,-62.486l0,-375.026c0,-25.274 -15.224,-48.058 -38.573,-57.729"\n                style="fill-rule: nonzero"\n              ></path>\n            </g>\n          </svg>\n        </div>\n      </a>\n    </div>\n  </template>\n\n  <media-controller\n    part="controller"\n    defaultstreamtype="{{defaultstreamtype ?? \'on-demand\'}}"\n    breakpoints="sm:470"\n    gesturesdisabled="{{disabled}}"\n    hotkeys="{{hotkeys}}"\n    nohotkeys="{{nohotkeys}}"\n    novolumepref="{{novolumepref}}"\n    audio="{{audio}}"\n    noautoseektolive="{{noautoseektolive}}"\n    defaultsubtitles="{{defaultsubtitles}}"\n    defaultduration="{{defaultduration ?? false}}"\n    keyboardforwardseekoffset="{{forwardseekoffset}}"\n    keyboardbackwardseekoffset="{{backwardseekoffset}}"\n    exportparts="layer, media-layer, poster-layer, vertical-layer, centered-layer, gesture-layer"\n    style="--_pre-playback-place:{{preplaybackplace ?? \'center\'}}"\n  >\n    <slot name="media" slot="media"></slot>\n    <slot name="poster" slot="poster"></slot>\n\n    <media-loading-indicator slot="centered-chrome" noautohide></media-loading-indicator>\n\n    <template if="!audio">\n      <media-error-dialog slot="dialog" noautohide></media-error-dialog>\n      <!-- Pre-playback UI -->\n      <!-- same for both on-demand and live -->\n      <div slot="centered-chrome" class="center-controls pre-playback">\n        <template if="!breakpointsm">{{>PlayButton section="center"}}</template>\n        <template if="breakpointsm">{{>PrePlayButton section="center"}}</template>\n      </div>\n\n      <!-- Mux Badge -->\n      <template if="proudlydisplaymuxbadge"> {{>MuxBadge}} </template>\n\n      <!-- Autoplay centered unmute button -->\n      <!--\n        todo: figure out how show this with available state variables\n        needs to show when:\n        - autoplay is enabled\n        - playback has been successful\n        - audio is muted\n        - in place / instead of the pre-plaback play button\n        - not to show again after user has interacted with this button\n          - OR user has interacted with the mute button in the control bar\n      -->\n      <!--\n        There should be a >MuteButton to the left of the "Unmute" text, but a templating bug\n        makes it appear even if commented out in the markup, add it back when code is un-commented\n      -->\n      <!-- <div slot="centered-chrome" class="autoplay-unmute">\n        <div role="button" class="autoplay-unmute-btn">Unmute</div>\n      </div> -->\n\n      <template if="streamtype == \'on-demand\'">\n        <template if="breakpointsm">\n          <media-control-bar part="control-bar top" slot="top-chrome">{{>TitleDisplay}} </media-control-bar>\n        </template>\n        {{>TimeRange}}\n        <media-control-bar part="control-bar bottom">\n          {{>PlayButton}} {{>SeekBackwardButton}} {{>SeekForwardButton}} {{>TimeDisplay}} {{>MuteButton}}\n          {{>VolumeRange}}\n          <div class="spacer"></div>\n          {{>RenditionMenu}} {{>PlaybackRateMenu}} {{>AudioTrackMenu}} {{>CaptionsMenu}} {{>AirplayButton}}\n          {{>CastButton}} {{>PipButton}} {{>FullscreenButton}}\n        </media-control-bar>\n      </template>\n\n      <template if="streamtype == \'live\'">\n        <media-control-bar part="control-bar top" slot="top-chrome">\n          {{>LiveButton}}\n          <template if="breakpointsm"> {{>TitleDisplay}} </template>\n        </media-control-bar>\n        <template if="targetlivewindow > 0">{{>TimeRange}}</template>\n        <media-control-bar part="control-bar bottom">\n          {{>PlayButton}}\n          <template if="targetlivewindow > 0">{{>SeekBackwardButton}} {{>SeekForwardButton}}</template>\n          {{>MuteButton}} {{>VolumeRange}}\n          <div class="spacer"></div>\n          {{>RenditionMenu}} {{>AudioTrackMenu}} {{>CaptionsMenu}} {{>AirplayButton}} {{>CastButton}} {{>PipButton}}\n          {{>FullscreenButton}}\n        </media-control-bar>\n      </template>\n    </template>\n\n    <template if="audio">\n      <template if="streamtype == \'on-demand\'">\n        <template if="title">\n          <media-control-bar part="control-bar top">{{>TitleDisplay}}</media-control-bar>\n        </template>\n        <media-control-bar part="control-bar bottom">\n          {{>PlayButton}}\n          <template if="breakpointsm"> {{>SeekBackwardButton}} {{>SeekForwardButton}} </template>\n          {{>MuteButton}}\n          <template if="breakpointsm">{{>VolumeRange}}</template>\n          {{>TimeDisplay}} {{>TimeRange}}\n          <template if="breakpointsm">{{>PlaybackRateMenu}}</template>\n          {{>AirplayButton}} {{>CastButton}}\n        </media-control-bar>\n      </template>\n\n      <template if="streamtype == \'live\'">\n        <template if="title">\n          <media-control-bar part="control-bar top">{{>TitleDisplay}}</media-control-bar>\n        </template>\n        <media-control-bar part="control-bar bottom">\n          {{>PlayButton}} {{>LiveButton section="bottom"}} {{>MuteButton}}\n          <template if="breakpointsm">\n            {{>VolumeRange}}\n            <template if="targetlivewindow > 0"> {{>SeekBackwardButton}} {{>SeekForwardButton}} </template>\n          </template>\n          <template if="targetlivewindow > 0"> {{>TimeDisplay}} {{>TimeRange}} </template>\n          <template if="!targetlivewindow"><div class="spacer"></div></template>\n          {{>AirplayButton}} {{>CastButton}}\n        </media-control-bar>\n      </template>\n    </template>\n\n    <slot></slot>\n  </media-controller>\n</template>\n');var Tm,Tf,Tp=class extends pj{};Tp.template=null==(Tf=null==(Tm=Tc.content)?void 0:Tm.children)?void 0:Tf[0],bx.customElements.get("media-theme-gerwig")||bx.customElements.define("media-theme-gerwig",Tp);var Tg={SRC:"src",POSTER:"poster"},Tv={STYLE:"style",DEFAULT_HIDDEN_CAPTIONS:"default-hidden-captions",PRIMARY_COLOR:"primary-color",SECONDARY_COLOR:"secondary-color",ACCENT_COLOR:"accent-color",FORWARD_SEEK_OFFSET:"forward-seek-offset",BACKWARD_SEEK_OFFSET:"backward-seek-offset",PLAYBACK_TOKEN:"playback-token",THUMBNAIL_TOKEN:"thumbnail-token",STORYBOARD_TOKEN:"storyboard-token",DRM_TOKEN:"drm-token",STORYBOARD_SRC:"storyboard-src",THUMBNAIL_TIME:"thumbnail-time",AUDIO:"audio",NOHOTKEYS:"nohotkeys",HOTKEYS:"hotkeys",PLAYBACK_RATES:"playbackrates",DEFAULT_SHOW_REMAINING_TIME:"default-show-remaining-time",DEFAULT_DURATION:"default-duration",TITLE:"title",VIDEO_TITLE:"video-title",PLACEHOLDER:"placeholder",THEME:"theme",DEFAULT_STREAM_TYPE:"default-stream-type",TARGET_LIVE_WINDOW:"target-live-window",EXTRA_SOURCE_PARAMS:"extra-source-params",NO_VOLUME_PREF:"no-volume-pref",CAST_RECEIVER:"cast-receiver",NO_TOOLTIPS:"no-tooltips",PROUDLY_DISPLAY_MUX_BADGE:"proudly-display-mux-badge",DISABLE_PSEUDO_ENDED:"disable-pseudo-ended"},TE=["audio","backwardseekoffset","defaultduration","defaultshowremainingtime","defaultsubtitles","noautoseektolive","disabled","exportparts","forwardseekoffset","hideduration","hotkeys","nohotkeys","playbackrates","defaultstreamtype","streamtype","style","targetlivewindow","template","title","videotitle","novolumepref","proudlydisplaymuxbadge"],Ty=fv.formatErrorMessage;function Tb(e){let t=e.videoTitle?{video_title:e.videoTitle}:{};return e.getAttributeNames().filter(e=>e.startsWith("metadata-")).reduce((t,i)=>{let r=e.getAttribute(i);return null!==r&&(t[i.replace(/^metadata-/,"").replace(/-/g,"_")]=r),t},t)}fv.formatErrorMessage=e=>{var t,i;if(e instanceof oJ){let r=Tu(e,!1);return"\n      ".concat(null!=r&&r.title?"<h3>".concat(r.title,"</h3>"):"","\n      ").concat(null!=r&&r.message||null!=r&&r.linkUrl?"<p>\n        ".concat(null==r?void 0:r.message,"\n        ").concat(null!=r&&r.linkUrl?'<a\n              href="'.concat(r.linkUrl,'"\n              target="_blank"\n              rel="external noopener"\n              aria-label="').concat(null!=(t=r.linkText)?t:""," ").concat(lo("(opens in a new window)"),'"\n              >').concat(null!=(i=r.linkText)?i:r.linkUrl,"</a\n            >"):"","\n      </p>"):"","\n    ")}return Ty(e)};var TT,T_,TA,TS,TI,TR,Tk,TL,TD,Tw,TC,TM,TO,TP,Tx,TN=Object.values(d$),TU=Object.values(Tg),TF=Object.values(Tv),TB=bY,TH="mux-player",TG={isDialogOpen:!1},TK={redundant_streams:!0},TV=class extends b9{static get NAME(){return TH}static get VERSION(){return TB}static get observedAttributes(){var e;return[...null!=(e=b9.observedAttributes)?e:[],...TU,...TN,...TF]}get mediaTheme(){var e;return null==(e=this.shadowRoot)?void 0:e.querySelector("media-theme")}get mediaController(){var e,t;return null==(t=null==(e=this.mediaTheme)?void 0:e.shadowRoot)?void 0:t.querySelector("media-controller")}connectedCallback(){let e=this.media;e&&(e.metadata=Tb(this))}attributeChangedCallback(e,t,i){var r;switch(gX(this,Tk,TL).call(this),super.attributeChangedCallback(e,t,i),e){case Tv.HOTKEYS:gj(this,TI).value=i;break;case Tv.THUMBNAIL_TIME:null!=i&&this.tokens.thumbnail&&b$(lo("Use of thumbnail-time with thumbnail-token is currently unsupported. Ignore thumbnail-time.").toString());break;case Tv.THUMBNAIL_TOKEN:if(i){let e=ln(i);if(e){let{aud:t}=e,i=lL.THUMBNAIL;t!==i&&b$(lo("The {tokenNamePrefix}-token has an incorrect aud value: {aud}. aud value should be {expectedAud}.").format({aud:t,expectedAud:i,tokenNamePrefix:"thumbnail"}))}}break;case Tv.STORYBOARD_TOKEN:if(i){let e=ln(i);if(e){let{aud:t}=e,i=lL.STORYBOARD;t!==i&&b$(lo("The {tokenNamePrefix}-token has an incorrect aud value: {aud}. aud value should be {expectedAud}.").format({aud:t,expectedAud:i,tokenNamePrefix:"storyboard"}))}}break;case Tv.DRM_TOKEN:if(i){let e=ln(i);if(e){let{aud:t}=e,i=lL.DRM;t!==i&&b$(lo("The {tokenNamePrefix}-token has an incorrect aud value: {aud}. aud value should be {expectedAud}.").format({aud:t,expectedAud:i,tokenNamePrefix:"drm"}))}}break;case d$.PLAYBACK_ID:null!=i&&i.includes("?token")&&b0(lo("The specificed playback ID {playbackId} contains a token which must be provided via the playback-token attribute.").format({playbackId:i}));break;case d$.STREAM_TYPE:i&&![o1.LIVE,o1.ON_DEMAND,o1.UNKNOWN].includes(i)?["ll-live","live:dvr","ll-live:dvr"].includes(this.streamType)?this.targetLiveWindow=i.includes("dvr")?1/0:0:b1({file:"invalid-stream-type.md",message:lo("Invalid stream-type value supplied: `{streamType}`. Please provide stream-type as either: `on-demand` or `live`").format({streamType:this.streamType})}):i===o1.LIVE?null==this.getAttribute(Tv.TARGET_LIVE_WINDOW)&&(this.targetLiveWindow=0):this.targetLiveWindow=NaN}[d$.PLAYBACK_ID,Tg.SRC,Tv.PLAYBACK_TOKEN].includes(e)&&t!==i&&gz(this,TR,{...gj(this,TR),...TG}),gX(this,Tk,TC).call(this,{[null!=(r=bX[e])?r:bF(e)]:i})}async requestFullscreen(e){var t;if(!(!this.mediaController||this.mediaController.hasAttribute(hM.MEDIA_IS_FULLSCREEN)))return null==(t=this.mediaController)||t.dispatchEvent(new bx.CustomEvent(hL.MEDIA_ENTER_FULLSCREEN_REQUEST,{composed:!0,bubbles:!0})),new Promise((e,t)=>{var i;null==(i=this.mediaController)||i.addEventListener(hO.MEDIA_IS_FULLSCREEN,()=>e(),{once:!0})})}async exitFullscreen(){var e;if(!(!this.mediaController||!this.mediaController.hasAttribute(hM.MEDIA_IS_FULLSCREEN)))return null==(e=this.mediaController)||e.dispatchEvent(new bx.CustomEvent(hL.MEDIA_EXIT_FULLSCREEN_REQUEST,{composed:!0,bubbles:!0})),new Promise((e,t)=>{var i;null==(i=this.mediaController)||i.addEventListener(hO.MEDIA_IS_FULLSCREEN,()=>e(),{once:!0})})}get preferCmcd(){var e;return null!=(e=this.getAttribute(d$.PREFER_CMCD))?e:void 0}set preferCmcd(e){e!==this.preferCmcd&&(e?o4.includes(e)?this.setAttribute(d$.PREFER_CMCD,e):b$("Invalid value for preferCmcd. Must be one of ".concat(o4.join())):this.removeAttribute(d$.PREFER_CMCD))}get hasPlayed(){var e,t;return null!=(t=null==(e=this.mediaController)?void 0:e.hasAttribute(hM.MEDIA_HAS_PLAYED))&&t}get inLiveWindow(){var e;return null==(e=this.mediaController)?void 0:e.hasAttribute(hM.MEDIA_TIME_IS_LIVE)}get _hls(){var e;return null==(e=this.media)?void 0:e._hls}get mux(){var e;return null==(e=this.media)?void 0:e.mux}get theme(){var e;return null!=(e=this.getAttribute(Tv.THEME))?e:"gerwig"}set theme(e){this.setAttribute(Tv.THEME,"".concat(e))}get themeProps(){let e=this.mediaTheme;if(!e)return;let t={};for(let i of e.getAttributeNames()){if(TE.includes(i))continue;let r=e.getAttribute(i);t[bF(i)]=""===r||r}return t}set themeProps(e){var t,i;gX(this,Tk,TL).call(this);let r={...this.themeProps,...e};for(let a in r){if(TE.includes(a))continue;let r=null==e?void 0:e[a];"boolean"==typeof r||null==r?null==(t=this.mediaTheme)||t.toggleAttribute(bU(a),!!r):null==(i=this.mediaTheme)||i.setAttribute(bU(a),r)}}get playbackId(){var e;return null!=(e=this.getAttribute(d$.PLAYBACK_ID))?e:void 0}set playbackId(e){e?this.setAttribute(d$.PLAYBACK_ID,e):this.removeAttribute(d$.PLAYBACK_ID)}get src(){var e,t;return this.playbackId?null!=(e=TW(this,Tg.SRC))?e:void 0:null!=(t=this.getAttribute(Tg.SRC))?t:void 0}set src(e){e?this.setAttribute(Tg.SRC,e):this.removeAttribute(Tg.SRC)}get poster(){var e;let t=this.getAttribute(Tg.POSTER);if(null!=t)return t;let{tokens:i}=this;return i.playback&&!i.thumbnail?void b$("Missing expected thumbnail token. No poster image will be shown"):this.playbackId&&!this.audio?bj(this.playbackId,{customDomain:this.customDomain,thumbnailTime:null!=(e=this.thumbnailTime)?e:this.startTime,programTime:this.programStartTime,token:i.thumbnail}):void 0}set poster(e){e||""===e?this.setAttribute(Tg.POSTER,e):this.removeAttribute(Tg.POSTER)}get storyboardSrc(){var e;return null!=(e=this.getAttribute(Tv.STORYBOARD_SRC))?e:void 0}set storyboardSrc(e){e?this.setAttribute(Tv.STORYBOARD_SRC,e):this.removeAttribute(Tv.STORYBOARD_SRC)}get storyboard(){let{tokens:e}=this;return this.storyboardSrc&&!e.storyboard?this.storyboardSrc:this.audio||!this.playbackId||!this.streamType||[o1.LIVE,o1.UNKNOWN].includes(this.streamType)||e.playback&&!e.storyboard?void 0:bQ(this.playbackId,{customDomain:this.customDomain,token:e.storyboard,programStartTime:this.programStartTime,programEndTime:this.programEndTime})}get audio(){return this.hasAttribute(Tv.AUDIO)}set audio(e){if(!e)return void this.removeAttribute(Tv.AUDIO);this.setAttribute(Tv.AUDIO,"")}get hotkeys(){return gj(this,TI)}get nohotkeys(){return this.hasAttribute(Tv.NOHOTKEYS)}set nohotkeys(e){if(!e)return void this.removeAttribute(Tv.NOHOTKEYS);this.setAttribute(Tv.NOHOTKEYS,"")}get thumbnailTime(){return bB(this.getAttribute(Tv.THUMBNAIL_TIME))}set thumbnailTime(e){this.setAttribute(Tv.THUMBNAIL_TIME,"".concat(e))}get videoTitle(){var e,t;return null!=(t=null!=(e=this.getAttribute(Tv.VIDEO_TITLE))?e:this.getAttribute(Tv.TITLE))?t:""}set videoTitle(e){e!==this.videoTitle&&(e?this.setAttribute(Tv.VIDEO_TITLE,e):this.removeAttribute(Tv.VIDEO_TITLE))}get placeholder(){var e;return null!=(e=TW(this,Tv.PLACEHOLDER))?e:""}set placeholder(e){this.setAttribute(Tv.PLACEHOLDER,"".concat(e))}get primaryColor(){var e,t;let i=this.getAttribute(Tv.PRIMARY_COLOR);if(null!=i||this.mediaTheme&&(i=null==(t=null==(e=bx.getComputedStyle(this.mediaTheme))?void 0:e.getPropertyValue("--_primary-color"))?void 0:t.trim()))return i}set primaryColor(e){this.setAttribute(Tv.PRIMARY_COLOR,"".concat(e))}get secondaryColor(){var e,t;let i=this.getAttribute(Tv.SECONDARY_COLOR);if(null!=i||this.mediaTheme&&(i=null==(t=null==(e=bx.getComputedStyle(this.mediaTheme))?void 0:e.getPropertyValue("--_secondary-color"))?void 0:t.trim()))return i}set secondaryColor(e){this.setAttribute(Tv.SECONDARY_COLOR,"".concat(e))}get accentColor(){var e,t;let i=this.getAttribute(Tv.ACCENT_COLOR);if(null!=i||this.mediaTheme&&(i=null==(t=null==(e=bx.getComputedStyle(this.mediaTheme))?void 0:e.getPropertyValue("--_accent-color"))?void 0:t.trim()))return i}set accentColor(e){this.setAttribute(Tv.ACCENT_COLOR,"".concat(e))}get defaultShowRemainingTime(){return this.hasAttribute(Tv.DEFAULT_SHOW_REMAINING_TIME)}set defaultShowRemainingTime(e){e?this.setAttribute(Tv.DEFAULT_SHOW_REMAINING_TIME,""):this.removeAttribute(Tv.DEFAULT_SHOW_REMAINING_TIME)}get playbackRates(){if(this.hasAttribute(Tv.PLAYBACK_RATES))return this.getAttribute(Tv.PLAYBACK_RATES).trim().split(/\s*,?\s+/).map(e=>Number(e)).filter(e=>!Number.isNaN(e)).sort((e,t)=>e-t)}set playbackRates(e){if(!e)return void this.removeAttribute(Tv.PLAYBACK_RATES);this.setAttribute(Tv.PLAYBACK_RATES,e.join(" "))}get forwardSeekOffset(){var e;return null!=(e=bB(this.getAttribute(Tv.FORWARD_SEEK_OFFSET)))?e:10}set forwardSeekOffset(e){this.setAttribute(Tv.FORWARD_SEEK_OFFSET,"".concat(e))}get backwardSeekOffset(){var e;return null!=(e=bB(this.getAttribute(Tv.BACKWARD_SEEK_OFFSET)))?e:10}set backwardSeekOffset(e){this.setAttribute(Tv.BACKWARD_SEEK_OFFSET,"".concat(e))}get defaultHiddenCaptions(){return this.hasAttribute(Tv.DEFAULT_HIDDEN_CAPTIONS)}set defaultHiddenCaptions(e){e?this.setAttribute(Tv.DEFAULT_HIDDEN_CAPTIONS,""):this.removeAttribute(Tv.DEFAULT_HIDDEN_CAPTIONS)}get defaultDuration(){return bB(this.getAttribute(Tv.DEFAULT_DURATION))}set defaultDuration(e){null==e?this.removeAttribute(Tv.DEFAULT_DURATION):this.setAttribute(Tv.DEFAULT_DURATION,"".concat(e))}get playerInitTime(){return this.hasAttribute(d$.PLAYER_INIT_TIME)?bB(this.getAttribute(d$.PLAYER_INIT_TIME)):gj(this,TT)}set playerInitTime(e){e!=this.playerInitTime&&(null==e?this.removeAttribute(d$.PLAYER_INIT_TIME):this.setAttribute(d$.PLAYER_INIT_TIME,"".concat(+e)))}get playerSoftwareName(){var e;return null!=(e=this.getAttribute(d$.PLAYER_SOFTWARE_NAME))?e:TH}get playerSoftwareVersion(){var e;return null!=(e=this.getAttribute(d$.PLAYER_SOFTWARE_VERSION))?e:TB}get beaconCollectionDomain(){var e;return null!=(e=this.getAttribute(d$.BEACON_COLLECTION_DOMAIN))?e:void 0}set beaconCollectionDomain(e){e!==this.beaconCollectionDomain&&(e?this.setAttribute(d$.BEACON_COLLECTION_DOMAIN,e):this.removeAttribute(d$.BEACON_COLLECTION_DOMAIN))}get maxResolution(){var e;return null!=(e=this.getAttribute(d$.MAX_RESOLUTION))?e:void 0}set maxResolution(e){e!==this.maxResolution&&(e?this.setAttribute(d$.MAX_RESOLUTION,e):this.removeAttribute(d$.MAX_RESOLUTION))}get minResolution(){var e;return null!=(e=this.getAttribute(d$.MIN_RESOLUTION))?e:void 0}set minResolution(e){e!==this.minResolution&&(e?this.setAttribute(d$.MIN_RESOLUTION,e):this.removeAttribute(d$.MIN_RESOLUTION))}get renditionOrder(){var e;return null!=(e=this.getAttribute(d$.RENDITION_ORDER))?e:void 0}set renditionOrder(e){e!==this.renditionOrder&&(e?this.setAttribute(d$.RENDITION_ORDER,e):this.removeAttribute(d$.RENDITION_ORDER))}get programStartTime(){return bB(this.getAttribute(d$.PROGRAM_START_TIME))}set programStartTime(e){null==e?this.removeAttribute(d$.PROGRAM_START_TIME):this.setAttribute(d$.PROGRAM_START_TIME,"".concat(e))}get programEndTime(){return bB(this.getAttribute(d$.PROGRAM_END_TIME))}set programEndTime(e){null==e?this.removeAttribute(d$.PROGRAM_END_TIME):this.setAttribute(d$.PROGRAM_END_TIME,"".concat(e))}get assetStartTime(){return bB(this.getAttribute(d$.ASSET_START_TIME))}set assetStartTime(e){null==e?this.removeAttribute(d$.ASSET_START_TIME):this.setAttribute(d$.ASSET_START_TIME,"".concat(e))}get assetEndTime(){return bB(this.getAttribute(d$.ASSET_END_TIME))}set assetEndTime(e){null==e?this.removeAttribute(d$.ASSET_END_TIME):this.setAttribute(d$.ASSET_END_TIME,"".concat(e))}get extraSourceParams(){return this.hasAttribute(Tv.EXTRA_SOURCE_PARAMS)?[...new URLSearchParams(this.getAttribute(Tv.EXTRA_SOURCE_PARAMS)).entries()].reduce((e,t)=>{let[i,r]=t;return e[i]=r,e},{}):TK}set extraSourceParams(e){null==e?this.removeAttribute(Tv.EXTRA_SOURCE_PARAMS):this.setAttribute(Tv.EXTRA_SOURCE_PARAMS,new URLSearchParams(e).toString())}get customDomain(){var e;return null!=(e=this.getAttribute(d$.CUSTOM_DOMAIN))?e:void 0}set customDomain(e){e!==this.customDomain&&(e?this.setAttribute(d$.CUSTOM_DOMAIN,e):this.removeAttribute(d$.CUSTOM_DOMAIN))}get envKey(){var e;return null!=(e=TW(this,d$.ENV_KEY))?e:void 0}set envKey(e){this.setAttribute(d$.ENV_KEY,"".concat(e))}get noVolumePref(){return this.hasAttribute(Tv.NO_VOLUME_PREF)}set noVolumePref(e){e?this.setAttribute(Tv.NO_VOLUME_PREF,""):this.removeAttribute(Tv.NO_VOLUME_PREF)}get debug(){return null!=TW(this,d$.DEBUG)}set debug(e){e?this.setAttribute(d$.DEBUG,""):this.removeAttribute(d$.DEBUG)}get disableTracking(){return null!=TW(this,d$.DISABLE_TRACKING)}set disableTracking(e){this.toggleAttribute(d$.DISABLE_TRACKING,!!e)}get disableCookies(){return null!=TW(this,d$.DISABLE_COOKIES)}set disableCookies(e){e?this.setAttribute(d$.DISABLE_COOKIES,""):this.removeAttribute(d$.DISABLE_COOKIES)}get streamType(){var e,t,i;return null!=(i=null!=(t=this.getAttribute(d$.STREAM_TYPE))?t:null==(e=this.media)?void 0:e.streamType)?i:o1.UNKNOWN}set streamType(e){this.setAttribute(d$.STREAM_TYPE,"".concat(e))}get defaultStreamType(){var e,t,i;return null!=(i=null!=(t=this.getAttribute(Tv.DEFAULT_STREAM_TYPE))?t:null==(e=this.mediaController)?void 0:e.getAttribute(Tv.DEFAULT_STREAM_TYPE))?i:o1.ON_DEMAND}set defaultStreamType(e){e?this.setAttribute(Tv.DEFAULT_STREAM_TYPE,e):this.removeAttribute(Tv.DEFAULT_STREAM_TYPE)}get targetLiveWindow(){var e,t;return this.hasAttribute(Tv.TARGET_LIVE_WINDOW)?+this.getAttribute(Tv.TARGET_LIVE_WINDOW):null!=(t=null==(e=this.media)?void 0:e.targetLiveWindow)?t:NaN}set targetLiveWindow(e){e==this.targetLiveWindow||Number.isNaN(e)&&Number.isNaN(this.targetLiveWindow)||(null==e?this.removeAttribute(Tv.TARGET_LIVE_WINDOW):this.setAttribute(Tv.TARGET_LIVE_WINDOW,"".concat(+e)))}get liveEdgeStart(){var e;return null==(e=this.media)?void 0:e.liveEdgeStart}get startTime(){return bB(TW(this,d$.START_TIME))}set startTime(e){this.setAttribute(d$.START_TIME,"".concat(e))}get preferPlayback(){let e=this.getAttribute(d$.PREFER_PLAYBACK);if(e===o2.MSE||e===o2.NATIVE)return e}set preferPlayback(e){e!==this.preferPlayback&&(e===o2.MSE||e===o2.NATIVE?this.setAttribute(d$.PREFER_PLAYBACK,e):this.removeAttribute(d$.PREFER_PLAYBACK))}get metadata(){var e;return null==(e=this.media)?void 0:e.metadata}set metadata(e){if(gX(this,Tk,TL).call(this),!this.media)return void b0("underlying media element missing when trying to set metadata. metadata will not be set.");this.media.metadata={...Tb(this),...e}}get _hlsConfig(){var e;return null==(e=this.media)?void 0:e._hlsConfig}set _hlsConfig(e){if(gX(this,Tk,TL).call(this),!this.media)return void b0("underlying media element missing when trying to set _hlsConfig. _hlsConfig will not be set.");this.media._hlsConfig=e}async addCuePoints(e){var t;return(gX(this,Tk,TL).call(this),this.media)?null==(t=this.media)?void 0:t.addCuePoints(e):void b0("underlying media element missing when trying to addCuePoints. cuePoints will not be added.")}get activeCuePoint(){var e;return null==(e=this.media)?void 0:e.activeCuePoint}get cuePoints(){var e,t;return null!=(t=null==(e=this.media)?void 0:e.cuePoints)?t:[]}addChapters(e){var t;return(gX(this,Tk,TL).call(this),this.media)?null==(t=this.media)?void 0:t.addChapters(e):void b0("underlying media element missing when trying to addChapters. chapters will not be added.")}get activeChapter(){var e;return null==(e=this.media)?void 0:e.activeChapter}get chapters(){var e,t;return null!=(t=null==(e=this.media)?void 0:e.chapters)?t:[]}getStartDate(){var e;return null==(e=this.media)?void 0:e.getStartDate()}get currentPdt(){var e;return null==(e=this.media)?void 0:e.currentPdt}get tokens(){let e=this.getAttribute(Tv.PLAYBACK_TOKEN),t=this.getAttribute(Tv.DRM_TOKEN),i=this.getAttribute(Tv.THUMBNAIL_TOKEN),r=this.getAttribute(Tv.STORYBOARD_TOKEN);return{...gj(this,TA),...null!=e?{playback:e}:{},...null!=t?{drm:t}:{},...null!=i?{thumbnail:i}:{},...null!=r?{storyboard:r}:{}}}set tokens(e){gz(this,TA,null!=e?e:{})}get playbackToken(){var e;return null!=(e=this.getAttribute(Tv.PLAYBACK_TOKEN))?e:void 0}set playbackToken(e){this.setAttribute(Tv.PLAYBACK_TOKEN,"".concat(e))}get drmToken(){var e;return null!=(e=this.getAttribute(Tv.DRM_TOKEN))?e:void 0}set drmToken(e){this.setAttribute(Tv.DRM_TOKEN,"".concat(e))}get thumbnailToken(){var e;return null!=(e=this.getAttribute(Tv.THUMBNAIL_TOKEN))?e:void 0}set thumbnailToken(e){this.setAttribute(Tv.THUMBNAIL_TOKEN,"".concat(e))}get storyboardToken(){var e;return null!=(e=this.getAttribute(Tv.STORYBOARD_TOKEN))?e:void 0}set storyboardToken(e){this.setAttribute(Tv.STORYBOARD_TOKEN,"".concat(e))}addTextTrack(e,t,i,r){var a;let n=null==(a=this.media)?void 0:a.nativeEl;if(n)return lm(n,e,t,i,r)}removeTextTrack(e){var t;let i=null==(t=this.media)?void 0:t.nativeEl;if(i){let t;return void(null==(t=Array.prototype.find.call(i.querySelectorAll("track"),t=>t.track===e))||t.remove())}}get textTracks(){var e;return null==(e=this.media)?void 0:e.textTracks}get castReceiver(){var e;return null!=(e=this.getAttribute(Tv.CAST_RECEIVER))?e:void 0}set castReceiver(e){e!==this.castReceiver&&(e?this.setAttribute(Tv.CAST_RECEIVER,e):this.removeAttribute(Tv.CAST_RECEIVER))}get castCustomData(){var e;return null==(e=this.media)?void 0:e.castCustomData}set castCustomData(e){if(!this.media)return void b0("underlying media element missing when trying to set castCustomData. castCustomData will not be set.");this.media.castCustomData=e}get noTooltips(){return this.hasAttribute(Tv.NO_TOOLTIPS)}set noTooltips(e){if(!e)return void this.removeAttribute(Tv.NO_TOOLTIPS);this.setAttribute(Tv.NO_TOOLTIPS,"")}get proudlyDisplayMuxBadge(){return this.hasAttribute(Tv.PROUDLY_DISPLAY_MUX_BADGE)}set proudlyDisplayMuxBadge(e){e?this.setAttribute(Tv.PROUDLY_DISPLAY_MUX_BADGE,""):this.removeAttribute(Tv.PROUDLY_DISPLAY_MUX_BADGE)}constructor(){super(),gQ(this,Tk),gQ(this,TT),gQ(this,T_,!1),gQ(this,TA,{}),gQ(this,TS,!0),gQ(this,TI,new bZ(this,"hotkeys")),gQ(this,TR,{...TG,onCloseErrorDialog:e=>{var t;(null==(t=e.composedPath()[0])?void 0:t.localName)==="media-error-dialog"&&gX(this,Tk,Tw).call(this,{isDialogOpen:!1})},onFocusInErrorDialog:e=>{var t;(null==(t=e.composedPath()[0])?void 0:t.localName)==="media-error-dialog"&&(bW(this,bN.activeElement)||e.preventDefault())}}),gz(this,TT,lZ()),this.attachShadow({mode:"open"}),gX(this,Tk,TD).call(this),this.isConnected&&gX(this,Tk,TL).call(this)}};function TW(e,t){return e.media?e.media.getAttribute(t):e.getAttribute(t)}TT=new WeakMap,T_=new WeakMap,TA=new WeakMap,TS=new WeakMap,TI=new WeakMap,TR=new WeakMap,Tk=new WeakSet,TL=function(){var e,t,i,r;if(!gj(this,T_)){gz(this,T_,!0),gX(this,Tk,TC).call(this);try{if(customElements.upgrade(this.mediaTheme),!(this.mediaTheme instanceof bx.HTMLElement))throw""}catch(e){b0("<media-theme> failed to upgrade!")}try{customElements.upgrade(this.media)}catch(e){b0("underlying media element failed to upgrade!")}try{if(customElements.upgrade(this.mediaController),!(this.mediaController instanceof mA))throw""}catch(e){b0("<media-controller> failed to upgrade!")}gX(this,Tk,TM).call(this),gX(this,Tk,TO).call(this),gX(this,Tk,TP).call(this),gz(this,TS,null==(t=null==(e=this.mediaController)?void 0:e.hasAttribute(cN.USER_INACTIVE))||t),gX(this,Tk,Tx).call(this),null==(i=this.media)||i.addEventListener("streamtypechange",()=>gX(this,Tk,TC).call(this)),null==(r=this.media)||r.addEventListener("loadstart",()=>gX(this,Tk,TC).call(this))}},TD=function(){var e,t;try{null==(e=null==window?void 0:window.CSS)||e.registerProperty({name:"--media-primary-color",syntax:"<color>",inherits:!0}),null==(t=null==window?void 0:window.CSS)||t.registerProperty({name:"--media-secondary-color",syntax:"<color>",inherits:!0})}catch(e){}},Tw=function(e){Object.assign(gj(this,TR),e),gX(this,Tk,TC).call(this)},TC=function(){var e,t,i,r,a,n,s,o,l,d,u,h,c,m,f,p,g,E,y,b,T,_,A,S,I,R,k,L,D,w,C,M,O,P,x,N,U,F,B,H,G,K,V,W;let q,Y,j=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e={...gj(this,TR),...j},q={src:!this.playbackId&&this.src,playbackId:this.playbackId,hasSrc:!!this.playbackId||!!this.src||!!this.currentSrc,poster:this.poster,storyboard:this.storyboard,storyboardSrc:this.getAttribute(Tv.STORYBOARD_SRC),placeholder:this.getAttribute("placeholder"),themeTemplate:function(e){var t,i;let r=e.theme;if(r){let a=null==(i=null==(t=e.getRootNode())?void 0:t.getElementById)?void 0:i.call(t,r);if(a&&a instanceof HTMLTemplateElement)return a;r.startsWith("media-theme-")||(r="media-theme-".concat(r));let n=bx.customElements.get(r);if(null!=n&&n.template)return n.template}}(this),thumbnailTime:!this.tokens.thumbnail&&this.thumbnailTime,autoplay:this.autoplay,crossOrigin:this.crossOrigin,loop:this.loop,noHotKeys:this.hasAttribute(Tv.NOHOTKEYS),hotKeys:this.getAttribute(Tv.HOTKEYS),muted:this.muted,paused:this.paused,preload:this.preload,envKey:this.envKey,preferCmcd:this.preferCmcd,debug:this.debug,disableTracking:this.disableTracking,disableCookies:this.disableCookies,tokens:this.tokens,beaconCollectionDomain:this.beaconCollectionDomain,maxResolution:this.maxResolution,minResolution:this.minResolution,programStartTime:this.programStartTime,programEndTime:this.programEndTime,assetStartTime:this.assetStartTime,assetEndTime:this.assetEndTime,renditionOrder:this.renditionOrder,metadata:this.metadata,playerInitTime:this.playerInitTime,playerSoftwareName:this.playerSoftwareName,playerSoftwareVersion:this.playerSoftwareVersion,startTime:this.startTime,preferPlayback:this.preferPlayback,audio:this.audio,defaultStreamType:this.defaultStreamType,targetLiveWindow:this.getAttribute(d$.TARGET_LIVE_WINDOW),streamType:bz(this.getAttribute(d$.STREAM_TYPE)),primaryColor:this.getAttribute(Tv.PRIMARY_COLOR),secondaryColor:this.getAttribute(Tv.SECONDARY_COLOR),accentColor:this.getAttribute(Tv.ACCENT_COLOR),forwardSeekOffset:this.forwardSeekOffset,backwardSeekOffset:this.backwardSeekOffset,defaultHiddenCaptions:this.defaultHiddenCaptions,defaultDuration:this.defaultDuration,defaultShowRemainingTime:this.defaultShowRemainingTime,hideDuration:(Y=null==(r=this.mediaController)?void 0:r.querySelector("media-time-display"))&&"none"===getComputedStyle(Y).getPropertyValue("--media-duration-display-display").trim(),playbackRates:this.getAttribute(Tv.PLAYBACK_RATES),customDomain:null!=(t=this.getAttribute(d$.CUSTOM_DOMAIN))?t:void 0,title:this.getAttribute(Tv.TITLE),videoTitle:null!=(i=this.getAttribute(Tv.VIDEO_TITLE))?i:this.getAttribute(Tv.TITLE),novolumepref:this.hasAttribute(Tv.NO_VOLUME_PREF),proudlyDisplayMuxBadge:this.hasAttribute(Tv.PROUDLY_DISPLAY_MUX_BADGE),castReceiver:this.castReceiver,disablePseudoEnded:this.hasAttribute(Tv.DISABLE_PSEUDO_ENDED),...e,extraSourceParams:this.extraSourceParams},a=Tn(gG(),(e=>{let{tokens:t}=e;return t.drm?":host(:not([cast-receiver])) { --_cast-button-drm-display: none; }":""})(q),":host {\n  --media-control-display: var(--controls);\n  --media-loading-indicator-display: var(--loading-indicator);\n  --media-dialog-display: var(--dialog);\n  --media-play-button-display: var(--play-button);\n  --media-live-button-display: var(--live-button);\n  --media-seek-backward-button-display: var(--seek-backward-button);\n  --media-seek-forward-button-display: var(--seek-forward-button);\n  --media-mute-button-display: var(--mute-button);\n  --media-captions-button-display: var(--captions-button);\n  --media-captions-menu-button-display: var(--captions-menu-button, var(--media-captions-button-display));\n  --media-rendition-menu-button-display: var(--rendition-menu-button);\n  --media-audio-track-menu-button-display: var(--audio-track-menu-button);\n  --media-airplay-button-display: var(--airplay-button);\n  --media-pip-button-display: var(--pip-button);\n  --media-fullscreen-button-display: var(--fullscreen-button);\n  --media-cast-button-display: var(--cast-button, var(--_cast-button-drm-display));\n  --media-playback-rate-button-display: var(--playback-rate-button);\n  --media-playback-rate-menu-button-display: var(--playback-rate-menu-button);\n  --media-volume-range-display: var(--volume-range);\n  --media-time-range-display: var(--time-range);\n  --media-time-display-display: var(--time-display);\n  --media-duration-display-display: var(--duration-display);\n  --media-title-display-display: var(--title-display);\n\n  display: inline-block;\n  line-height: 0;\n  width: 100%;\n}\n\na {\n  color: #fff;\n  font-size: 0.9em;\n  text-decoration: underline;\n}\n\nmedia-theme {\n  display: inline-block;\n  line-height: 0;\n  width: 100%;\n  height: 100%;\n  direction: ltr;\n}\n\nmedia-poster-image {\n  display: inline-block;\n  line-height: 0;\n  width: 100%;\n  height: 100%;\n}\n\nmedia-poster-image:not([src]):not([placeholdersrc]) {\n  display: none;\n}\n\n::part(top),\n[part~='top'] {\n  --media-control-display: var(--controls, var(--top-controls));\n  --media-play-button-display: var(--play-button, var(--top-play-button));\n  --media-live-button-display: var(--live-button, var(--top-live-button));\n  --media-seek-backward-button-display: var(--seek-backward-button, var(--top-seek-backward-button));\n  --media-seek-forward-button-display: var(--seek-forward-button, var(--top-seek-forward-button));\n  --media-mute-button-display: var(--mute-button, var(--top-mute-button));\n  --media-captions-button-display: var(--captions-button, var(--top-captions-button));\n  --media-captions-menu-button-display: var(\n    --captions-menu-button,\n    var(--media-captions-button-display, var(--top-captions-menu-button))\n  );\n  --media-rendition-menu-button-display: var(--rendition-menu-button, var(--top-rendition-menu-button));\n  --media-audio-track-menu-button-display: var(--audio-track-menu-button, var(--top-audio-track-menu-button));\n  --media-airplay-button-display: var(--airplay-button, var(--top-airplay-button));\n  --media-pip-button-display: var(--pip-button, var(--top-pip-button));\n  --media-fullscreen-button-display: var(--fullscreen-button, var(--top-fullscreen-button));\n  --media-cast-button-display: var(--cast-button, var(--top-cast-button, var(--_cast-button-drm-display)));\n  --media-playback-rate-button-display: var(--playback-rate-button, var(--top-playback-rate-button));\n  --media-playback-rate-menu-button-display: var(\n    --captions-menu-button,\n    var(--media-playback-rate-button-display, var(--top-playback-rate-menu-button))\n  );\n  --media-volume-range-display: var(--volume-range, var(--top-volume-range));\n  --media-time-range-display: var(--time-range, var(--top-time-range));\n  --media-time-display-display: var(--time-display, var(--top-time-display));\n  --media-duration-display-display: var(--duration-display, var(--top-duration-display));\n  --media-title-display-display: var(--title-display, var(--top-title-display));\n}\n\n::part(center),\n[part~='center'] {\n  --media-control-display: var(--controls, var(--center-controls));\n  --media-play-button-display: var(--play-button, var(--center-play-button));\n  --media-live-button-display: var(--live-button, var(--center-live-button));\n  --media-seek-backward-button-display: var(--seek-backward-button, var(--center-seek-backward-button));\n  --media-seek-forward-button-display: var(--seek-forward-button, var(--center-seek-forward-button));\n  --media-mute-button-display: var(--mute-button, var(--center-mute-button));\n  --media-captions-button-display: var(--captions-button, var(--center-captions-button));\n  --media-captions-menu-button-display: var(\n    --captions-menu-button,\n    var(--media-captions-button-display, var(--center-captions-menu-button))\n  );\n  --media-rendition-menu-button-display: var(--rendition-menu-button, var(--center-rendition-menu-button));\n  --media-audio-track-menu-button-display: var(--audio-track-menu-button, var(--center-audio-track-menu-button));\n  --media-airplay-button-display: var(--airplay-button, var(--center-airplay-button));\n  --media-pip-button-display: var(--pip-button, var(--center-pip-button));\n  --media-fullscreen-button-display: var(--fullscreen-button, var(--center-fullscreen-button));\n  --media-cast-button-display: var(--cast-button, var(--center-cast-button, var(--_cast-button-drm-display)));\n  --media-playback-rate-button-display: var(--playback-rate-button, var(--center-playback-rate-button));\n  --media-playback-rate-menu-button-display: var(\n    --playback-rate-menu-button,\n    var(--media-playback-rate-button-display, var(--center-playback-rate-menu-button))\n  );\n  --media-volume-range-display: var(--volume-range, var(--center-volume-range));\n  --media-time-range-display: var(--time-range, var(--center-time-range));\n  --media-time-display-display: var(--time-display, var(--center-time-display));\n  --media-duration-display-display: var(--duration-display, var(--center-duration-display));\n}\n\n::part(bottom),\n[part~='bottom'] {\n  --media-control-display: var(--controls, var(--bottom-controls));\n  --media-play-button-display: var(--play-button, var(--bottom-play-button));\n  --media-live-button-display: var(--live-button, var(--bottom-live-button));\n  --media-seek-backward-button-display: var(--seek-backward-button, var(--bottom-seek-backward-button));\n  --media-seek-forward-button-display: var(--seek-forward-button, var(--bottom-seek-forward-button));\n  --media-mute-button-display: var(--mute-button, var(--bottom-mute-button));\n  --media-captions-button-display: var(--captions-button, var(--bottom-captions-button));\n  --media-captions-menu-button-display: var(\n    --captions-menu-button,\n    var(--media-captions-button-display, var(--bottom-captions-menu-button))\n  );\n  --media-rendition-menu-button-display: var(--rendition-menu-button, var(--bottom-rendition-menu-button));\n  --media-audio-track-menu-button-display: var(--audio-track-menu-button, var(--bottom-audio-track-menu-button));\n  --media-airplay-button-display: var(--airplay-button, var(--bottom-airplay-button));\n  --media-pip-button-display: var(--pip-button, var(--bottom-pip-button));\n  --media-fullscreen-button-display: var(--fullscreen-button, var(--bottom-fullscreen-button));\n  --media-cast-button-display: var(--cast-button, var(--bottom-cast-button, var(--_cast-button-drm-display)));\n  --media-playback-rate-button-display: var(--playback-rate-button, var(--bottom-playback-rate-button));\n  --media-playback-rate-menu-button-display: var(\n    --playback-rate-menu-button,\n    var(--media-playback-rate-button-display, var(--bottom-playback-rate-menu-button))\n  );\n  --media-volume-range-display: var(--volume-range, var(--bottom-volume-range));\n  --media-time-range-display: var(--time-range, var(--bottom-time-range));\n  --media-time-display-display: var(--time-display, var(--bottom-time-display));\n  --media-duration-display-display: var(--duration-display, var(--bottom-duration-display));\n  --media-title-display-display: var(--title-display, var(--bottom-title-display));\n}\n\n:host([no-tooltips]) {\n  --media-tooltip-display: none;\n}\n",(s=q,Tn(gW(),s.themeTemplate||!1,null!=(o=s.defaultStreamType)&&o,(e=>{let t=e.hotKeys?"".concat(e.hotKeys):"";return"live"===bz(e.streamType)&&(t+=" noarrowleft noarrowright"),t})(s)||!1,s.noHotKeys||!s.hasSrc||!1,!!(null!=(l=s.streamType)&&l.includes(o1.LIVE))&&0!==s.targetLiveWindow,s.novolumepref||!1,!s.hasSrc||s.isDialogOpen,null!=(d=s.audio)&&d,null!=(u=function(e){let t="";return Object.entries(e).forEach(e=>{let[i,r]=e;null!=r&&(t+="".concat(bU(i),": ").concat(r,"; "))}),t?t.trim():void 0}({"--media-primary-color":s.primaryColor,"--media-secondary-color":s.secondaryColor,"--media-accent-color":s.accentColor}))&&u,!s.defaultHiddenCaptions,null!=(h=s.forwardSeekOffset)&&h,null!=(c=s.backwardSeekOffset)&&c,null!=(m=s.playbackRates)&&m,null!=(f=s.defaultShowRemainingTime)&&f,null!=(p=s.defaultDuration)&&p,null!=(g=s.hideDuration)&&g,null!=(E=s.title)&&E,null!=(y=s.videoTitle)&&y,null!=(b=s.proudlyDisplayMuxBadge)&&b,Ts,s.onCloseErrorDialog,s.onFocusInErrorDialog,null!=(T=s.noHotKeys)&&T,null!=(_=s.targetLiveWindow)&&_,null!=(A=bz(s.streamType))&&A,null!=(S=s.crossOrigin)?S:"",null!=(I=s.autoplay)&&I,null!=(R=s.muted)&&R,null!=(k=s.loop)&&k,null!=(L=s.preload)&&L,null!=(D=s.debug)&&D,null!=(w=s.preferCmcd)&&w,null!=(C=s.disableTracking)&&C,null!=(M=s.disableCookies)&&M,null!=(O=s.preferPlayback)&&O,null!=s.startTime&&s.startTime,null!=(P=s.beaconCollectionDomain)&&P,null!=(x=s.playerInitTime)&&x,null!=(N=s.playerSoftwareName)&&N,null!=(U=s.playerSoftwareVersion)&&U,null!=(F=s.envKey)&&F,null!=(B=s.customDomain)&&B,s.src?s.src:!!s.playbackId&&l$(s),s.src?s.src:!!s.playbackId&&l$(s),null!=(H=s.castReceiver)&&H,null!=(K=null==(G=s.tokens)?void 0:G.drm)&&K,null!=(V=s.disablePseudoEnded)&&V,s.storyboard?Tn(gK(),s.storyboard):Tn(gV()),!!s.poster&&s.poster,null!=(W=s.placeholder)&&W))),n=this.shadowRoot,a.renderInto(n)},TM=function(){let e=e=>{var t,i;if(!(null!=e&&e.startsWith("theme-")))return;let r=e.replace(/^theme-/,"");if(TE.includes(r))return;let a=this.getAttribute(e);null!=a?null==(t=this.mediaTheme)||t.setAttribute(r,a):null==(i=this.mediaTheme)||i.removeAttribute(r)};new MutationObserver(t=>{for(let{attributeName:i}of t)e(i)}).observe(this,{attributes:!0}),this.getAttributeNames().forEach(e)},TO=function(){var e=this;let t=e=>{var t;let i=null==(t=this.media)?void 0:t.error;if(!(i instanceof oJ)){let{message:e,code:t}=null!=i?i:{};i=new oJ(e,t)}if(!(null!=i&&i.fatal)){b$(i),i.data&&b$("".concat(i.name," data:"),i.data);return}let r=Th(i,!1);r.message&&b1(r),b0(i),i.data&&b0("".concat(i.name," data:"),i.data),gX(this,Tk,Tw).call(this,{isDialogOpen:!0})};this.addEventListener("error",t),this.media&&(this.media.errorTranslator=function(){var t,i,r;let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!((null==(t=e.media)?void 0:t.error)instanceof oJ))return a;let n=Th(null==(i=e.media)?void 0:i.error,!1);return{player_error_code:null==(r=e.media)?void 0:r.error.code,player_error_message:n.message?String(n.message):a.player_error_message,player_error_context:n.context?String(n.context):a.player_error_context}})},TP=function(){var e,t,i,r;let a=()=>gX(this,Tk,TC).call(this);null==(t=null==(e=this.media)?void 0:e.textTracks)||t.addEventListener("addtrack",a),null==(r=null==(i=this.media)?void 0:i.textTracks)||r.addEventListener("removetrack",a)},Tx=function(){var e,t,i=this;if(!/Firefox/i.test(navigator.userAgent))return;let r,a=new WeakMap,n=()=>this.streamType===o1.LIVE&&!this.secondaryColor&&this.offsetWidth>=800,s=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];n()||Array.from(e&&e.activeCues||[]).forEach(e=>{if(!(!e.snapToLines||e.line<-5||e.line>=0&&e.line<10))if(!t||i.paused){let t=e.text.split("\n").length,n=-3;i.streamType===o1.LIVE&&(n=-2);let s=n-t;if(e.line===s&&!r)return;a.has(e)||a.set(e,e.line),e.line=s}else setTimeout(()=>{e.line=a.get(e)||"auto"},500)})},o=()=>{var e,t;s(r,null!=(t=null==(e=this.mediaController)?void 0:e.hasAttribute(cN.USER_INACTIVE))&&t)},l=()=>{var e,t;let i=Array.from((null==(t=null==(e=this.mediaController)?void 0:e.media)?void 0:t.textTracks)||[]).filter(e=>["subtitles","captions"].includes(e.kind)&&"showing"===e.mode)[0];i!==r&&(null==r||r.removeEventListener("cuechange",o)),null==(r=i)||r.addEventListener("cuechange",o),s(r,gj(this,TS))};l(),null==(e=this.textTracks)||e.addEventListener("change",l),null==(t=this.textTracks)||t.addEventListener("addtrack",l),this.addEventListener("userinactivechange",()=>{var e,t;let i=null==(t=null==(e=this.mediaController)?void 0:e.hasAttribute(cN.USER_INACTIVE))||t;gj(this,TS)!==i&&(gz(this,TS,i),s(r,gj(this,TS)))})};var Tq=TV,TY=e=>{throw TypeError(e)},Tj=(e,t,i)=>t.has(e)||TY("Cannot "+i),TQ=class{addEventListener(){}removeEventListener(){}dispatchEvent(e){return!0}};"undefined"==typeof DocumentFragment&&(globalThis.DocumentFragment=class extends TQ{});var Tz,TX=class extends TQ{},TZ=class{get detail(){let e,t;return Tj(this,e=Tz,"read from private field"),t?t.call(this):e.get(this)}initCustomEvent(){}constructor(e,t={}){((e,t,i)=>t.has(e)?TY("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,i))(this,Tz),((e,t,i,r)=>(Tj(e,t,"write to private field"),r?r.call(e,i):t.set(e,i)))(this,Tz,null==t?void 0:t.detail)}};Tz=new WeakMap;var TJ={document:{createElement:function(e,t){return new TX}},DocumentFragment,customElements:{get(e){},define(e,t,i){},getName:e=>null,upgrade(e){},whenDefined:e=>Promise.resolve(TX)},CustomEvent:TZ,EventTarget:TQ,HTMLElement:TX,HTMLVideoElement:class extends TQ{}},T$="undefined"==typeof window||void 0===globalThis.customElements,T0=T$?TJ:globalThis;T$?TJ.document:globalThis.document,T0.customElements.get("mux-player")||(T0.customElements.define("mux-player",Tq),T0.MuxPlayerElement=Tq),e.i(606552);var T1=parseInt(o.default.version)>=19,T2={className:"class",classname:"class",htmlFor:"for",crossOrigin:"crossorigin",viewBox:"viewBox",playsInline:"playsinline",autoPlay:"autoplay",playbackRate:"playbackrate"},T3=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{ref:t,...i}=e;return Object.entries(i).reduce((e,t)=>{let[i,r]=t,a=((e,t)=>{if(!(!T1&&"boolean"==typeof t&&!t)){let i,r;if(i=e,null!=(r=T2)&&i in r)return T2[e];if(void 0!==t)return/[A-Z]/.test(e)?e.replace(/[A-Z]/g,e=>"-".concat(e.toLowerCase())):e}})(i,r);if(!a)return e;let n=T1||"boolean"!=typeof r?r:"";return e[a]=n,e},{})};function T4(e,t){if("function"==typeof e)return e(t);null!=e&&(e.current=t)}var T5=Object.prototype.hasOwnProperty,T8=(e,t,i)=>!((e,t)=>{if(Object.is(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;if(Array.isArray(e))return!!Array.isArray(t)&&e.length===t.length&&e.some((e,i)=>t[i]===e);let i=Object.keys(e),r=Object.keys(t);if(i.length!==r.length)return!1;for(let r=0;r<i.length;r++)if(!T5.call(t,i[r])||!Object.is(e[i[r]],t[i[r]]))return!1;return!0})(t,e[i]),T9=(e,t,i)=>{e[i]=t},T6=function(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:T9,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:T8;return(0,o.useEffect)(()=>{let n=null==i?void 0:i.current;n&&a(n,t,e)&&r(n,t,e)},[null==i?void 0:i.current,t])},T7=(()=>{try{return"3.6.0"}catch(e){}return"UNKNOWN"})(),_e=(e,t,i)=>(0,o.useEffect)(()=>{let r=null==t?void 0:t.current;if(r&&i)return r.addEventListener(e,i),()=>{r.removeEventListener(e,i)}},[null==t?void 0:t.current,i,e]),_t=o.default.forwardRef((e,t)=>{let{children:i,...r}=e;return o.default.createElement("mux-player",{suppressHydrationWarning:!0,...T3(r),ref:t},i)}),_i=o.default.forwardRef((e,t)=>{var i;let r=(0,o.useRef)(null),a=function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return o.useCallback(function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return e=>{let i=!1,r=t.map(t=>{let r=T4(t,e);return i||"function"!=typeof r||(i=!0),r});if(i)return()=>{for(let e=0;e<r.length;e++){let i=r[e];"function"==typeof i?i():T4(t[e],null)}}}}(...t),t)}(r,t),[n]=((e,t)=>{let{onAbort:i,onCanPlay:r,onCanPlayThrough:a,onEmptied:n,onLoadStart:s,onLoadedData:o,onLoadedMetadata:l,onProgress:d,onDurationChange:u,onVolumeChange:h,onRateChange:c,onResize:m,onWaiting:f,onPlay:p,onPlaying:g,onTimeUpdate:E,onPause:y,onSeeking:b,onSeeked:T,onStalled:_,onSuspend:A,onEnded:S,onError:I,onCuePointChange:R,onChapterChange:k,metadata:L,tokens:D,paused:w,playbackId:C,playbackRates:M,currentTime:O,themeProps:P,extraSourceParams:x,castCustomData:N,_hlsConfig:U,...F}=t;return T6("tokens",D,e),T6("playbackId",C,e),T6("playbackRates",M,e),T6("metadata",L,e),T6("extraSourceParams",x,e),T6("_hlsConfig",U,e),T6("themeProps",P,e),T6("castCustomData",N,e),T6("paused",w,e,(e,t)=>{null!=t&&(t?e.pause():e.play())},(e,t,i)=>(!e.hasAttribute("autoplay")||!!e.hasPlayed)&&T8(e,t,i)),T6("currentTime",O,e,(e,t)=>{null!=t&&(e.currentTime=t)}),_e("abort",e,i),_e("canplay",e,r),_e("canplaythrough",e,a),_e("emptied",e,n),_e("loadstart",e,s),_e("loadeddata",e,o),_e("loadedmetadata",e,l),_e("progress",e,d),_e("durationchange",e,u),_e("volumechange",e,h),_e("ratechange",e,c),_e("resize",e,m),_e("waiting",e,f),_e("play",e,p),_e("playing",e,g),_e("timeupdate",e,E),_e("pause",e,y),_e("seeking",e,b),_e("seeked",e,T),_e("stalled",e,_),_e("suspend",e,A),_e("ended",e,S),_e("error",e,I),_e("cuepointchange",e,R),_e("chapterchange",e,k),[F]})(r,e),[s]=(0,o.useState)(null!=(i=e.playerInitTime)?i:lZ());return o.default.createElement(_t,{ref:a,defaultHiddenCaptions:e.defaultHiddenCaptions,playerSoftwareName:"mux-player-react",playerSoftwareVersion:T7,playerInitTime:s,...n})});function _r(e){let t,i,r=(0,s.c)(5),{customDomain:a,playbackId:o,tokens:l}=e;return r[0]===Symbol.for("react.memo_cache_sentinel")?(t={position:"absolute",inset:0},r[0]=t):t=r[0],r[1]!==a||r[2]!==o||r[3]!==l?(i=(0,n.jsx)(_i,{customDomain:a,theme:"sutro",playbackId:o,tokens:l,autoPlay:!1,loop:!1,style:t}),r[1]=a,r[2]=o,r[3]=l,r[4]=i):i=r[4],i}}]);