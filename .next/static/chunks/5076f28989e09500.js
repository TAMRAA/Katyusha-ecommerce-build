(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,403241,t=>{"use strict";let e;t.s(["v4",()=>i],403241);let n={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)},s=new Uint8Array(16),r=[];for(let t=0;t<256;++t)r.push((t+256).toString(16).slice(1));let i=function(t,i,o){var a,c,u;if(n.randomUUID&&!i&&!t)return n.randomUUID();let l=null!=(u=null!=(c=(t=t||{}).random)?c:null==(a=t.rng)?void 0:a.call(t))?u:function(){if(!e){if("undefined"==typeof crypto||!crypto.getRandomValues)throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");e=crypto.getRandomValues.bind(crypto)}return e(s)}();if(l.length<16)throw Error("Random bytes length must be >= 16");if(l[6]=15&l[6]|64,l[8]=63&l[8]|128,i){if((o=o||0)<0||o+16>i.length)throw RangeError("UUID byte range ".concat(o,":").concat(o+15," is out of buffer bounds"));for(let t=0;t<16;++t)i[o+t]=l[t];return i}return function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(r[t[e+0]]+r[t[e+1]]+r[t[e+2]]+r[t[e+3]]+"-"+r[t[e+4]]+r[t[e+5]]+"-"+r[t[e+6]]+r[t[e+7]]+"-"+r[t[e+8]]+r[t[e+9]]+"-"+r[t[e+10]]+r[t[e+11]]+r[t[e+12]]+r[t[e+13]]+r[t[e+14]]+r[t[e+15]]).toLowerCase()}(l)}},697165,847616,t=>{"use strict";t.s(["$",()=>q,"B",()=>tt,"C",()=>tE,"D",()=>K,"E",()=>tO,"F",()=>Q,"G",()=>tS,"H",()=>function t(e,n,s,r){if("string"==typeof n){let t=tu(e,n).next(s,r);return t&&t.length?t:e.next(s,r)}if(1===Object.keys(n).length){let i=Object.keys(n),o=t(tu(e,i[0]),n[i[0]],s,r);return o&&o.length?o:e.next(s,r)}let i=[];for(let o of Object.keys(n)){let a=n[o];if(!a)continue;let c=t(tu(e,o),a,s,r);c&&i.push(...c)}return i.length?i:e.next(s,r)},"I",()=>tb,"J",()=>l,"K",()=>tg,"L",()=>tc,"M",()=>p,"N",()=>r,"O",()=>Z,"P",()=>tl,"Q",()=>tM,"R",()=>k,"S",()=>s,"T",()=>o,"U",()=>u,"V",()=>T,"W",()=>tR,"X",()=>a,"a",()=>F,"c",()=>R,"e",()=>S,"f",()=>j,"g",()=>td,"h",()=>D,"k",()=>L,"l",()=>y,"n",()=>W,"q",()=>ts,"r",()=>tC,"t",()=>v,"u",()=>_,"v",()=>tn,"w",()=>J,"x",()=>x,"y",()=>te,"z",()=>tr],697165),t.s(["devToolsAdapter",()=>e],847616);let e=e=>{if("undefined"==typeof window)return;let n=function(){let e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:t.g;if(e.__xstate__)return e.__xstate__}();n&&n.register(e)};class n{start(){this._active=!0,this.flush()}clear(){this._current&&(this._current.next=null,this._last=this._current)}enqueue(t){let e={value:t,next:null};if(this._current){this._last.next=e,this._last=e;return}this._current=e,this._last=e,this._active&&this.flush()}flush(){for(;this._current;){let t=this._current;this._process(t.value),this._current=t.next}this._last=null}constructor(t){this._process=t,this._active=!1,this._current=null,this._last=null}}let s=".",r="",i="xstate.init",o="xstate.error",a="xstate.stop";function c(t,e){return{type:"xstate.done.state.".concat(t),output:e}}function u(t,e){return{type:"xstate.error.actor.".concat(t),error:e,actorId:t}}function l(t){return{type:i,input:t}}function d(t){setTimeout(()=>{throw t})}let h="function"==typeof Symbol&&Symbol.observable||"@@observable";function p(t){if(m(t))return t;let e=[],n="";for(let s=0;s<t.length;s++){switch(t.charCodeAt(s)){case 92:n+=t[s+1],s++;continue;case 46:e.push(n),n="";continue}n+=t[s]}return e.push(n),e}function f(t){var e;return(e=t)&&"object"==typeof e&&"machine"in e&&"value"in e?t.value:"string"!=typeof t?t:function(t){if(1===t.length)return t[0];let e={},n=e;for(let e=0;e<t.length-1;e++)if(e===t.length-2)n[t[e]]=t[e+1];else{let s=n;n={},s[t[e]]=n}return e}(p(t))}function y(t,e){let n={},s=Object.keys(t);for(let r=0;r<s.length;r++){let i=s[r];n[i]=e(t[i],i,t,r)}return n}function v(t){var e;return void 0===t?[]:m(e=t)?e:[e]}function g(t,e,n,s){return"function"==typeof t?t({context:e,event:n,self:s}):t}function m(t){return Array.isArray(t)}function _(t){var e;return(m(e=t)?e:[e]).map(t=>void 0===t||"string"==typeof t?{target:t}:t)}function b(t){if(void 0!==t&&""!==t)return v(t)}function S(t,e,n){var s,r,i;let o="object"==typeof t,a=o?t:void 0;return{next:null==(s=o?t.next:t)?void 0:s.bind(a),error:null==(r=o?t.error:e)?void 0:r.bind(a),complete:null==(i=o?t.complete:n)?void 0:i.bind(a)}}function x(t,e){return"".concat(e,".").concat(t)}function k(t,e){let n=e.match(/^xstate\.invoke\.(\d+)\.(.*)/);if(!n)return t.implementations.actors[e];let[,s,r]=n,i=t.getStateNodeById(r).config.invoke;return(Array.isArray(i)?i[s]:i).src}function E(t,e){return"".concat(t.sessionId,".").concat(e)}let w=0,I=!1,q=1,T=function(t){return t[t.NotStarted=0]="NotStarted",t[t.Running=1]="Running",t[t.Stopped=2]="Stopped",t}({}),A={clock:{setTimeout:(t,e)=>setTimeout(t,e),clearTimeout:t=>clearTimeout(t)},logger:console.log.bind(console),devTools:!1};class O{_initState(t){try{var e;this._snapshot=t?this.logic.restoreSnapshot?this.logic.restoreSnapshot(t,this._actorScope):t:this.logic.getInitialSnapshot(this._actorScope,null==(e=this.options)?void 0:e.input)}catch(t){this._snapshot={status:"error",output:void 0,error:t}}}update(t,e){var n,s,r,i;let o;for(this._snapshot=t;o=this._deferred.shift();)try{o()}catch(e){this._deferred.length=0,this._snapshot={...t,status:"error",error:e}}switch(this._snapshot.status){case"active":for(let e of this.observers)try{null==(n=e.next)||n.call(e,t)}catch(t){d(t)}break;case"done":for(let e of this.observers)try{null==(s=e.next)||s.call(e,t)}catch(t){d(t)}this._stopProcedure(),this._complete(),this._doneEvent=(r=this.id,i=this._snapshot.output,{type:"xstate.done.actor.".concat(r),output:i,actorId:r}),this._parent&&this.system._relay(this,this._parent,this._doneEvent);break;case"error":this._error(this._snapshot.error)}this.system._sendInspectionEvent({type:"@xstate.snapshot",actorRef:this,event:e,snapshot:t})}subscribe(t,e,n){let s=S(t,e,n);if(this._processingStatus!==T.Stopped)this.observers.add(s);else switch(this._snapshot.status){case"done":try{var r;null==(r=s.complete)||r.call(s)}catch(t){d(t)}break;case"error":{let t=this._snapshot.error;if(s.error)try{s.error(t)}catch(t){d(t)}else d(t)}}return{unsubscribe:()=>{this.observers.delete(s)}}}on(t,e){let n=this.eventListeners.get(t);n||(n=new Set,this.eventListeners.set(t,n));let s=e.bind(void 0);return n.add(s),{unsubscribe:()=>{n.delete(s)}}}start(){if(this._processingStatus===T.Running)return this;this._syncSnapshot&&this.subscribe({next:t=>{"active"===t.status&&this.system._relay(this,this._parent,{type:"xstate.snapshot.".concat(this.id),snapshot:t})},error:()=>{}}),this.system._register(this.sessionId,this),this._systemId&&this.system._set(this._systemId,this),this._processingStatus=T.Running;let t=l(this.options.input);switch(this.system._sendInspectionEvent({type:"@xstate.event",sourceRef:this._parent,actorRef:this,event:t}),this._snapshot.status){case"done":return this.update(this._snapshot,t),this;case"error":return this._error(this._snapshot.error),this}if(this._parent||this.system.start(),this.logic.start)try{this.logic.start(this._snapshot,this._actorScope)}catch(t){return this._snapshot={...this._snapshot,status:"error",error:t},this._error(t),this}return this.update(this._snapshot,t),this.options.devTools&&this.attachDevTools(),this.mailbox.start(),this}_process(t){let e,n;try{e=this.logic.transition(this._snapshot,t,this._actorScope)}catch(t){n={err:t}}if(n){let{err:t}=n;this._snapshot={...this._snapshot,status:"error",error:t},this._error(t);return}this.update(e,t),t.type===a&&(this._stopProcedure(),this._complete())}_stop(){return this._processingStatus===T.Stopped||((this.mailbox.clear(),this._processingStatus===T.NotStarted)?this._processingStatus=T.Stopped:this.mailbox.enqueue({type:a})),this}stop(){if(this._parent)throw Error("A non-root actor cannot be stopped directly.");return this._stop()}_complete(){for(let e of this.observers)try{var t;null==(t=e.complete)||t.call(e)}catch(t){d(t)}this.observers.clear()}_reportError(t){if(!this.observers.size){this._parent||d(t);return}let e=!1;for(let n of this.observers){let s=n.error;e||(e=!s);try{null==s||s(t)}catch(t){d(t)}}this.observers.clear(),e&&d(t)}_error(t){this._stopProcedure(),this._reportError(t),this._parent&&this.system._relay(this,this._parent,u(this.id,t))}_stopProcedure(){return this._processingStatus!==T.Running||(this.system.scheduler.cancelAll(this),this.mailbox.clear(),this.mailbox=new n(this._process.bind(this)),this._processingStatus=T.Stopped,this.system._unregister(this)),this}_send(t){this._processingStatus!==T.Stopped&&this.mailbox.enqueue(t)}send(t){this.system._relay(void 0,this,t)}attachDevTools(){let{devTools:t}=this.options;t&&("function"==typeof t?t:e)(this)}toJSON(){return{xstate$$type:q,id:this.id}}getPersistedSnapshot(t){return this.logic.getPersistedSnapshot(this._snapshot,t)}[h](){return this}getSnapshot(){return this._snapshot}constructor(t,e){var s,r,i,o;this.logic=t,this._snapshot=void 0,this.clock=void 0,this.options=void 0,this.id=void 0,this.mailbox=new n(this._process.bind(this)),this.observers=new Set,this.eventListeners=new Map,this.logger=void 0,this._processingStatus=T.NotStarted,this._parent=void 0,this._syncSnapshot=void 0,this.ref=void 0,this._actorScope=void 0,this._systemId=void 0,this.sessionId=void 0,this.system=void 0,this._doneEvent=void 0,this.src=void 0,this._deferred=[];let a={...A,...e},{clock:c,logger:u,parent:l,syncSnapshot:h,id:p,systemId:f,inspect:y}=a;this.system=l?l.system:function(t,e){var n;let s=new Map,r=new Map,i=new WeakMap,o=new Set,a={},{clock:c,logger:u}=e,l={schedule:function(t,e,n,s){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Math.random().toString(36).slice(2),i={source:t,target:e,event:n,delay:s,id:r,startedAt:Date.now()},o=E(t,r);d._snapshot._scheduledEvents[o]=i;let u=c.setTimeout(()=>{delete a[o],delete d._snapshot._scheduledEvents[o],d._relay(t,e,n)},s);a[o]=u},cancel:(t,e)=>{let n=E(t,e),s=a[n];delete a[n],delete d._snapshot._scheduledEvents[n],void 0!==s&&c.clearTimeout(s)},cancelAll:t=>{for(let e in d._snapshot._scheduledEvents){let n=d._snapshot._scheduledEvents[e];n.source===t&&l.cancel(t,n.id)}}},d={_snapshot:{_scheduledEvents:null!=(n=(null==e?void 0:e.snapshot)&&e.snapshot.scheduler)?n:{}},_bookId:()=>"x:".concat(w++),_register:(t,e)=>(s.set(t,e),t),_unregister:t=>{s.delete(t.sessionId);let e=i.get(t);void 0!==e&&(r.delete(e),i.delete(t))},get:t=>r.get(t),_set:(t,e)=>{let n=r.get(t);if(n&&n!==e)throw Error("Actor with system ID '".concat(t,"' already exists."));r.set(t,e),i.set(e,t)},inspect:t=>{let e=S(t);return o.add(e),{unsubscribe(){o.delete(e)}}},_sendInspectionEvent:e=>{if(!o.size)return;let n={...e,rootId:t.sessionId};o.forEach(t=>{var e;return null==(e=t.next)?void 0:e.call(t,n)})},_relay:(t,e,n)=>{d._sendInspectionEvent({type:"@xstate.event",sourceRef:t,actorRef:e,event:n}),e._send(n)},scheduler:l,getSnapshot:()=>({_scheduledEvents:{...d._snapshot._scheduledEvents}}),start:()=>{let t=d._snapshot._scheduledEvents;for(let e in d._snapshot._scheduledEvents={},t){let{source:n,target:s,event:r,delay:i,id:o}=t[e];l.schedule(n,s,r,i,o)}},_clock:c,_logger:u};return d}(this,{clock:c,logger:u}),y&&!l&&this.system.inspect(S(y)),this.sessionId=this.system._bookId(),this.id=null!=p?p:this.sessionId,this.logger=null!=(s=null==e?void 0:e.logger)?s:this.system._logger,this.clock=null!=(r=null==e?void 0:e.clock)?r:this.system._clock,this._parent=l,this._syncSnapshot=h,this.options=a,this.src=null!=(i=a.src)?i:t,this.ref=this,this._actorScope={self:this,id:this.id,sessionId:this.sessionId,logger:this.logger,defer:t=>{this._deferred.push(t)},system:this.system,stopChild:t=>{if(t._parent!==this)throw Error("Cannot stop child actor ".concat(t.id," of ").concat(this.id," because it is not a child"));t._stop()},emit:t=>{let e=this.eventListeners.get(t.type),n=this.eventListeners.get("*");if(e||n)for(let s of[...e?e.values():[],...n?n.values():[]])try{s(t)}catch(t){d(t)}},actionExecutor:t=>{let e=()=>{if(this._actorScope.system._sendInspectionEvent({type:"@xstate.action",actorRef:this,action:{type:t.type,params:t.params}}),!t.exec)return;let e=I;try{I=!0,t.exec(t.info,t.params)}finally{I=e}};this._processingStatus===T.Running?e():this._deferred.push(e)}},this.send=this.send.bind(this),this.system._sendInspectionEvent({type:"@xstate.actor",actorRef:this}),f&&(this._systemId=f,this.system._set(f,this)),this._initState(null!=(o=null==e?void 0:e.snapshot)?o:null==e?void 0:e.state),f&&"active"!==this._snapshot.status&&this.system._unregister(this)}}function R(t){for(var e=arguments.length,n=Array(e>1?e-1:0),s=1;s<e;s++)n[s-1]=arguments[s];let[r]=n;return new O(t,r)}function M(t,e,n,s,r){let{sendId:i}=r;return[e,{sendId:"function"==typeof i?i(n,s):i},void 0]}function N(t,e){t.defer(()=>{t.system.scheduler.cancel(t.self,e.sendId)})}function j(t){function e(t,e){}return e.type="xstate.cancel",e.sendId=t,e.resolve=M,e.execute=N,e}function C(t,e,n,s,r){let i,o,{id:a,systemId:c,src:u,input:l,syncSnapshot:d}=r,h="string"==typeof u?k(e.machine,u):u,p="function"==typeof a?a(n):a;return h&&(i="function"==typeof l?l({context:e.context,event:n.event,self:t.self}):l,o=R(h,{id:p,src:u,parent:t.self,syncSnapshot:d,systemId:c,input:i})),[tR(e,{children:{...e.children,[p]:o}}),{id:a,systemId:c,actorRef:o,src:u,input:i},void 0]}function P(t,e){let{actorRef:n}=e;n&&t.defer(()=>{n._processingStatus!==T.Stopped&&n.start()})}function D(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];let[s,{id:r,systemId:i,input:o,syncSnapshot:a=!1}={}]=e;function c(t,e){}return c.type="xstate.spawnChild",c.id=r,c.systemId=i,c.src=s,c.input=o,c.syncSnapshot=a,c.resolve=C,c.execute=P,c}function U(t,e,n,s,r){let{actorRef:i}=r,o="function"==typeof i?i(n,s):i,a="string"==typeof o?e.children[o]:o,c=e.children;return a&&(c={...c},delete c[a.id]),[tR(e,{children:c}),a,void 0]}function B(t,e){if(e){if(t.system._unregister(e),e._processingStatus!==T.Running)return void t.stopChild(e);t.defer(()=>{t.stopChild(e)})}}function L(t){function e(t,e){}return e.type="xstate.stopChild",e.actorRef=t,e.resolve=U,e.execute=B,e}function V(t,e,n){let{context:s,event:r}=e,{guards:i}=n;return!J(i[0],s,r,t)}function W(t){function e(t,e){return!1}return e.check=V,e.guards=[t],e}function z(t,e,n){let{context:s,event:r}=e,{guards:i}=n;return i.every(e=>J(e,s,r,t))}function F(t){function e(t,e){return!1}return e.check=z,e.guards=t,e}function J(t,e,n,s){let{machine:r}=s,i="function"==typeof t,o=i?t:r.implementations.guards["string"==typeof t?t:t.type];if(!i&&!o)throw Error("Guard '".concat("string"==typeof t?t:t.type,"' is not implemented.'."));if("function"!=typeof o)return J(o,e,n,s);let a={context:e,event:n},c=i||"string"==typeof t?void 0:"params"in t?"function"==typeof t.params?t.params({context:e,event:n}):t.params:void 0;return"check"in o?o.check(s,a,o):o(a,c)}let G=t=>"atomic"===t.type||"final"===t.type;function $(t){return Object.values(t.states).filter(t=>"history"!==t.type)}function H(t,e){let n=[];if(e===t)return n;let s=t.parent;for(;s&&s!==e;)n.push(s),s=s.parent;return n}function K(t){let e=new Set(t),n=X(e);for(let t of e)if("compound"!==t.type||n.get(t)&&n.get(t).length){if("parallel"===t.type){for(let n of $(t))if("history"!==n.type&&!e.has(n))for(let t of ta(n))e.add(t)}}else ta(t).forEach(t=>e.add(t));for(let t of e){let n=t.parent;for(;n;)e.add(n),n=n.parent}return e}function X(t){let e=new Map;for(let n of t)e.has(n)||e.set(n,[]),n.parent&&(e.has(n.parent)||e.set(n.parent,[]),e.get(n.parent).push(n));return e}function Y(t,e){return function t(e,n){let s=n.get(e);if(!s)return{};if("compound"===e.type){let t=s[0];if(!t)return{};if(G(t))return t.key}let r={};for(let e of s)r[e.key]=t(e,n);return r}(t,X(K(e)))}function Q(t,e){return"compound"===e.type?$(e).some(e=>"final"===e.type&&t.has(e)):"parallel"===e.type?$(e).every(e=>Q(t,e)):"final"===e.type}let Z=t=>"#"===t[0];function tt(t,e){return t.transitions.get(e)||[...t.transitions.keys()].filter(t=>{if("*"===t)return!0;if(!t.endsWith(".*"))return!1;let n=t.split("."),s=e.split(".");for(let t=0;t<n.length;t++){let e=n[t],r=s[t];if("*"===e)return t===n.length-1;if(e!==r)return!1}return!0}).sort((t,e)=>e.length-t.length).flatMap(e=>t.transitions.get(e))}function te(t){let e=t.config.after;return e?Object.keys(e).flatMap(n=>{let s=e[n],r=Number.isNaN(+n)?n:+n,i=(e=>{var n;let s=(n=t.id,{type:"xstate.after.".concat(e,".").concat(n)}),r=s.type;return t.entry.push(tC(s,{id:r,delay:e})),t.exit.push(j(r)),r})(r);return v("string"==typeof s?{target:s}:s).map(t=>({...t,event:i,delay:r}))}).map(e=>{let{delay:n}=e;return{...tn(t,e.event,e),delay:n}}):[]}function tn(t,e,n){var r;let i=b(n.target),o=null!=(r=n.reenter)&&r,a=function(t,e){if(void 0!==e)return e.map(e=>{if("string"!=typeof e)return e;if(Z(e))return t.machine.getStateNodeById(e);let n=e[0]===s;if(n&&!t.parent)return tl(t,e.slice(1));let r=n?t.key+e:e;if(t.parent)try{return tl(t.parent,r)}catch(e){throw Error("Invalid transition definition for state node '".concat(t.id,"':\n").concat(e.message))}throw Error('Invalid target: "'.concat(e,'" is not a valid target from the root node. Did you mean ".').concat(e,'"?'))})}(t,i),c={...n,actions:v(n.actions),guard:n.guard,target:a,source:t,reenter:o,eventType:e,toJSON:()=>({...c,source:"#".concat(t.id),target:a?a.map(t=>"#".concat(t.id)):void 0})};return c}function ts(t){let e=new Map;if(t.config.on)for(let n of Object.keys(t.config.on)){if(n===r)throw Error('Null events ("") cannot be specified as a transition key. Use `always: { ... }` instead.');let s=t.config.on[n];e.set(n,_(s).map(e=>tn(t,n,e)))}if(t.config.onDone){let n="xstate.done.state.".concat(t.id);e.set(n,_(t.config.onDone).map(e=>tn(t,n,e)))}for(let n of t.invoke){if(n.onDone){let s="xstate.done.actor.".concat(n.id);e.set(s,_(n.onDone).map(e=>tn(t,s,e)))}if(n.onError){let s="xstate.error.actor.".concat(n.id);e.set(s,_(n.onError).map(e=>tn(t,s,e)))}if(n.onSnapshot){let s="xstate.snapshot.".concat(n.id);e.set(s,_(n.onSnapshot).map(e=>tn(t,s,e)))}}for(let n of t.after){let t=e.get(n.eventType);t||(t=[],e.set(n.eventType,t)),t.push(n)}return e}function tr(t,e){let n="string"==typeof e?t.states[e]:e?t.states[e.target]:void 0;if(!n&&e)throw Error('Initial state node "'.concat(e,'" not found on parent state node #').concat(t.id));let s={source:t,actions:e&&"string"!=typeof e?v(e.actions):[],eventType:null,reenter:!1,target:n?[n]:[],toJSON:()=>({...s,source:"#".concat(t.id),target:n?["#".concat(n.id)]:[]})};return s}function ti(t){let e=b(t.config.target);return e?{target:e.map(e=>"string"==typeof e?tl(t.parent,e):e)}:t.parent.initial}function to(t){return"history"===t.type}function ta(t){let e=tc(t);for(let n of e)for(let s of H(n,t))e.add(s);return e}function tc(t){let e=new Set;return!function t(n){if(!e.has(n)){if(e.add(n),"compound"===n.type)t(n.initial.target[0]);else if("parallel"===n.type)for(let e of $(n))t(e)}}(t),e}function tu(t,e){if(Z(e))return t.machine.getStateNodeById(e);if(!t.states)throw Error("Unable to retrieve child state '".concat(e,"' from '").concat(t.id,"'; no child states exist."));let n=t.states[e];if(!n)throw Error("Child state '".concat(e,"' does not exist on '").concat(t.id,"'"));return n}function tl(t,e){if("string"==typeof e&&Z(e))try{return t.machine.getStateNodeById(e)}catch(t){}let n=p(e).slice(),s=t;for(;n.length;){let t=n.shift();if(!t.length)break;s=tu(s,t)}return s}function td(t,e){if("string"==typeof e){let n=t.states[e];if(!n)throw Error("State '".concat(e,"' does not exist on '").concat(t.id,"'"));return[t,n]}let n=Object.keys(e),s=n.map(e=>tu(t,e)).filter(Boolean);return[t.machine.root,t].concat(s,n.reduce((n,s)=>{let r=tu(t,s);if(!r)return n;let i=td(r,e[s]);return n.concat(i)},[]))}function th(t,e){let n=t;for(;n.parent&&n.parent!==e;)n=n.parent;return n.parent===e}function tp(t,e,n){let s=new Set;for(let r of t){let t=!1,i=new Set;for(let o of s)if(function(t,e){let n=new Set(t),s=new Set(e);for(let t of n)if(s.has(t))return!0;for(let t of s)if(n.has(t))return!0;return!1}(tv([r],e,n),tv([o],e,n)))if(th(r.source,o.source))i.add(o);else{t=!0;break}if(!t){for(let t of i)s.delete(t);s.add(r)}}return Array.from(s)}function tf(t,e){if(!t.target)return[];let n=new Set;for(let s of t.target)if(to(s))if(e[s.id])for(let t of e[s.id])n.add(t);else for(let t of tf(ti(s),e))n.add(t);else n.add(s);return[...n]}function ty(t,e){let n=tf(t,e);if(!n)return;if(!t.reenter&&n.every(e=>e===t.source||th(e,t.source)))return t.source;let s=function(t){let[e,...n]=t;for(let t of H(e,void 0))if(n.every(e=>th(e,t)))return t}(n.concat(t.source));return s||(t.reenter?void 0:t.source.machine.root)}function tv(t,e,n){let s=new Set;for(let i of t){var r;if(null==(r=i.target)?void 0:r.length){let t=ty(i,n);for(let n of(i.reenter&&i.source===t&&s.add(t),e))th(n,t)&&s.add(n)}}return[...s]}function tg(t,e,n,s,r,i){if(!t.length)return e;let o=new Set(e._nodes),a=e.historyValue,u=tp(t,o,a),l=e;r||([l,a]=function(t,e,n,s,r,i,o,a){let c,u=t,l=tv(s,r,i);for(let t of(l.sort((t,e)=>e.order-t.order),l))for(let e of function(t){return Object.keys(t.states).map(e=>t.states[e]).filter(t=>"history"===t.type)}(t)){let n;n="deep"===e.history?e=>G(e)&&th(e,t):e=>e.parent===t,null!=c||(c={...i}),c[e.id]=Array.from(r).filter(n)}for(let t of l)u=tb(u,e,n,[...t.exit,...t.invoke.map(t=>L(t.id))],o,void 0),r.delete(t);return[u,c||i]}(l,s,n,u,o,a,i,n.actionExecutor)),l=function(t,e,n,s,r,i,o,a){let u=t,l=new Set,d=new Set;(function(t,e,n,s){for(let r of t){let t=ty(r,e);for(let i of r.target||[])!to(i)&&(r.source!==i||r.source!==t||r.reenter)&&(s.add(i),n.add(i)),tm(i,e,n,s);for(let i of tf(r,e)){let o=H(i,t);(null==t?void 0:t.type)==="parallel"&&o.push(t),t_(s,e,n,o,!r.source.parent&&r.reenter?void 0:t)}}})(s,o,d,l),a&&d.add(t.machine.root);let h=new Set;for(let t of[...l].sort((t,e)=>t.order-e.order)){r.add(t);let s=[];for(let e of(s.push(...t.entry),t.invoke))s.push(D(e.src,{...e,syncSnapshot:!!e.onSnapshot}));if(d.has(t)){let e=t.initial.actions;s.push(...e)}if(u=tb(u,e,n,s,i,t.invoke.map(t=>t.id)),"final"===t.type){let s=t.parent,o=(null==s?void 0:s.type)==="parallel"?s:null==s?void 0:s.parent,a=o||t;for((null==s?void 0:s.type)==="compound"&&i.push(c(s.id,void 0!==t.output?g(t.output,u.context,e,n.self):void 0));(null==o?void 0:o.type)==="parallel"&&!h.has(o)&&Q(r,o);)h.add(o),i.push(c(o.id)),a=o,o=o.parent;if(o)continue;u=tR(u,{status:"done",output:function(t,e,n,s,r){if(void 0===s.output)return;let i=c(r.id,void 0!==r.output&&r.parent?g(r.output,t.context,e,n.self):void 0);return g(s.output,t.context,i,n.self)}(u,e,n,u.machine.root,a)})}}return u}(l=tb(l,s,n,u.flatMap(t=>t.actions),i,void 0),s,n,u,o,i,a,r);let d=[...o];"done"===l.status&&(l=tb(l,s,n,d.sort((t,e)=>e.order-t.order).flatMap(t=>t.exit),i,void 0));try{if(a===e.historyValue&&function(t,e){if(t.length!==e.size)return!1;for(let n of t)if(!e.has(n))return!1;return!0}(e._nodes,o))return l;return tR(l,{_nodes:d,historyValue:a})}catch(t){throw t}}function tm(t,e,n,s){var r,i,o,a,c;if(to(t))if(e[t.id]){let o=e[t.id];for(let t of o)s.add(t),tm(t,e,n,s);for(let a of o){r=a,i=t.parent,t_(s,e,n,H(r,i))}}else{let r=ti(t);for(let i of r.target){s.add(i),r===(null==(o=t.parent)?void 0:o.initial)&&n.add(t.parent),tm(i,e,n,s)}for(let i of r.target){a=i,c=t.parent,t_(s,e,n,H(a,c))}}else if("compound"===t.type){let[r]=t.initial.target;to(r)||(s.add(r),n.add(r)),tm(r,e,n,s),t_(s,e,n,H(r,t))}else if("parallel"===t.type)for(let r of $(t).filter(t=>!to(t)))[...s].some(t=>th(t,r))||(to(r)||(s.add(r),n.add(r)),tm(r,e,n,s))}function t_(t,e,n,s,r){for(let i of s)if((!r||th(i,r))&&t.add(i),"parallel"===i.type)for(let s of $(i).filter(t=>!to(t)))[...t].some(t=>th(t,s))||(t.add(s),tm(s,e,n,t))}function tb(t,e,n,s,r,i){let o=i?[]:void 0,a=function t(e,n,s,r,i,o){let{machine:a}=e,c=e;for(let e of r){var u;let r="function"==typeof e,l=r?e:(u="string"==typeof e?e:e.type,a.implementations.actions[u]),d={context:c.context,event:n,self:s.self,system:s.system},h=r||"string"==typeof e?void 0:"params"in e?"function"==typeof e.params?e.params({context:c.context,event:n}):e.params:void 0;if(!l||!("resolve"in l)){s.actionExecutor({type:"string"==typeof e?e:"object"==typeof e?e.type:e.name||"(anonymous)",info:d,params:h,exec:l});continue}let[p,f,y]=l.resolve(s,c,d,h,l,i);c=p,"retryResolve"in l&&(null==o||o.push([l,f])),"execute"in l&&s.actionExecutor({type:l.type,info:d,params:f,exec:l.execute.bind(null,s,f)}),y&&(c=t(c,n,s,y,i,o))}return c}(t,e,n,s,{internalQueue:r,deferredActorIds:i},o);return null==o||o.forEach(t=>{let[e,s]=t;e.retryResolve(n,a,s)}),a}function tS(t,e,n,s){let r=t,o=[];function c(t,e,s){n.system._sendInspectionEvent({type:"@xstate.microstep",actorRef:n.self,event:e,snapshot:t,_transitions:s}),o.push(t)}if(e.type===a)return c(r=tR(tx(r,e,n),{status:"stopped"}),e,[]),{snapshot:r,microstates:o};let u=e;if(u.type!==i){let e=u,i=e.type.startsWith("xstate.error.actor"),a=tk(e,r);if(i&&!a.length)return c(r=tR(t,{status:"error",error:e.error}),e,[]),{snapshot:r,microstates:o};c(r=tg(a,t,n,u,!1,s),e,a)}let l=!0;for(;"active"===r.status;){let t=l?function(t,e){let n=new Set;for(let s of t._nodes.filter(G))t:for(let r of[s].concat(H(s,void 0)))if(r.always){for(let s of r.always)if(void 0===s.guard||J(s.guard,t.context,e,t)){n.add(s);break t}}return tp(Array.from(n),new Set(t._nodes),t.historyValue)}(r,u):[],e=t.length?r:void 0;if(!t.length){if(!s.length)break;t=tk(u=s.shift(),r)}l=(r=tg(t,r,n,u,!1,s))!==e,c(r,u,t)}return"active"!==r.status&&tx(r,u,n),{snapshot:r,microstates:o}}function tx(t,e,n){return tb(t,e,n,Object.values(t.children).map(t=>L(t)),[],void 0)}function tk(t,e){return e.machine.getTransitionData(e,t)}function tE(t,e){let n=K(td(t,e));return Y(t,[...n])}let tw=function(t){return function t(e,n){let s=f(e),r=f(n);return"string"==typeof r?"string"==typeof s&&r===s:"string"==typeof s?s in r:Object.keys(s).every(e=>e in r&&t(s[e],r[e]))}(t,this.value)},tI=function(t){return this.tags.has(t)},tq=function(t){let e=this.machine.getTransitionData(this,t);return!!(null==e?void 0:e.length)&&e.some(t=>void 0!==t.target||t.actions.length)},tT=function(){let{_nodes:t,tags:e,machine:n,getMeta:s,toJSON:r,can:i,hasTag:o,matches:a,...c}=this;return{...c,tags:Array.from(e)}},tA=function(){return this._nodes.reduce((t,e)=>(void 0!==e.meta&&(t[e.id]=e.meta),t),{})};function tO(t,e){return{status:t.status,output:t.output,error:t.error,machine:e,context:t.context,_nodes:t._nodes,value:Y(e.root,t._nodes),tags:new Set(t._nodes.flatMap(t=>t.tags)),children:t.children,historyValue:t.historyValue||{},matches:tw,hasTag:tI,can:tq,getMeta:tA,toJSON:tT}}function tR(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return tO({...t,...e},t.machine)}function tM(t,e){let{_nodes:n,tags:s,machine:r,children:i,context:o,can:a,hasTag:c,matches:u,getMeta:l,toJSON:d,...h}=t,p={};for(let t in i){let n=i[t];p[t]={snapshot:n.getPersistedSnapshot(e),src:n.src,systemId:n._systemId,syncSnapshot:n._syncSnapshot}}return{...h,context:function t(e){let n;for(let s in e){let r=e[s];if(r&&"object"==typeof r)if("sessionId"in r&&"send"in r&&"ref"in r)null!=n||(n=Array.isArray(e)?e.slice():{...e}),n[s]={xstate$$type:q,id:r.id};else{let i=t(r);i!==r&&(null!=n||(n=Array.isArray(e)?e.slice():{...e}),n[s]=i)}}return null!=n?n:e}(o),children:p,historyValue:function(t){if("object"!=typeof t||null===t)return{};let e={};for(let n in t){let s=t[n];Array.isArray(s)&&(e[n]=s.map(t=>({id:t.id})))}return e}(h.historyValue)}}function tN(t,e,n,s,r,i){let o,{event:a,id:c,delay:u}=r,{internalQueue:l}=i,d=e.machine.implementations.delays;if("string"==typeof a)throw Error('Only event objects may be used with raise; use raise({ type: "'.concat(a,'" }) instead'));let h="function"==typeof a?a(n,s):a;if("string"==typeof u){let t=d&&d[u];o="function"==typeof t?t(n,s):t}else o="function"==typeof u?u(n,s):u;return"number"!=typeof o&&l.push(h),[e,{event:h,id:c,delay:o},void 0]}function tj(t,e){let{event:n,delay:s,id:r}=e;if("number"==typeof s)return void t.defer(()=>{let e=t.self;t.system.scheduler.schedule(e,e,n,s,r)})}function tC(t,e){function n(t,e){}return n.type="xstate.raise",n.event=t,n.id=null==e?void 0:e.id,n.delay=null==e?void 0:e.delay,n.resolve=tN,n.execute=tj,n}},509820,807574,823588,t=>{"use strict";t.s(["assertEvent",()=>k,"setup",()=>E],509820),t.s(["fromCallback",()=>i,"fromEventObservable",()=>l,"fromObservable",()=>u,"fromPromise",()=>f],807574);var e,n,s=t.i(697165);t.i(847616);let r=new WeakMap;function i(t){return{config:t,start:(e,n)=>{let{self:s,system:i,emit:o}=n,a={receivers:void 0,dispose:void 0};r.set(s,a),a.dispose=t({input:e.input,system:i,self:s,sendBack:t=>{"stopped"!==s.getSnapshot().status&&s._parent&&i._relay(s,s._parent,t)},receive:t=>{null!=a.receivers||(a.receivers=new Set),a.receivers.add(t)},emit:o})},transition:(t,e,n)=>{var i,o;let a=r.get(n.self);return e.type===s.X?(t={...t,status:"stopped",error:void 0},null==(o=a.dispose)||o.call(a)):null==(i=a.receivers)||i.forEach(t=>t(e)),t},getInitialSnapshot:(t,e)=>({status:"active",output:void 0,error:void 0,input:e}),getPersistedSnapshot:t=>t,restoreSnapshot:t=>t}}let o="xstate.observable.next",a="xstate.observable.error",c="xstate.observable.complete";function u(t){return{config:t,transition:(t,e)=>{if("active"!==t.status)return t;switch(e.type){case o:return{...t,context:e.data};case a:return{...t,status:"error",error:e.data,input:void 0,_subscription:void 0};case c:return{...t,status:"done",input:void 0,_subscription:void 0};case s.X:return t._subscription.unsubscribe(),{...t,status:"stopped",input:void 0,_subscription:void 0};default:return t}},getInitialSnapshot:(t,e)=>({status:"active",output:void 0,error:void 0,context:void 0,input:e,_subscription:void 0}),start:(e,n)=>{let{self:s,system:r,emit:i}=n;"done"!==e.status&&(e._subscription=t({input:e.input,system:r,self:s,emit:i}).subscribe({next:t=>{r._relay(s,s,{type:o,data:t})},error:t=>{r._relay(s,s,{type:a,data:t})},complete:()=>{r._relay(s,s,{type:c})}}))},getPersistedSnapshot:t=>{let{_subscription:e,...n}=t;return n},restoreSnapshot:t=>({...t,_subscription:void 0})}}function l(t){return{config:t,transition:(t,e)=>{if("active"!==t.status)return t;switch(e.type){case a:return{...t,status:"error",error:e.data,input:void 0,_subscription:void 0};case c:return{...t,status:"done",input:void 0,_subscription:void 0};case s.X:return t._subscription.unsubscribe(),{...t,status:"stopped",input:void 0,_subscription:void 0};default:return t}},getInitialSnapshot:(t,e)=>({status:"active",output:void 0,error:void 0,context:void 0,input:e,_subscription:void 0}),start:(e,n)=>{let{self:s,system:r,emit:i}=n;"done"!==e.status&&(e._subscription=t({input:e.input,system:r,self:s,emit:i}).subscribe({next:t=>{s._parent&&r._relay(s,s._parent,t)},error:t=>{r._relay(s,s,{type:a,data:t})},complete:()=>{r._relay(s,s,{type:c})}}))},getPersistedSnapshot:t=>{let{_subscription:e,...n}=t;return n},restoreSnapshot:t=>({...t,_subscription:void 0})}}let d="xstate.promise.resolve",h="xstate.promise.reject",p=new WeakMap;function f(t){return{config:t,transition:(t,e,n)=>{if("active"!==t.status)return t;switch(e.type){case d:{let n=e.data;return{...t,status:"done",output:n,input:void 0}}case h:return{...t,status:"error",error:e.data,input:void 0};case s.X:var r;return null==(r=p.get(n.self))||r.abort(),{...t,status:"stopped",input:void 0};default:return t}},start:(e,n)=>{let{self:s,system:r,emit:i}=n;if("active"!==e.status)return;let o=new AbortController;p.set(s,o),Promise.resolve(t({input:e.input,system:r,self:s,signal:o.signal,emit:i})).then(t=>{"active"===s.getSnapshot().status&&(p.delete(s),r._relay(s,s,{type:d,data:t}))},t=>{"active"===s.getSnapshot().status&&(p.delete(s),r._relay(s,s,{type:h,data:t}))})},getInitialSnapshot:(t,e)=>({status:"active",output:void 0,error:void 0,input:e}),getPersistedSnapshot:t=>t,restoreSnapshot:t=>t}}function y(t,e,n,r,i){let{assignment:o}=i;if(!e.context)throw Error("Cannot assign to undefined `context`. Ensure that `context` is defined in the machine config.");let a={},c={context:e.context,event:n.event,spawn:function(t,e,n,r){let{machine:i,context:o}=e;return(e,a)=>{let c=((e,a)=>{if("string"!=typeof e)return(0,s.c)(e,{id:null==a?void 0:a.id,parent:t.self,syncSnapshot:null==a?void 0:a.syncSnapshot,input:null==a?void 0:a.input,src:e,systemId:null==a?void 0:a.systemId});{let c=(0,s.R)(i,e);if(!c)throw Error("Actor logic '".concat(e,"' not implemented in machine '").concat(i.id,"'"));let u=(0,s.c)(c,{id:null==a?void 0:a.id,parent:t.self,syncSnapshot:null==a?void 0:a.syncSnapshot,input:"function"==typeof(null==a?void 0:a.input)?a.input({context:o,event:n,self:t.self}):null==a?void 0:a.input,src:e,systemId:null==a?void 0:a.systemId});return r[u.id]=u,u}})(e,a);return r[c.id]=c,t.defer(()=>{c._processingStatus!==s.V.Stopped&&c.start()}),c}}(t,e,n.event,a),self:t.self,system:t.system},u={};if("function"==typeof o)u=o(c,r);else for(let t of Object.keys(o)){let e=o[t];u[t]="function"==typeof e?e(c,r):e}let l=Object.assign({},e.context,u);return[(0,s.W)(e,{context:l,children:Object.keys(a).length?{...e.children,...a}:e.children}),void 0,void 0]}function v(t){function e(t,e){}return e.type="xstate.assign",e.assignment=t,e.resolve=y,e}e=t=>void 0,n=0,t.s(["a",()=>v],823588);let g=new WeakMap;function m(t,e,n){let s=g.get(t);return s?e in s||(s[e]=n()):(s={[e]:n()},g.set(t,s)),s[e]}let _={},b=t=>"string"==typeof t?{type:t}:"function"==typeof t?"resolve"in t?{type:t.type}:{type:t.name}:t;class S{_initialize(){this.transitions=(0,s.q)(this),this.config.always&&(this.always=(0,s.u)(this.config.always).map(t=>(0,s.v)(this,s.N,t))),Object.keys(this.states).forEach(t=>{this.states[t]._initialize()})}get definition(){return{id:this.id,key:this.key,version:this.machine.version,type:this.type,initial:this.initial?{target:this.initial.target,source:this,actions:this.initial.actions.map(b),eventType:null,reenter:!1,toJSON:()=>({target:this.initial.target.map(t=>"#".concat(t.id)),source:"#".concat(this.id),actions:this.initial.actions.map(b),eventType:null})}:void 0,history:this.history,states:(0,s.l)(this.states,t=>t.definition),on:this.on,transitions:[...this.transitions.values()].flat().map(t=>({...t,actions:t.actions.map(b)})),entry:this.entry.map(b),exit:this.exit.map(b),meta:this.meta,order:this.order||-1,output:this.output,invoke:this.invoke,description:this.description,tags:this.tags}}toJSON(){return this.definition}get invoke(){return m(this,"invoke",()=>(0,s.t)(this.config.invoke).map((t,e)=>{var n;let{src:r,systemId:i}=t,o=null!=(n=t.id)?n:(0,s.x)(this.id,e),a="string"==typeof r?r:"xstate.invoke.".concat((0,s.x)(this.id,e));return{...t,src:a,id:o,systemId:i,toJSON(){let{onDone:e,onError:n,...s}=t;return{...s,type:"xstate.invoke",src:a,id:o}}}}))}get on(){return m(this,"on",()=>[...this.transitions].flatMap(t=>{let[e,n]=t;return n.map(t=>[e,t])}).reduce((t,e)=>{let[n,s]=e;return t[n]=t[n]||[],t[n].push(s),t},{}))}get after(){return m(this,"delayedTransitions",()=>(0,s.y)(this))}get initial(){return m(this,"initial",()=>(0,s.z)(this,this.config.initial))}next(t,e){let n,r=e.type,i=[];for(let o of m(this,"candidates-".concat(r),()=>(0,s.B)(this,r))){let{guard:a}=o,c=t.context,u=!1;try{u=!a||(0,s.w)(a,c,e,t)}catch(e){let t="string"==typeof a?a:"object"==typeof a?a.type:void 0;throw Error("Unable to evaluate guard ".concat(t?"'".concat(t,"' "):"","in transition for event '").concat(r,"' in state node '").concat(this.id,"':\n").concat(e.message))}if(u){i.push(...o.actions),n=o;break}}return n?[n]:void 0}get events(){return m(this,"events",()=>{let{states:t}=this,e=new Set(this.ownEvents);if(t)for(let n of Object.keys(t)){let s=t[n];if(s.states)for(let t of s.events)e.add("".concat(t))}return Array.from(e)})}get ownEvents(){return Array.from(new Set([...this.transitions.keys()].filter(t=>this.transitions.get(t).some(t=>!(!t.target&&!t.actions.length&&!t.reenter)))))}constructor(t,e){if(this.config=t,this.key=void 0,this.id=void 0,this.type=void 0,this.path=void 0,this.states=void 0,this.history=void 0,this.entry=void 0,this.exit=void 0,this.parent=void 0,this.machine=void 0,this.meta=void 0,this.output=void 0,this.order=-1,this.description=void 0,this.tags=[],this.transitions=void 0,this.always=void 0,this.parent=e._parent,this.key=e._key,this.machine=e._machine,this.path=this.parent?this.parent.path.concat(this.key):[],this.id=this.config.id||[this.machine.id,...this.path].join(s.S),this.type=this.config.type||(this.config.states&&Object.keys(this.config.states).length?"compound":this.config.history?"history":"atomic"),this.description=this.config.description,this.order=this.machine.idMap.size,this.machine.idMap.set(this.id,this),this.states=this.config.states?(0,s.l)(this.config.states,(t,e)=>new S(t,{_parent:this,_key:e,_machine:this.machine})):_,"compound"===this.type&&!this.config.initial)throw Error('No initial state specified for compound state node "#'.concat(this.id,'". Try adding { initial: "').concat(Object.keys(this.states)[0],'" } to the state config.'));this.history=!0===this.config.history?"shallow":this.config.history||!1,this.entry=(0,s.t)(this.config.entry).slice(),this.exit=(0,s.t)(this.config.exit).slice(),this.meta=this.config.meta,this.output="final"!==this.type&&this.parent?void 0:this.config.output,this.tags=(0,s.t)(t.tags).slice()}}class x{provide(t){let{actions:e,guards:n,actors:s,delays:r}=this.implementations;return new x(this.config,{actions:{...e,...t.actions},guards:{...n,...t.guards},actors:{...s,...t.actors},delays:{...r,...t.delays}})}resolveState(t){let e=(0,s.C)(this.root,t.value),n=(0,s.D)((0,s.g)(this.root,e));return(0,s.E)({_nodes:[...n],context:t.context||{},children:{},status:(0,s.F)(n,this.root)?"done":t.status||"active",output:t.output,error:t.error,historyValue:t.historyValue},this)}transition(t,e,n){return(0,s.G)(t,e,n,[]).snapshot}microstep(t,e,n){return(0,s.G)(t,e,n,[]).microstates}getTransitionData(t,e){return(0,s.H)(this.root,t.value,t,e)||[]}getPreInitialState(t,e,n){let{context:r}=this.config,i=(0,s.E)({context:"function"!=typeof r&&r?r:{},_nodes:[this.root],children:{},status:"active"},this);return"function"==typeof r?(0,s.I)(i,e,t,[v(t=>{let{spawn:e,event:n,self:s}=t;return r({spawn:e,input:n.input,self:s})})],n,void 0):i}getInitialSnapshot(t,e){let n=(0,s.J)(e),r=[],i=this.getPreInitialState(t,n,r),o=(0,s.K)([{target:[...(0,s.L)(this.root)],source:this.root,reenter:!0,actions:[],eventType:null,toJSON:null}],i,t,n,!0,r),{snapshot:a}=(0,s.G)(o,n,t,r);return a}start(t){Object.values(t.children).forEach(t=>{"active"===t.getSnapshot().status&&t.start()})}getStateNodeById(t){let e=(0,s.M)(t),n=e.slice(1),r=(0,s.O)(e[0])?e[0].slice(1):e[0],i=this.idMap.get(r);if(!i)throw Error("Child state node '#".concat(r,"' does not exist on machine '").concat(this.id,"'"));return(0,s.P)(i,n)}get definition(){return this.root.definition}toJSON(){return this.definition}getPersistedSnapshot(t,e){return(0,s.Q)(t,e)}restoreSnapshot(t,e){let n={},r=t.children;Object.keys(r).forEach(t=>{let i=r[t],o=i.snapshot,a=i.src,c="string"==typeof a?(0,s.R)(this,a):a;if(!c)return;let u=(0,s.c)(c,{id:t,parent:e.self,syncSnapshot:i.syncSnapshot,snapshot:o,src:a,systemId:i.systemId});n[t]=u});let i=function(t,e){if(!e||"object"!=typeof e)return{};let n={};for(let s in e)for(let r of e[s]){let e=function(t,e){if(e instanceof S)return e;try{return t.machine.getStateNodeById(e.id)}catch(t){}}(t,r);e&&(null!=n[s]||(n[s]=[]),n[s].push(e))}return n}(this.root,t.historyValue),o=(0,s.E)({...t,children:n,_nodes:Array.from((0,s.D)((0,s.g)(this.root,t.value))),historyValue:i},this),a=new Set;return!function t(e,n){if(!a.has(e))for(let r in a.add(e),e){let i=e[r];if(i&&"object"==typeof i){if("xstate$$type"in i&&i.xstate$$type===s.$){e[r]=n[i.id];continue}t(i,n)}}}(o.context,n),o}constructor(t,e){var n,s,r,i;this.config=t,this.version=void 0,this.schemas=void 0,this.implementations=void 0,this.__xstatenode=!0,this.idMap=new Map,this.root=void 0,this.id=void 0,this.states=void 0,this.events=void 0,this.id=t.id||"(machine)",this.implementations={actors:null!=(n=null==e?void 0:e.actors)?n:{},actions:null!=(s=null==e?void 0:e.actions)?s:{},delays:null!=(r=null==e?void 0:e.delays)?r:{},guards:null!=(i=null==e?void 0:e.guards)?i:{}},this.version=this.config.version,this.schemas=this.config.schemas,this.transition=this.transition.bind(this),this.getInitialSnapshot=this.getInitialSnapshot.bind(this),this.getPersistedSnapshot=this.getPersistedSnapshot.bind(this),this.restoreSnapshot=this.restoreSnapshot.bind(this),this.start=this.start.bind(this),this.root=new S(t,{_key:this.id,_machine:this}),this.root._initialize(),this.states=this.root.states,this.events=this.root.events}}function k(t,e){let n=(0,s.t)(e);if(!n.includes(t.type)){let e=1===n.length?'type "'.concat(n[0],'"'):'one of types "'.concat(n.join('", "'),'"');throw Error("Expected event ".concat(JSON.stringify(t)," to have ").concat(e))}}function E(t){let{schemas:e,actors:n,actions:s,guards:r,delays:i}=t;return{createStateConfig:t=>t,createMachine:t=>new x({...t,schemas:e},{actors:n,actions:s,guards:r,delays:i})}}},663567,t=>{"use strict";t.s(["a",()=>h,"b",()=>l,"e",()=>i,"l",()=>y]);var e=t.i(697165),n=t.i(823588);function s(t,e,n,s,r){let{event:i}=r;return[e,{event:"function"==typeof i?i(n,s):i},void 0]}function r(t,e){let{event:n}=e;t.defer(()=>t.emit(n))}function i(t){function e(t,e){}return e.type="xstate.emit",e.event=t,e.resolve=s,e.execute=r,e}let o=function(t){return t.Parent="#_parent",t.Internal="#_internal",t}({});function a(t,e,n,s,r,i){let a,c,{to:u,event:l,id:d,delay:h}=r,p=e.machine.implementations.delays;if("string"==typeof l)throw Error('Only event objects may be used with sendTo; use sendTo({ type: "'.concat(l,'" }) instead'));let f="function"==typeof l?l(n,s):l;if("string"==typeof h){let t=p&&p[h];a="function"==typeof t?t(n,s):t}else a="function"==typeof h?h(n,s):h;let y="function"==typeof u?u(n,s):u;if("string"==typeof y){if(y===o.Parent)c=t.self._parent;else if(y===o.Internal)c=t.self;else if(y.startsWith("#_"))c=e.children[y.slice(2)];else{var v;c=(null==(v=i.deferredActorIds)?void 0:v.includes(y))?y:e.children[y]}if(!c)throw Error("Unable to send event to actor '".concat(y,"' from machine '").concat(e.machine.id,"'."))}else c=y||t.self;return[e,{to:c,targetId:"string"==typeof y?y:void 0,event:f,id:d,delay:a},void 0]}function c(t,e,n){"string"==typeof n.to&&(n.to=e.children[n.to])}function u(t,n){t.defer(()=>{let{to:s,event:r,delay:i,id:o}=n;if("number"==typeof i)return void t.system.scheduler.schedule(t.self,s,r,i,o);t.system._relay(t.self,s,r.type===e.T?(0,e.U)(t.self.id,r.data):r)})}function l(t,e,n){function s(t,e){}return s.type="xstate.sendTo",s.to=t,s.event=e,s.id=null==n?void 0:n.id,s.delay=null==n?void 0:n.delay,s.resolve=a,s.retryResolve=c,s.execute=u,s}function d(t,s,r,a,c){let{collect:u}=c,d=[],h=function(t){d.push(t)};return h.assign=function(){for(var t=arguments.length,e=Array(t),s=0;s<t;s++)e[s]=arguments[s];d.push((0,n.a)(...e))},h.cancel=function(){for(var t=arguments.length,n=Array(t),s=0;s<t;s++)n[s]=arguments[s];d.push((0,e.f)(...n))},h.raise=function(){for(var t=arguments.length,n=Array(t),s=0;s<t;s++)n[s]=arguments[s];d.push((0,e.r)(...n))},h.sendTo=function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];d.push(l(...e))},h.sendParent=function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];d.push(function(t,e){return l(o.Parent,t,e)}(...e))},h.spawnChild=function(){for(var t=arguments.length,n=Array(t),s=0;s<t;s++)n[s]=arguments[s];d.push((0,e.h)(...n))},h.stopChild=function(){for(var t=arguments.length,n=Array(t),s=0;s<t;s++)n[s]=arguments[s];d.push((0,e.k)(...n))},h.emit=function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];d.push(i(...e))},u({context:r.context,event:r.event,enqueue:h,check:t=>(0,e.w)(t,s.context,r.event,s),self:t.self,system:t.system},a),[s,void 0,d]}function h(t){function e(t,e){}return e.type="xstate.enqueueActions",e.collect=t,e.resolve=d,e}function p(t,e,n,s,r){let{value:i,label:o}=r;return[e,{value:"function"==typeof i?i(n,s):i,label:o},void 0]}function f(t,e){let{logger:n}=t,{value:s,label:r}=e;r?n(r,s):n(s)}function y(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t=>{let{context:e,event:n}=t;return{context:e,event:n}},e=arguments.length>1?arguments[1]:void 0;function n(t,e){}return n.type="xstate.log",n.value=t,n.label=e,n.resolve=p,n.execute=f,n}},418994,t=>{"use strict";t.s(["sendTo",()=>e.b]);var e=t.i(663567)},968207,t=>{"use strict";t.s(["assign",()=>e.a]);var e=t.i(823588)},109658,t=>{"use strict";t.s(["createActor",()=>e.c]);var e=t.i(697165)},264450,t=>{"use strict";t.s(["enqueueActions",()=>e.a]);var e=t.i(663567)},129337,t=>{"use strict";t.s(["raise",()=>e.r]);var e=t.i(697165)},890965,t=>{"use strict";t.s(["emit",()=>e.e]);var e=t.i(663567)},463246,t=>{"use strict";t.s(["stopChild",()=>e.k]);var e=t.i(697165)},807136,t=>{"use strict";t.s(["fromEvent",()=>function t(h,p,f,y){if((0,o.isFunction)(f)&&(y=f,f=void 0),y)return t(h,p,f).pipe((0,a.mapOneOrManyArgs)(y));var v,g,m,_=(0,e.__read)((v=h,(0,o.isFunction)(v.addEventListener)&&(0,o.isFunction)(v.removeEventListener))?u.map(function(t){return function(e){return h[t](p,e,f)}}):(g=h,(0,o.isFunction)(g.addListener)&&(0,o.isFunction)(g.removeListener))?c.map(d(h,p)):(m=h,(0,o.isFunction)(m.on)&&(0,o.isFunction)(m.off))?l.map(d(h,p)):[],2),b=_[0],S=_[1];if(!b&&(0,i.isArrayLike)(h))return(0,r.mergeMap)(function(e){return t(e,p,f)})((0,n.innerFrom)(h));if(!b)throw TypeError("Invalid event target");return new s.Observable(function(t){var e=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return t.next(1<e.length?e:e[0])};return b(e),function(){return S(e)}})}]);var e=t.i(290571),n=t.i(220324),s=t.i(394426),r=t.i(484973),i=t.i(987675),o=t.i(603752),a=t.i(272383),c=["addListener","removeListener"],u=["addEventListener","removeEventListener"],l=["on","off"];function d(t,e){return function(n){return function(s){return t[n](e,s)}}}},445556,t=>{"use strict";t.s(["bufferCount",()=>i]);var e=t.i(290571),n=t.i(902965),s=t.i(627608),r=t.i(586903);function i(t,i){return void 0===i&&(i=null),i=null!=i?i:t,(0,n.operate)(function(n,o){var a=[],c=0;n.subscribe((0,s.createOperatorSubscriber)(o,function(n){var s,u,l,d,h=null;c++%i==0&&a.push([]);try{for(var p=(0,e.__values)(a),f=p.next();!f.done;f=p.next()){var y=f.value;y.push(n),t<=y.length&&(h=null!=h?h:[]).push(y)}}catch(t){s={error:t}}finally{try{f&&!f.done&&(u=p.return)&&u.call(p)}finally{if(s)throw s.error}}if(h)try{for(var v=(0,e.__values)(h),g=v.next();!g.done;g=v.next()){var y=g.value;(0,r.arrRemove)(a,y),o.next(y)}}catch(t){l={error:t}}finally{try{g&&!g.done&&(d=v.return)&&d.call(v)}finally{if(l)throw l.error}}},function(){var t,n;try{for(var s=(0,e.__values)(a),r=s.next();!r.done;r=s.next()){var i=r.value;o.next(i)}}catch(e){t={error:e}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}o.complete()},void 0,function(){a=null}))})}},589293,t=>{"use strict";t.s(["concatMap",()=>s]);var e=t.i(484973),n=t.i(603752);function s(t,s){return(0,n.isFunction)(s)?(0,e.mergeMap)(t,s,1):(0,e.mergeMap)(t,1)}},10839,t=>{"use strict";t.s(["take",()=>r]);var e=t.i(96623),n=t.i(902965),s=t.i(627608);function r(t){return t<=0?function(){return e.EMPTY}:(0,n.operate)(function(e,n){var r=0;e.subscribe((0,s.createOperatorSubscriber)(n,function(e){++r<=t&&(n.next(e),t<=r&&n.complete())}))})}},800879,t=>{"use strict";t.s(["takeUntil",()=>i]);var e=t.i(902965),n=t.i(627608),s=t.i(220324),r=t.i(114940);function i(t){return(0,e.operate)(function(e,i){(0,s.innerFrom)(t).subscribe((0,n.createOperatorSubscriber)(i,function(){return i.complete()},r.noop)),i.closed||e.subscribe(i)})}},881283,t=>{"use strict";t.s(["DOMAIN",()=>E,"MSG_DISCONNECT",()=>q,"MSG_HANDSHAKE_ACK",()=>O,"MSG_HANDSHAKE_SYN",()=>T,"MSG_HANDSHAKE_SYN_ACK",()=>A,"MSG_HEARTBEAT",()=>I,"MSG_RESPONSE",()=>w,"createConnectionMachine",()=>N,"createController",()=>D,"createListenLogic",()=>k,"createNode",()=>B,"createNodeMachine",()=>U,"createRequestMachine",()=>R]);var e=t.i(403241),n=t.i(807574),s=t.i(509820),r=t.i(418994),i=t.i(968207),o=t.i(109658),a=t.i(264450),c=t.i(129337),u=t.i(890965),l=t.i(463246),d=t.i(172441),h=t.i(807136),p=t.i(94059),f=t.i(282541),y=t.i(722249),v=t.i(445556),g=t.i(589293),m=t.i(10839),_=t.i(96623),b=t.i(800879);let S=t=>e=>{let{context:n}=e,{count:s,include:r,exclude:i,responseType:o="message.received"}=t;return{count:s,domain:n.domain,from:n.connectTo,include:r?Array.isArray(r)?r:[r]:[],exclude:i?Array.isArray(i)?i:[i]:[],responseType:o,target:n.target,to:n.name}},x=(0,d.defer)(()=>(0,h.fromEvent)(window,"message")),k=t=>(0,n.fromEventObservable)(e=>{let n,{input:s}=e;return x.pipe(t?(0,p.map)(t):(0,f.pipe)(),(0,y.filter)((t=>e=>{let{data:n}=e;return(!t.include.length||t.include.includes(n.type))&&(!t.exclude.length||!t.exclude.includes(n.type))&&n.domain===t.domain&&n.from===t.from&&n.to===t.to&&(!t.target||e.source===t.target)})(s)),(0,p.map)((n=s.responseType,t=>({type:n,message:t}))),s.count?(0,f.pipe)((0,v.bufferCount)(s.count),(0,g.concatMap)(t=>t),(0,m.take)(s.count)):(0,f.pipe)())}),E="sanity/comlink",w="comlink/response",I="comlink/heartbeat",q="comlink/disconnect",T="comlink/handshake/syn",A="comlink/handshake/syn-ack",O="comlink/handshake/ack",R=()=>(0,s.setup)({types:{},actors:{listen:(0,n.fromEventObservable)(t=>{let e,{input:n}=t,s=n.signal?(0,h.fromEvent)(n.signal,"abort").pipe((e="Request ".concat(n.requestId," aborted"),t=>t.pipe((0,m.take)(1),(0,p.map)(()=>{throw Error(e)})))):_.EMPTY;return(0,h.fromEvent)(window,"message").pipe((0,y.filter)(t=>{var e,s;return(null==(e=t.data)?void 0:e.type)===w&&(null==(s=t.data)?void 0:s.responseTo)===n.requestId&&!!t.source&&n.sources.has(t.source)}),(0,m.take)(n.sources.size),(0,b.takeUntil)(s))})},actions:{"send message":(t,e)=>{let{context:n}=t,{sources:s,targetOrigin:r}=n,{message:i}=e;s.forEach(t=>{t.postMessage(i,{targetOrigin:r})})},"on success":(0,r.sendTo)(t=>{let{context:e}=t;return e.parentRef},t=>{var e;let{context:n,self:s}=t;return n.response&&(null==(e=n.resolvable)||e.resolve(n.response)),{type:"request.success",requestId:s.id,response:n.response,responseTo:n.responseTo}}),"on fail":(0,r.sendTo)(t=>{let{context:e}=t;return e.parentRef},t=>{var e;let{context:n,self:s}=t;return n.suppressWarnings||console.warn("[@sanity/comlink] Received no response to message '".concat(n.type,"' on client '").concat(n.from,"' (ID: '").concat(n.id,"').")),null==(e=n.resolvable)||e.reject(Error("No response received")),{type:"request.failed",requestId:s.id}}),"on abort":(0,r.sendTo)(t=>{let{context:e}=t;return e.parentRef},t=>{var e;let{context:n,self:s}=t;return null==(e=n.resolvable)||e.reject(Error("Request aborted")),{type:"request.aborted",requestId:s.id}})},guards:{expectsResponse:t=>{let{context:e}=t;return e.expectResponse}},delays:{initialTimeout:0,responseTimeout:t=>{var e;let{context:n}=t;return null!=(e=n.responseTimeout)?e:3e3}}}).createMachine({context:t=>{var n;let{input:s}=t;return{channelId:s.channelId,data:s.data,domain:s.domain,expectResponse:null!=(n=s.expectResponse)&&n,from:s.from,id:"msg-".concat((0,e.v4)()),parentRef:s.parentRef,resolvable:s.resolvable,response:null,responseTimeout:s.responseTimeout,responseTo:s.responseTo,signal:s.signal,sources:s.sources instanceof Set?s.sources:new Set([s.sources]),suppressWarnings:s.suppressWarnings,targetOrigin:s.targetOrigin,to:s.to,type:s.type}},initial:"idle",on:{abort:".aborted"},states:{idle:{after:{initialTimeout:[{target:"sending"}]}},sending:{entry:{type:"send message",params:t=>{let{context:e}=t,{channelId:n,data:s,domain:r,from:i,id:o,responseTo:a,to:c,type:u}=e;return{message:{channelId:n,data:s,domain:r,from:i,id:o,to:c,type:u,responseTo:a}}}},always:[{guard:"expectsResponse",target:"awaiting"},"success"]},awaiting:{invoke:{id:"listen for response",src:"listen",input:t=>{let{context:e}=t;return{requestId:e.id,sources:e.sources,signal:e.signal}},onError:"aborted"},after:{responseTimeout:"failed"},on:{message:{actions:(0,i.assign)({response:t=>{let{event:e}=t;return e.data.data},responseTo:t=>{let{event:e}=t;return e.data.responseTo}}),target:"success"}}},failed:{type:"final",entry:"on fail"},success:{type:"final",entry:"on success"},aborted:{type:"final",entry:"on abort"}},output:t=>{let{context:e,self:n}=t;return{requestId:n.id,response:e.response,responseTo:e.responseTo}}}),M=(0,n.fromCallback)(t=>{let{sendBack:e,input:n}=t,s=()=>{e(n.event)};n.immediate&&s();let r=setInterval(s,n.interval);return()=>{clearInterval(r)}}),N=()=>(0,s.setup)({types:{},actors:{requestMachine:R(),listen:k(),sendBackAtInterval:M},actions:{"buffer message":(0,a.enqueueActions)(t=>{let{enqueue:e}=t;e.assign({buffer:t=>{let{event:e,context:n}=t;return(0,s.assertEvent)(e,"post"),[...n.buffer,e.data]}}),e.emit(t=>{let{event:e}=t;return(0,s.assertEvent)(e,"post"),{type:"buffer.added",message:e.data}})}),"create request":(0,i.assign)({requests:t=>{let{context:n,event:r,self:i,spawn:o}=t;(0,s.assertEvent)(r,"request");let a=(Array.isArray(r.data)?r.data:[r.data]).map(t=>o("requestMachine",{id:"req-".concat((0,e.v4)()),input:{channelId:n.channelId,data:t.data,domain:n.domain,expectResponse:t.expectResponse,from:n.name,parentRef:i,responseTo:t.responseTo,sources:n.target,targetOrigin:n.targetOrigin,to:n.connectTo,type:t.type}}));return[...n.requests,...a]}}),"emit received message":(0,a.enqueueActions)(t=>{let{enqueue:e}=t;e.emit(t=>{let{event:e}=t;return(0,s.assertEvent)(e,"message.received"),{type:"message",message:e.message.data}})}),"emit status":(0,u.emit)((t,e)=>({type:"status",status:e.status})),"post message":(0,c.raise)(t=>{let{event:e}=t;return(0,s.assertEvent)(e,"post"),{type:"request",data:{data:e.data.data,expectResponse:!0,type:e.data.type}}}),"remove request":(0,a.enqueueActions)(t=>{let{context:e,enqueue:n,event:r}=t;(0,s.assertEvent)(r,["request.success","request.failed","request.aborted"]),(0,l.stopChild)(r.requestId),n.assign({requests:e.requests.filter(t=>{let{id:e}=t;return e!==r.requestId})})}),respond:(0,c.raise)(t=>{let{event:e}=t;return(0,s.assertEvent)(e,"response"),{type:"request",data:{data:e.data,type:w,responseTo:e.respondTo}}}),"send handshake ack":(0,c.raise)({type:"request",data:{type:O}}),"send disconnect":(0,c.raise)(()=>({type:"request",data:{type:q}})),"send handshake syn":(0,c.raise)({type:"request",data:{type:T}}),"send pending messages":(0,a.enqueueActions)(t=>{let{enqueue:e}=t;e.raise(t=>{let{context:e}=t;return{type:"request",data:e.buffer.map(t=>{let{data:e,type:n}=t;return{data:e,type:n}})}}),e.emit(t=>{let{context:e}=t;return{type:"buffer.flushed",messages:e.buffer}}),e.assign({buffer:[]})}),"set target":(0,i.assign)({target:t=>{let{event:e}=t;return(0,s.assertEvent)(e,"target.set"),e.target}})},guards:{"has target":t=>{let{context:e}=t;return!!e.target},"should send heartbeats":t=>{let{context:e}=t;return e.heartbeat}}}).createMachine({id:"connection",context:t=>{var n,s;let{input:r}=t;return{id:r.id||"".concat(r.name,"-").concat((0,e.v4)()),buffer:[],channelId:"chn-".concat((0,e.v4)()),connectTo:r.connectTo,domain:null!=(n=r.domain)?n:E,heartbeat:null!=(s=r.heartbeat)&&s,name:r.name,requests:[],target:r.target,targetOrigin:r.targetOrigin}},on:{"target.set":{actions:"set target"},"request.success":{actions:"remove request"},"request.failed":{actions:"remove request"}},initial:"idle",states:{idle:{entry:[{type:"emit status",params:{status:"idle"}}],on:{connect:{target:"handshaking",guard:"has target"},post:{actions:"buffer message"}}},handshaking:{id:"handshaking",entry:[{type:"emit status",params:{status:"handshaking"}}],invoke:[{id:"send syn",src:"sendBackAtInterval",input:()=>({event:{type:"syn"},interval:500,immediate:!0})},{id:"listen for handshake",src:"listen",input:t=>S({include:A,count:1})(t)}],on:{syn:{actions:"send handshake syn"},request:{actions:"create request"},post:{actions:"buffer message"},"message.received":{target:"connected"},disconnect:{target:"disconnected"}},exit:"send handshake ack"},connected:{entry:["send pending messages",{type:"emit status",params:{status:"connected"}}],invoke:{id:"listen for messages",src:"listen",input:S({exclude:[w,I]})},on:{post:{actions:"post message"},request:{actions:"create request"},response:{actions:"respond"},"message.received":{actions:"emit received message"},disconnect:{target:"disconnected"}},initial:"heartbeat",states:{heartbeat:{initial:"checking",states:{checking:{always:{guard:"should send heartbeats",target:"sending"}},sending:{on:{"request.failed":{target:"#handshaking"}},invoke:{id:"send heartbeat",src:"sendBackAtInterval",input:()=>({event:{type:"post",data:{type:I,data:void 0}},interval:2e3,immediate:!1})}}}}}},disconnected:{id:"disconnected",entry:["send disconnect",{type:"emit status",params:{status:"disconnected"}}],on:{request:{actions:"create request"},post:{actions:"buffer message"},connect:{target:"handshaking",guard:"has target"}}}}}),j=function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:N(),s=t.id||"".concat(t.name,"-").concat((0,e.v4)()),r=(0,o.createActor)(n,{input:{...t,id:s}}),i=new Map,a=new Map;r.on("message",async t=>{let{message:e}=t,n=i.get(e.type);if(n)return void n.forEach(async t=>{let n=await t(e.data);n&&r.send({type:"response",respondTo:e.id,data:n})});let s=a.get(e.type);s?s.add(e):a.set(e.type,new Set([e]))});let c=()=>{r.stop()};return{actor:r,connect:()=>{r.send({type:"connect"})},disconnect:()=>{r.send({type:"disconnect"})},id:s,name:t.name,machine:n,on:(t,e,n)=>{let s=i.get(t)||new Set;i.has(t)||i.set(t,s),s.add(e);let o=a.get(t);if(o){var c;let s=null!=(c=null==n?void 0:n.replay)?c:1;Array.from(o).slice(-s).forEach(async t=>{let{data:n,id:s}=t,i=await e(n);i&&r.send({type:"response",respondTo:s,data:i})}),a.delete(t)}return()=>{s.delete(e)}},onStatus:(t,e)=>{let{unsubscribe:n}=r.on("status",n=>{e&&n.status!==e||t(n.status)});return n},post:(t,e)=>{r.send({type:"post",data:{type:t,data:e}})},setTarget:t=>{r.send({type:"target.set",target:t})},start:()=>(r.start(),c),stop:c,get target(){return r.getSnapshot().context.target}}},C=t=>{t.disconnect(),setTimeout(()=>{t.stop()},0)},P=()=>{},D=t=>{let{targetOrigin:e}=t,n=new Set,s=new Set;return{addTarget:t=>{if(n.has(t))return P;if(!n.size||!s.size)return n.add(t),s.forEach(e=>{e.connections.forEach(e=>{e.setTarget(t),e.connect()})}),()=>{n.delete(t),s.forEach(e=>{e.connections.forEach(e=>{e.target===t&&e.disconnect()})})};n.add(t);let r=new Set;return s.forEach(n=>{let s=j({...n.input,target:t,targetOrigin:e},n.machine);r.add(s),n.connections.add(s),n.subscribers.forEach(t=>{let{type:e,handler:n,unsubscribers:r}=t;r.push(s.on(e,n))}),n.internalEventSubscribers.forEach(t=>{let{type:e,handler:n,unsubscribers:r}=t;r.push(s.actor.on(e,n).unsubscribe)}),n.statusSubscribers.forEach(t=>{let{handler:e,unsubscribers:n}=t;n.push(s.onStatus(t=>e({connection:s.id,status:t})))}),s.start(),s.connect()}),()=>{n.delete(t),r.forEach(t=>{C(t),s.forEach(e=>{e.connections.delete(t)})})}},createChannel:function(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:N(),i={connections:new Set,input:t,internalEventSubscribers:new Set,machine:r,statusSubscribers:new Set,subscribers:new Set};s.add(i);let{connections:o,internalEventSubscribers:a,statusSubscribers:c,subscribers:u}=i;if(n.size)n.forEach(n=>{let s=j({...t,target:n,targetOrigin:e},r);o.add(s)});else{let n=j({...t,targetOrigin:e},r);o.add(n)}let l=()=>{let t=i.connections;t.forEach(C),t.clear(),s.delete(i)};return{on:(t,e)=>{let n=[];o.forEach(s=>{n.push(s.on(t,e))});let s={type:t,handler:e,unsubscribers:n};return u.add(s),()=>{n.forEach(t=>t()),u.delete(s)}},onInternalEvent:(t,e)=>{let n=[];o.forEach(s=>{n.push(s.actor.on(t,e).unsubscribe)});let s={type:t,handler:e,unsubscribers:n};return a.add(s),()=>{n.forEach(t=>t()),a.delete(s)}},onStatus:t=>{let e=[];o.forEach(n=>{e.push(n.onStatus(e=>t({connection:n.id,status:e})))});let n={handler:t,unsubscribers:e};return c.add(n),()=>{e.forEach(t=>t()),c.delete(n)}},post:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];let[s,r]=e;o.forEach(t=>{t.post(s,r)})},start:()=>(o.forEach(t=>{t.start(),t.connect()}),l),stop:l}},destroy:()=>{s.forEach(t=>{let{connections:e}=t;e.forEach(C),e.clear()}),s.clear(),n.clear()}}},U=()=>(0,s.setup)({types:{},actors:{requestMachine:R(),listen:k()},actions:{"buffer handshake":(0,i.assign)({handshakeBuffer:t=>{let{event:e,context:n}=t;return(0,s.assertEvent)(e,"message.received"),[...n.handshakeBuffer,e]}}),"buffer message":(0,a.enqueueActions)(t=>{let{enqueue:e}=t;e.assign({buffer:t=>{let{event:e,context:n}=t;return(0,s.assertEvent)(e,"post"),[...n.buffer,{data:e.data,resolvable:e.resolvable,options:e.options}]}}),e.emit(t=>{let{event:e}=t;return(0,s.assertEvent)(e,"post"),{type:"buffer.added",message:e.data}})}),"create request":(0,i.assign)({requests:t=>{let{context:n,event:r,self:i,spawn:o}=t;(0,s.assertEvent)(r,"request");let a=(Array.isArray(r.data)?r.data:[r.data]).map(t=>{var s,r,a;return o("requestMachine",{id:"req-".concat((0,e.v4)()),input:{channelId:n.channelId,data:t.data,domain:n.domain,expectResponse:t.expectResponse,from:n.name,parentRef:i,resolvable:t.resolvable,responseTimeout:null==(s=t.options)?void 0:s.responseTimeout,responseTo:t.responseTo,signal:null==(r=t.options)?void 0:r.signal,sources:n.target,suppressWarnings:null==(a=t.options)?void 0:a.suppressWarnings,targetOrigin:n.targetOrigin,to:n.connectTo,type:t.type}})});return[...n.requests,...a]}}),"emit heartbeat":(0,u.emit)(()=>({type:"heartbeat"})),"emit received message":(0,a.enqueueActions)(t=>{let{enqueue:e}=t;e.emit(t=>{let{event:e}=t;return(0,s.assertEvent)(e,"message.received"),{type:"message",message:e.message.data}})}),"emit status":(0,u.emit)((t,e)=>({type:"status",status:e.status})),"post message":(0,c.raise)(t=>{let{event:e}=t;return(0,s.assertEvent)(e,"post"),{type:"request",data:{data:e.data.data,expectResponse:!!e.resolvable,type:e.data.type,resolvable:e.resolvable,options:e.options}}}),"process pending handshakes":(0,a.enqueueActions)(t=>{let{context:e,enqueue:n}=t;e.handshakeBuffer.forEach(t=>n.raise(t)),n.assign({handshakeBuffer:[]})}),"remove request":(0,a.enqueueActions)(t=>{let{context:e,enqueue:n,event:r}=t;(0,s.assertEvent)(r,["request.success","request.failed","request.aborted"]),(0,l.stopChild)(r.requestId),n.assign({requests:e.requests.filter(t=>{let{id:e}=t;return e!==r.requestId})})}),"send response":(0,c.raise)(t=>{let{event:e}=t;return(0,s.assertEvent)(e,["message.received","heartbeat.received"]),{type:"request",data:{type:w,responseTo:e.message.data.id,data:void 0}}}),"send handshake syn ack":(0,c.raise)({type:"request",data:{type:A}}),"send pending messages":(0,a.enqueueActions)(t=>{let{enqueue:e}=t;e.raise(t=>{let{context:e}=t;return{type:"request",data:e.buffer.map(t=>{let{data:e,resolvable:n,options:s}=t;return{data:e.data,type:e.type,expectResponse:!!n,resolvable:n,options:s}})}}),e.emit(t=>{let{context:e}=t;return{type:"buffer.flushed",messages:e.buffer.map(t=>{let{data:e}=t;return e})}}),e.assign({buffer:[]})}),"set connection config":(0,i.assign)({channelId:t=>{let{event:e}=t;return(0,s.assertEvent)(e,"handshake.syn"),e.message.data.channelId},target:t=>{let{event:e}=t;return(0,s.assertEvent)(e,"handshake.syn"),e.message.source||void 0},targetOrigin:t=>{let{event:e}=t;return(0,s.assertEvent)(e,"handshake.syn"),e.message.origin}})},guards:{hasSource:t=>{let{context:e}=t;return null!==e.target}}}).createMachine({id:"node",context:t=>{var e;let{input:n}=t;return{buffer:[],channelId:null,connectTo:n.connectTo,domain:null!=(e=n.domain)?e:E,handshakeBuffer:[],name:n.name,requests:[],target:void 0,targetOrigin:null}},invoke:{id:"listen for handshake syn",src:"listen",input:S({include:T,responseType:"handshake.syn"})},on:{"request.success":{actions:"remove request"},"request.failed":{actions:"remove request"},"request.aborted":{actions:"remove request"},"handshake.syn":{actions:"set connection config",target:".handshaking"}},initial:"idle",states:{idle:{entry:[{type:"emit status",params:{status:"idle"}}],on:{post:{actions:"buffer message"}}},handshaking:{guard:"hasSource",entry:["send handshake syn ack",{type:"emit status",params:{status:"handshaking"}}],invoke:[{id:"listen for handshake ack",src:"listen",input:S({include:O,count:1,responseType:"handshake.complete"}),onDone:"connected"},{id:"listen for disconnect",src:"listen",input:S({include:q,count:1,responseType:"disconnect"})},{id:"listen for messages",src:"listen",input:S({exclude:[q,T,O,I,w]})}],on:{request:{actions:"create request"},post:{actions:"buffer message"},"message.received":{actions:"buffer handshake"},disconnect:{target:"idle"}}},connected:{entry:["process pending handshakes","send pending messages",{type:"emit status",params:{status:"connected"}}],invoke:[{id:"listen for messages",src:"listen",input:S({exclude:[q,T,O,I,w]})},{id:"listen for heartbeat",src:"listen",input:S({include:I,responseType:"heartbeat.received"})},{id:"listen for disconnect",src:"listen",input:S({include:q,count:1,responseType:"disconnect"})}],on:{request:{actions:"create request"},post:{actions:"post message"},disconnect:{target:"idle"},"message.received":{actions:["send response","emit received message"]},"heartbeat.received":{actions:["send response","emit heartbeat"]}}}}}),B=function(t){let e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:U(),s=(0,o.createActor)(n,{input:t}),r=new Map,i=new Map;s.on("message",t=>{let{message:e}=t,n=r.get(e.type);if(n)return void n.forEach(t=>t(e.data));let s=i.get(e.type);s?s.add(e):i.set(e.type,new Set([e]))});let a=()=>{s.stop()};return{actor:s,fetch:(t,e,n)=>{let r,i,{responseTimeout:o=1e4,signal:a,suppressWarnings:c}=n||{},u="function"==typeof Promise.withResolvers?Promise.withResolvers():{promise:new Promise((t,e)=>{r=t,i=e}),resolve:r,reject:i};return s.send({type:"post",data:{type:t,data:e},resolvable:u,options:{responseTimeout:o,signal:a,suppressWarnings:c}}),u.promise},machine:n,on:(t,e,n)=>{let s=r.get(t)||new Set;r.has(t)||r.set(t,s),s.add(e);let o=i.get(t);if(o){var a;let s=null!=(a=null==n?void 0:n.replay)?a:1;Array.from(o).slice(-s).forEach(t=>{let{data:n}=t;return e(n)}),i.delete(t)}return()=>{s.delete(e)}},onStatus:(t,n)=>{let{unsubscribe:r}=s.on("status",s=>{e=s.status,n&&s.status!==n||t(s.status)});return e&&t(e),r},post:(t,e)=>{s.send({type:"post",data:{type:t,data:e}})},start:()=>(s.start(),a),stop:a}}}]);