(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,979391,e=>{"use strict";e.s(["default",()=>f],979391);var t=e.i(271645),i=e.i(408659),s=e.i(134352),r=e.i(630330),u=e.i(789196),n=e.i(277497),o=e.i(902965),p=e.i(627608),a=e.i(993817),c=e.i(800879),l=e.i(722249),b=e.i(94059),d=e.i(827492),h=e.i(537152),m=e.i(216024),f=(0,t.memo)(e=>{let{comlink:f,refs:v,perspective:g}=e,_=(0,h.useDocumentPreviewStore)(),w=(0,h.useSchema)(),P=(0,t.useMemo)(()=>new i.Subject,[]),E=(0,t.useMemo)(()=>P.asObservable().pipe((0,s.switchMap)(e=>(0,r.combineLatest)(e.map(e=>{var t;let i={...e,_id:(0,m.getDraftId)(e._id)},s="published"===g?u.NEVER:_.observeForPreview(i,w.get(i._type)).pipe((0,n.share)(),(t=e=>null===e.snapshot,(0,o.operate)(function(e,i){var s=!1,r=0;e.subscribe((0,p.createOperatorSubscriber)(i,function(e){return(s||(s=!t(e,r++)))&&i.next(e)}))}))),r={...e,_id:(0,m.getPublishedId)(e._id)},d=_.observeForPreview(r,w.get(r._type));return(0,a.merge)(d.pipe((0,c.takeUntil)(s)),s).pipe((0,l.filter)(e=>!!e.snapshot),(0,b.map)(e=>{let t=e.snapshot;return{_id:(0,m.getPublishedId)(t._id),title:t.title,subtitle:t.subtitle,description:t.description,imageUrl:t.imageUrl}}))}))),(0,d.debounceTime)(0)),[_,P,w,g]),S=(0,t.useRef)([]);return(0,t.useEffect)(()=>{let e=E.subscribe(e=>{f.post("presentation/preview-snapshots",{snapshots:e}),S.current=e});return()=>{e.unsubscribe()}},[f,E]),(0,t.useEffect)(()=>f.on("visual-editing/preview-snapshots",()=>({snapshots:S.current})),[f]),(0,t.useEffect)(()=>{P.next(v)},[v,P]),null})}]);