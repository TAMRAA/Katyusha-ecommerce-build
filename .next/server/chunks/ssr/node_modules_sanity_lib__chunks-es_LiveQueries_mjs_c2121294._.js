module.exports=[658825,a=>{"use strict";a.s(["default",()=>s,"turboChargeResultIfSourceMap",()=>w],658825);var b=a.i(187924),c=a.i(997162),d=a.i(32274),e=a.i(150460),f=a.i(57430),g=a.i(319958),h=a.i(294939),i=a.i(572131),j=a.i(454320),k=a.i(678465),l=a.i(685332),m=a.i(678144);function n(a,b){switch(b.type){case"message":return{...a,messages:[...a.messages,b]};case"reconnect":case"restart":return{...a,messages:[],resets:a.resets+1};case"welcome":return a;default:throw Error(`Unknown event: ${b.type}`,{cause:b})}}let o={messages:[],resets:0},p=(a,{previousValue:b})=>{if("string"==typeof b){if("number"==typeof a)return`${a}`;if(Array.isArray(a)){if(0===a.length)return"";if(a.some(a=>"object"==typeof a&&(0,m.isPortableTextBlock)(a)))return(0,m.toPlainText)(a)}}return a};function q(a,b){switch(b.type){case"query-listen":return function(a,{payload:b}){var c,d,e;let f=(c=b.perspective,d=b.query,e=b.params,`${c}:${d}:${JSON.stringify(e)}`),g={query:b.query,params:b.params,perspective:b.perspective},i=new Map(a.heartbeats);i.set(f,{receivedAt:Date.now(),heartbeat:b.heartbeat});let j=a.queries;return a.queries.has(f)&&(0,h.default)(a.queries.get(f),g)||(j=new Map(a.queries)).set(f,g),{heartbeats:i,queries:j}}(a,b);case"gc":if(a.queries.size<1)return a;let c=Date.now();if(!Array.from(a.heartbeats.values()).some(a=>!1!==a.heartbeat&&c>a.receivedAt+a.heartbeat))return a;let d=new Map,e=new Map;for(let[b,f]of a.heartbeats.entries())!1!==f.heartbeat&&c>f.receivedAt+f.heartbeat||(d.set(b,f),e.set(b,a.queries.get(b)));return{...a,queries:e,heartbeats:d};default:throw Error(`Unknown action: ${b.type}`,{cause:b})}}let r={queries:new Map,heartbeats:new Map};function s(a){let d,e,h,k,m,p,s,v,w=(0,c.c)(28),{controller:x,perspective:y,onLoadersConnection:z,onDocumentsOnPage:A}=a,[B,C]=(0,i.useState)(),[D,E]=function(){let a,b,d,e=(0,c.c)(4),[f,g]=(0,i.useReducer)(q,r);e[0]===Symbol.for("react.memo_cache_sentinel")?(a=()=>{let a=setInterval(()=>g({type:"gc"}),l.LOADER_QUERY_GC_INTERVAL);return()=>clearInterval(a)},b=[],e[0]=a,e[1]=b):(a=e[0],b=e[1]),(0,i.useEffect)(a,b);let h=(0,i.useDeferredValue)(f.queries);return e[2]!==h?(d=[h,g],e[2]=h,e[3]=d):d=e[3],d}(),F=(0,j.useProjectId)(),G=(0,j.useDataset)();w[0]!==x||w[1]!==G||w[2]!==E||w[3]!==A||w[4]!==z||w[5]!==F?(d=()=>{if(x){let a=x.createChannel({name:"presentation",connectTo:"loaders",heartbeat:!0},(0,f.createConnectionMachine)().provide({actors:(0,g.createCompatibilityActors)()}));return C(a),a.onStatus(z),a.on("loader/documents",a=>{a.projectId===F&&a.dataset===G&&A("loaders",a.perspective,a.documents)}),a.on("loader/query-listen",a=>{if(a.projectId===F&&a.dataset===G){if("number"==typeof a.heartbeat&&a.heartbeat<l.MIN_LOADER_QUERY_LISTEN_HEARTBEAT_INTERVAL)throw Error(`Loader query listen heartbeat interval must be at least ${l.MIN_LOADER_QUERY_LISTEN_HEARTBEAT_INTERVAL}ms`);E({type:"query-listen",payload:{perspective:a.perspective,query:a.query,params:a.params,heartbeat:a.heartbeat??!1}})}}),a.start()}return t},e=[x,G,E,A,z,F],w[0]=x,w[1]=G,w[2]=E,w[3]=A,w[4]=z,w[5]=F,w[6]=d,w[7]=e):(d=w[6],e=w[7]),(0,i.useEffect)(d,e),w[8]!==y?(h=(0,j.isReleasePerspective)(y)?j.RELEASES_STUDIO_CLIENT_OPTIONS:{apiVersion:l.API_VERSION},w[8]=y,w[9]=h):h=w[9];let H=(0,j.useClient)(h);w[10]!==H?(k=H.withConfig({resultSourceMap:"withKeyArraySelector"}),w[10]=H,w[11]=k):k=w[11];let I=k;w[12]!==y||w[13]!==B||w[14]!==G||w[15]!==F?(m=()=>{B&&B.post("loader/perspective",{projectId:F,dataset:G,perspective:y})},p=[B,y,F,G],w[12]=y,w[13]=B,w[14]=G,w[15]=F,w[16]=m,w[17]=p):(m=w[16],p=w[17]),(0,i.useEffect)(m,p);let J=(0,i.useDeferredValue)(a.liveDocument),K=function(a){let b,d,e=(0,c.c)(3),[f,g]=(0,i.useReducer)(n,o),[h,j]=(0,i.useState)(null);if(null!==h)throw h;return e[0]!==a.live?(b=()=>{let b=a.live.events({includeDrafts:!0,tag:"presentation-loader"}).subscribe({next:g,error:a=>j(a instanceof Error?a:Error("Unexpected error in useLiveEvents",{cause:a}))});return()=>b.unsubscribe()},d=[a.live],e[0]=a.live,e[1]=b,e[2]=d):(b=e[1],d=e[2]),(0,i.useEffect)(b,d),(0,i.useDeferredValue)(f)}(I);return w[18]!==D?(s=[...D.entries()],w[18]=D,w[19]=s):s=w[19],w[20]!==I||w[21]!==B||w[22]!==G||w[23]!==J||w[24]!==K||w[25]!==F||w[26]!==s?(v=(0,b.jsx)(b.Fragment,{children:s.map(a=>{let[c,d]=a,{query:e,params:f,perspective:g}=d;return(0,b.jsx)(u,{projectId:F,dataset:G,perspective:g,query:e,params:f,comlink:B,client:I,liveDocument:J,liveEventsMessages:K.messages},`${K.resets}:${c}`)})}),w[20]=I,w[21]=B,w[22]=G,w[23]=J,w[24]=K,w[25]=F,w[26]=s,w[27]=v):v=w[27],v}function t(){}let u=(0,i.memo)(function(a){let b,d,e,f=(0,c.c)(20),{projectId:g,dataset:j,perspective:l,query:m,client:n,liveDocument:o,params:p,comlink:q,liveEventsMessages:r}=a,{result:s,resultSourceMap:t,syncTags:u}=function(a){let b,d,e,f,g,j=(0,c.c)(30),{liveDocument:k,client:l,query:m,params:n,perspective:o,liveEventsMessages:p}=a,[q,r]=(0,i.useState)(null),[s,t]=(0,i.useState)(null),[u,x]=(0,i.useState)(void 0);j[0]!==p?(b=()=>new Set(p.map(v)),j[0]=p,j[1]=b):b=j[1];let[y]=(0,i.useState)(b);if(j[2]!==p||j[3]!==y||j[4]!==u){let a,b;j[6]!==y?(a=a=>!y.has(a.id),j[6]=y,j[7]=a):a=j[7];let c=p.filter(a);j[8]!==u?(b=a=>a.tags.some(a=>u?.includes(a)),j[8]=u,j[9]=b):b=j[9],d=c.findLast(b),j[2]=p,j[3]=y,j[4]=u,j[5]=d}else d=j[5];let z=d?.id,[A,B]=(0,i.useState)(null);if(A)throw A;j[10]!==l||j[11]!==z||j[12]!==n||j[13]!==o||j[14]!==m?(e=()=>{let a=new AbortController;return l.fetch(m,n,{lastLiveEventId:z,tag:"presentation-loader",signal:a.signal,perspective:o,filterResponse:!1,returnQuery:!1}).then(a=>{(0,i.startTransition)(()=>{r(b=>(0,h.default)(b,a.result)?b:a.result),t(b=>(0,h.default)(b,a.resultSourceMap)?b:a.resultSourceMap),x(b=>(0,h.default)(b,a.syncTags)?b:a.syncTags)})}).catch(a=>{("object"!=typeof a||a?.name!=="AbortError")&&B(a)}),()=>{a.abort()}},f=[l,z,n,o,m],j[10]=l,j[11]=z,j[12]=n,j[13]=o,j[14]=m,j[15]=e,j[16]=f):(e=j[15],f=j[16]),(0,i.useEffect)(e,f);a:{let a;if(k&&s){let a,b;j[17]!==k||j[18]!==o||j[19]!==q||j[20]!==s?(a=w(k,q,o,s),j[17]=k,j[18]=o,j[19]=q,j[20]=s,j[21]=a):a=j[21],j[22]!==s||j[23]!==u||j[24]!==a?(b={result:a,resultSourceMap:s,syncTags:u},j[22]=s,j[23]=u,j[24]=a,j[25]=b):b=j[25],g=b;break a}j[26]!==q||j[27]!==s||j[28]!==u?(a={result:q,resultSourceMap:s,syncTags:u},j[26]=q,j[27]=s,j[28]=u,j[29]=a):a=j[29],g=a}return g}({client:n,liveDocument:o,params:p,perspective:l,query:m,liveEventsMessages:r})||{};f[0]!==j||f[1]!==g?(b=(a,b,c,d,e,f,h)=>{a?.post("loader/query-change",{projectId:g,dataset:j,perspective:b,query:c,params:d,result:e,resultSourceMap:f,tags:h})},f[0]=j,f[1]=g,f[2]=b):b=f[2];let x=(0,k.useEffectEvent)(b);return f[3]!==q||f[4]!==x||f[5]!==p||f[6]!==l||f[7]!==m||f[8]!==s||f[9]!==t||f[10]!==u?(d=()=>{t&&x(q,l,m,p,s,t,u)},f[3]=q,f[4]=x,f[5]=p,f[6]=l,f[7]=m,f[8]=s,f[9]=t,f[10]=u,f[11]=d):d=f[11],f[12]!==q||f[13]!==p||f[14]!==l||f[15]!==m||f[16]!==s||f[17]!==t||f[18]!==u?(e=[q,p,l,m,s,t,u],f[12]=q,f[13]=p,f[14]=l,f[15]=m,f[16]=s,f[17]=t,f[18]=u,f[19]=e):e=f[19],(0,i.useEffect)(d,e),null});function v(a){return a.id}function w(a,b,c,f){if("raw"===c)throw Error("turboChargeResultIfSourceMap does not support raw perspective");if(!f)return b;let g=function(a,b){let c=function(a){if((0,e.validateApiPerspective)(a),Array.isArray(a))return a.includes("published")?a:[...a,"published"];switch(a){case"previewDrafts":case"drafts":return["drafts","published"];default:return["published"]}}(b);return function(b){for(let e of c){let c=null;if(e.startsWith("r")&&(c=a({...b,_id:(0,d.getVersionId)(b._id,e)})),"drafts"===e&&(c=a({...b,_id:(0,d.getDraftId)(b._id)})),"published"===e&&(c=a({...b,_id:(0,d.getPublishedId)(b._id)})),c)return{...c,_id:(0,d.getPublishedId)(c._id),_originalId:c._id}}return null}}(b=>!b._projectId&&a?._id&&(0,d.getPublishedId)(a._id)===(0,d.getPublishedId)(b._id)?"string"==typeof a._id&&"string"==typeof b._type?a:{...a,_id:a._id||b._id,_type:a._type||b._type}:null,c),h=f.documents?.map?.(g)||[];return(0,d.walkMap)(JSON.parse(JSON.stringify(b)),(a,b)=>{let c=(0,d.resolveMapping)(b,f);if(!c)return a;let{mapping:e,pathSuffix:g}=c;if("value"!==e.type||"documentValue"!==e.source.type)return a;let i=f.documents[e.source.document],j=f.paths[e.source.path];if(i){let b=(0,d.parseJsonPath)(j+g),c=(0,d.toString)(b),f=h[e.source.document];if(!f)return a;let k=f?(0,d.get)(f,c,a):a;return a===k?a:p(k,{cachedDocument:f,previousValue:a,sourceDocument:i,sourcePath:b})}return a})}u.displayName="Memo(QuerySubscription)"}];

//# sourceMappingURL=node_modules_sanity_lib__chunks-es_LiveQueries_mjs_c2121294._.js.map