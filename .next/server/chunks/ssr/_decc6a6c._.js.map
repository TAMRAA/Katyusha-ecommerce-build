{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/tamra/Desktop/Katyusha-ecommerce/ecommerce-build/components/addToBasketButton.tsx"],"sourcesContent":["\"use client\";\n\nimport useBasketStore from \"@/app/(store)/store/store\";\nimport { Product } from \"@/sanity.types\";\nimport { useState, useEffect } from \"react\";\n\ninterface AddToBasketButtonProps {\n  product: Product;\n  disabled?: boolean;\n}\n\nfunction AddToBasketButton({ product, disabled }: AddToBasketButtonProps) {\n  const { addItem, removeItem, getItemCount } = useBasketStore();\n  const itemCount = getItemCount(product._id);\n  const [isClient, setIsClient] = useState(false);\n\n  useEffect(() => {\n    setIsClient(true);\n  }, []);\n\n  if (!isClient) {\n    return null;\n  }\n\n  return (\n    <div className=\"flex items-center justify-center space-x-2\">\n      {isClient && (\n        <>\n          <button\n            onClick={() => removeItem(product._id)}\n            className={`w-8 h-8 rounded-full flex items-center justify-center transition-colors duration-200 ${\n              itemCount === 0\n                ? \"bg-gray-100 cursor-not-allowed\"\n                : \"bg-gray-200 hover:bg-gray-300\"\n            }`}\n            disabled={itemCount === 0 || disabled}\n            aria-label={`Remove ${product.name || \"item\"} from basket`}\n          >\n            <span\n              className={`text-xl font-bold leading-none ${\n                itemCount === 0 ? \"text-gray-400\" : \"text-gray-600\"\n              }`}\n              style={{\n                lineHeight: \"1\",\n                display: \"flex\",\n                alignItems: \"center\",\n                justifyContent: \"center\",\n              }}\n            >\n              -\n            </span>\n          </button>\n          <span className=\"w-8 text-center font-semibold\">{itemCount}</span>\n          <button\n            onClick={() => addItem(product)}\n            className=\"w-8 h-8 rounded-full flex items-center justify-center bg-gray-900 text-white hover:bg-orange-500 transition-colors duration-200\"\n            disabled={disabled || false}\n            aria-label={`Add ${product.name || \"item\"} to basket`}\n          >\n            <span\n              className=\"text-xl font-bold leading-none\"\n              style={{\n                lineHeight: \"1\",\n                display: \"flex\",\n                alignItems: \"center\",\n                justifyContent: \"center\",\n              }}\n            >\n              +\n            </span>\n          </button>\n        </>\n      )}\n    </div>\n  );\n}\n\nexport default AddToBasketButton;\n"],"names":[],"mappings":";;;;;AAEA;AAEA;AAJA;;;;AAWA,SAAS,kBAAkB,EAAE,OAAO,EAAE,QAAQ,EAA0B;IACtE,MAAM,EAAE,OAAO,EAAE,UAAU,EAAE,YAAY,EAAE,GAAG,IAAA,8IAAc;IAC5D,MAAM,YAAY,aAAa,QAAQ,GAAG;IAC1C,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,iNAAQ,EAAC;IAEzC,IAAA,kNAAS,EAAC;QACR,YAAY;IACd,GAAG,EAAE;IAEL,IAAI,CAAC,UAAU;QACb,OAAO;IACT;IAEA,qBACE,8OAAC;QAAI,WAAU;kBACZ,0BACC;;8BACE,8OAAC;oBACC,SAAS,IAAM,WAAW,QAAQ,GAAG;oBACrC,WAAW,CAAC,qFAAqF,EAC/F,cAAc,IACV,mCACA,iCACJ;oBACF,UAAU,cAAc,KAAK;oBAC7B,cAAY,CAAC,OAAO,EAAE,QAAQ,IAAI,IAAI,OAAO,YAAY,CAAC;8BAE1D,cAAA,8OAAC;wBACC,WAAW,CAAC,+BAA+B,EACzC,cAAc,IAAI,kBAAkB,iBACpC;wBACF,OAAO;4BACL,YAAY;4BACZ,SAAS;4BACT,YAAY;4BACZ,gBAAgB;wBAClB;kCACD;;;;;;;;;;;8BAIH,8OAAC;oBAAK,WAAU;8BAAiC;;;;;;8BACjD,8OAAC;oBACC,SAAS,IAAM,QAAQ;oBACvB,WAAU;oBACV,UAAU,YAAY;oBACtB,cAAY,CAAC,IAAI,EAAE,QAAQ,IAAI,IAAI,OAAO,UAAU,CAAC;8BAErD,cAAA,8OAAC;wBACC,WAAU;wBACV,OAAO;4BACL,YAAY;4BACZ,SAAS;4BACT,YAAY;4BACZ,gBAAgB;wBAClB;kCACD;;;;;;;;;;;;;;;;;;AAQb;uCAEe","debugId":null}},
    {"offset": {"line": 98, "column": 0}, "map": {"version":3,"sources":["file:///Users/tamra/Desktop/Katyusha-ecommerce/ecommerce-build/sanity/env.ts"],"sourcesContent":["export const apiVersion =\n  process.env.NEXT_PUBLIC_SANITY_API_VERSION || '2025-09-16'\n\nexport const dataset = assertValue(\n  process.env.NEXT_PUBLIC_SANITY_DATASET,\n  'Missing environment variable: NEXT_PUBLIC_SANITY_DATASET'\n)\n\nexport const projectId = assertValue(\n  process.env.NEXT_PUBLIC_SANITY_PROJECT_ID,\n  'Missing environment variable: NEXT_PUBLIC_SANITY_PROJECT_ID'\n)\n\nfunction assertValue<T>(v: T | undefined, errorMessage: string): T {\n  if (v === undefined) {\n    throw new Error(errorMessage)\n  }\n\n  return v\n}\n"],"names":[],"mappings":";;;;;;;;AAAO,MAAM,aACX,QAAQ,GAAG,CAAC,8BAA8B,IAAI;AAEzC,MAAM,UAAU,4DAErB;AAGK,MAAM,YAAY,0DAEvB;AAGF,SAAS,YAAe,CAAgB,EAAE,YAAoB;IAC5D,IAAI,MAAM,WAAW;QACnB,MAAM,IAAI,MAAM;IAClB;IAEA,OAAO;AACT","debugId":null}},
    {"offset": {"line": 119, "column": 0}, "map": {"version":3,"sources":["file:///Users/tamra/Desktop/Katyusha-ecommerce/ecommerce-build/sanity/lib/client.ts"],"sourcesContent":["import { createClient } from 'next-sanity'\n\nimport { apiVersion, dataset, projectId } from '../env'\n\nexport const client = createClient({\n  projectId,\n  dataset,\n  apiVersion,\n  useCdn: true, // Set to false if statically generating pages, using ISR or tag-based revalidation\n  stega: {\n    studioUrl: process.env.NODE_ENV === \"production\"\n      ? `https://${process.env.VERCEL_URL}/studio`\n      : `${process.env.NEXT_PUBLIC_BASE_URL}/studio`,\n  },\n});\n"],"names":[],"mappings":";;;;AAAA;AAEA;;;AAEO,MAAM,SAAS,IAAA,mLAAY,EAAC;IACjC,WAAA,0HAAS;IACT,SAAA,wHAAO;IACP,YAAA,2HAAU;IACV,QAAQ;IACR,OAAO;QACL,WAAW,sCACP,0BACA,2DAAoC,OAAO,CAAC;IAClD;AACF","debugId":null}},
    {"offset": {"line": 140, "column": 0}, "map": {"version":3,"sources":["file:///Users/tamra/Desktop/Katyusha-ecommerce/ecommerce-build/lib/imageUrl.ts"],"sourcesContent":["import { client } from \"@/sanity/lib/client\";\nimport imageUrlBuilder from \"@sanity/image-url\";\nimport { SanityImageSource } from \"@sanity/image-url/lib/types/types\";\n\nconst builder = imageUrlBuilder(client);\n\nexport function imageUrl(source: SanityImageSource){\n  return builder.image(source);\n}"],"names":[],"mappings":";;;;AAAA;AACA;;;AAGA,MAAM,UAAU,IAAA,2KAAe,EAAC,iIAAM;AAE/B,SAAS,SAAS,MAAyB;IAChD,OAAO,QAAQ,KAAK,CAAC;AACvB","debugId":null}},
    {"offset": {"line": 156, "column": 0}, "map": {"version":3,"sources":["file:///Users/tamra/Desktop/Katyusha-ecommerce/ecommerce-build/components/Loader.tsx"],"sourcesContent":["\nfunction Loader(){\n  return (\n    <div className=\"flex justify-center items-center h-screen\">\n      <div className=\"animate-spin rounded-full h-32 w-32 border-b-2 border-gray-900\"></div>\n    </div>\n  )\n}\n\nexport default Loader"],"names":[],"mappings":";;;;;;AACA,SAAS;IACP,qBACE,8OAAC;QAAI,WAAU;kBACb,cAAA,8OAAC;YAAI,WAAU;;;;;;;;;;;AAGrB;uCAEe","debugId":null}},
    {"offset": {"line": 183, "column": 0}, "map": {"version":3,"sources":["file:///Users/tamra/Desktop/Katyusha-ecommerce/ecommerce-build/actions/createCheckoutSession.ts"],"sourcesContent":["\"use server\";\nimport { BasketItem } from \"@/app/(store)/store/store\";\nimport { imageUrl } from \"@/lib/imageUrl\";\nimport stripe from \"@/lib/stripe\";\nimport { toPlainText } from \"@portabletext/toolkit\";\n\nexport type Metadata = {\n  orderNumber: string;\n  customerName: string;\n  customerEmail: string;\n  clerkUserId: string;\n};\n\nexport type GroupedBasketItem = {\n  product: BasketItem[\"product\"];\n  quantity: number;\n};\n\nexport async function createCheckoutSession(\n  items: GroupedBasketItem[],\n  metadata: Metadata\n) {\n  try {\n    // Check if any grouped items don't have a price\n    const itemsWithoutPrice = items.filter((item) => !item.product.price);\n    if (itemsWithoutPrice.length > 0) {\n      throw new Error(\"Some items do not have a price\");\n    }\n\n    // Log items for debugging\n    console.log(\"Items:\", JSON.stringify(items, null, 2));\n\n    // Search for existing customers by email\n    const customers = await stripe.customers.list({\n      email: metadata.customerEmail,\n      limit: 1,\n    });\n\n    let customerId: string | undefined;\n    if (customers.data.length > 0) {\n      customerId = customers.data[0].id;\n    }\n    const baseUrl =\n      process.env.NODE_ENV === \"production\"\n        ? `https://${process.env.VERCEL_URL}`\n        : `${process.env.NEXT_PUBLIC_BASE_URL}`;\n    const successUrl = `${baseUrl}/success?session_id={CHECKOUT_SESSION_ID}&orderNumber=${metadata.orderNumber}`;\n    const cancelUrl = `${baseUrl}/basket`;\n    // Debugging\n    console.log(\"SUCCESS URL <<<<<<\", successUrl);\n    console.log(\"CANCEL URL <<<<<<\", cancelUrl);\n\n    const session = await stripe.checkout.sessions.create({\n      customer: customerId,\n      customer_creation: customerId ? undefined : \"always\",\n      customer_email: !customerId ? metadata.customerEmail : undefined,\n      metadata,\n      mode: \"payment\",\n      allow_promotion_codes: true,\n      success_url: successUrl,\n      cancel_url: cancelUrl,\n      line_items: items.map((item) => ({\n        price_data: {\n          currency: \"usd\",\n          unit_amount: Math.round(item.product.price! * 100),\n          product_data: {\n            name: item.product.name || \"Unnamed Product\",\n            description: item.product.description\n              ? toPlainText(item.product.description)\n              : undefined,\n            metadata: {\n              id: item.product._id,\n            },\n            images: item.product.image\n              ? [imageUrl(item.product.image).url()]\n              : undefined,\n          },\n        },\n        quantity: item.quantity,\n      })),\n    });\n\n    console.log(\"Stripe session:\", JSON.stringify(session, null, 2));\n    return session.url;\n  } catch (error) {\n    console.error(\"Error creating checkout session:\", error);\n    throw error;\n  }\n}\n"],"names":[],"mappings":";;;;;;;IAkBsB,wBAAA,WAAA,GAAA,IAAA,+OAAA,EAAA,8CAAA,oOAAA,EAAA,KAAA,GAAA,0OAAA,EAAA","debugId":null}},
    {"offset": {"line": 195, "column": 0}, "map": {"version":3,"sources":["file:///Users/tamra/Desktop/Katyusha-ecommerce/ecommerce-build/app/%28store%29/basket/page.tsx"],"sourcesContent":["\"use client\";\n\nimport useBasketStore from \"@/app/(store)/store/store\";\nimport { SignInButton, useAuth, useUser } from \"@clerk/nextjs\";\nimport { useRouter } from \"next/navigation\";\nimport { useState, useEffect } from \"react\";\nimport AddToBasketButton from \"@/components/addToBasketButton\";\nimport Image from \"next/image\";\nimport { imageUrl } from \"@/lib/imageUrl\";\nimport Loader from \"@/components/Loader\";\n\nimport {\n  createCheckoutSession,\n  Metadata,\n} from \"@/actions/createCheckoutSession\";\n\nfunction BasketPage() {\n  const groupedItems = useBasketStore((state) => state.getGroupedItems());\n  const { isSignedIn } = useAuth();\n  const { user } = useUser();\n  const router = useRouter();\n  const [isClient, setIsClient] = useState(false);\n  const [isLoading, setIsLoading] = useState(false);\n\n  useEffect(() => {\n    setIsClient(true);\n  }, []);\n\n  if (!isClient) {\n    return <Loader />;\n  }\n\n  if (groupedItems.length === 0) {\n    return (\n      <div className=\"container mx-auto p-4 flex flex-col items-center justify-center min-h-[50vh]\">\n        <h1 className=\"text-2xl font-bold mb-6 text-gray-800\">Your Basket</h1>\n        <p className=\"text-gray-600 text-lg\">Your basket is empty...</p>\n      </div>\n    );\n  }\n\n  const handleCheckout = async () => {\n    if (!isSignedIn) return;\n    setIsLoading(true);\n\n    try {\n      const metadata: Metadata = {\n        orderNumber: crypto.randomUUID(),\n        customerName: user?.fullName ?? \"Unknown\",\n        customerEmail: user?.emailAddresses[0].emailAddress ?? \"Unknown\",\n        clerkUserId: user!.id,\n      };\n      const checkoutUrl = await createCheckoutSession(groupedItems, metadata);\n      if (checkoutUrl) {\n        window.location.href = checkoutUrl;\n      }\n    } catch (error) {\n      console.error(\"Error creating checkout session:\", error);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"container mx-auto p-4 max-w-6xl\">\n      <h1 className=\"text-2xl font-bold mb-4\">Your Basket</h1>\n      <div className=\"flex flex-col lg:flex-row gap-8\">\n        <div className=\"flex-grow\">\n          {groupedItems.map((item) => (\n            <div\n              key={item.product._id}\n              className=\"mb-4 p-4 border flex items-center justify-between\"\n            >\n              <div\n                className=\"flex items-center cursor-pointer flex-1 min-w-0\"\n                onClick={() =>\n                  router.push(`/product/${item.product.slug?.current}`)\n                }\n              >\n                <div className=\"w-20 h-20 sm:w-24 sm:h-24 flex-shrink-0 mr-4\">\n                  {item.product.image && (\n                    <Image\n                      src={imageUrl(item.product.image).url()}\n                      alt={item.product.name ?? \"Product image\"}\n                      className=\"w-full h-full object-cover rounded\"\n                      width={96}\n                      height={96}\n                    />\n                  )}\n                </div>\n                <div className=\"min-w-0\">\n                  <h2 className=\"text-lg sm:text-xl font-semibold truncate\">\n                    {item.product.name}\n                  </h2>\n                  <p className=\"text-sm sm:text-base\">\n                    Price: $\n                    {((item.product.price ?? 0) * item.quantity).toFixed(2)}\n                  </p>\n                </div>\n              </div>\n              <div className=\"flex items-center ml-4 flex-shrink-0\">\n                <AddToBasketButton product={item.product} />\n              </div>\n            </div>\n          ))}\n        </div>\n        <div className=\"w-full lg:w-80 lg:sticky lg:top-4 h-fit bg-white p-6 border rounded order-first lg:order-last fixed bottom-0 left-0 lg:left-auto\">\n          <h3 className=\"text-xl font-semibold\">Order Summary</h3>\n          <div className=\"mt-4 space-y-2\">\n            <p className=\"flex justify-between\">\n              <span>Items:</span>\n              <span>\n                {groupedItems.reduce((total, item) => total + item.quantity, 0)}\n              </span>\n            </p>\n            <p className=\"flex justify-between text-2xl font-bold border-t pt-2\">\n              <span>Total:</span>\n              <span>\n                {useBasketStore.getState().getTotalPrice().toFixed(2)}$\n              </span>\n            </p>\n          </div>\n          {isSignedIn ? (\n            <button\n              onClick={handleCheckout}\n              disabled={isLoading}\n              className=\"mt-4 w-full bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 disabled:bg-gray-400\"\n            >\n              {isLoading ? \"Processing...\" : \"Checkout\"}\n            </button>\n          ) : (\n            <SignInButton mode=\"modal\">\n              <button className=\"mt-4 w-full bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600\">\n                Sign in to Checkout\n              </button>\n            </SignInButton>\n          )}\n        </div>\n        <div className=\"h-64 lg:h-0\">\n          {/* Spacer for fixed checkout on mobile */}\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default BasketPage;\n"],"names":[],"mappings":"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","debugId":null}}]
}