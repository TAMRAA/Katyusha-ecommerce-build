module.exports=[484591,a=>{"use strict";a.s(["default",()=>b4],484591);var b=a.i(187924),c=a.i(997162),d=a.i(275235),e=a.i(685332),f=a.i(57430),g=a.i(319958),h=a.i(162790),i=a.i(64179),j=a.i(566482),k=a.i(572131),l=a.i(454320),m=a.i(32274),n=a.i(679679),o=a.i(775716),p=a.i(678465),q=a.i(170923),r=a.i(528817),s=a.i(98020),t=a.i(622492),t=t,u=a.i(910980),v=a.i(547663),w=a.i(173192),x=a.i(604861),y=a.i(319150),z=a.i(122839),A=a.i(679280),B=a.i(254799);let C={randomUUID:B.randomUUID},D=new Uint8Array(256),E=D.length,F=[];for(let a=0;a<256;++a)F.push((a+256).toString(16).slice(1));let G=function(a,b,c){if(C.randomUUID&&!b&&!a)return C.randomUUID();let d=(a=a||{}).random??a.rng?.()??(E>D.length-16&&((0,B.randomFillSync)(D),E=0),D.slice(E,E+=16));if(d.length<16)throw Error("Random bytes length must be >= 16");if(d[6]=15&d[6]|64,d[8]=63&d[8]|128,b){if((c=c||0)<0||c+16>b.length)throw RangeError(`UUID byte range ${c}:${c+15} is out of buffer bounds`);for(let a=0;a<16;++a)b[c+a]=d[a];return b}return function(a,b=0){return(F[a[b+0]]+F[a[b+1]]+F[a[b+2]]+F[a[b+3]]+"-"+F[a[b+4]]+F[a[b+5]]+"-"+F[a[b+6]]+F[a[b+7]]+"-"+F[a[b+8]]+F[a[b+9]]+"-"+F[a[b+10]]+F[a[b+11]]+F[a[b+12]]+F[a[b+13]]+F[a[b+14]]+F[a[b+15]]).toLowerCase()}(d)};var H=a.i(346271),I=a.i(262036),J=a.i(965802),K=a.i(224772),L=a.i(774290);function M({children:a,isValidProp:c,...d}){c&&(0,K.loadExternalIsValidProp)(c),(d={...(0,k.useContext)(J.MotionConfigContext),...d}).isStatic=(0,L.useConstant)(()=>d.isStatic);let e=(0,k.useMemo)(()=>d,[JSON.stringify(d.transition),d.transformPagePoint,d.reducedMotion]);return(0,b.jsx)(J.MotionConfigContext.Provider,{value:e,children:a})}var N=a.i(935112),O=a.i(994830);function P(){if("u">typeof crypto){let a=new Uint8Array(16);crypto.getRandomValues(a);let b="";for(let c=0;c<a.length;c++)b+=a[c].toString(16).padStart(2,"0");return btoa(b).replace(/\+/g,"-").replace(/\//g,"_").replace(/[=]+$/,"")}return Math.random().toString(36).slice(2)}async function Q(a,b,c,d){let e=a.withConfig({apiVersion:h.apiVersion}),f=P(),g=e.patch(h.schemaIdSingleton).set({secret:f,studioUrl:c,userId:d});return await e.transaction().createIfNotExists({_id:h.schemaIdSingleton,_type:h.schemaTypeSingleton,source:b,studioUrl:c,userId:d}).patch(g).commit({tag:h.tag}),{secret:f}}async function R(a,b,c,d){let e=a.withConfig({apiVersion:h.apiVersion}),f=e.patch(h.schemaIdSingleton).set({secret:null,studioUrl:c,userId:d});await e.transaction().createIfNotExists({_id:h.schemaIdSingleton,_type:h.schemaTypeSingleton,source:b,studioUrl:c,userId:d}).patch(f).commit({tag:h.tag})}var S=a.i(150460),T=a.i(294939);function U(a){return a.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function V(a){return a&&a.sensitive?"":"i"}var W=a.i(248726);async function X(a,b,c,d,e=(0,W.uuid)()){let f=a.withConfig({apiVersion:h.apiVersion});try{let a=new Date(Date.now()+1e3*h.SECRET_TTL),g=`drafts.${e}`,i=P(),j=f.patch(g).set({secret:i,source:b,studioUrl:c,userId:d});return await f.transaction().createOrReplace({_id:g,_type:h.schemaType}).patch(j).commit({tag:h.tag}),{secret:i,expiresAt:a}}finally{try{await f.delete({query:h.deleteExpiredSecretsQuery})}catch(a){console.error("Failed to delete expired secrets",a)}}}var Y=a.i(952535),Z=(0,k.memo)(a=>{let b,d,e=(0,c.c)(3),{comlink:f}=a;return e[0]!==f?(b=()=>f.on("visual-editing/features",$),d=[f],e[0]=f,e[1]=b,e[2]=d):(b=e[1],d=e[2]),(0,k.useEffect)(b,d),null});function $(){return{features:{optimistic:!0}}}let _=(0,q.setup)({types:{},actions:{},actors:{},guards:{}}).createMachine({id:"Presentation Tool",context:{url:null,error:null,visualEditingOverlaysEnabled:!1},on:{"iframe reload":{actions:(0,r.assign)({url:null}),target:".loading"}},states:{error:{description:"Failed to load, either because of a misconfiguration, a network error, or an unexpected error",tags:["error"]},loading:{on:{"iframe loaded":{target:"loaded"}},tags:["busy"]},loaded:{on:{"toggle visual editing overlays":{actions:(0,r.assign)({visualEditingOverlaysEnabled:({event:a})=>a.enabled})},"iframe refresh":{target:".refreshing"},"iframe reload":{target:".reloading"}},states:{idle:{},refreshing:{on:{"iframe loaded":{target:"idle"}},tags:["busy"]},reloading:{on:{"iframe loaded":{target:"idle"}},tags:["busy"]}},initial:"idle"}},initial:"loading"}),aa=function(a){let d,e,f,g,h,i,j,l=(0,c.c)(14),{comlink:m,children:n}=a;l[0]===Symbol.for("react.memo_cache_sentinel")?(d={},l[0]=d):d=l[0];let o=(0,k.useRef)(d);l[1]!==m?(e=()=>m?.on("visual-editing/shared-state",()=>({state:o.current})),f=[m],l[1]=m,l[2]=e,l[3]=f):(e=l[2],f=l[3]),(0,k.useEffect)(e,f),l[4]!==m?(g=(a,b)=>{o.current[a]=b,m?.post("presentation/shared-state",{key:a,value:b})},l[4]=m,l[5]=g):g=l[5];let p=g;l[6]!==m?(h=a=>{m?.post("presentation/shared-state",{key:a}),delete o.current[a]},l[6]=m,l[7]=h):h=l[7];let q=h;l[8]!==q||l[9]!==p?(i={removeValue:q,setValue:p},l[8]=q,l[9]=p,l[10]=i):i=l[10];let r=i;return l[11]!==n||l[12]!==r?(j=(0,b.jsx)(u.PresentationSharedStateContext.Provider,{value:r,children:n}),l[11]=n,l[12]=r,l[13]=j):j=l[13],j},ab=o.styled.div`
  overflow: hidden;
  flex-basis: 0;
  flex-shrink: 1;
`,ac=function(a){let d,e,f,g,h=(0,c.c)(15),{children:i,defaultSize:j,id:l,minWidth:m,maxWidth:n,order:o}=a,p=void 0===j?null:j,q=void 0===o?0:o,r=(0,k.useContext)(u.PresentationPanelsContext);if(null===r)throw Error("Panel components must be rendered within a PanelGroup container");let{getPanelStyle:s,registerElement:t,unregisterElement:v}=r;h[0]!==s||h[1]!==l?(d=s(l),h[0]=s,h[1]=l,h[2]=d):d=h[2];let w=d;return h[3]!==p||h[4]!==l||h[5]!==n||h[6]!==m||h[7]!==q||h[8]!==t||h[9]!==v?(e=()=>(t(l,{id:l,type:"panel",defaultSize:p,maxWidth:n??null,minWidth:m??0,order:q}),()=>{v(l)}),f=[l,p,q,n,m,t,v],h[3]=p,h[4]=l,h[5]=n,h[6]=m,h[7]=q,h[8]=t,h[9]=v,h[10]=e,h[11]=f):(e=h[10],f=h[11]),(0,k.useLayoutEffect)(e,f),h[12]!==i||h[13]!==w?(g=(0,b.jsx)(ab,{style:w,children:i}),h[12]=i,h[13]=w,h[14]=g):g=h[14],g};function ad(a,b){let c;return(...d)=>{clearTimeout(c),c=setTimeout(()=>{a.apply(a,d)},b)}}let ae="presentation/panels",af=()=>JSON.parse(localStorage.getItem(ae)||"{}"),ag=a=>a.map(a=>[a.id,a.order].join(":")).join(",");function ah(a,b){var c;let d=af(),e=ag(a);c={...d,[e]:b},localStorage.setItem(ae,JSON.stringify(c))}function ai(a){let b=af(),c=ag(a);return Array.isArray(b[c])&&b[c].some(aj)?void 0:b[c]}function aj(a){return null===a}function ak(a,b,c){let{maxWidth:d,minWidth:e}=a;return Math.min(null==d?100:d/c*100,Math.max(e/c*100,b))}function al(a,b,c=0,d=null){return a.clientX-(d||b.getBoundingClientRect()).left-c}function am(a){return"panel"===a.type}function an(a){return"resizer"===a.type}function ao(a){return Array.from(a.values()).sort(({order:a},{order:b})=>null==a&&null==b?0:null==a?-1:null==b?1:a-b)}function ap(a,b,c){let d=b.reduce((a,b)=>a+b,0),e=[...b].map(a=>a/d*100),f=0;for(let b=0;b<a.length;b++){let d=a[b],g=e[b],h=ak(d,g,c);g!=h&&(f+=g-h,e[b]=h)}if("0.000"!==f.toFixed(3))for(let b=0;b<a.length;b++){let{maxWidth:d,minWidth:g}=a[b];g=g/c*100,null!=d&&(d=d/c*100);let h=Math.min(d??100,Math.max(g,e[b]+f));if(h!==e[b]&&(f-=h-e[b],e[b]=h,"0.000"===Math.abs(f).toFixed(3)))break}return e}let aq=o.styled.div`
  display: flex;
  flex-direction: row;
  height: 100%;
  overflow: hidden;
  width: 100%;
`,ar=function(a){let d,e,f,g,h,i,j,l,m,n,o,p,q,r,s,t,v,w,x,y,z,A,B=(0,c.c)(46),{children:C}=a,D=(0,k.useRef)(null);B[0]===Symbol.for("react.memo_cache_sentinel")?(d=new Map,B[0]=d):d=B[0];let[E,F]=(0,k.useState)(d);B[1]!==E?(e=ao(E).filter(am),B[1]=E,B[2]=e):e=B[2];let G=e;B[3]===Symbol.for("react.memo_cache_sentinel")?(f=[],B[3]=f):f=B[3];let[H,I]=(0,k.useState)(f),[J,K]=(0,k.useState)(null);B[4]!==E||B[5]!==G||B[6]!==H?(g={elements:E,panels:G,widths:H},B[4]=E,B[5]=G,B[6]=H,B[7]=g):g=B[7];let L=(0,k.useRef)(g);B[8]!==J||B[9]!==G||B[10]!==H?(h=a=>({flexGrow:function(a,b,c){if(1===a.length)return"100";let d=c[a.findIndex(a=>a.id===b)];return null==d?"0":d.toPrecision(10)}(G,a,H),pointerEvents:null===J?void 0:"none"}),B[8]=J,B[9]=G,B[10]=H,B[11]=h):h=B[11];let M=h;B[12]===Symbol.for("react.memo_cache_sentinel")?(i=(a,b)=>{F(c=>{if(c.has(a))return c;let d=new Map(c);return d.set(a,b),d})},B[12]=i):i=B[12];let N=i;B[13]===Symbol.for("react.memo_cache_sentinel")?(j=a=>{F(b=>{if(!b.has(a))return b;let c=new Map(b);return c.delete(a),c})},B[13]=j):j=B[13];let O=j;B[14]===Symbol.for("react.memo_cache_sentinel")?(l={containerWidth:window.innerWidth,dragOffset:0,panelAfter:null,panelBefore:null,resizerIndex:-1,resizerRect:null,startX:0,widths:[]},B[14]=l):l=B[14];let P=(0,k.useRef)(l);B[15]!==E?(m=(a,b)=>{let c=ao(E),d=c.findIndex(b=>b.id===a),e=E.get(a);if(!e||!an(e))return;let f=e.el.current;f&&(P.current={resizerIndex:d,panelBefore:c.reduce((a,b,c)=>am(b)&&c<d?b:a,null),panelAfter:c.reduce((a,b,c)=>null===a&&am(b)&&c>d?b:a,null),containerWidth:window.innerWidth,startX:b.pageX,dragOffset:al(b,f),resizerRect:f.getBoundingClientRect(),widths:L.current.widths},K(a))},B[15]=E,B[16]=m):m=B[16];let Q=m;B[17]===Symbol.for("react.memo_cache_sentinel")?(n=()=>{K(null)},B[17]=n):n=B[17];let R=n;B[18]!==E?(o=(a,b)=>{b.preventDefault(),b.stopPropagation();let{containerWidth:c,dragOffset:d,panelBefore:e,panelAfter:f,resizerRect:g}=P.current;if(null==e||null==f)return;let h=E.get(a);if(!h||!an(h))return;let i=h.el.current;if(!i)return;let j=al(b,i,d,g);if(0===j)return;let{widths:k}=L.current,l=function(a,b,c,d,e,f){let{panels:g,widths:h}=e,{widths:i}=f,j=i||h,k=[...j];{let e=a<0?d:c,f=j[g.findIndex(a=>a.id===e.id)],h=ak(e,f+Math.abs(a),b);if(f===h)return j;a=a<0?f-h:h-f}let l=0,m=a<0?c:d,n=g.findIndex(a=>a.id===m.id);for(;;){let c=g[n],d=j[n],e=ak(c,d-(Math.abs(a)-Math.abs(l)),b);if(d!==e&&(l+=d-e,k[n]=e,l.toPrecision(10).localeCompare(Math.abs(a).toPrecision(10),void 0,{numeric:!0})>=0))break;if(a<0){if(--n<0)break}else if(++n>=g.length)break}return 0===l?j:(m=a<0?d:c,k[n=g.findIndex(a=>a.id===m.id)]=j[n]+l,k)}(j/D.current.getBoundingClientRect().width*100,c,e,f,L.current,P.current);k.some((a,b)=>a!==l[b])&&I(l)},B[18]=E,B[19]=o):o=B[19];let S=o;B[20]!==E||B[21]!==G||B[22]!==H?(p=()=>{L.current.elements=E,L.current.panels=G,L.current.widths=H},q=[E,G,H],B[20]=E,B[21]=G,B[22]=H,B[23]=p,B[24]=q):(p=B[23],q=B[24]),(0,k.useLayoutEffect)(p,q);let T=function(){let a,b=(0,c.c)(1);return b[0]===Symbol.for("react.memo_cache_sentinel")?(a={get:ai,set:ah,setDebounced:ad(ah,100)},b[0]=a):a=b[0],a}();B[25]!==G||B[26]!==T?(r=()=>{let{widths:a}=L.current;if(a.length===G.length)return;let b=T.get(G);if(b)return void I(ap(G,b,window.innerWidth));I(function(a){let b=a.length,c=100,d=a.map(a=>a.defaultSize?(c-=a.defaultSize,b-=1,a.defaultSize):null),e=c/b;return d.map(a=>null===a?e:a)}(G))},s=[T,G],B[25]=G,B[26]=T,B[27]=r,B[28]=s):(r=B[27],s=B[28]),(0,k.useLayoutEffect)(r,s),B[29]!==G||B[30]!==T||B[31]!==H?(t=()=>{H.length&&T.setDebounced(G,H)},v=[T,G,H],B[29]=G,B[30]=T,B[31]=H,B[32]=t,B[33]=v):(t=B[32],v=B[33]),(0,k.useEffect)(t,v),B[34]===Symbol.for("react.memo_cache_sentinel")?(w=()=>{let a=new ResizeObserver(()=>{let{panels:a,widths:b}=L.current,c=ap(a,b,window.innerWidth);b.some((a,b)=>a!==c[b])&&I(c)});return a.observe(D.current),()=>{a.disconnect()}},x=[],B[34]=w,B[35]=x):(w=B[34],x=B[35]),(0,k.useLayoutEffect)(w,x),B[36]!==J||B[37]!==S||B[38]!==M||B[39]!==Q?(y={activeResizer:J,drag:S,getPanelStyle:M,registerElement:N,startDragging:Q,stopDragging:R,unregisterElement:O},B[36]=J,B[37]=S,B[38]=M,B[39]=Q,B[40]=y):y=B[40];let U=y;return B[41]!==C?(z=(0,b.jsx)(aq,{ref:D,children:C}),B[41]=C,B[42]=z):z=B[42],B[43]!==U||B[44]!==z?(A=(0,b.jsx)(u.PresentationPanelsContext.Provider,{value:U,children:z}),B[43]=U,B[44]=z,B[45]=A):A=B[45],A};function as(a){let d,f,g,h,j,k,m,n,o,p,q,r,s,t,u,v,w=(0,c.c)(37);w[0]!==a?({children:d,message:f,onRetry:h,onContinueAnyway:g,...j}=a,w[0]=a,w[1]=d,w[2]=f,w[3]=g,w[4]=h,w[5]=j):(d=w[1],f=w[2],g=w[3],h=w[4],j=w[5]);let{t:x}=(0,l.useTranslation)(e.presentationLocaleNamespace);w[6]!==x?(k=x("error-card.retry-button.text"),w[6]=x,w[7]=k):k=w[7],w[8]!==h||w[9]!==k?(m=(0,b.jsx)(y.Button,{mode:"ghost",onClick:h,text:k}),w[8]=h,w[9]=k,w[10]=m):m=w[10];let z=m;w[11]!==x?(n=x("error-card.continue-button.text"),w[11]=x,w[12]=n):n=w[12],w[13]!==g||w[14]!==n?(o=(0,b.jsx)(y.Button,{mode:"ghost",tone:"critical",onClick:g,text:n}),w[13]=g,w[14]=n,w[15]=o):o=w[15];let A=o;return w[16]!==x?(p=x("error-card.title"),w[16]=x,w[17]=p):p=w[17],w[18]!==p?(q=(0,b.jsx)(i.Text,{size:1,weight:"semibold",children:p}),w[18]=p,w[19]=q):q=w[19],w[20]!==f?(r=(0,b.jsx)(i.Text,{muted:!0,size:1,children:f}),w[20]=f,w[21]=r):r=w[21],w[22]!==q||w[23]!==r?(s=(0,b.jsxs)(i.Stack,{space:3,children:[q,r]}),w[22]=q,w[23]=r,w[24]=s):s=w[24],w[25]!==A||w[26]!==g||w[27]!==h||w[28]!==z?(t=h&&g?(0,b.jsxs)(i.Inline,{space:2,children:[z,A]}):h?(0,b.jsx)(i.Box,{children:z}):g?(0,b.jsx)(i.Box,{children:A}):null,w[25]=A,w[26]=g,w[27]=h,w[28]=z,w[29]=t):t=w[29],w[30]!==d||w[31]!==s||w[32]!==t?(u=(0,b.jsx)(i.Flex,{align:"center",height:"fill",justify:"center",children:(0,b.jsx)(i.Container,{padding:4,sizing:"border",width:0,children:(0,b.jsxs)(i.Stack,{space:4,children:[s,d,t]})})}),w[30]=d,w[31]=s,w[32]=t,w[33]=u):u=w[33],w[34]!==j||w[35]!==u?(v=(0,b.jsx)(i.Card,{height:"fill",...j,children:u}),w[34]=j,w[35]=u,w[36]=v):v=w[36],v}let at=(0,k.forwardRef)(function(a,d){let e,f,g,h,i,j,k,l,m=(0,c.c)(17);if(m[0]!==a){let{childId:b,childType:c,childPayload:d,childParameters:j,searchParams:k,...l}=a;e=b,g=c,f=j,i=k,h=l,m[0]=a,m[1]=e,m[2]=f,m[3]=g,m[4]=h,m[5]=i}else e=m[1],f=m[2],g=m[3],h=m[4],i=m[5];return m[6]!==f||m[7]!==i?(j=Object.entries({...i,...f}),m[6]=f,m[7]=i,m[8]=j):j=m[8],m[9]!==e||m[10]!==g||m[11]!==j?(k={id:e,type:g,_searchParams:j},m[9]=e,m[10]=g,m[11]=j,m[12]=k):k=m[12],m[13]!==d||m[14]!==h||m[15]!==k?(l=(0,b.jsx)(n.StateLink,{...h,ref:d,state:k}),m[13]=d,m[14]=h,m[15]=k,m[16]=l):l=m[16],l}),au=(0,k.forwardRef)(function(a,d){let e,f,g,h,i,j,k,m,n,o,p=(0,c.c)(22);p[0]!==a?({documentId:e,documentType:f,parentRefPath:g,template:j,searchParams:i,...h}=a,p[0]=a,p[1]=e,p[2]=f,p[3]=g,p[4]=h,p[5]=i,p[6]=j):(e=p[1],f=p[2],g=p[3],h=p[4],i=p[5],j=p[6]);let q=j?.params;return p[7]!==g?(k=(0,l.pathToString)(g),p[7]=g,p[8]=k):k=p[8],p[9]!==j?(m=j&&{template:j?.id},p[9]=j,p[10]=m):m=p[10],p[11]!==k||p[12]!==m?(n={parentRefPath:k,...m},p[11]=k,p[12]=m,p[13]=n):n=p[13],p[14]!==e||p[15]!==f||p[16]!==d||p[17]!==h||p[18]!==i||p[19]!==q||p[20]!==n?(o=(0,b.jsx)(at,{...h,ref:d,childId:e,childType:f,childPayload:q,childParameters:n,searchParams:i}),p[14]=e,p[15]=f,p[16]=d,p[17]=h,p[18]=i,p[19]=q,p[20]=n,p[21]=o):o=p[21],o}),av=(0,k.forwardRef)(function(a,d){let e,f,g,h,i=(0,c.c)(9);return i[0]!==a?({searchParams:f,...e}=a,i[0]=a,i[1]=e,i[2]=f):(e=i[1],f=i[2]),i[3]!==f?(g={type:void 0,_searchParams:Object.entries(f)},i[3]=f,i[4]=g):g=i[4],i[5]!==d||i[6]!==e||i[7]!==g?(h=(0,b.jsx)(n.StateLink,{...e,ref:d,state:g,title:void 0}),i[5]=d,i[6]=e,i[7]=g,i[8]=h):h=i[8],h});function aw(a){let d,e,f,g,h,i,j,o,p,q,r=(0,c.c)(28),{children:s,onEditReference:t,onStructureParams:v,structureParams:w,searchParams:x,refs:y}=a,{state:A,resolvePathFromState:B}=(0,n.useRouter)();r[0]!==A._searchParams?(d=Object.fromEntries(A._searchParams||[]),r[0]=A._searchParams,r[1]=d):d=r[1];let C=(0,l.useUnique)(d);r[2]!==B||r[3]!==C||r[4]!==A?(e=a=>{let b=B(A),c=function(a){let b=["comment","inspect","instruction","pathKey","rev","since","template","view"];return function(a={}){let b=Object.entries(a).map(([a,b])=>`${a}=${b}`).join("&");return b.length?`?${b}`:""}(Object.entries(a).filter(([a])=>b.includes(a)).reduce((a,[b,c])=>null==c?a:{...a,[b]:c},{}))}({...C,...a});return`${b}${c}`},r[2]=B,r[3]=C,r[4]=A,r[5]=e):e=r[5];let D=e;r[6]===Symbol.for("react.memo_cache_sentinel")?(f={},r[6]=f):f=r[6],r[7]===Symbol.for("react.memo_cache_sentinel")?(g=[],r[7]=g):g=r[7],r[8]!==y||r[9]!==x?(h=(0,k.forwardRef)(function(a,c){let{childId:d,...e}=a,f=y?.find(a=>a._id===d||(0,m.getPublishedId)(a._id)===d);return f?(0,b.jsx)(at,{...e,ref:c,childId:d,childType:f._type,searchParams:x}):(console.warn(`ChildLink: No document found for childId "${d}"`),null)}),r[8]=y,r[9]=x,r[10]=h):h=r[10],r[11]!==x?(i=(0,k.forwardRef)(function(a,c){return(0,b.jsx)(av,{...a,ref:c,searchParams:x})}),r[11]=x,r[12]=i):i=r[12],r[13]!==x?(j=(0,k.forwardRef)(function(a,c){return(0,b.jsx)(au,{...a,ref:c,searchParams:x})}),r[13]=x,r[14]=j):j=r[14],r[15]!==t?(o=a=>{let{id:b,template:c,type:d,parentRefPath:e,version:f}=a;t({state:{id:b,type:d},params:{template:c.id,parentRefPath:(0,z.toString)(e),version:f}})},r[15]=t,r[16]=o):o=r[16],r[17]!==D||r[18]!==v||r[19]!==w||r[20]!==h||r[21]!==i||r[22]!==j||r[23]!==o?(p={index:0,groupIndex:0,siblingIndex:0,payload:f,params:w,hasGroupSiblings:!1,groupLength:1,routerPanesState:g,ChildLink:h,BackLink:i,ReferenceChildLink:j,ParameterizedLink:aE,closeCurrentAndAfter:aD,handleEditReference:o,replaceCurrent:aC,closeCurrent:aB,duplicateCurrent:aA,setView:az,setParams:v,setPayload:ay,navigateIntent:ax,createPathWithParams:D},r[17]=D,r[18]=v,r[19]=w,r[20]=h,r[21]=i,r[22]=j,r[23]=o,r[24]=p):p=r[24];let E=p;return r[25]!==s||r[26]!==E?(q=(0,b.jsx)(u.PaneRouterContext.Provider,{value:E,children:s}),r[25]=s,r[26]=E,r[27]=q):q=r[27],q}function ax(a,b,c){console.warn("navigateIntent",a,b,c)}function ay(a){console.warn("setPayload",a)}function az(a){console.warn("setView",a)}function aA(a){console.warn("duplicateCurrent",a)}function aB(){console.warn("closeCurrent")}function aC(a){console.warn("replaceCurrent",a)}function aD(){console.warn("closeCurrentAndAfter")}function aE(){throw Error("ParameterizedLink not implemented")}let aF=(0,o.styled)(w.PaneLayout)`
  height: 100%;
`,aG=(0,o.styled)(i.Flex)`
  & > div {
    min-width: none !important;
    max-width: none !important;
  }
`,aH=(0,o.styled)(i.Code)`
  white-space: pre-wrap;
`;function aI(a){let d,f,g,h,j,n,o,p,q,r=(0,c.c)(34),{mainDocumentState:s,onEditReference:t,onStructureParams:u,searchParams:v,refs:z}=a,{t:A}=(0,l.useTranslation)(e.presentationLocaleNamespace),{devMode:B}=(0,e.usePresentationTool)();if(r[0]!==s?.document?._id||r[1]!==z){let a;r[3]!==s?.document?._id?(a=a=>(0,m.getPublishedId)(a._id)!==s?.document?._id,r[3]=s?.document?._id,r[4]=a):a=r[4],d=z.filter(a).map(aK),r[0]=s?.document?._id,r[1]=z,r[2]=d}else d=r[2];let C=d;r[5]!==C?(f={filter:"_id in $ids",params:{ids:C}},r[5]=C,r[6]=f):f=r[6],r[7]!==A?(g=A("document-list-pane.document-list.title"),r[7]=A,r[8]=g):g=r[8],r[9]!==f||r[10]!==g?(h={id:"$root",options:f,schemaTypeName:"",title:g,type:"documentList"},r[9]=f,r[10]=g,r[11]=h):h=r[11];let D=h,[E,F]=(0,k.useState)(null);r[12]===Symbol.for("react.memo_cache_sentinel")?(j=()=>F(null),r[12]=j):j=r[12];let G=j,[H]=(0,k.useState)(aJ);if(r[13]===Symbol.for("react.memo_cache_sentinel")?(n=()=>F(null),r[13]=n):n=r[13],r[14]!==z?(o=[z],r[14]=z,r[15]=o):o=r[15],(0,k.useEffect)(n,o),E){let a,c,d;return r[16]!==A?(a=A("document-list-pane.error.text"),r[16]=A,r[17]=a):a=r[17],r[18]!==B||r[19]!==E||r[20]!==A?(c=B&&(0,b.jsx)(i.Card,{overflow:"auto",padding:3,radius:2,tone:"critical",children:(0,b.jsxs)(i.Stack,{space:3,children:[(0,b.jsx)(i.Label,{muted:!0,size:0,children:A("presentation-error.label")}),(0,b.jsx)(aH,{size:1,children:E.error.message})]})}),r[18]=B,r[19]=E,r[20]=A,r[21]=c):c=r[21],r[22]!==a||r[23]!==c?(d=(0,b.jsx)(as,{flex:1,message:a,onRetry:G,children:c}),r[22]=a,r[23]=c,r[24]=d):d=r[24],d}return r[25]!==D?(p=(0,b.jsx)(aG,{direction:"column",flex:1,children:(0,b.jsx)(w.PaneContainer,{index:0,itemId:"$root",pane:D,paneKey:"$root"})}),r[25]=D,r[26]=p):p=r[26],r[27]!==t||r[28]!==u||r[29]!==z||r[30]!==v||r[31]!==H||r[32]!==p?(q=(0,b.jsx)(y.ErrorBoundary,{onCatch:F,children:(0,b.jsx)(aF,{children:(0,b.jsx)(x.StructureToolProvider,{children:(0,b.jsx)(aw,{onEditReference:t,onStructureParams:u,structureParams:H,searchParams:v,refs:z,children:p})})})}),r[27]=t,r[28]=u,r[29]=z,r[30]=v,r[31]=H,r[32]=p,r[33]=q):q=r[33],q}function aJ(){return{}}function aK(a){return(0,m.getPublishedId)(a._id)}let aL=(0,o.styled)(i.Code)`
  white-space: pre-wrap;
`;function aM(a){let d,f,g,h,j,o,p,q,r,s,t,u=(0,c.c)(40),{documentId:v,documentType:x,onFocusPath:z,onEditReference:A,onStructureParams:B,searchParams:C,structureParams:D}=a,{template:E,templateParams:F}=D,{t:G}=(0,l.useTranslation)(e.presentationLocaleNamespace),{devMode:H}=(0,e.usePresentationTool)();u[0]!==F?(d=(0,n.decodeJsonParams)(F),u[0]=F,u[1]=d):d=u[1],u[2]!==v||u[3]!==x||u[4]!==d||u[5]!==E?(f={id:v,type:x,template:E,templateParameters:d},u[2]=v,u[3]=x,u[4]=d,u[5]=E,u[6]=f):f=u[6],u[7]!==v||u[8]!==f?(g={id:v,options:f,title:"",type:"document"},u[7]=v,u[8]=f,u[9]=g):g=u[9];let I=g;u[10]!==v||u[11]!==x||u[12]!==z?(h=a=>z({id:v,type:x,path:m.studioPath.toString(a)}),u[10]=v,u[11]=x,u[12]=z,u[13]=h):h=u[13];let J=h,[K,L]=(0,k.useState)(null);u[14]===Symbol.for("react.memo_cache_sentinel")?(j=()=>L(null),u[14]=j):j=u[14];let M=j;if(u[15]===Symbol.for("react.memo_cache_sentinel")?(o=()=>{L(null)},u[15]=o):o=u[15],u[16]!==v||u[17]!==x||u[18]!==D?(p=[v,x,D],u[16]=v,u[17]=x,u[18]=D,u[19]=p):p=u[19],(0,k.useEffect)(o,p),K){let a,c,d;return u[20]!==G?(a=G("document-pane.error.text"),u[20]=G,u[21]=a):a=u[21],u[22]!==H||u[23]!==K||u[24]!==G?(c=H&&(0,b.jsx)(i.Card,{overflow:"auto",padding:3,radius:2,tone:"critical",children:(0,b.jsxs)(i.Stack,{space:3,children:[(0,b.jsx)(i.Label,{muted:!0,size:0,children:G("presentation-error.label")}),(0,b.jsx)(aL,{size:1,children:K.error.message})]})}),u[22]=H,u[23]=K,u[24]=G,u[25]=c):c=u[25],u[26]!==a||u[27]!==c?(d=(0,b.jsx)(as,{flex:1,message:a,onRetry:M,children:c}),u[26]=a,u[27]=c,u[28]=d):d=u[28],d}return u[29]===Symbol.for("react.memo_cache_sentinel")?(q={height:"100%"},u[29]=q):q=u[29],u[30]===Symbol.for("react.memo_cache_sentinel")?(r=(0,b.jsx)(e.PresentationSpinner,{}),u[30]=r):r=u[30],u[31]!==J||u[32]!==I?(s=(0,b.jsx)(k.Suspense,{fallback:r,children:(0,b.jsx)(w.DocumentPane,{paneKey:"document",index:1,itemId:"document",pane:I,onFocusPath:J})}),u[31]=J,u[32]=I,u[33]=s):s=u[33],u[34]!==A||u[35]!==B||u[36]!==C||u[37]!==D||u[38]!==s?(t=(0,b.jsx)(y.ErrorBoundary,{onCatch:L,children:(0,b.jsx)(w.PaneLayout,{style:q,children:(0,b.jsx)(aw,{searchParams:C,onEditReference:A,onStructureParams:B,structureParams:D,children:s})})}),u[34]=A,u[35]=B,u[36]=C,u[37]=D,u[38]=s,u[39]=t):t=u[39],t}function aN(a){let d,e=(0,c.c)(8),{documentId:f,documentType:g,onFocusPath:h,onEditReference:i,onStructureParams:j,searchParams:k,structureParams:l}=a;return e[0]!==f||e[1]!==g||e[2]!==i||e[3]!==h||e[4]!==j||e[5]!==k||e[6]!==l?(d=(0,b.jsx)(x.StructureToolProvider,{children:(0,b.jsx)(aM,{documentId:f,documentType:g,onEditReference:i,onFocusPath:h,onStructureParams:j,searchParams:k,structureParams:l})}),e[0]=f,e[1]=g,e[2]=i,e[3]=h,e[4]=j,e[5]=k,e[6]=l,e[7]=d):d=e[7],d}function aO(a){let d,f,g,h,j,m,o=(0,c.c)(40),{documentId:p,documentType:q,mainDocumentState:r,onEditReference:s,onFocusPath:t,onStructureParams:u,refs:w,searchParams:x,structureParams:y}=a,{t:z}=(0,l.useTranslation)(e.presentationLocaleNamespace),A=(0,l.useSchema)();o[0]!==r?.document?._id||o[1]!==r?.document?._type||o[2]!==x?(d=a=>(0,b.jsx)(n.StateLink,{...a,state:{id:r?.document?._id,type:r?.document?._type,_searchParams:Object.entries(x)}}),o[0]=r?.document?._id,o[1]=r?.document?._type,o[2]=x,o[3]=d):d=o[3];let B=d;o[4]!==r?.document?._type||o[5]!==A?(f=A.get(r?.document?._type||"shoe"),o[4]=r?.document?._type,o[5]=A,o[6]=f):f=o[6];let C=f,D=function(a,b){let d,e,f,g=(0,c.c)(7),h=(0,l.useDocumentPreviewStore)();g[0]===Symbol.for("react.memo_cache_sentinel")?(d={},g[0]=d):d=g[0];let[i,j]=(0,k.useState)(d),{perspectiveStack:m}=(0,l.usePerspective)();return g[1]!==a||g[2]!==h||g[3]!==m||g[4]!==b?(e=()=>{if(!b)return;let c=(0,l.getPreviewStateObservable)(h,b,a,m).subscribe(a=>{j(a)});return()=>{c?.unsubscribe()}},f=[h,b,a,m],g[1]=a,g[2]=h,g[3]=m,g[4]=b,g[5]=e,g[6]=f):(e=g[5],f=g[6]),(0,k.useEffect)(e,f),i}(r?.document?._id||"",C);a:{let a,c,d,e;if(!r?.document){g=null;break a}o[7]!==r.document||o[8]!==D.snapshot?(a=(0,l.getPreviewValueWithFallback)({snapshot:D.snapshot,fallback:r.document}),o[7]=r.document,o[8]=D.snapshot,o[9]=a):a=o[9],o[10]!==z?(c=z("main-document.label"),o[10]=z,o[11]=c):c=o[11],o[12]!==c?(d=(0,b.jsx)(i.Card,{padding:1,radius:2,shadow:1,children:(0,b.jsx)(i.Text,{muted:!0,size:0,weight:"medium",children:c})}),o[12]=c,o[13]=d):d=o[13],o[14]!==C||o[15]!==a||o[16]!==d?(e=(0,b.jsx)(l.SanityDefaultPreview,{...a,schemaType:C,status:d}),o[14]=C,o[15]=a,o[16]=d,o[17]=e):e=o[17],g=e}let E=g;if(p&&q){let a;return o[18]!==p||o[19]!==q||o[20]!==s||o[21]!==t||o[22]!==u||o[23]!==x||o[24]!==y?(a=(0,b.jsx)(aN,{documentId:p,documentType:q,onEditReference:s,onFocusPath:t,onStructureParams:u,searchParams:x,structureParams:y}),o[18]=p,o[19]=q,o[20]=s,o[21]=t,o[22]=u,o[23]=x,o[24]=y,o[25]=a):a=o[25],a}return o[26]!==B||o[27]!==r||o[28]!==E||o[29]!==z?(h=r&&(0,b.jsx)(i.Card,{padding:3,tone:r.document?"inherit":"caution",children:r.document?(0,b.jsx)(l.PreviewCard,{__unstable_focusRing:!0,as:B,"data-as":"a",radius:2,sizing:"border",tone:"inherit",children:E}):(0,b.jsx)(i.Card,{padding:2,radius:2,tone:"inherit",children:(0,b.jsxs)(i.Flex,{gap:3,children:[(0,b.jsx)(i.Box,{flex:"none",children:(0,b.jsx)(i.Text,{size:1,children:(0,b.jsx)(v.WarningOutlineIcon,{})})}),(0,b.jsx)(i.Box,{flex:1,children:(0,b.jsx)(i.Text,{size:1,children:(0,b.jsx)(l.Translate,{t:z,i18nKey:"main-document.missing.text",components:{Code:"code"},values:{path:r.path}})})})]})})}),o[26]=B,o[27]=r,o[28]=E,o[29]=z,o[30]=h):h=o[30],o[31]!==r||o[32]!==s||o[33]!==u||o[34]!==w||o[35]!==x?(j=(0,b.jsx)(aI,{mainDocumentState:r,onEditReference:s,onStructureParams:u,searchParams:x,refs:w}),o[31]=r,o[32]=s,o[33]=u,o[34]=w,o[35]=x,o[36]=j):j=o[36],o[37]!==h||o[38]!==j?(m=(0,b.jsxs)(i.Flex,{direction:"column",flex:1,height:"fill",children:[h,j]}),o[37]=h,o[38]=j,o[39]=m):m=o[39],m}let aP=o.styled.div`
  position: relative;
`,aQ=o.styled.div`
  position: absolute;
  top: 0;
  bottom: 0;
  left: -5px;
  width: 9px;
  z-index: 10;
  cursor: ${({$disabled:a})=>a?"auto":"ew-resize"};

  /* Border */
  & > span:nth-child(1) {
    display: block;
    border-left: 1px solid var(--card-border-color);
    position: absolute;
    top: 0;
    left: 4px;
    bottom: 0;
    transition: opacity 200ms;
  }

  ${({$disabled:a})=>!a&&`
    /* Hover effect */
    & > span:nth-child(2) {
      display: block;
      position: absolute;
      top: 0;
      left: 0;
      width: 9px;
      bottom: 0;
      background-color: var(--card-border-color);
      opacity: 0;
      transition: opacity 150ms;
    }

    @media (hover: hover) {
      &:hover > span:nth-child(2) {
        opacity: 0.2;
      }
    }
  `}
`,aR=function(a){let d,e,f,g,h,i,j,l,m,n,o,p=(0,c.c)(27),{id:q,order:r,disabled:s}=a,t=void 0!==s&&s,v=(0,k.useRef)(null),w=(0,k.useContext)(u.PresentationPanelsContext);if(null===w)throw Error("Panel components must be rendered within a PanelGroup container");let x=function(a){let b,d=(0,c.c)(2);d[0]!==a?(b=()=>a||G(),d[0]=a,d[1]=b):b=d[1];let[e]=(0,k.useState)(b);return e}(q),{activeResizer:y,drag:z,startDragging:A,stopDragging:B,registerElement:C,unregisterElement:D}=w,E=y===x;if(null===w)throw Error("Panel components must be rendered within a PanelGroup container");p[0]!==x||p[1]!==A?(d=a=>{A(x,a.nativeEvent)},p[0]=x,p[1]=A,p[2]=d):d=p[2];let F=d;p[3]!==z||p[4]!==x?(e=a=>{z(x,a)},p[3]=z,p[4]=x,p[5]=e):e=p[5];let H=e;p[6]!==B?(f=()=>{v.current.blur(),B()},p[6]=B,p[7]=f):f=p[7];let I=f;return p[8]!==t||p[9]!==E||p[10]!==H||p[11]!==I?(g=()=>{if(!E||t)return;let a=function(){let a=document.body.style,b=document.documentElement.style,{cursor:c}=b,{userSelect:d}=a;return b.cursor="ew-resize",a.userSelect="none",()=>{c?b.cursor=c:b.removeProperty("cursor"),d?a.userSelect=d:a.removeProperty("user-select")}}();return window.addEventListener("mousemove",H),window.addEventListener("mouseup",I),window.addEventListener("contextmenu",I),()=>{a(),window.removeEventListener("mousemove",H),window.removeEventListener("mouseup",I),window.removeEventListener("contextmenu",I)}},h=[t,E,H,I],p[8]=t,p[9]=E,p[10]=H,p[11]=I,p[12]=g,p[13]=h):(g=p[12],h=p[13]),(0,k.useEffect)(g,h),p[14]!==x||p[15]!==r||p[16]!==C||p[17]!==D?(i=()=>(C(x,{id:x,order:r,type:"resizer",el:v}),()=>{D(x)}),j=[x,r,C,D],p[14]=x,p[15]=r,p[16]=C,p[17]=D,p[18]=i,p[19]=j):(i=p[18],j=p[19]),(0,k.useLayoutEffect)(i,j),p[20]===Symbol.for("react.memo_cache_sentinel")?(m=(0,b.jsx)("span",{}),l=(0,b.jsx)("span",{}),p[20]=l,p[21]=m):(l=p[20],m=p[21]),p[22]!==t?(n=(0,b.jsxs)(aQ,{$disabled:t,children:[m,l]}),p[22]=t,p[23]=n):n=p[23],p[24]!==F||p[25]!==n?(o=(0,b.jsx)(aP,{onMouseDown:F,ref:v,children:n}),p[24]=F,p[25]=n,p[26]=o):o=p[26],o},aS=a=>{let d,e,f,g=(0,c.c)(8),{documentId:h,setDisplayedDocument:i,getCommentIntent:j}=a;return g[0]===Symbol.for("react.memo_cache_sentinel")?(d=(0,b.jsx)(aR,{order:4}),g[0]=d):d=g[0],g[1]!==j||g[2]!==a.children?(e=(0,b.jsx)(l.CommentsIntentProvider,{getIntent:j,children:a.children}),g[1]=j,g[2]=a.children,g[3]=e):e=g[3],g[4]!==h||g[5]!==i||g[6]!==e?(f=(0,b.jsxs)(b.Fragment,{children:[d,(0,b.jsx)(ac,{id:"content",minWidth:325,order:5,children:(0,b.jsx)(A.DisplayedDocumentBroadcasterProvider,{documentId:h,setDisplayedDocument:i,children:e})})]}),g[4]=h,g[5]=i,g[6]=e,g[7]=f):f=g[7],f},aT=a=>{let d,e,f=(0,c.c)(15),{documentId:g,documentsOnPage:h,documentType:i,getCommentIntent:j,mainDocumentState:k,onEditReference:l,onFocusPath:m,onStructureParams:n,searchParams:o,setDisplayedDocument:p,structureParams:q}=a;return f[0]!==g||f[1]!==i||f[2]!==h||f[3]!==k||f[4]!==l||f[5]!==m||f[6]!==n||f[7]!==o||f[8]!==q?(d=(0,b.jsx)(aO,{documentId:g,documentType:i,mainDocumentState:k,onEditReference:l,onFocusPath:m,onStructureParams:n,refs:h,searchParams:o,structureParams:q}),f[0]=g,f[1]=i,f[2]=h,f[3]=k,f[4]=l,f[5]=m,f[6]=n,f[7]=o,f[8]=q,f[9]=d):d=f[9],f[10]!==g||f[11]!==j||f[12]!==p||f[13]!==d?(e=(0,b.jsx)(aS,{documentId:g,getCommentIntent:j,setDisplayedDocument:p,children:d}),f[10]=g,f[11]=j,f[12]=p,f[13]=d,f[14]=e):e=f[14],e},aU=function(a){let d,e,f=(0,c.c)(5),{children:g,navigate:h}=a;f[0]!==h?(d=(a,b)=>{if(a||b){let c={};a&&(c.params={preview:a}),b&&(c.state=b),h(c)}},f[0]=h,f[1]=d):d=f[1];let i=d;return f[2]!==g||f[3]!==i?(e=(0,b.jsx)(u.PresentationNavigateContext.Provider,{value:i,children:g}),f[2]=g,f[3]=i,f[4]=e):e=f[4],e};function aV(a){return!a}let aW=(0,k.memo)(function(a){let d,e,f,g,h=(0,c.c)(11),{minWidth:i,maxWidth:j,component:k}=a,l=null!=i&&null!=j&&i===j;return h[0]!==k?(d=(0,b.jsx)(k,{}),h[0]=k,h[1]=d):d=h[1],h[2]!==j||h[3]!==i||h[4]!==d?(e=(0,b.jsx)(ac,{id:"navigator",minWidth:i,maxWidth:j,order:1,children:d}),h[2]=j,h[3]=i,h[4]=d,h[5]=e):e=h[5],h[6]!==l?(f=(0,b.jsx)(aR,{order:2,disabled:l}),h[6]=l,h[7]=f):f=h[7],h[8]!==e||h[9]!==f?(g=(0,b.jsxs)(b.Fragment,{children:[e,f]}),h[8]=e,h[9]=f,h[10]=g):g=h[10],g}),aX=function(a){let d,e=(0,c.c)(3),{children:f,params:g}=a;return e[0]!==f||e[1]!==g?(d=(0,b.jsx)(u.PresentationParamsContext.Provider,{value:g,children:f}),e[0]=f,e[1]=g,e[2]=d):d=e[2],d},aY=function(a){let d,e,f=(0,c.c)(10),{children:g,devMode:h,name:i,navigate:j,params:k,searchParams:l,structureParams:m}=a;f[0]!==h||f[1]!==i||f[2]!==j||f[3]!==k||f[4]!==l||f[5]!==m?(d={devMode:h,name:i,navigate:j,params:k,searchParams:l,structureParams:m},f[0]=h,f[1]=i,f[2]=j,f[3]=k,f[4]=l,f[5]=m,f[6]=d):d=f[6];let n=d;return f[7]!==g||f[8]!==n?(e=(0,b.jsx)(u.PresentationContext.Provider,{value:n,children:g}),f[7]=g,f[8]=n,f[9]=e):e=f[9],e};function aZ(a){let b=(0,d.useSelector)(a,a$);if(!Array.isArray(b))throw TypeError("allowPatterns must be an array");return b}function a$(a){return a.context.allowOrigins}function a_(a){return Array.isArray(a)?a.join(","):a}function a0(){let a,b=(0,c.c)(2),d=(0,k.useId)();return b[0]!==d?(a=d.startsWith(":")?d.replace(/^:(.+):$/,"«$1»"):d,b[0]=d,b[1]=a):a=b[1],a}let a1=(0,k.forwardRef)(function(a,d){let e,f,g,h,i,j,l,m,n=(0,c.c)(19),{animate:o,initial:p,onLoad:q,preventClick:r,src:s,variants:t,style:u}=a,v=(0,k.useRef)(null);n[0]===Symbol.for("react.memo_cache_sentinel")?(e=()=>v.current,n[0]=e):e=n[0],(0,k.useImperativeHandle)(d,e),n[1]===Symbol.for("react.memo_cache_sentinel")?(f=()=>{if(!v.current)return;let a=v.current,b=function(){a===document.activeElement&&a.dispatchEvent(new MouseEvent("mousedown",{bubbles:!0,cancelable:!0}))};return window.addEventListener("blur",b),()=>{window.removeEventListener("blur",b)}},g=[],n[1]=f,n[2]=g):(f=n[1],g=n[2]),(0,k.useEffect)(f,g);let w=a0();return n[3]!==u||n[4]!==w?(h={...u,viewTransitionName:w},n[3]=u,n[4]=w,n[5]=h):h=n[5],n[6]!==o||n[7]!==p||n[8]!==q||n[9]!==s||n[10]!==h||n[11]!==t?(i=(0,b.jsx)(a2,{style:h,animate:o,initial:p,onLoad:q,ref:v,src:s,variants:t}),n[6]=o,n[7]=p,n[8]=q,n[9]=s,n[10]=h,n[11]=t,n[12]=i):i=n[12],n[13]!==r?(j=r&&(0,b.jsx)(a3,{}),n[13]=r,n[14]=j):j=n[14],n[15]===Symbol.for("react.memo_cache_sentinel")?(l=(0,b.jsx)(a4,{}),n[15]=l):l=n[15],n[16]!==i||n[17]!==j?(m=(0,b.jsxs)(b.Fragment,{children:[i,j,l]}),n[16]=i,n[17]=j,n[18]=m):m=n[18],m}),a2=H.motion.create(o.styled.iframe`
  box-shadow: 0 0 0 1px var(--card-border-color);
  border: 0;
  max-height: 100%;
  width: 100%;
  view-transition-class: presentation-tool-iframe;
`),a3=(0,o.styled)(i.Box)`
  position: absolute;
  inset: 0;
  background: transparent;
`,a4=o.createGlobalStyle`
html:active-view-transition-type(sanity-iframe-viewport) {
  view-transition-name: none;
  &::view-transition {
    pointer-events: none;
  }
  /* &::view-transition-old(root) {
    display: none;
  }
  &::view-transition-new(root) {
    animation: none;
  } */
}
`;function a5(a){let d,f,g,j,k,m,n,o=(0,c.c)(16),{openPopup:p,previewLocationOrigin:q,previewLocationRoute:r,perspective:s,targetOrigin:t}=a,u=new URL(r,q||t);u.searchParams.set(h.urlSearchParamPreviewPerspective,a_(s));let{pathname:w,search:x}=u,z=`${q}${w}${x}`,{t:A}=(0,l.useTranslation)(e.presentationLocaleNamespace);o[0]!==p?(d=a=>{a.preventDefault(),p(a.currentTarget.href)},o[0]=p,o[1]=d):d=o[1];let B=d;return o[2]!==A?(f=A("share-url.menu-item.open.text"),o[2]=A,o[3]=f):f=o[3],o[4]!==f?(g=(0,b.jsx)(i.Text,{size:1,children:f}),o[4]=f,o[5]=g):g=o[5],o[6]===Symbol.for("react.memo_cache_sentinel")?(j=["bottom-start"],o[6]=j):j=o[6],o[7]!==A?(k=A("share-url.menu-item.open.text"),o[7]=A,o[8]=k):k=o[8],o[9]!==B||o[10]!==z||o[11]!==k?(m=(0,b.jsx)(y.Button,{as:"a","aria-label":k,icon:v.LaunchIcon,mode:"bleed",href:z,rel:"opener",target:"_blank",tooltipProps:null,onClick:B}),o[9]=B,o[10]=z,o[11]=k,o[12]=m):m=o[12],o[13]!==g||o[14]!==m?(n=(0,b.jsx)(y.Tooltip,{animate:!0,content:g,fallbackPlacements:j,placement:"bottom",portal:!0,children:m}),o[13]=g,o[14]=m,o[15]=n):n=o[15],n}function a6(a){let b=(0,d.useSelector)(a,a7);if(!b)throw TypeError("targetOrigin is required");return b}function a7(a){return a.context.previewUrl?.origin}function a8(a){let d,f,g,h,j,m,n,o,p,q,r=(0,c.c)(32),{fontSize:s,onChange:t,padding:u,prefix:w,suffix:x,value:y,previewUrlRef:z}=a,A=void 0===s?1:s,B=void 0===u?3:u,C=aZ(z),D=a6(z),{t:E}=(0,l.useTranslation)(e.presentationLocaleNamespace),{basePath:F}=(0,l.useActiveWorkspace)()?.activeWorkspace||{},G=void 0===F?"/":F,H=(0,k.useRef)(null),[I,J]=(0,k.useState)(void 0),[K,L]=(0,k.useState)(void 0);r[0]===Symbol.for("react.memo_cache_sentinel")?(d=a=>{J(a.currentTarget.value)},r[0]=d):d=r[0];let M=d;r[1]!==C||r[2]!==G||r[3]!==t||r[4]!==I||r[5]!==E||r[6]!==D?(f=a=>{if("Enter"===a.key){if(void 0===I)return;let b=I;try{b=new URL(I,D).toString()}catch{}if(Array.isArray(C)){if(!C.some(a=>a.test(b))){L(E("preview-location-input.error",{origin:D,context:"origin-not-allowed"})),a.currentTarget.reportValidity();return}}else if(!D&&(b.startsWith(`${G}/`)||b===G))return void L(E("preview-location-input.error",{basePath:G,context:"same-base-path"}));let c=b===D?`${D}/`:b;L(void 0),J(void 0),t(c),H.current?.blur()}"Escape"===a.key&&(L(void 0),J(void 0))},r[1]=C,r[2]=G,r[3]=t,r[4]=I,r[5]=E,r[6]=D,r[7]=f):f=r[7];let N=f;r[8]===Symbol.for("react.memo_cache_sentinel")?(g=()=>{L(void 0),J(void 0)},r[8]=g):g=r[8];let O=g;r[9]!==D||r[10]!==y?(h=()=>{L(void 0);let a=y;try{a=new URL(y,D).toString()}catch{}J(a)},r[9]=D,r[10]=y,r[11]=h):h=r[11];let P=h;r[12]===Symbol.for("react.memo_cache_sentinel")?(j=()=>{L(void 0),J(void 0)},r[12]=j):j=r[12],r[13]!==D||r[14]!==y?(m=[D,y],r[13]=D,r[14]=y,r[15]=m):m=r[15],(0,k.useEffect)(j,m),r[16]===Symbol.for("react.memo_cache_sentinel")?(n={icon:v.ResetIcon},r[16]=n):n=r[16];let Q=K?n:void 0;return r[17]===Symbol.for("react.memo_cache_sentinel")?(o={zIndex:1},r[17]=o):o=r[17],r[18]!==I||r[19]!==D||r[20]!==y?(p=void 0===I?new URL(y,D).toString():I,r[18]=I,r[19]=D,r[20]=y,r[21]=p):p=r[21],r[22]!==K||r[23]!==A||r[24]!==P||r[25]!==N||r[26]!==B||r[27]!==w||r[28]!==x||r[29]!==Q||r[30]!==p?(q=(0,b.jsx)(b.Fragment,{children:(0,b.jsx)(i.TextInput,{clearButton:Q,customValidity:K,fontSize:A,onBlur:O,onClear:P,onChange:M,onKeyDownCapture:N,padding:B,prefix:w,style:o,radius:2,ref:H,space:B,suffix:x,value:p})}),r[22]=K,r[23]=A,r[24]=P,r[25]=N,r[26]=B,r[27]=w,r[28]=x,r[29]=Q,r[30]=p,r[31]=q):q=r[31],q}let a9=(0,k.lazy)(()=>a.A(220829)),ba=(0,o.styled)(O.SanityMonogram)`
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  height: ${24}px;
  width: ${24}px;
`,bb=H.motion.create(i.Spinner),bc=H.motion.create(i.Text),bd=H.motion.create(ba),be=(0,k.memo)(function(a){let{canToggleSharePreviewAccess:c,canUseSharedPreviewAccess:d,initialUrl:f,previewLocationRoute:g,perspective:m}=a,{t:n}=(0,l.useTranslation)(e.presentationLocaleNamespace),{push:o}=(0,j.useToast)(),p=(0,l.useClient)({apiVersion:e.API_VERSION}),q=(0,l.useCurrentUser)(),[r,s]=(0,k.useState)(!0),[t,u]=(0,k.useState)(!1),[w,x]=(0,k.useState)(!1),[z,A]=(0,k.useState)(null),B=t||w||r,C=(0,k.useMemo)(()=>z?function(a,b,c,d){let e=new URL(a),{searchParams:f}=e;return b&&(f.set(h.urlSearchParamPreviewSecret,b),f.set(h.urlSearchParamPreviewPathname,c)),f.set(h.urlSearchParamPreviewPerspective,d),e}(f,z,g,a_(m)):null,[f,m,g,z]),[D,E]=(0,k.useState)(null);if(D)throw D;let F=(0,k.useCallback)(()=>{o({closable:!0,status:"warning",title:n("share-preview-menu.error_toggle-sharing",{context:"toggle-sharing"})})},[o,n]),G=(0,k.useCallback)(async()=>{try{x(!0),await R(p,"sanity/presentation","",q?.id),A(null)}catch(a){E(a)}finally{x(!1)}},[p,q?.id]),H=(0,k.useCallback)(async()=>{try{u(!0);let a=await Q(p,"sanity/presentation","",q?.id);A(a.secret)}catch(a){E(a)}finally{u(!1)}},[p,q?.id]),J=(0,k.useCallback)(()=>{try{if(!C)throw Error("No URL to copy");navigator.clipboard.writeText(C.toString()),o({closable:!0,status:"success",title:n("share-url.clipboard.status",{context:"success"})})}catch(a){E(a)}},[o,n,C]);return(0,k.useEffect)(()=>{let a=new AbortController,b=[];async function c(a,c){let{result:d,syncTags:e}=await p.fetch(h.fetchSharedAccessQuery,{},{filterResponse:!1,lastLiveEventId:a,tag:"presentation.fetch-shared-access-secret"});Array.isArray(e)&&(b=e),c.aborted||A(d)}let d=p.live.events().subscribe({next:d=>{"message"===d.type&&(a.abort(),a=new AbortController,d.tags.some(a=>b.includes(a))&&c(d.id,a.signal))},error:E});return c(null,a.signal).finally(()=>s(!1)),()=>{d.unsubscribe(),a.abort()}},[p]),(0,b.jsx)(y.MenuButton,{button:(0,b.jsx)(y.Button,{"aria-label":n("preview-frame.share-button.aria-label"),icon:v.ShareIcon,mode:"bleed",tooltipProps:null}),id:"share-menu",menu:(0,b.jsx)(i.Menu,{style:{maxWidth:248},padding:d?void 0:0,children:d?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("label",{style:{cursor:"pointer"},children:(0,b.jsxs)(i.Grid,{columns:2,rows:2,gapX:3,gapY:1,style:{justifyContent:"center",alignItems:"center",gridTemplateColumns:"min-content 1fr",gridTemplateRows:"min-content"},paddingTop:3,paddingX:3,children:[(0,b.jsx)(y.Tooltip,{animate:!0,content:(0,b.jsx)(i.Text,{size:1,children:n("share-preview-menu.toggle-button.tooltip",{context:C?"disable":"enable"})}),fallbackPlacements:["bottom-start"],placement:"bottom",portal:!0,children:(0,b.jsx)(i.Switch,{checked:t||null!==C&&!w,readOnly:t||w,indeterminate:r,onChange:c?C?G:H:F})}),(0,b.jsx)(i.Text,{size:1,weight:"medium",children:n("share-preview-menu.toggle-button.label",{context:"first-line"})}),(0,b.jsx)("span",{}),(0,b.jsx)(i.Text,{muted:!0,size:1,children:n("share-preview-menu.toggle-button.label",{context:"second-line"})})]})}),(0,b.jsx)(i.Box,{padding:3,paddingTop:2,children:(0,b.jsxs)(i.Stack,{space:3,children:[(0,b.jsx)(i.Card,{tone:B||!C?"transparent":void 0,style:{position:"relative",aspectRatio:"1 / 1",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,b.jsx)(I.AnimatePresence,{children:B?(0,b.jsx)(bb,{muted:!0,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0}}):C?(0,b.jsx)(b.Fragment,{children:(0,b.jsxs)(k.Suspense,{fallback:(0,b.jsx)(i.Spinner,{}),children:[(0,b.jsx)(a9,{title:n("share-preview-menu.qr-code.title",{url:C.toString()}),value:C.toString(),size:224,color:"var(--card-fg-color)",logoSize:40}),(0,b.jsx)(bd,{initial:{opacity:-.5},animate:{opacity:1.5},exit:{opacity:0}})]})}):(0,b.jsx)(bc,{muted:!0,size:1,style:{maxWidth:"100px",textWrap:"pretty",textAlign:"center"},initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:n("share-preview-menu.qr-code.placeholder")})})}),(0,b.jsx)(i.Text,{muted:!0,size:1,children:n("share-preview-menu.qr-code.instructions")})]})}),(0,b.jsx)(i.MenuDivider,{}),(0,b.jsx)(y.MenuItem,{disabled:!C||w,icon:v.CopyIcon,onClick:J,text:n("share-preview-menu.copy-url.text")})]}):(0,b.jsx)(i.Card,{padding:2,tone:"caution",radius:3,children:(0,b.jsx)(i.Text,{style:{textWrap:"pretty"},children:n("share-preview-menu.error",{context:"missing-grants"})})})}),popover:{constrainSize:!0,placement:"bottom",portal:!0}})});be.displayName="Memo(SharePreviewMenu)";let bf=a=>{let f,g,j,k,m,n,o,p,q,r,s,t,u,w,x,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T=(0,c.c)(107),{canSharePreviewAccess:U,canToggleSharePreviewAccess:V,canUseSharedPreviewAccess:W,iframeRef:X,initialUrl:Y,navigatorEnabled:Z,onPathChange:$,onRefresh:_,openPopup:aa,overlaysConnection:ab,presentationRef:ac,perspective:ad,previewUrl:ae,setViewport:af,targetOrigin:ag,toggleNavigator:ah,toggleOverlay:ai,viewport:aj,previewUrlRef:ak}=a,{t:al}=(0,l.useTranslation)(e.presentationLocaleNamespace);T[0]!==af||T[1]!==aj?(f=()=>af("desktop"===aj?"mobile":"desktop"),T[0]=af,T[1]=aj,T[2]=f):f=T[2];let am=f,an=ag===location.origin?"":ag;T[3]!==X||T[4]!==_||T[5]!==ac||T[6]!==ae||T[7]!==ag?(g=()=>{_(()=>{X.current&&(ac.send({type:"iframe reload"}),Object.assign(X.current,{src:`${ag}${ae||"/"}`}))})},T[3]=X,T[4]=_,T[5]=ac,T[6]=ae,T[7]=ag,T[8]=g):g=T[8];let ao=g,ap=(0,d.useSelector)(ac,bi),aq=(0,d.useSelector)(ac,bj),ar=(0,d.useSelector)(ac,bk),as=(0,d.useSelector)(ac,bl),at=(0,d.useSelector)(ac,bm),{pathname:au,search:av}=function(a){let b=new URL(a),{searchParams:c}=b;return c.delete(h.urlSearchParamPreviewPathname),c.delete(h.urlSearchParamPreviewSecret),c.delete(h.urlSearchParamPreviewPerspective),c.delete(h.urlSearchParamVercelProtectionBypass),c.delete(h.urlSearchParamVercelSetBypassCookie),b}(new URL(ae||"/",ag)),aw=`${au}${av}`,ax=a0(),ay=(0,d.useSelector)(ak,bn);T[9]===Symbol.for("react.memo_cache_sentinel")?(j={width:"100%"},T[9]=j):j=T[9],T[10]!==Z||T[11]!==al||T[12]!==ah?(k=ah&&(0,b.jsx)(y.Button,{"aria-label":al("preview-frame.navigator.toggle-button.aria-label"),icon:v.PanelLeftIcon,mode:"bleed",onClick:ah,selected:Z,tooltipProps:{content:(0,b.jsx)(i.Text,{size:1,children:al("preview-frame.navigator.toggle-button.tooltip")}),fallbackPlacements:["bottom-start"],placement:"bottom"}}),T[10]=Z,T[11]=al,T[12]=ah,T[13]=k):k=T[13],T[14]===Symbol.for("react.memo_cache_sentinel")?(m={whiteSpace:"nowrap"},T[14]=m):m=T[14];let az=at?"disable":"enable";T[15]!==al||T[16]!==az?(n=al("preview-frame.overlay.toggle-button.tooltip",{context:az}),T[15]=al,T[16]=az,T[17]=n):n=T[17],T[18]!==n?(o=(0,b.jsx)(i.Box,{padding:1,children:(0,b.jsx)(i.Text,{size:1,children:n})}),T[18]=n,T[19]=o):o=T[19],T[20]===Symbol.for("react.memo_cache_sentinel")?(p=(0,b.jsx)(i.Box,{paddingY:1,children:(0,b.jsx)(i.Hotkeys,{keys:["Alt"],style:{marginTop:-4,marginBottom:-4}})}),T[20]=p):p=T[20],T[21]!==o?(q=(0,b.jsxs)(i.Flex,{align:"center",style:m,children:[o,p]}),T[21]=o,T[22]=q):q=T[22],T[23]===Symbol.for("react.memo_cache_sentinel")?(r=["bottom-start"],T[23]=r):r=T[23],T[24]===Symbol.for("react.memo_cache_sentinel")?(s={lineHeight:0,borderRadius:999,userSelect:"none"},T[24]=s):s=T[24];let aA=at?"transparent":void 0;T[25]===Symbol.for("react.memo_cache_sentinel")?(t={margin:-4},T[25]=t):t=T[25];let aB=!aq,aC=ap||"connected"!==ab;T[26]!==at||T[27]!==aB||T[28]!==aC||T[29]!==ai?(u=(0,b.jsx)("div",{style:t,children:(0,b.jsx)(i.Switch,{indeterminate:aB,checked:at,onChange:ai,disabled:aC})}),T[26]=at,T[27]=aB,T[28]=aC,T[29]=ai,T[30]=u):u=T[30];let aD=!at;T[31]!==al?(w=al("preview-frame.overlay.toggle-button.text"),T[31]=al,T[32]=w):w=T[32],T[33]!==aD||T[34]!==w?(x=(0,b.jsx)(i.Box,{children:(0,b.jsx)(i.Text,{muted:aD,size:1,weight:"medium",children:w})}),T[33]=aD,T[34]=w,T[35]=x):x=T[35],T[36]!==u||T[37]!==x?(z=(0,b.jsxs)(i.Flex,{align:"center",gap:3,children:[u,x]}),T[36]=u,T[37]=x,T[38]=z):z=T[38],T[39]!==aA||T[40]!==z?(A=(0,b.jsx)(i.Card,{as:"label",flex:"none",padding:3,marginX:1,style:s,tone:aA,children:z}),T[39]=aA,T[40]=z,T[41]=A):A=T[41],T[42]!==A||T[43]!==q?(B=(0,b.jsx)(y.Tooltip,{animate:!0,content:q,fallbackPlacements:r,placement:"bottom",portal:!0,children:A}),T[42]=A,T[43]=q,T[44]=B):B=T[44],T[45]!==aq||T[46]!==ap||T[47]!==ar||T[48]!==as||T[49]!==al?(C=aq?al("preview-frame.refresh-button.tooltip"):al("preview-frame.status",{context:ap?"loading":ar?"refreshing":as?"reloading":"unknown"}),T[45]=aq,T[46]=ap,T[47]=ar,T[48]=as,T[49]=al,T[50]=C):C=T[50],T[51]!==C?(D=(0,b.jsx)(i.Text,{size:1,children:C}),T[51]=C,T[52]=D):D=T[52],T[53]===Symbol.for("react.memo_cache_sentinel")?(E=["bottom-end"],T[53]=E):E=T[53],T[54]!==al?(F=al("preview-frame.refresh-button.aria-label"),T[54]=al,T[55]=F):F=T[55];let aE=as||ar||ay;T[56]!==ao||T[57]!==F||T[58]!==aE?(G=(0,b.jsx)(y.Button,{"aria-label":F,icon:v.RefreshIcon,mode:"bleed",loading:aE,onClick:ao,tooltipProps:null}),T[56]=ao,T[57]=F,T[58]=aE,T[59]=G):G=T[59],T[60]!==D||T[61]!==G?(H=(0,b.jsx)(i.Box,{padding:1,children:(0,b.jsx)(y.Tooltip,{animate:!0,content:D,fallbackPlacements:E,placement:"bottom",portal:!0,children:G})}),T[60]=D,T[61]=G,T[62]=H):H=T[62],T[63]!==aa||T[64]!==ad||T[65]!==an||T[66]!==aw||T[67]!==ag?(I=(0,b.jsx)(i.Box,{padding:1,children:(0,b.jsx)(a5,{openPopup:aa,previewLocationOrigin:an,previewLocationRoute:aw,perspective:ad,targetOrigin:ag})}),T[63]=aa,T[64]=ad,T[65]=an,T[66]=aw,T[67]=ag,T[68]=I):I=T[68],T[69]!==$||T[70]!==aw||T[71]!==ak||T[72]!==H||T[73]!==I?(J=(0,b.jsx)(i.Box,{flex:1,children:(0,b.jsx)(a8,{previewUrlRef:ak,prefix:H,onChange:$,suffix:I,value:aw})}),T[69]=$,T[70]=aw,T[71]=ak,T[72]=H,T[73]=I,T[74]=J):J=T[74],T[75]!==ax?(K=a=>{a?.style.setProperty("view-transition-name",ax)},T[75]=ax,T[76]=K):K=T[76];let aF="desktop"===aj?"narrow":"full";T[77]!==al||T[78]!==aF?(L=al("preview-frame.viewport-button.tooltip",{context:aF}),T[77]=al,T[78]=aF,T[79]=L):L=T[79],T[80]!==L?(M=(0,b.jsx)(i.Text,{size:1,children:L}),T[80]=L,T[81]=M):M=T[81],T[82]===Symbol.for("react.memo_cache_sentinel")?(N=["bottom-start"],T[82]=N):N=T[82],T[83]!==al?(O=al("preview-frame.viewport-button.aria-label"),T[83]=al,T[84]=O):O=T[84];let aG="desktop"===aj?v.MobileDeviceIcon:v.DesktopIcon;return T[85]!==O||T[86]!==aG||T[87]!==am||T[88]!==aj?(P=(0,b.jsx)(y.Button,{"data-testid":"preview-viewport-toggle","data-viewport":aj,"aria-label":O,icon:aG,mode:"bleed",onClick:am,tooltipProps:null}),T[85]=O,T[86]=aG,T[87]=am,T[88]=aj,T[89]=P):P=T[89],T[90]!==K||T[91]!==M||T[92]!==P?(Q=(0,b.jsx)(i.Flex,{align:"center",flex:"none",gap:1,children:(0,b.jsx)(y.Tooltip,{animate:!0,ref:K,content:M,fallbackPlacements:N,placement:"bottom",portal:!0,children:P})}),T[90]=K,T[91]=M,T[92]=P,T[93]=Q):Q=T[93],T[94]!==U||T[95]!==V||T[96]!==W||T[97]!==Y||T[98]!==ad||T[99]!==aw?(R=U&&(0,b.jsx)(i.Flex,{align:"center",flex:"none",gap:1,children:(0,b.jsx)(be,{canToggleSharePreviewAccess:V,canUseSharedPreviewAccess:W,previewLocationRoute:aw,initialUrl:Y,perspective:ad})}),T[94]=U,T[95]=V,T[96]=W,T[97]=Y,T[98]=ad,T[99]=aw,T[100]=R):R=T[100],T[101]!==B||T[102]!==k||T[103]!==J||T[104]!==Q||T[105]!==R?(S=(0,b.jsxs)(i.Flex,{align:"center",gap:1,paddingX:1,style:j,children:[k,B,J,Q,R]}),T[101]=B,T[102]=k,T[103]=J,T[104]=Q,T[105]=R,T[106]=S):S=T[106],S};function bg(a){let d,e,f,g,h=(0,c.c)(7),j=bh,k=a.options?.component;h[0]!==k||h[1]!==a?(d=k?(0,b.jsx)(k,{...a,renderDefault:j}):j(a),h[0]=k,h[1]=a,h[2]=d):d=h[2];let l=d;return h[3]===Symbol.for("react.memo_cache_sentinel")?(e={position:"relative"},h[3]=e):e=h[3],h[4]===Symbol.for("react.memo_cache_sentinel")?(f={minHeight:0},h[4]=f):f=h[4],h[5]!==l?(g=(0,b.jsx)(i.Card,{flex:"none",padding:2,borderBottom:!0,style:e,children:(0,b.jsx)(i.Flex,{align:"center",style:f,children:l})}),h[5]=l,h[6]=g):g=h[6],g}function bh(a){return(0,b.jsx)(bf,{...a})}function bi(a){return a.matches("loading")}function bj(a){return a.matches("loaded")}function bk(a){return a.matches({loaded:"refreshing"})}function bl(a){return a.matches({loaded:"reloading"})}function bm(a){return a.context.visualEditingOverlaysEnabled}function bn(a){return a.hasTag("busy")}let bo=H.motion.create(i.Flex),bp=(0,k.memo)((0,k.forwardRef)(function(a,c){let{header:m,initialUrl:n,loadersConnection:o,overlaysConnection:q,perspective:r,viewport:s,vercelProtectionBypass:t,presentationRef:u,previewUrlRef:v}=a,[w,x]=(0,k.useState)(null),z=a_(null===w?r:w),A=(0,k.useMemo)(()=>{let a=new URL(n);return a.searchParams.get(h.urlSearchParamPreviewPerspective)||a.searchParams.set(h.urlSearchParamPreviewPerspective,z),(t||a.searchParams.get(h.urlSearchParamVercelProtectionBypass))&&a.searchParams.set(h.urlSearchParamVercelSetBypassCookie,"samesitenone"),t&&!a.searchParams.get(h.urlSearchParamVercelProtectionBypass)&&a.searchParams.set(h.urlSearchParamVercelProtectionBypass,t),a},[n,z,t]);(0,k.useEffect)(()=>{"connected"===o&&x(a=>null===a?r:a)},[o,r]);let{t:B}=(0,l.useTranslation)(e.presentationLocaleNamespace),{devMode:C}=(0,e.usePresentationTool)(),D=(0,i.usePrefersReducedMotion)(),E=(0,k.useRef)(null),F=(0,b.jsx)(bg,{...a,iframeRef:E,options:m});(0,k.useImperativeHandle)(c,()=>E.current);let G=(0,d.useSelector)(u,a=>a.matches("loading")||a.matches({loaded:"reloading"})),[H,J]=(0,k.useState)(!1),K=(0,d.useSelector)(u,a=>a.matches({loaded:"refreshing"})),[L,O]=(0,k.useState)(!1),P=G||K||"connecting"===q,Q=(0,k.useCallback)(()=>{E.current&&(E.current.src=A.toString(),u.send({type:"iframe reload"}))},[u,A]),R=(0,k.useCallback)(()=>{T(!0)},[]),[S,T]=(0,k.useState)(!1),[U,V]=(0,k.useState)(!1);(0,k.useEffect)(()=>{if(!(G||K)&&("connecting"===q||"reconnecting"===q)){let a=setTimeout(()=>{V(!0)},5e3);return()=>clearTimeout(a)}},[q,G,K]),(0,k.useEffect)(()=>{if(!(G||K||!U)){if("connected"===q&&(O(!1),V(!1),J(!1),T(!1)),"connecting"===q){let a=setTimeout(()=>{J(!0),console.error("Unable to connect to visual editing. Make sure you've setup '@sanity/visual-editing' correctly")},e.MAX_TIME_TO_OVERLAYS_CONNECTION);return()=>clearTimeout(a)}if("reconnecting"===q){let a=setTimeout(()=>{J(!0),O(!0)},e.MAX_TIME_TO_OVERLAYS_CONNECTION);return()=>clearTimeout(a)}}},[G,q,K,U]);let W=(0,k.useCallback)(()=>{u.send({type:"iframe loaded"})},[u]),X=(0,k.useMemo)(()=>(G||"connecting"===q&&!K)&&!S,[S,G,K,q]),Y=(0,k.useSyncExternalStore)((0,k.useCallback)(()=>()=>{},[]),()=>CSS.supports("(view-transition-name: test)")),Z=(0,k.useMemo)(()=>[X?"background":"active",G?"reloading":"idle",Y?"":s,U&&!S?"timedOut":""],[Y,S,G,X,U,s]),[$,_]=(0,k.useState)(s),[aa,ab]=(0,k.useState)(bt[s]);(0,k.useEffect)(()=>{if(Y&&s!==$){let a=()=>{_(s),ab(bt[s])};!D&&"startViewTransition"in document&&"function"==typeof document.startViewTransition?document.startViewTransition({update:()=>(0,N.flushSync)(()=>a()),types:["sanity-iframe-viewport"]}):a()}},[Y,D,$,s]);let ac=(0,j.useToast)(),ad=aZ(v),[ae,af]=(0,k.useState)(!1),[ag]=(0,k.useState)(new Set),ah=(0,p.useEffectEvent)(a=>{if(ad.some(b=>b.test(a)))return void af(a);ag.has(a)||(ag.add(a),console.warn("Visual Editing is here but misconfigured",{reportedOrigin:a}),ac.push({closable:!0,id:`presentation-iframe-origin-mismatch-${a}`,status:"error",duration:1/0,title:B("preview-frame.configuration.error.title"),description:(0,b.jsx)(l.Translate,{t:B,i18nKey:"preview-frame.configuration.error.description",components:{Code:"code"},values:{targetOrigin:A.origin,reportedOrigin:a}})}))}),ai=(0,e.usePresentationNavigate)(),aj=(0,p.useEffectEvent)(a=>{if(!ae)return;let b=new URL(a,ae);ai(`${ae}${b.pathname}${b.search}${b.hash}`)});return(0,k.useEffect)(()=>{if(!ae)return;let a=E.current?.contentWindow;if(!a)return;let b=(0,f.createController)({targetOrigin:ae});b.addTarget(a);let c=b.createChannel({name:"presentation",heartbeat:!0,connectTo:"visual-editing"},(0,f.createConnectionMachine)().provide({actors:(0,g.createCompatibilityActors)()}));c.on("visual-editing/navigate",a=>{aj(a.url)});let d=c.start();return()=>{d(),b.destroy()}},[ae]),(0,k.useEffect)(()=>{if("connecting"===q||"reconnecting"===q){let a=setInterval(()=>{E.current?.contentWindow?.postMessage({domain:"sanity/channels",from:"presentation",type:"presentation/status"},"*")},1e3),b=new AbortController;return window.addEventListener("message",({data:a})=>{a&&"object"==typeof a&&"domain"in a&&"sanity/channels"===a.domain&&"type"in a&&"visual-editing/status"===a.type&&"data"in a&&"object"==typeof a.data&&a.data&&"origin"in a.data&&"string"==typeof a.data.origin&&ah(a.data.origin)},{signal:b.signal}),()=>{b.abort(),clearInterval(a)}}},[q,H]),(0,b.jsx)(M,{transition:D?{duration:0}:void 0,children:(0,b.jsxs)(y.TooltipDelayGroupProvider,{children:[F,(0,b.jsx)(i.Card,{flex:1,tone:"transparent",children:(0,b.jsxs)(i.Flex,{align:"center",height:"fill",justify:"center",padding:2*((Y?$:s)!=="desktop"),sizing:"border",style:{position:"relative",cursor:P?"wait":void 0},children:[(0,b.jsx)(I.AnimatePresence,{children:L||G||K||!U||S?!G&&("connecting"!==q||K)||S?L&&!S?(0,b.jsx)(bo,{initial:"initial",animate:"animate",exit:"exit",variants:bs,justify:"center",align:"center",style:{background:"var(--card-bg-color)",inset:"0",position:"absolute"},children:(0,b.jsx)(as,{flex:1,message:B("preview-frame.connection.error.text"),onRetry:Q,onContinueAnyway:R,children:C&&(0,b.jsxs)(b.Fragment,{children:["connected"!==q&&(0,b.jsx)(i.Card,{padding:3,radius:2,tone:"critical",children:(0,b.jsxs)(i.Stack,{space:3,children:[(0,b.jsx)(i.Label,{muted:!0,size:0,children:B("preview-frame.overlay.connection-status.label")}),(0,b.jsx)(i.Code,{size:1,children:B("channel.status",{context:q})})]})}),"connected"!==o&&(0,b.jsx)(i.Card,{padding:3,radius:2,tone:"critical",children:(0,b.jsxs)(i.Stack,{space:3,children:[(0,b.jsx)(i.Label,{muted:!0,size:0,children:B("preview-frame.loader.connection-status.label")}),(0,b.jsx)(i.Code,{size:1,children:B("channel.status",{context:o})})]})})]})})}):null:(0,b.jsx)(bo,{initial:"initial",animate:"animate",exit:"exit",variants:br,justify:"center",align:"center",style:{inset:"0",position:"absolute"},children:(0,b.jsxs)(i.Flex,{style:{...bq[s]},justify:"center",align:"center",direction:"column",gap:4,children:[(0,b.jsx)(i.Spinner,{muted:!0}),(0,b.jsx)(i.Text,{muted:!0,size:1,children:B("preview-frame.status",{context:"loading"})})]})}):(0,b.jsx)(bo,{initial:"initial",animate:"animate",exit:"exit",variants:br,justify:"center",align:"center",style:{inset:"0",position:"absolute",backdropFilter:H?"blur(16px) saturate(0.5) grayscale(0.5)":"blur(2px)",transition:"backdrop-filter 0.2s ease-in-out",WebkitBackdropFilter:H?"blur(16px) saturate(0.5) grayscale(0.5)":"blur(2px)",WebkitTransition:"-webkit-backdrop-filter 0.2s ease-in-out",zIndex:1},children:(0,b.jsxs)(i.Flex,{style:{...bq[s]},justify:"center",align:"center",direction:"column",gap:4,children:[H&&(0,b.jsx)(y.Button,{disabled:!0,mode:"ghost",text:B("preview-frame.continue-button.text"),style:{opacity:0}}),(0,b.jsx)(i.Card,{radius:2,tone:H?"caution":"inherit",padding:4,shadow:1,children:(0,b.jsxs)(i.Flex,{justify:"center",align:"center",direction:"column",gap:4,children:[(0,b.jsx)(i.Spinner,{muted:!0}),(0,b.jsx)(i.Text,{muted:!0,size:1,children:H?B("preview-frame.status",{context:"timeout"}):B("preview-frame.status",{context:"connecting"})})]})}),H&&(0,b.jsx)(y.Button,{tone:"critical",onClick:R,text:B("preview-frame.continue-button.text")})]})})}),(0,b.jsx)(a1,{animate:Z,initial:["background"],onLoad:W,preventClick:X,ref:E,src:A.toString(),style:aa,variants:bt})]})})]})})}));bp.displayName="Memo(ForwardRef(Preview))";let bq={desktop:{width:"100%",height:"100%"},mobile:{width:375,height:650}},br={initial:{opacity:1},animate:{opacity:[0,0,1]},exit:{opacity:[1,0,0]}},bs={initial:{opacity:1},animate:{opacity:[0,0,1]},exit:{opacity:[1,0,0]}},bt={desktop:{...bq.desktop,boxShadow:"0 0 0 0px var(--card-border-color)"},mobile:{...bq.mobile,boxShadow:"0 0 0 1px var(--card-border-color)"},background:{opacity:0,scale:1},idle:{scale:1},reloading:{scale:[1,1,1,.98]},active:{opacity:[0,0,1],scale:1},timedOut:{opacity:[0,0,1]}},bu=function(){let a=!1;return(...b)=>{a||(console.warn(...b),a=!0)}}();function bv(a,b){return Object.values(b).forEach(b=>{a[b._id]=b}),a}function bw(a){return"_projectId"in a&&a._projectId?(bu("Cross dataset references are not supported yet, ignoring source document",a),!1):a}function bx(a,b){return a instanceof Function?a(b):a}function by(a){let[b]=a;return"preview"===b}let bz=/^([\w-]+):(0|[1-9][0-9]*)$/,bA=/^([\w-]+):([0-9]+),([0-9]+)$/,bB=/^([\w-]+):([\w-]+)$/;function bC(a){return Object.fromEntries(Object.entries(a).filter(([,a])=>void 0!==a&&""!==a&&null!==a))}let bD=()=>a=>a,bE=bD()(["perspective","preview","viewport"]),bF=bD()(["changesInspectorTab","comment","inspect","instruction","parentRefPath","path","pathKey","rev","since","template","templateParams","version","view"]);function bG(){return new Set}function bH(a){return a()}function bI(){let{perspectiveStack:a,selectedPerspectiveName:b,selectedReleaseId:c}=(0,l.usePerspective)();return c?a:void 0===b?"drafts":b}function bJ(){let a,b,d,e,f=(0,c.c)(4);f[0]===Symbol.for("react.memo_cache_sentinel")?(a=new Map,f[0]=a):a=f[0];let[g,h]=(0,k.useState)(a);a:{let a=Array.from(g.values());if(a.find(bM)){b="connected";break a}let c=a.filter(bL);if(c.length){b=c.some(bK)?"connecting":"reconnecting";break a}b="idle"}let i=b;f[1]===Symbol.for("react.memo_cache_sentinel")?(d=a=>{h(b=>{let c=new Map(b);if("disconnected"===a.status)c.delete(a.connection);else{let b=c.get(a.connection)?.hasConnected||"connected"===a.status,d="handshaking"===a.status?"connecting":a.status;c.set(a.connection,{status:d,hasConnected:b})}return c})},f[1]=d):d=f[1];let j=d;return f[2]!==i?(e=[i,j],f[2]=i,f[3]=e):e=f[3],e}function bK(a){let{hasConnected:b}=a;return!b}function bL(a){let{status:b}=a;return"connecting"===b}function bM(a){let{status:b}=a;return"connected"===b}let bN=(0,k.lazy)(()=>a.A(287720)),bO=(0,k.lazy)(()=>a.A(601102)),bP=(0,k.lazy)(()=>a.A(586106)),bQ=(0,k.lazy)(()=>a.A(456459)),bR=(0,k.lazy)(()=>a.A(899796)),bS=(0,k.lazy)(()=>a.A(442408)),bT=(0,k.lazy)(()=>a.A(573486)),bU=(0,o.styled)(i.Flex)`
  overflow-x: auto;
`;function bV(a){let{canToggleSharePreviewAccess:j,canUseSharedPreviewAccess:o,tool:q,vercelProtectionBypass:r,initialPreviewUrl:s,previewUrlRef:t}=a,u=aZ(t),v=a6(t),w=q.options?.components,x=q.name||e.DEFAULT_TOOL_NAME,{unstable_navigator:y,unstable_header:z}=w||{},{navigate:A,state:B}=(0,n.useRouter)(),C=(0,l.useUnique)(Object.fromEntries(B._searchParams||[])),D=bI(),E=(0,d.useSelector)(t,a=>a.context.previewMode?.shareAccess!==!1),[F]=(0,k.useState)(()=>{let a=q.options?.devMode;return"function"==typeof a?a():"boolean"==typeof a&&a}),G=(0,k.useRef)(null),[H,I]=(0,k.useState)(),[J,K]=(0,k.useState)(null),L=(0,k.useRef)({title:void 0,url:void 0}),{isSameDocument:M,navigate:N,navigationHistory:O,params:P,searchParams:Q,structureParams:R}=function({initialPreviewUrl:a,routerNavigate:b,routerState:c,routerSearchParams:d,frameStateRef:e}){let f=(0,k.useMemo)(()=>{let{id:b,path:e,type:f}={id:function(a){if(void 0===a)return;let b=decodeURIComponent(a)?.split(".");return"drafts"===b[0]&&b.shift(),b.join(".")}(c.id),path:function(a){if(void 0!==a)return m.studioPath.toString(function(a){let b=[];for(let c of a.split(".")){let a=bz.exec(c);if(a){b.push(a[1],Number(a[2]));continue}let d=bA.exec(c);if(d){b.push(d[1],[Number(d[2]),Number(d[3])]);continue}let e=bB.exec(c);if(e){b.push(e[1],{_key:e[2]});continue}b.push(c)}return b}(decodeURIComponent(a)))}(c.path),type:c.type};return{id:b,type:f,path:e,preview:d.preview||a.toString(),perspective:d.perspective,viewport:d.viewport,inspect:d.inspect,parentRefPath:d.parentRefPath,rev:d.rev,since:d.since,template:d.template,templateParams:d.templateParams,view:d.view,pathKey:d.pathKey,instruction:d.instruction,comment:d.comment,changesInspectorTab:d.changesInspectorTab}},[c,d,a]),g=(0,k.useMemo)(()=>bC({inspect:f.inspect,path:f.path,parentRefPath:f.parentRefPath,rev:f.rev,since:f.since,template:f.template,templateParams:f.templateParams,view:f.view,pathKey:f.pathKey,instruction:f.instruction,comment:f.comment,changesInspectorTab:f.changesInspectorTab}),[f.changesInspectorTab,f.comment,f.inspect,f.instruction,f.path,f.pathKey,f.parentRefPath,f.rev,f.since,f.template,f.templateParams,f.view]),h=(0,k.useMemo)(()=>bC({perspective:f.perspective,preview:f.preview,viewport:f.viewport}),[f.perspective,f.preview,f.viewport]),i=(0,k.useRef)(c);(0,k.useLayoutEffect)(()=>{i.current=c},[c]);let[j,l]=(0,k.useState)([c]),n=(0,k.useCallback)(({id:a,type:b})=>{let{current:c}=i;return a===c.id&&b===c.type},[]),o=(0,k.useCallback)(a=>{let{state:c,params:d,replace:e=!1}=a;c?.id&&(c.id=(0,m.getPublishedId)(c.id));let{current:f}=i,g={id:f.id,type:f.type,path:f.path},h=Object.fromEntries(f._searchParams||[]),j=c||g,k={...[...bE,...n(j)?bF:[]].reduce((a,b)=>(a[b]=h[b],a),{}),...d},o={...j,_searchParams:Object.entries(k).reduce((a,[b,c])=>[...a,[b,c]],[])};l(a=>[...a,o]),b(o,{replace:e})},[n,b]);return{isSameDocument:n,navigate:o,navigationHistory:j,params:f,searchParams:h,structureParams:g}}({initialPreviewUrl:s,routerNavigate:A,routerState:B,routerSearchParams:C,frameStateRef:L}),W=(0,d.useActorRef)(_),X=(0,k.useMemo)(()=>P.viewport?"mobile":"desktop",[P.viewport]),[Y,$]=function(a,b){let d,e,f,g,h,i,j=(0,c.c)(11);(0,S.validateApiPerspective)(a),j[0]===Symbol.for("react.memo_cache_sentinel")?(d={},j[0]=d):d=j[0];let[l,m]=(0,k.useState)(d);j[1]===Symbol.for("react.memo_cache_sentinel")?(e={},j[1]=e):e=j[1];let[n,o]=(0,k.useState)(e),p=(0,k.useRef)("");j[2]!==b?(f=(a,c,d)=>{let e=(void 0===d?[]:d).filter(bw);("published"===c?m:o)(c=>{let d={};for(let a of e)d[a._id]=a;if(p.current!==b.current.url)return p.current=b.current.url,{[a]:d};let f=c[a];return(0,T.default)(f,d)?c:{...c,[a]:d}})},j[2]=b,j[3]=f):f=j[3];let q=f,r="published"===a?l:n;j[4]!==r?(g=Object.values(r).reduce(bv,{}),j[4]=r,j[5]=g):g=j[5];let s=g;j[6]!==s?(h=Object.values(s),j[6]=s,j[7]=h):h=j[7];let t=h;return j[8]!==t||j[9]!==q?(i=[t,q],j[8]=t,j[9]=q,j[10]=i):i=j[10],i}(D,L),ab=(0,l.useProjectId)(),ae=(0,l.useDataset)(),af=function(a){let b,d,f,g,h,i,j=(0,c.c)(22),{navigate:m,navigationHistory:o,path:q,targetOrigin:r,resolvers:s}=a;j[0]!==s?(b=void 0===s?[]:s,j[0]=s,j[1]=b):b=j[1];let t=b,{state:u}=(0,n.useRouter)(),{perspectiveStack:v}=(0,l.usePerspective)();j[2]===Symbol.for("react.memo_cache_sentinel")?(d={apiVersion:e.API_VERSION},j[2]=d):d=j[2];let w=(0,l.useClient)(d);j[3]!==q||j[4]!==u?(f=q||u._searchParams?.find(by)?.[1]||"",j[3]=q,j[4]=u,j[5]=f):f=j[5];let x=f,[y,z]=(0,k.useState)(void 0),A=(0,k.useRef)(void 0);j[6]!==m||j[7]!==o?(g=(a,b)=>{a&&A.current===a._id||(z({document:a,path:b.pathname}),A.current=a?._id,o.at(-1)?.id===o.at(-2)?.id&&m?.({state:{id:a?._id,type:a?._type}}))},j[6]=m,j[7]=o,j[8]=g):g=j[8];let B=(0,p.useEffectEvent)(g);return j[9]!==w||j[10]!==B||j[11]!==v||j[12]!==x||j[13]!==t||j[14]!==r?(h=()=>{let a=new URL(x,r);if(t.length){let d;for(let b of t){let c=function(a,b){for(a of Array.isArray(a)?a:[a]){let{origin:c}=b,d=a;if("string"==typeof a)try{let b=new URL(a);if(b.origin!==c)continue;c=b.origin,d=b.pathname}catch{}try{let a=(function(a,b){var c=[];return function(a,b,c){void 0===c&&(c={});var d=c.decode,e=void 0===d?function(a){return a}:d;return function(c){var d=a.exec(c);if(!d)return!1;for(var f=d[0],g=d.index,h=Object.create(null),i=1;i<d.length;i++)!function(a){if(void 0!==d[a]){var c=b[a-1];"*"===c.modifier||"+"===c.modifier?h[c.name]=d[a].split(c.prefix+c.suffix).map(function(a){return e(a,c)}):h[c.name]=e(d[a],c)}}(i);return{path:f,index:g,params:h}}}(function a(b,c,d){if(b instanceof RegExp){var e;if(!c)return b;for(var f=/\((?:\?<(.*?)>)?(?!\?)/g,g=0,h=f.exec(b.source);h;)c.push({name:h[1]||g++,prefix:"",suffix:"",modifier:"",pattern:""}),h=f.exec(b.source);return b}return Array.isArray(b)?(e=b.map(function(b){return a(b,c,d).source}),new RegExp("(?:".concat(e.join("|"),")"),V(d))):function(a,b,c){void 0===c&&(c={});for(var d=c.strict,e=void 0!==d&&d,f=c.start,g=c.end,h=c.encode,i=void 0===h?function(a){return a}:h,j=c.delimiter,k=c.endsWith,l="[".concat(U(void 0===k?"":k),"]|$"),m="[".concat(U(void 0===j?"/#?":j),"]"),n=void 0===f||f?"^":"",o=0;o<a.length;o++){var p=a[o];if("string"==typeof p)n+=U(i(p));else{var q=U(i(p.prefix)),r=U(i(p.suffix));if(p.pattern)if(b&&b.push(p),q||r)if("+"===p.modifier||"*"===p.modifier){var s="*"===p.modifier?"?":"";n+="(?:".concat(q,"((?:").concat(p.pattern,")(?:").concat(r).concat(q,"(?:").concat(p.pattern,"))*)").concat(r,")").concat(s)}else n+="(?:".concat(q,"(").concat(p.pattern,")").concat(r,")").concat(p.modifier);else{if("+"===p.modifier||"*"===p.modifier)throw TypeError('Can not repeat "'.concat(p.name,'" without a prefix and suffix'));n+="(".concat(p.pattern,")").concat(p.modifier)}else n+="(?:".concat(q).concat(r,")").concat(p.modifier)}}if(void 0===g||g)e||(n+="".concat(m,"?")),n+=c.endsWith?"(?=".concat(l,")"):"$";else{var t=a[a.length-1],u="string"==typeof t?m.indexOf(t[t.length-1])>-1:void 0===t;e||(n+="(?:".concat(m,"(?=").concat(l,"))?")),u||(n+="(?=".concat(m,"|").concat(l,")"))}return new RegExp(n,V(c))}(function(a,b){void 0===b&&(b={});for(var c=function(a){for(var b=[],c=0;c<a.length;){var d=a[c];if("*"===d||"+"===d||"?"===d){b.push({type:"MODIFIER",index:c,value:a[c++]});continue}if("\\"===d){b.push({type:"ESCAPED_CHAR",index:c++,value:a[c++]});continue}if("{"===d){b.push({type:"OPEN",index:c,value:a[c++]});continue}if("}"===d){b.push({type:"CLOSE",index:c,value:a[c++]});continue}if(":"===d){for(var e="",f=c+1;f<a.length;){var g=a.charCodeAt(f);if(g>=48&&g<=57||g>=65&&g<=90||g>=97&&g<=122||95===g){e+=a[f++];continue}break}if(!e)throw TypeError("Missing parameter name at ".concat(c));b.push({type:"NAME",index:c,value:e}),c=f;continue}if("("===d){var h=1,i="",f=c+1;if("?"===a[f])throw TypeError('Pattern cannot start with "?" at '.concat(f));for(;f<a.length;){if("\\"===a[f]){i+=a[f++]+a[f++];continue}if(")"===a[f]){if(0==--h){f++;break}}else if("("===a[f]&&(h++,"?"!==a[f+1]))throw TypeError("Capturing groups are not allowed at ".concat(f));i+=a[f++]}if(h)throw TypeError("Unbalanced pattern at ".concat(c));if(!i)throw TypeError("Missing pattern at ".concat(c));b.push({type:"PATTERN",index:c,value:i}),c=f;continue}b.push({type:"CHAR",index:c,value:a[c++]})}return b.push({type:"END",index:c,value:""}),b}(a),d=b.prefixes,e=void 0===d?"./":d,f=b.delimiter,g=void 0===f?"/#?":f,h=[],i=0,j=0,k="",l=function(a){if(j<c.length&&c[j].type===a)return c[j++].value},m=function(a){var b=l(a);if(void 0!==b)return b;var d=c[j],e=d.type,f=d.index;throw TypeError("Unexpected ".concat(e," at ").concat(f,", expected ").concat(a))},n=function(){for(var a,b="";a=l("CHAR")||l("ESCAPED_CHAR");)b+=a;return b},o=function(a){for(var b=0;b<g.length;b++){var c=g[b];if(a.indexOf(c)>-1)return!0}return!1},p=function(a){var b=h[h.length-1],c=a||(b&&"string"==typeof b?b:"");if(b&&!c)throw TypeError('Must have text between two parameters, missing text after "'.concat(b.name,'"'));return!c||o(c)?"[^".concat(U(g),"]+?"):"(?:(?!".concat(U(c),")[^").concat(U(g),"])+?")};j<c.length;){var q=l("CHAR"),r=l("NAME"),s=l("PATTERN");if(r||s){var t=q||"";-1===e.indexOf(t)&&(k+=t,t=""),k&&(h.push(k),k=""),h.push({name:r||i++,prefix:t,suffix:"",pattern:s||p(t),modifier:l("MODIFIER")||""});continue}var u=q||l("ESCAPED_CHAR");if(u){k+=u;continue}if(k&&(h.push(k),k=""),l("OPEN")){var t=n(),v=l("NAME")||"",w=l("PATTERN")||"",x=n();m("CLOSE"),h.push({name:v||(w?i++:""),pattern:v&&!w?p(t):w,prefix:t,suffix:x,modifier:l("MODIFIER")||""});continue}m("END")}return h}(b,d),c,d)}(a,c,b),c,b)})(d,{decode:decodeURIComponent})(b.pathname);if(a){let{params:b,path:d}=a;return{origin:c,params:b,path:d}}}catch{throw Error(`"${a}" is not a valid route pattern`)}}}(b.route,a);if(c){d={context:c,resolver:b};break}}if(d){var b,c;let e=function(a,b){if(a.resolve){let c=a.resolve(b)?.filter;return c?`// groq
*[${c}][0]{_id, _type}`:void 0}return"type"in a?`// groq
*[_type == "${a.type}"][0]{_id, _type}`:`// groq
*[${bx(a.filter,b)}][0]{_id, _type}`}(d.resolver,d.context),f=(b=d.resolver,c=d.context,b.resolve?b.resolve(c)?.params??c.params:"type"in b?{}:bx(b.params,c)??c.params);if(e){let b=new AbortController,c={perspective:v,signal:b.signal,tag:"use-main-document"};return w.fetch(e,f,c).then(b=>B(b,a)).catch(b=>{b instanceof Error&&"AbortError"===b.name||(z({document:void 0,path:a.pathname}),A.current=void 0)}),()=>{b.abort()}}}}z(void 0),A.current=void 0},j[9]=w,j[10]=B,j[11]=v,j[12]=x,j[13]=t,j[14]=r,j[15]=h):h=j[15],j[16]!==w||j[17]!==v||j[18]!==x||j[19]!==t||j[20]!==r?(i=[w,v,x,t,r],j[16]=w,j[17]=v,j[18]=x,j[19]=t,j[20]=r,j[21]=i):i=j[21],(0,k.useEffect)(h,i),y}({navigate:N,navigationHistory:O,path:P.preview,targetOrigin:v,resolvers:q.options?.resolve?.mainDocuments}),[ag,ah]=bJ(),[ai,aj]=bJ(),[ak,al]=bJ(),{open:am}=(a=>{let b,d,f,g,h,i,j=(0,c.c)(10),[l,m]=(0,k.useState)(bG);j[0]===Symbol.for("react.memo_cache_sentinel")?(b=a=>{let b=window.open(a,"_blank");b&&m(a=>new Set(a).add(b))},j[0]=b):b=j[0];let n=b;return j[1]!==a||j[2]!==l?(d=()=>{let b=[];if(l.size&&a)for(let c of l)c&&"closed"in c&&!c.closed&&b.push(a.addTarget(c));return()=>{b.forEach(bH)}},f=[a,l],j[1]=a,j[2]=l,j[3]=d,j[4]=f):(d=j[3],f=j[4]),(0,k.useEffect)(d,f),j[5]!==l?(g=()=>{if(l.size){let a=setInterval(()=>{let a=new Set;for(let b of l)b&&"closed"in b&&b.closed&&a.add(b);a.size&&m(b=>{let c=new Set(b);for(let b of a)c.delete(b);return c})},e.POPUP_CHECK_INTERVAL);return()=>{clearInterval(a)}}},h=[l],j[5]=l,j[6]=g,j[7]=h):(g=j[6],h=j[7]),(0,k.useEffect)(g,h),j[8]!==l?(i={popups:l,open:n},j[8]=l,j[9]=i):i=j[9],i})(H),an=(0,d.useSelector)(W,a=>a.matches("loading"));(0,k.useEffect)(()=>{let a=G.current?.contentWindow;if(!a||an)return;let b=(0,f.createController)({targetOrigin:v});return b.addTarget(a),I(b),()=>{b.destroy(),I(void 0)}},[v,an]);let ao=(0,p.useEffectEvent)(a=>{N(a)});(0,k.useEffect)(()=>{if(!H)return;let a=H.createChannel({name:"presentation",heartbeat:!0,connectTo:"visual-editing"},(0,f.createConnectionMachine)().provide({actors:(0,g.createCompatibilityActors)()}));a.on("visual-editing/focus",a=>{"id"in a&&ao({state:{type:a.type,id:a.id,path:a.path}})}),a.on("visual-editing/navigate",a=>{let{title:b}=a,c=a.url;if(!c.startsWith("http"))try{c=new URL(c,v).toString()}catch{}if(L.current.url!==c)try{let[a,b]=c.split("?"),d=new URLSearchParams(b);d.delete(h.urlSearchParamVercelProtectionBypass),d.delete(h.urlSearchParamVercelSetBypassCookie),ao({params:{preview:`${a}${d.size>0?"?":""}${d}`}})}catch{ao({params:{preview:c}})}L.current={title:b,url:c}}),a.on("visual-editing/meta",a=>{L.current.title=a.title}),a.on("visual-editing/toggle",a=>{W.send({type:"toggle visual editing overlays",enabled:a.enabled})}),a.on("visual-editing/documents",a=>{$("visual-editing",a.perspective,a.documents)}),a.on("visual-editing/refreshing",a=>{"manual"===a.source?clearTimeout(aC.current):"mutation"===a.source&&W.send({type:"iframe refresh"})}),a.on("visual-editing/refreshed",()=>{W.send({type:"iframe loaded"})}),a.onStatus(ah);let b=a.start();return K(a),()=>{b(),K(null)}},[H,W,$,ah,v]),(0,k.useEffect)(()=>{if(!H)return;let a=H.createChannel({name:"presentation",connectTo:"preview-kit",heartbeat:!0},(0,f.createConnectionMachine)().provide({actors:(0,g.createCompatibilityActors)()}));return a.onStatus(al),a.on("preview-kit/documents",a=>{a.projectId===ab&&a.dataset===ae&&$("preview-kit",a.perspective,a.documents)}),a.start()},[H,ae,ab,$,al,v]);let ap=(0,k.useMemo)(()=>ad(a=>{M(a)&&N({state:a,replace:!0})},0),[M,N]),aq=(0,k.useCallback)(a=>{let b=new URL(a,v),c=b.toString();P.preview!==c&&(Array.isArray(u)?u.some(a=>a.test(c))&&N({params:{preview:c}}):b.origin===v&&N({params:{preview:c}}))},[v,P.preview,u,N]),as=(0,k.useCallback)(a=>{N({params:a})},[N]),at=(0,k.useCallback)(a=>{N(a)},[N]);(0,k.useEffect)(()=>{P.id&&P.path?J?.post("presentation/focus",{id:P.id,path:P.path}):J?.post("presentation/blur")},[P.id,P.path,J]),(0,k.useEffect)(()=>{if(L.current.url&&P.preview&&L.current.url!==P.preview){try{let a=new URL(L.current.url,v).origin,b=new URL(P.preview,v).origin;if(a!==b)return}catch{}if(L.current.url=P.preview,"connected"===ag){let a=P.preview;if(a.startsWith("http"))try{let b=new URL(P.preview,v);a=b.pathname+b.search+b.hash}catch{}J?.post("presentation/navigate",{url:a,type:"replace"})}}},[ag,v,P.preview,J]);let au=(0,k.useCallback)(()=>J?.post("presentation/toggle-overlay"),[J]),[av,aw]=(0,k.useState)(null);(0,k.useEffect)(()=>{let a=a=>{bW(a)&&au()},b=a=>{var b,c;bW(a)&&au(),b=["mod","\\"],c=a,b.every(a=>bX[a]?c[bX[a]]:c.key===a.toUpperCase())&&au()};return window.addEventListener("keydown",b),window.addEventListener("keyup",a),()=>{window.removeEventListener("keydown",b),window.removeEventListener("keyup",a)}},[au]);let[ax,ay]=(0,k.useState)(null),[{navigatorEnabled:az,toggleNavigator:aA},aB]=function(a){let d,e,f,g,h=(0,c.c)(11),{unstable_navigator:i}=a,j=!!i?.component,[l,m]=function(a,b){let d,e,f,g,h=(0,c.c)(9);h[0]!==b||h[1]!==a?(d=()=>JSON.parse(localStorage.getItem(a)??JSON.stringify(b)),h[0]=b,h[1]=a,h[2]=d):d=h[2];let[i,j]=(0,k.useState)(d);return h[3]!==a||h[4]!==i?(e=()=>{localStorage.setItem(a,JSON.stringify(i))},f=[a,i],h[3]=a,h[4]=i,h[5]=e,h[6]=f):(e=h[5],f=h[6]),(0,k.useEffect)(e,f),h[7]!==i?(g=[i,j],h[7]=i,h[8]=g):g=h[8],g}("presentation/navigator",j),n=!!j&&l;a:{let a;if(!j){d=void 0;break a}h[0]!==m?(a=()=>m(aV),h[0]=m,h[1]=a):a=h[1],d=a}let o=d;h[2]!==n||h[3]!==i?(e=function(){return(0,b.jsx)(b.Fragment,{children:n&&(0,b.jsx)(aW,{...i})})},h[2]=n,h[3]=i,h[4]=e):e=h[4];let p=e;return h[5]!==n||h[6]!==o?(f={navigatorEnabled:n,toggleNavigator:o},h[5]=n,h[6]=o,h[7]=f):f=h[7],h[8]!==p||h[9]!==f?(g=[f,p],h[8]=p,h[9]=f,h[10]=g):g=h[10],g}({unstable_navigator:y}),aC=(0,k.useRef)(void 0),aD=(0,k.useCallback)(a=>{if(W.send({type:"iframe refresh"}),J){aC.current=window.setTimeout(a,300),J.post("presentation/refresh",{source:"manual",livePreviewEnabled:"connected"===ak||"connected"===ai});return}a()},[ai,W,ak,J]),aE=(0,l.useWorkspace)(),aF=(0,k.useCallback)(({id:a,type:b,path:c})=>{if(L.current.url)return{title:L.current.title||L.current.url,name:"edit",params:{id:a,path:c,type:b,inspect:l.COMMENTS_INSPECTOR_NAME,workspace:aE.name,mode:e.EDIT_INTENT_MODE,preview:P.preview}}},[P.preview,aE.name]),aG=(0,k.useCallback)(a=>{N({params:{viewport:"desktop"===a?void 0:"mobile"},replace:!0})},[N]);return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(aY,{devMode:F,name:x,navigate:N,params:P,searchParams:Q,structureParams:R,children:(0,b.jsx)(aU,{navigate:N,children:(0,b.jsx)(aX,{params:P,children:(0,b.jsx)(aa,{comlink:J,children:(0,b.jsx)(bU,{"data-testid":"presentation-root",height:"fill",children:(0,b.jsxs)(ar,{children:[(0,b.jsx)(aB,{}),(0,b.jsx)(ac,{id:"preview",minWidth:325,defaultSize:az?50:75,order:3,children:(0,b.jsx)(i.Flex,{direction:"column",flex:1,height:"fill",ref:ay,children:(0,b.jsx)(i.BoundaryElementProvider,{element:ax,children:(0,b.jsx)(bp,{canSharePreviewAccess:E,canToggleSharePreviewAccess:j,canUseSharedPreviewAccess:o,header:z,initialUrl:s,loadersConnection:ai,navigatorEnabled:az,onPathChange:aq,onRefresh:aD,openPopup:am,overlaysConnection:ag,previewUrl:P.preview,perspective:D,ref:G,setViewport:aG,targetOrigin:v,toggleNavigator:aA,toggleOverlay:au,viewport:X,vercelProtectionBypass:r,presentationRef:W,previewUrlRef:t},v)})})}),(0,b.jsx)(aT,{documentId:P.id,documentsOnPage:Y,documentType:P.type,getCommentIntent:aF,mainDocumentState:af,onEditReference:at,onFocusPath:ap,onStructureParams:as,searchParams:Q,setDisplayedDocument:aw,structureParams:R})]})})})})})}),(0,b.jsxs)(k.Suspense,{children:[H&&(0,b.jsx)(bN,{controller:H,perspective:D,liveDocument:av,onDocumentsOnPage:$,onLoadersConnection:aj}),J&&P.id&&P.type&&(0,b.jsx)(bP,{comlink:J,id:P.id,type:P.type,loadersConnection:ai,previewKitConnection:ak}),J&&(0,b.jsx)(bS,{comlink:J,perspective:D}),J&&Y.length>0&&(0,b.jsx)(bR,{comlink:J,perspective:D,refs:Y}),J&&(0,b.jsx)(bO,{comlink:J,perspective:D}),J&&(0,b.jsx)(Z,{comlink:J}),J&&(0,b.jsx)(bQ,{comlink:J,perspective:D}),J&&(0,b.jsx)(bT,{comlink:J})]})]})}function bW(a){return"Alt"===a.key}let bX={alt:"altKey",ctrl:"ctrlKey",mod:"ctrlKey",shift:"shiftKey"},bY=(0,s.fromPromise)(async({input:a})=>{let{previewSearchParam:b,initialUrl:c,allowOrigins:d}=a;if(!b)return c;try{let a=new URL(b,c.origin);return d.some(b=>b.test(a.origin))?a:c}catch{return c}}),bZ={_id:h.schemaIdSingleton,_type:h.schemaTypeSingleton},b$={_id:`drafts.${(0,W.uuid)()}`,_type:h.schemaType},b_=(0,q.setup)({types:{},actions:{"notify preview will likely fail":(0,t.l)("Missing permissions to create preview secret, or read shared preview secret. Preview will likely fail loading."),"assign preview search param":(0,r.assign)({previewSearchParam:(a,b)=>b.previewSearchParam}),"assign error":(0,r.assign)({error:(a,b)=>b.error instanceof Error?b.error:Error(b.message,{cause:b.error})})},actors:{"check permission":(0,s.fromObservable)(()=>(0,Y.throwError)(()=>Error("The 'check permission' actor is not implemented. Add it to previewUrlMachine.provide({actors: {'check permission': fromObservable(({input}: {input: CheckPermissionInput}) => ...)}})"))),"resolve initial url":(0,s.fromPromise)(()=>Promise.reject(Error("The 'resolve initial url' actor is not implemented. Add it to previewUrlMachine.provide({actors: {'resolve initial url': fromPromise(...)}})"))),"resolve allow patterns":(0,s.fromPromise)(()=>Promise.reject(Error("The 'resolve allow patterns' actor is not implemented. Add it to previewUrlMachine.provide({actors: {'resolve allow pattern': fromPromise(...)}})"))),"resolve url from preview search param":bY,"resolve preview mode":(0,s.fromPromise)(()=>Promise.reject(Error("The 'resolve preview mode' actor is not implemented. Add it to previewUrlMachine.provide({actors: {'resolve preview mode': fromPromise(...)}})"))),"create preview secret":(0,s.fromPromise)(async()=>Promise.reject(Error("The 'create preview secret' actor is not implemented. Add it to previewUrlMachine.provide({actors: {'create preview secret': fromPromise(...)}})"))),"read shared preview secret":(0,s.fromPromise)(async()=>Promise.reject(Error("The 'read shared preview secret' actor is not implemented. Add it to previewUrlMachine.provide({actors: {'read shared preview secret': fromPromise(...)}})"))),"resolve preview mode url":(0,s.fromPromise)(()=>Promise.reject(Error("The 'resolve preview mode url' actor is not implemented. Add it to previewUrlMachine.provide({actors: {'resolve preview mode url': fromPromise(...)}})")))},guards:{"has checked permissions":({context:a})=>!!(a.previewAccessSharingCreatePermission&&a.previewAccessSharingReadPermission&&a.previewAccessSharingUpdatePermission&&a.previewUrlSecretPermission),"search param has new origin":({context:a,event:b})=>{if(!a.previewUrl||!b.previewSearchParam)return!1;try{let c=new URL(b.previewSearchParam,a.previewUrl);return a.previewUrl.origin!==c.origin}catch{return!1}},"can create preview secret":({context:a})=>a.previewUrlSecretPermission?.granted===!0,"has preview mode with created secret":({context:a},b)=>!1!==b&&a.previewUrlSecretPermission?.granted===!0,"has preview mode with share access":({context:a},b)=>!1!==b&&a.previewAccessSharingReadPermission?.granted===!0,"has preview mode without permissions":({context:a},b)=>!1!==b&&a.previewAccessSharingReadPermission?.granted===!1&&a.previewUrlSecretPermission?.granted===!1},delays:{expiredSecret:({context:a})=>{if(!a.previewUrlSecret?.expiresAt)return 0;let b=Date.now();return Math.max(a.previewUrlSecret.expiresAt.getTime()-b,0)}}}).createMachine({id:"Preview URL",context:({input:a})=>({initialUrl:null,previewUrl:null,error:null,allowOrigins:null,previewSearchParam:a.previewSearchParam,previewUrlSecret:null,previewAccessSharingCreatePermission:null,previewAccessSharingReadPermission:null,previewAccessSharingUpdatePermission:null,previewUrlSecretPermission:null,previewMode:null}),invoke:[{src:"check permission",input:()=>({checkPermissionName:"read",document:bZ}),onError:{target:".error",actions:{type:"assign error",params:({event:a})=>({message:"Failed to check permission",error:a.error})}},onSnapshot:{actions:(0,r.assign)({previewAccessSharingReadPermission:({event:a})=>a.snapshot.context??null})}},{src:"check permission",input:()=>({checkPermissionName:"create",document:bZ}),onError:{target:".error",actions:{type:"assign error",params:({event:a})=>({message:"Failed to check permission",error:a.error})}},onSnapshot:{actions:(0,r.assign)({previewAccessSharingCreatePermission:({event:a})=>a.snapshot.context??null})}},{src:"check permission",input:()=>({checkPermissionName:"update",document:bZ}),onError:{target:".error",actions:{type:"assign error",params:({event:a})=>({message:"Failed to check permission",error:a.error})}},onSnapshot:{actions:(0,r.assign)({previewAccessSharingUpdatePermission:({event:a})=>a.snapshot.context??null})}},{src:"check permission",input:()=>({checkPermissionName:"create",document:b$}),onError:{target:".error",actions:{type:"assign error",params:({event:a})=>({message:"Failed to check permission",error:a.error})}},onSnapshot:{actions:(0,r.assign)({previewUrlSecretPermission:({event:a})=>a.snapshot.context??null})}}],on:{"set preview search param":{actions:{type:"assign preview search param",params:({event:a})=>({previewSearchParam:a.previewSearchParam})}}},states:{checkingPermissions:{always:{guard:"has checked permissions",target:"resolvingInitialUrl"},tags:"busy"},resolvingInitialUrl:{invoke:{src:"resolve initial url",input:({context:a})=>({previewSearchParam:a.previewSearchParam}),onError:{target:"error",actions:{type:"assign error",params:({event:a})=>({message:"Failed to resolve initial url",error:a.error})}},onDone:{target:"resolvingAllowPatterns",actions:(0,r.assign)({initialUrl:({event:a})=>a.output})}},tags:"busy"},error:{type:"final",tags:"error"},resolvingAllowPatterns:{invoke:{src:"resolve allow patterns",input:({context:a})=>({initialUrl:a.initialUrl}),onError:{target:"error",actions:{type:"assign error",params:({event:a})=>({message:"Failed to resolve preview url allow patterns",error:a.error})}},onDone:{target:"resolvingUrlFromPreviewSearchParam",actions:(0,r.assign)({allowOrigins:({event:a})=>a.output})}},tags:["busy"]},resolvingUrlFromPreviewSearchParam:{id:"loop",invoke:{src:"resolve url from preview search param",input:({context:a})=>({initialUrl:a.initialUrl,allowOrigins:a.allowOrigins,previewSearchParam:a.previewSearchParam}),onError:{target:"error",actions:{type:"assign error",params:({event:a})=>({message:"Failed to resolve preview url from search param",error:a.error})}},onDone:{target:"resolvingPreviewMode",actions:(0,r.assign)({initialUrl:({event:a})=>a.output})}},tags:["busy"]},resolvingPreviewMode:{on:{"set preview search param":{guard:"search param has new origin",actions:{type:"assign preview search param",params:({event:a})=>({previewSearchParam:a.previewSearchParam})},target:"#loop",reenter:!0}},invoke:{src:"resolve preview mode",input:({context:a})=>({targetOrigin:a.initialUrl.origin}),onError:{target:"error",actions:{type:"assign error",params:({event:a})=>({message:"Failed to resolve preview url allow patterns",error:a.error})}},onDone:[{guard:{type:"has preview mode with created secret",params:({event:a})=>a.output},actions:(0,r.assign)({previewMode:({event:a})=>a.output}),target:"previewMode.createPreviewSecret"},{guard:{type:"has preview mode with share access",params:({event:a})=>a.output},actions:(0,r.assign)({previewMode:({event:a})=>a.output}),target:"previewMode.readShareAccess"},{guard:{type:"has preview mode without permissions",params:({event:a})=>a.output},actions:[(0,r.assign)({previewUrl:({context:a})=>a.initialUrl}),"notify preview will likely fail"],target:"success"},{actions:(0,r.assign)({previewUrl:({context:a})=>a.initialUrl}),target:"success"}]},tags:["busy"]},success:{on:{"set preview search param":{guard:"search param has new origin",actions:{type:"assign preview search param",params:({event:a})=>({previewSearchParam:a.previewSearchParam})},target:"#loop",reenter:!0}}},previewMode:{on:{"set preview search param":{guard:"search param has new origin",actions:{type:"assign preview search param",params:({event:a})=>({previewSearchParam:a.previewSearchParam})},target:"#loop",reenter:!0}},states:{createPreviewSecret:{invoke:{src:"create preview secret",onError:{target:"error",actions:{type:"assign error",params:({event:a})=>({message:"Failed to create preview secret",error:a.error})}},onDone:{target:"resolvePreviewUrl",actions:(0,r.assign)({previewUrlSecret:({event:a})=>a.output})}},tags:["busy"]},readShareAccess:{invoke:{src:"read shared preview secret",onError:{target:"error",actions:{type:"assign error",params:({event:a})=>({message:"Failed to read shared preview secret",error:a.error})}},onDone:{target:"resolvePreviewUrl",actions:(0,r.assign)({previewUrlSecret:({event:a})=>({secret:a.output,expiresAt:new Date(Date.now()+5184e6)})})}},tags:["busy"]},resolvePreviewUrl:{invoke:{src:"resolve preview mode url",input:({context:a})=>({initialUrl:a.initialUrl,resolvedPreviewMode:a.previewMode,previewUrlSecret:a.previewUrlSecret.secret}),onError:{target:"error",actions:{type:"assign error",params:({event:a})=>({message:"Failed to resolve preview url",error:a.error})}},onDone:{target:"success",actions:(0,r.assign)({previewUrl:({event:a})=>a.output})}},tags:["busy"]},error:{type:"final",tags:["error"]},success:{after:{expiredSecret:{guard:"can create preview secret",actions:(0,r.assign)({previewUrlSecret:null}),target:"createPreviewSecret",reenter:!0}}}},initial:"readShareAccess"}},initial:"checkingPermissions"});function b0(a){return"error"===a.status?a.error:a.hasTag("error")?a.context.error:null}function b1(a){return a.context.previewUrl?.origin}function b2(a){return a.context.allowOrigins}function b3(){return"ready"}function b4(f){let g,i=(0,c.c)(8),{tool:m}=f,o=function(b,f){let g,i,m,o,p,q,r=(0,c.c)(24),t=(0,l.useGrantsStore)();r[0]===Symbol.for("react.memo_cache_sentinel")?(g={apiVersion:e.API_VERSION},r[0]=g):g=r[0];let u=(0,l.useClient)(g),v=(0,l.useCurrentUser)()?.id,w=(0,l.useActiveWorkspace)()?.activeWorkspace?.basePath||"/",x=(0,n.useRouter)();r[1]!==x.state._searchParams?(i=new URLSearchParams(x.state._searchParams).get("preview"),r[1]=x.state._searchParams,r[2]=i):i=r[2];let y=i,{push:z}=(0,j.useToast)(),{t:A}=(0,l.useTranslation)(e.presentationLocaleNamespace),B=bI();if(r[3]!==f||r[4]!==u||r[5]!==v||r[6]!==t||r[7]!==B||r[8]!==b||r[9]!==z||r[10]!==w||r[11]!==A){let c,d;r[13]!==z||r[14]!==A?(c=()=>z({id:"preview-url-secret.missing-grants",closable:!0,status:"error",duration:1/0,title:A("preview-url-secret.missing-grants")}),r[13]=z,r[14]=A,r[15]=c):c=r[15],r[16]!==t?(d=a=>{let{input:b}=a;return t.checkDocumentPermission(b.checkPermissionName,b.document)},r[16]=t,r[17]=d):d=r[17],m=b_.provide({actions:{"notify preview will likely fail":c},actors:{"create preview secret":function({client:a,currentUserId:b}){return(0,s.fromPromise)(async()=>await X(a,"sanity/presentation",location.href,b))}({client:u,currentUserId:v}),"read shared preview secret":function({client:a}){return(0,s.fromPromise)(async()=>a.fetch(h.fetchSharedAccessQuery,{},{tag:"presentation.fallback-to-shared-access-secret"}))}({client:u}),"resolve allow patterns":function({client:b,allowOption:c}){return(0,s.fromPromise)(async({input:d})=>{let{initialUrl:e}=d;if(typeof URLPattern>"u"&&await a.A(308453),!c)return[new URLPattern(e.origin)];let f="function"==typeof c?await c({client:b,origin,initialUrl:e}):c,g=(Array.isArray(f)?f:[f]).map(a=>{let b=new URLPattern(a);if("*"===b.hostname)throw Error("It's insecure to allow any hostname, it could disclose data to a malicious site");return b});return g.some(a=>a.test(e.origin))?g:[...g,new URLPattern(e.origin)]})}({client:u,allowOption:f}),"resolve initial url":function({client:a,studioBasePath:b,previewUrlOption:c,perspective:d}){return(0,s.fromPromise)(async({input:e})=>{let{origin:f}=location;return"function"==typeof c?new URL(await c({client:a,studioBasePath:b,previewUrlSecret:"",studioPreviewPerspective:a_(d),previewSearchParam:e.previewSearchParam}),f):c?"string"==typeof c?new URL(c,f):"function"==typeof c.initial?new URL(await c.initial({client:a,origin:f}),f):"string"==typeof c.initial?new URL(c.initial,f):new URL(c.preview||"/",c.origin||f):new URL("/",f)})}({client:u,studioBasePath:w,previewUrlOption:b,perspective:B}),"resolve preview mode":function({client:a,previewUrlOption:b}){return(0,s.fromPromise)(async({input:c})=>{let{targetOrigin:d}=c;if("object"==typeof b&&b?.draftMode)return{enable:b.draftMode.enable,shareAccess:b.draftMode.shareAccess??!0};if(!b||"string"==typeof b||"function"==typeof b||!b.previewMode)return!1;let e="function"==typeof b.previewMode?await b.previewMode({client:a,origin,targetOrigin:d}):b.previewMode;return!1!==e&&{enable:e.enable,shareAccess:e.shareAccess??!0}})}({client:u,previewUrlOption:b}),"resolve preview mode url":function({client:a,studioBasePath:b,previewUrlOption:c,perspective:d}){return(0,s.fromPromise)(async({input:e})=>{let{previewUrlSecret:f,resolvedPreviewMode:g,initialUrl:i}=e;if("function"==typeof c)return new URL(await c({client:a,studioBasePath:b,previewUrlSecret:f,studioPreviewPerspective:a_(d),previewSearchParam:i.toString()}),i);if(!g)throw Error("Resolved preview mode is false");let j=new URL(g.enable,i);return j.searchParams.set(h.urlSearchParamPreviewSecret,f),j.searchParams.set(h.urlSearchParamPreviewPerspective,a_(d)),i.pathname!==j.pathname&&j.searchParams.set(h.urlSearchParamPreviewPathname,`${i.pathname}${i.search}${i.hash}`),j})}({client:u,studioBasePath:w,previewUrlOption:b,perspective:B}),"check permission":(0,s.fromObservable)(d)}}),r[3]=f,r[4]=u,r[5]=v,r[6]=t,r[7]=B,r[8]=b,r[9]=z,r[10]=w,r[11]=A,r[12]=m}else m=r[12];r[18]!==y?(o={input:{previewSearchParam:y}},r[18]=y,r[19]=o):o=r[19];let C=(0,d.useActorRef)(m,o);r[20]!==C||r[21]!==y?(p=()=>{C.send({type:"set preview search param",previewSearchParam:y})},q=[C,y],r[20]=C,r[21]=y,r[22]=p,r[23]=q):(p=r[22],q=r[23]),(0,k.useEffect)(p,q);let D=(0,d.useSelector)(C,b0);if(D)throw D;return C}(m.options?.previewUrl,m.options?.allowOrigins);!function(a){let f,g,h,i=(0,c.c)(9),{t:m}=(0,l.useTranslation)(e.presentationLocaleNamespace),{push:o}=(0,j.useToast)(),p=(0,n.useRouter)();i[0]!==p.state._searchParams?(f=new URLSearchParams(p.state._searchParams).get("preview"),i[0]=p.state._searchParams,i[1]=f):f=i[1];let q=f,r=(0,d.useSelector)(a,b2),s=(0,d.useSelector)(a,b1);i[2]!==r||i[3]!==s||i[4]!==q||i[5]!==o||i[6]!==m?(g=()=>{if(!Array.isArray(r)||!q||!s)return;let a=new URL(q,s).origin;r.some(b=>b.test(a))||o({closable:!0,id:`presentation-iframe-origin-mismatch-${a}`,status:"error",duration:1/0,title:m("preview-search-param.configuration.error.title"),description:(0,b.jsx)(l.Translate,{t:m,i18nKey:"preview-search-param.configuration.error.description",components:{Code:"code"},values:{previewSearchParam:q,blockedOrigin:a}})})},h=[r,s,q,o,m],i[2]=r,i[3]=s,i[4]=q,i[5]=o,i[6]=m,i[7]=g,i[8]=h):(g=i[7],h=i[8]),(0,k.useEffect)(g,h)}(o);let p=(0,d.useSelector)(o,b9),q=(0,d.useSelector)(o,b8),r=(0,d.useSelector)(o,b7),t=(0,d.useSelector)(o,b6),u=(0,d.useSelector)(o,b5),[v,w]=function(){let a,b,d,f,g=(0,c.c)(7);g[0]===Symbol.for("react.memo_cache_sentinel")?(a={apiVersion:e.API_VERSION},g[0]=a):a=g[0];let i=(0,l.useClient)(a),[j,m]=(0,k.useReducer)(b3,"loading"),[n,o]=(0,k.useState)(null);return g[1]!==i?(b=()=>{let a=function(a,b){let c=new AbortController,d=[];async function e(c,e){let{result:f,syncTags:g}=await a.fetch(h.fetchVercelProtectionBypassSecret,{},{filterResponse:!1,lastLiveEventId:c,tag:"preview-url-secret.fetch-vercel-bypass-protection-secret"});Array.isArray(g)&&(d=g),e.aborted||b(f)}let f=a.live.events().subscribe({next:a=>{"message"===a.type&&(c.abort(),c=new AbortController,a.tags.some(a=>d.includes(a))&&e(a.id,c.signal))},error:a=>console.error(a)});return e(null,c.signal),()=>{f.unsubscribe(),c.abort()}}(i,a=>{o(a),m()});return()=>a()},d=[i],g[1]=i,g[2]=b,g[3]=d):(b=g[2],d=g[3]),(0,k.useEffect)(b,d),g[4]!==j||g[5]!==n?(f=[n,j],g[4]=j,g[5]=n,g[6]=f):f=g[6],f}();if(!u||"loading"===w||!p||typeof p.granted>"u"||!q||typeof q.granted>"u"||!t||!r||typeof r.granted>"u"||typeof t.granted>"u"){let a;return i[0]===Symbol.for("react.memo_cache_sentinel")?(a=(0,b.jsx)(e.PresentationSpinner,{}),i[0]=a):a=i[0],a}let x=p?.granted===!0&&q?.granted===!0,y=r?.granted===!0;return i[1]!==o||i[2]!==x||i[3]!==y||i[4]!==m||i[5]!==u||i[6]!==v?(g=(0,b.jsx)(bV,{tool:m,initialPreviewUrl:u,vercelProtectionBypass:v,canToggleSharePreviewAccess:x,canUseSharedPreviewAccess:y,previewUrlRef:o}),i[1]=o,i[2]=x,i[3]=y,i[4]=m,i[5]=u,i[6]=v,i[7]=g):g=i[7],g}function b5(a){return a.context.previewUrl}function b6(a){return a.context.previewUrlSecretPermission}function b7(a){return a.context.previewAccessSharingReadPermission}function b8(a){return a.context.previewAccessSharingUpdatePermission}function b9(a){return a.context.previewAccessSharingCreatePermission}}];

//# sourceMappingURL=node_modules_sanity_lib__chunks-es_PresentationToolGrantsCheck_mjs_0d3d823f._.js.map